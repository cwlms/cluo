<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.1"/>
    <title>cluo.stages API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../cluo.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;cluo</a>

            <img src="https://static.wikia.nocookie.net/newersupermariobroswii/images/b/bf/Warp_pipe.png/revision/latest/scale-to-width-down/200?cb=20181227070915" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#ArrayFieldHasherStage">ArrayFieldHasherStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ArrayFieldHasherStage.__init__">ArrayFieldHasherStage</a>
                        </li>
                        <li>
                                <a class="function" href="#ArrayFieldHasherStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#BatchLimitExceededException">BatchLimitExceededException</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#BatchLimitStage">BatchLimitStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#BatchLimitStage.__init__">BatchLimitStage</a>
                        </li>
                        <li>
                                <a class="function" href="#BatchLimitStage.process_batch">process_batch</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#BranchStage">BranchStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#BranchStage.__init__">BranchStage</a>
                        </li>
                        <li>
                                <a class="function" href="#BranchStage.process_record">process_record</a>
                        </li>
                        <li>
                                <a class="function" href="#BranchStage.get_channels">get_channels</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CleanCurrencyStage">CleanCurrencyStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CleanCurrencyStage.__init__">CleanCurrencyStage</a>
                        </li>
                        <li>
                                <a class="function" href="#CleanCurrencyStage.process_field">process_field</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CleanUrlStage">CleanUrlStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CleanUrlStage.__init__">CleanUrlStage</a>
                        </li>
                        <li>
                                <a class="function" href="#CleanUrlStage.process_field">process_field</a>
                        </li>
                        <li>
                                <a class="function" href="#CleanUrlStage.clean_url">clean_url</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DedupeBatchStage">DedupeBatchStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DedupeBatchStage.__init__">DedupeBatchStage</a>
                        </li>
                        <li>
                                <a class="function" href="#DedupeBatchStage.process_batch">process_batch</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DropFieldsStage">DropFieldsStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DropFieldsStage.__init__">DropFieldsStage</a>
                        </li>
                        <li>
                                <a class="function" href="#DropFieldsStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EmptyBatchException">EmptyBatchException</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#EmptyBatchStage">EmptyBatchStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EmptyBatchStage.__init__">EmptyBatchStage</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyBatchStage.process_batch">process_batch</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EmptyStringNullifierStage">EmptyStringNullifierStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EmptyStringNullifierStage.__init__">EmptyStringNullifierStage</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyStringNullifierStage.process_field">process_field</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FieldHasherStage">FieldHasherStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FieldHasherStage.__init__">FieldHasherStage</a>
                        </li>
                        <li>
                                <a class="function" href="#FieldHasherStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FieldSurvivorshipStage">FieldSurvivorshipStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FieldSurvivorshipStage.__init__">FieldSurvivorshipStage</a>
                        </li>
                        <li>
                                <a class="function" href="#FieldSurvivorshipStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IdentityStage">IdentityStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#IdentityStage.__init__">IdentityStage</a>
                        </li>
                        <li>
                                <a class="function" href="#IdentityStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#KeepFieldsStage">KeepFieldsStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#KeepFieldsStage.__init__">KeepFieldsStage</a>
                        </li>
                        <li>
                                <a class="function" href="#KeepFieldsStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MasterMatchStage">MasterMatchStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MasterMatchStage.__init__">MasterMatchStage</a>
                        </li>
                        <li>
                                <a class="function" href="#MasterMatchStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MasterMatchStageV3_4">MasterMatchStageV3_4</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MasterMatchStageV3_4.__init__">MasterMatchStageV3_4</a>
                        </li>
                        <li>
                                <a class="function" href="#MasterMatchStageV3_4.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PhoneNumberParserStage">PhoneNumberParserStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PhoneNumberParserStage.__init__">PhoneNumberParserStage</a>
                        </li>
                        <li>
                                <a class="function" href="#PhoneNumberParserStage.process_field">process_field</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PostgresLookupStage">PostgresLookupStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PostgresLookupStage.__init__">PostgresLookupStage</a>
                        </li>
                        <li>
                                <a class="function" href="#PostgresLookupStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PostgresReferenceLookupStage">PostgresReferenceLookupStage</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#PythonCallableStage">PythonCallableStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PythonCallableStage.__init__">PythonCallableStage</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RedisLookupStage">RedisLookupStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RedisLookupStage.__init__">RedisLookupStage</a>
                        </li>
                        <li>
                                <a class="function" href="#RedisLookupStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RenameFieldsStage">RenameFieldsStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RenameFieldsStage.__init__">RenameFieldsStage</a>
                        </li>
                        <li>
                                <a class="function" href="#RenameFieldsStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SetToCurrentTimestampStage">SetToCurrentTimestampStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SetToCurrentTimestampStage.__init__">SetToCurrentTimestampStage</a>
                        </li>
                        <li>
                                <a class="function" href="#SetToCurrentTimestampStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SocialMediaUrlCleanerStage">SocialMediaUrlCleanerStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SocialMediaUrlCleanerStage.__init__">SocialMediaUrlCleanerStage</a>
                        </li>
                        <li>
                                <a class="function" href="#SocialMediaUrlCleanerStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SpecialCharacterCleanerStage">SpecialCharacterCleanerStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SpecialCharacterCleanerStage.__init__">SpecialCharacterCleanerStage</a>
                        </li>
                        <li>
                                <a class="function" href="#SpecialCharacterCleanerStage.process_field">process_field</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TypecastStage">TypecastStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TypecastStage.__init__">TypecastStage</a>
                        </li>
                        <li>
                                <a class="function" href="#TypecastStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#UpdateFieldsStage">UpdateFieldsStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#UpdateFieldsStage.__init__">UpdateFieldsStage</a>
                        </li>
                        <li>
                                <a class="function" href="#UpdateFieldsStage.process_record">process_record</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ValidateUrlStage">ValidateUrlStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ValidateUrlStage.__init__">ValidateUrlStage</a>
                        </li>
                        <li>
                                <a class="function" href="#ValidateUrlStage.process_field">process_field</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#WhitespaceTrimmerStage">WhitespaceTrimmerStage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#WhitespaceTrimmerStage.__init__">WhitespaceTrimmerStage</a>
                        </li>
                        <li>
                                <a class="function" href="#WhitespaceTrimmerStage.process_field">process_field</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../cluo.html">cluo</a><wbr>.stages    </h1>

                
                        <input id="mod-stages-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-stages-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">from</span> <span class="nn">.array_field_hasher</span> <span class="kn">import</span> <span class="n">ArrayFieldHasherStage</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="kn">from</span> <span class="nn">.batch_limit</span> <span class="kn">import</span> <span class="n">BatchLimitExceededException</span><span class="p">,</span> <span class="n">BatchLimitStage</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span> <span class="nn">.branch</span> <span class="kn">import</span> <span class="n">BranchStage</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span> <span class="nn">.clean_currency</span> <span class="kn">import</span> <span class="n">CleanCurrencyStage</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span> <span class="nn">.clean_url</span> <span class="kn">import</span> <span class="n">CleanUrlStage</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span> <span class="nn">.dedupe_batch</span> <span class="kn">import</span> <span class="n">DedupeBatchStage</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span> <span class="nn">.drop_fields</span> <span class="kn">import</span> <span class="n">DropFieldsStage</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span> <span class="nn">.empty_batch</span> <span class="kn">import</span> <span class="n">EmptyBatchException</span><span class="p">,</span> <span class="n">EmptyBatchStage</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span> <span class="nn">.empty_string_nullifier</span> <span class="kn">import</span> <span class="n">EmptyStringNullifierStage</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span> <span class="nn">.field_hasher</span> <span class="kn">import</span> <span class="n">FieldHasherStage</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span> <span class="nn">.field_survivorship</span> <span class="kn">import</span> <span class="n">FieldSurvivorshipStage</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span> <span class="nn">.identity</span> <span class="kn">import</span> <span class="n">IdentityStage</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="kn">from</span> <span class="nn">.keep_fields</span> <span class="kn">import</span> <span class="n">KeepFieldsStage</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="kn">from</span> <span class="nn">.master_match</span> <span class="kn">import</span> <span class="n">MasterMatchStage</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="kn">from</span> <span class="nn">.master_match_v3_4</span> <span class="kn">import</span> <span class="n">MasterMatchStageV3_4</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="kn">from</span> <span class="nn">.phone_number_parser</span> <span class="kn">import</span> <span class="n">PhoneNumberParserStage</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a><span class="kn">from</span> <span class="nn">.postgres_lookup</span> <span class="kn">import</span> <span class="n">PostgresLookupStage</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="kn">from</span> <span class="nn">.postgres_reference_lookup</span> <span class="kn">import</span> <span class="n">PostgresReferenceLookupStage</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a><span class="kn">from</span> <span class="nn">.python_callable</span> <span class="kn">import</span> <span class="n">PythonCallableStage</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="kn">from</span> <span class="nn">.redis_lookup</span> <span class="kn">import</span> <span class="n">RedisLookupStage</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a><span class="kn">from</span> <span class="nn">.rename_fields</span> <span class="kn">import</span> <span class="n">RenameFieldsStage</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="kn">from</span> <span class="nn">.set_to_current_timestamp</span> <span class="kn">import</span> <span class="n">SetToCurrentTimestampStage</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="kn">from</span> <span class="nn">.social_media_url_cleaner</span> <span class="kn">import</span> <span class="n">SocialMediaUrlCleanerStage</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a><span class="kn">from</span> <span class="nn">.special_character_cleaner</span> <span class="kn">import</span> <span class="n">SpecialCharacterCleanerStage</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="kn">from</span> <span class="nn">.type_cast</span> <span class="kn">import</span> <span class="n">TypecastStage</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a><span class="kn">from</span> <span class="nn">.update_fields</span> <span class="kn">import</span> <span class="n">UpdateFieldsStage</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a><span class="kn">from</span> <span class="nn">.validate_url</span> <span class="kn">import</span> <span class="n">ValidateUrlStage</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a><span class="kn">from</span> <span class="nn">.whitespace_trimmer</span> <span class="kn">import</span> <span class="n">WhitespaceTrimmerStage</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="s2">&quot;ArrayFieldHasherStage&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="s2">&quot;BatchLimitExceededException&quot;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="s2">&quot;BatchLimitStage&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="s2">&quot;BranchStage&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="s2">&quot;CleanCurrencyStage&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="s2">&quot;CleanUrlStage&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="s2">&quot;DedupeBatchStage&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="s2">&quot;DropFieldsStage&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="s2">&quot;EmptyBatchException&quot;</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="s2">&quot;EmptyBatchStage&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="s2">&quot;EmptyStringNullifierStage&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="s2">&quot;FieldHasherStage&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a>    <span class="s2">&quot;FieldSurvivorshipStage&quot;</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>    <span class="s2">&quot;IdentityStage&quot;</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a>    <span class="s2">&quot;KeepFieldsStage&quot;</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a>    <span class="s2">&quot;MasterMatchStage&quot;</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a>    <span class="s2">&quot;MasterMatchStageV3_4&quot;</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">48</span></a>    <span class="s2">&quot;PhoneNumberParserStage&quot;</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">49</span></a>    <span class="s2">&quot;PostgresLookupStage&quot;</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">50</span></a>    <span class="s2">&quot;PostgresReferenceLookupStage&quot;</span><span class="p">,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">51</span></a>    <span class="s2">&quot;PythonCallableStage&quot;</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">52</span></a>    <span class="s2">&quot;RedisLookupStage&quot;</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">53</span></a>    <span class="s2">&quot;RenameFieldsStage&quot;</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">54</span></a>    <span class="s2">&quot;SetToCurrentTimestampStage&quot;</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">55</span></a>    <span class="s2">&quot;SocialMediaUrlCleanerStage&quot;</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">56</span></a>    <span class="s2">&quot;SpecialCharacterCleanerStage&quot;</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">57</span></a>    <span class="s2">&quot;TypecastStage&quot;</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">58</span></a>    <span class="s2">&quot;UpdateFieldsStage&quot;</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">59</span></a>    <span class="s2">&quot;ValidateUrlStage&quot;</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">60</span></a>    <span class="s2">&quot;WhitespaceTrimmerStage&quot;</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">61</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="ArrayFieldHasherStage">
                            <input id="ArrayFieldHasherStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ArrayFieldHasherStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="ArrayFieldHasherStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArrayFieldHasherStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArrayFieldHasherStage-7"><a href="#ArrayFieldHasherStage-7"><span class="linenos"> 7</span></a><span class="k">class</span> <span class="nc">ArrayFieldHasherStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="ArrayFieldHasherStage-8"><a href="#ArrayFieldHasherStage-8"><span class="linenos"> 8</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Attach array of hashes of 1 or more fields to record.&quot;&quot;&quot;</span>
</span><span id="ArrayFieldHasherStage-9"><a href="#ArrayFieldHasherStage-9"><span class="linenos"> 9</span></a>
</span><span id="ArrayFieldHasherStage-10"><a href="#ArrayFieldHasherStage-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ArrayFieldHasherStage-11"><a href="#ArrayFieldHasherStage-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-12"><a href="#ArrayFieldHasherStage-12"><span class="linenos">12</span></a>        <span class="n">hash_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="ArrayFieldHasherStage-13"><a href="#ArrayFieldHasherStage-13"><span class="linenos">13</span></a>        <span class="n">hash_destination</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;array_hash&quot;</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-14"><a href="#ArrayFieldHasherStage-14"><span class="linenos">14</span></a>        <span class="n">hash_name_destination</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;array_hash_name&quot;</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-15"><a href="#ArrayFieldHasherStage-15"><span class="linenos">15</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-16"><a href="#ArrayFieldHasherStage-16"><span class="linenos">16</span></a>        <span class="n">hash_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-17"><a href="#ArrayFieldHasherStage-17"><span class="linenos">17</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-18"><a href="#ArrayFieldHasherStage-18"><span class="linenos">18</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-19"><a href="#ArrayFieldHasherStage-19"><span class="linenos">19</span></a>        <span class="n">streamsets_compatible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-20"><a href="#ArrayFieldHasherStage-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-21"><a href="#ArrayFieldHasherStage-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage-22"><a href="#ArrayFieldHasherStage-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArrayFieldHasherStage-23"><a href="#ArrayFieldHasherStage-23"><span class="linenos">23</span></a><span class="sd">        Initialize the `ArrayFieldHasherStage`.</span>
</span><span id="ArrayFieldHasherStage-24"><a href="#ArrayFieldHasherStage-24"><span class="linenos">24</span></a>
</span><span id="ArrayFieldHasherStage-25"><a href="#ArrayFieldHasherStage-25"><span class="linenos">25</span></a><span class="sd">        Args:</span>
</span><span id="ArrayFieldHasherStage-26"><a href="#ArrayFieldHasherStage-26"><span class="linenos">26</span></a><span class="sd">            hash_fields (list[list[str]]): Fields from which to create an array of hashes. Hashes in output hash array correspond one-to-one with inner lists of fields.</span>
</span><span id="ArrayFieldHasherStage-27"><a href="#ArrayFieldHasherStage-27"><span class="linenos">27</span></a><span class="sd">            hash_destination (str, optional): Record field in which to store the hashes. Will overwrite if field already exists. Defaults to &quot;array_hash&quot;.</span>
</span><span id="ArrayFieldHasherStage-28"><a href="#ArrayFieldHasherStage-28"><span class="linenos">28</span></a><span class="sd">            hash_name_destination (str | None, optional): Record field in which to store the array hash names. Defaults to &quot;array_hash_name&quot;.</span>
</span><span id="ArrayFieldHasherStage-29"><a href="#ArrayFieldHasherStage-29"><span class="linenos">29</span></a><span class="sd">            hash_nulls (bool, optional): Create hash when fields contain null values. Defaults to False.</span>
</span><span id="ArrayFieldHasherStage-30"><a href="#ArrayFieldHasherStage-30"><span class="linenos">30</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="ArrayFieldHasherStage-31"><a href="#ArrayFieldHasherStage-31"><span class="linenos">31</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="ArrayFieldHasherStage-32"><a href="#ArrayFieldHasherStage-32"><span class="linenos">32</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="ArrayFieldHasherStage-33"><a href="#ArrayFieldHasherStage-33"><span class="linenos">33</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="ArrayFieldHasherStage-34"><a href="#ArrayFieldHasherStage-34"><span class="linenos">34</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArrayFieldHasherStage-35"><a href="#ArrayFieldHasherStage-35"><span class="linenos">35</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ArrayFieldHasherStage-36"><a href="#ArrayFieldHasherStage-36"><span class="linenos">36</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-37"><a href="#ArrayFieldHasherStage-37"><span class="linenos">37</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-38"><a href="#ArrayFieldHasherStage-38"><span class="linenos">38</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-39"><a href="#ArrayFieldHasherStage-39"><span class="linenos">39</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-40"><a href="#ArrayFieldHasherStage-40"><span class="linenos">40</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage-41"><a href="#ArrayFieldHasherStage-41"><span class="linenos">41</span></a>        <span class="p">)</span>
</span><span id="ArrayFieldHasherStage-42"><a href="#ArrayFieldHasherStage-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span> <span class="o">=</span> <span class="n">hash_fields</span>
</span><span id="ArrayFieldHasherStage-43"><a href="#ArrayFieldHasherStage-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_destination</span> <span class="o">=</span> <span class="n">hash_destination</span>
</span><span id="ArrayFieldHasherStage-44"><a href="#ArrayFieldHasherStage-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_name_destination</span> <span class="o">=</span> <span class="n">hash_name_destination</span>
</span><span id="ArrayFieldHasherStage-45"><a href="#ArrayFieldHasherStage-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamsets_compatible</span> <span class="o">=</span> <span class="n">streamsets_compatible</span>
</span><span id="ArrayFieldHasherStage-46"><a href="#ArrayFieldHasherStage-46"><span class="linenos">46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_nulls</span> <span class="o">=</span> <span class="n">hash_nulls</span>
</span><span id="ArrayFieldHasherStage-47"><a href="#ArrayFieldHasherStage-47"><span class="linenos">47</span></a>
</span><span id="ArrayFieldHasherStage-48"><a href="#ArrayFieldHasherStage-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">_make_hash_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ArrayFieldHasherStage-49"><a href="#ArrayFieldHasherStage-49"><span class="linenos">49</span></a>        <span class="n">hash_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ArrayFieldHasherStage-50"><a href="#ArrayFieldHasherStage-50"><span class="linenos">50</span></a>        <span class="k">for</span> <span class="n">single_hash_fields</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage-51"><a href="#ArrayFieldHasherStage-51"><span class="linenos">51</span></a>            <span class="n">inputs_</span> <span class="o">=</span> <span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">single_hash_fields</span><span class="p">]</span>
</span><span id="ArrayFieldHasherStage-52"><a href="#ArrayFieldHasherStage-52"><span class="linenos">52</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_nulls</span> <span class="ow">or</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inputs_</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage-53"><a href="#ArrayFieldHasherStage-53"><span class="linenos">53</span></a>                <span class="n">hash_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">single_hash_fields</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_hash&quot;</span><span class="p">)</span>
</span><span id="ArrayFieldHasherStage-54"><a href="#ArrayFieldHasherStage-54"><span class="linenos">54</span></a>        <span class="k">return</span> <span class="n">hash_names</span>
</span><span id="ArrayFieldHasherStage-55"><a href="#ArrayFieldHasherStage-55"><span class="linenos">55</span></a>
</span><span id="ArrayFieldHasherStage-56"><a href="#ArrayFieldHasherStage-56"><span class="linenos">56</span></a>    <span class="k">def</span> <span class="nf">_make_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="ArrayFieldHasherStage-57"><a href="#ArrayFieldHasherStage-57"><span class="linenos">57</span></a>        <span class="n">hashes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ArrayFieldHasherStage-58"><a href="#ArrayFieldHasherStage-58"><span class="linenos">58</span></a>        <span class="c1"># generate streamsets hashes with nulls</span>
</span><span id="ArrayFieldHasherStage-59"><a href="#ArrayFieldHasherStage-59"><span class="linenos">59</span></a>        <span class="c1"># we will only pull out the ones we want</span>
</span><span id="ArrayFieldHasherStage-60"><a href="#ArrayFieldHasherStage-60"><span class="linenos">60</span></a>        <span class="n">streamsets_hashes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ArrayFieldHasherStage-61"><a href="#ArrayFieldHasherStage-61"><span class="linenos">61</span></a>            <span class="n">make_streamsets_hashes</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span><span class="p">,</span> <span class="n">allow_nulls</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ArrayFieldHasherStage-62"><a href="#ArrayFieldHasherStage-62"><span class="linenos">62</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamsets_compatible</span>
</span><span id="ArrayFieldHasherStage-63"><a href="#ArrayFieldHasherStage-63"><span class="linenos">63</span></a>            <span class="k">else</span> <span class="p">[]</span>
</span><span id="ArrayFieldHasherStage-64"><a href="#ArrayFieldHasherStage-64"><span class="linenos">64</span></a>        <span class="p">)</span>
</span><span id="ArrayFieldHasherStage-65"><a href="#ArrayFieldHasherStage-65"><span class="linenos">65</span></a>        <span class="k">for</span> <span class="n">hash_index</span><span class="p">,</span> <span class="n">single_hash_fields</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span><span class="p">):</span>
</span><span id="ArrayFieldHasherStage-66"><a href="#ArrayFieldHasherStage-66"><span class="linenos">66</span></a>            <span class="n">inputs_</span> <span class="o">=</span> <span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">single_hash_fields</span><span class="p">]</span>
</span><span id="ArrayFieldHasherStage-67"><a href="#ArrayFieldHasherStage-67"><span class="linenos">67</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_nulls</span> <span class="ow">or</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inputs_</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage-68"><a href="#ArrayFieldHasherStage-68"><span class="linenos">68</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamsets_compatible</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage-69"><a href="#ArrayFieldHasherStage-69"><span class="linenos">69</span></a>                    <span class="n">hashes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">streamsets_hashes</span><span class="p">[</span><span class="n">hash_index</span><span class="p">])</span>
</span><span id="ArrayFieldHasherStage-70"><a href="#ArrayFieldHasherStage-70"><span class="linenos">70</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage-71"><a href="#ArrayFieldHasherStage-71"><span class="linenos">71</span></a>                    <span class="n">hashes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hash_nested_primitive</span><span class="p">(</span><span class="n">inputs_</span><span class="p">))</span>
</span><span id="ArrayFieldHasherStage-72"><a href="#ArrayFieldHasherStage-72"><span class="linenos">72</span></a>        <span class="k">return</span> <span class="n">hashes</span>
</span><span id="ArrayFieldHasherStage-73"><a href="#ArrayFieldHasherStage-73"><span class="linenos">73</span></a>
</span><span id="ArrayFieldHasherStage-74"><a href="#ArrayFieldHasherStage-74"><span class="linenos">74</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage-75"><a href="#ArrayFieldHasherStage-75"><span class="linenos">75</span></a>        <span class="n">hashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_hashes</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="ArrayFieldHasherStage-76"><a href="#ArrayFieldHasherStage-76"><span class="linenos">76</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_destination</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashes</span>
</span><span id="ArrayFieldHasherStage-77"><a href="#ArrayFieldHasherStage-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_name_destination</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage-78"><a href="#ArrayFieldHasherStage-78"><span class="linenos">78</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_name_destination</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_hash_names</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="ArrayFieldHasherStage-79"><a href="#ArrayFieldHasherStage-79"><span class="linenos">79</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Attach array of hashes of 1 or more fields to record.</p>
</div>


                            <div id="ArrayFieldHasherStage.__init__" class="classattr">
                                        <input id="ArrayFieldHasherStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ArrayFieldHasherStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">hash_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">hash_destination</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;array_hash&#39;</span>,</span><span class="param">	<span class="n">hash_name_destination</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s1">&#39;array_hash_name&#39;</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">hash_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">streamsets_compatible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="ArrayFieldHasherStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArrayFieldHasherStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArrayFieldHasherStage.__init__-10"><a href="#ArrayFieldHasherStage.__init__-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ArrayFieldHasherStage.__init__-11"><a href="#ArrayFieldHasherStage.__init__-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-12"><a href="#ArrayFieldHasherStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">hash_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="ArrayFieldHasherStage.__init__-13"><a href="#ArrayFieldHasherStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">hash_destination</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;array_hash&quot;</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-14"><a href="#ArrayFieldHasherStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">hash_name_destination</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;array_hash_name&quot;</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-15"><a href="#ArrayFieldHasherStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-16"><a href="#ArrayFieldHasherStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">hash_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-17"><a href="#ArrayFieldHasherStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-18"><a href="#ArrayFieldHasherStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-19"><a href="#ArrayFieldHasherStage.__init__-19"><span class="linenos">19</span></a>        <span class="n">streamsets_compatible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-20"><a href="#ArrayFieldHasherStage.__init__-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-21"><a href="#ArrayFieldHasherStage.__init__-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage.__init__-22"><a href="#ArrayFieldHasherStage.__init__-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArrayFieldHasherStage.__init__-23"><a href="#ArrayFieldHasherStage.__init__-23"><span class="linenos">23</span></a><span class="sd">        Initialize the `ArrayFieldHasherStage`.</span>
</span><span id="ArrayFieldHasherStage.__init__-24"><a href="#ArrayFieldHasherStage.__init__-24"><span class="linenos">24</span></a>
</span><span id="ArrayFieldHasherStage.__init__-25"><a href="#ArrayFieldHasherStage.__init__-25"><span class="linenos">25</span></a><span class="sd">        Args:</span>
</span><span id="ArrayFieldHasherStage.__init__-26"><a href="#ArrayFieldHasherStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            hash_fields (list[list[str]]): Fields from which to create an array of hashes. Hashes in output hash array correspond one-to-one with inner lists of fields.</span>
</span><span id="ArrayFieldHasherStage.__init__-27"><a href="#ArrayFieldHasherStage.__init__-27"><span class="linenos">27</span></a><span class="sd">            hash_destination (str, optional): Record field in which to store the hashes. Will overwrite if field already exists. Defaults to &quot;array_hash&quot;.</span>
</span><span id="ArrayFieldHasherStage.__init__-28"><a href="#ArrayFieldHasherStage.__init__-28"><span class="linenos">28</span></a><span class="sd">            hash_name_destination (str | None, optional): Record field in which to store the array hash names. Defaults to &quot;array_hash_name&quot;.</span>
</span><span id="ArrayFieldHasherStage.__init__-29"><a href="#ArrayFieldHasherStage.__init__-29"><span class="linenos">29</span></a><span class="sd">            hash_nulls (bool, optional): Create hash when fields contain null values. Defaults to False.</span>
</span><span id="ArrayFieldHasherStage.__init__-30"><a href="#ArrayFieldHasherStage.__init__-30"><span class="linenos">30</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="ArrayFieldHasherStage.__init__-31"><a href="#ArrayFieldHasherStage.__init__-31"><span class="linenos">31</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="ArrayFieldHasherStage.__init__-32"><a href="#ArrayFieldHasherStage.__init__-32"><span class="linenos">32</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="ArrayFieldHasherStage.__init__-33"><a href="#ArrayFieldHasherStage.__init__-33"><span class="linenos">33</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="ArrayFieldHasherStage.__init__-34"><a href="#ArrayFieldHasherStage.__init__-34"><span class="linenos">34</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArrayFieldHasherStage.__init__-35"><a href="#ArrayFieldHasherStage.__init__-35"><span class="linenos">35</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ArrayFieldHasherStage.__init__-36"><a href="#ArrayFieldHasherStage.__init__-36"><span class="linenos">36</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-37"><a href="#ArrayFieldHasherStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-38"><a href="#ArrayFieldHasherStage.__init__-38"><span class="linenos">38</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-39"><a href="#ArrayFieldHasherStage.__init__-39"><span class="linenos">39</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-40"><a href="#ArrayFieldHasherStage.__init__-40"><span class="linenos">40</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="ArrayFieldHasherStage.__init__-41"><a href="#ArrayFieldHasherStage.__init__-41"><span class="linenos">41</span></a>        <span class="p">)</span>
</span><span id="ArrayFieldHasherStage.__init__-42"><a href="#ArrayFieldHasherStage.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span> <span class="o">=</span> <span class="n">hash_fields</span>
</span><span id="ArrayFieldHasherStage.__init__-43"><a href="#ArrayFieldHasherStage.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_destination</span> <span class="o">=</span> <span class="n">hash_destination</span>
</span><span id="ArrayFieldHasherStage.__init__-44"><a href="#ArrayFieldHasherStage.__init__-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_name_destination</span> <span class="o">=</span> <span class="n">hash_name_destination</span>
</span><span id="ArrayFieldHasherStage.__init__-45"><a href="#ArrayFieldHasherStage.__init__-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamsets_compatible</span> <span class="o">=</span> <span class="n">streamsets_compatible</span>
</span><span id="ArrayFieldHasherStage.__init__-46"><a href="#ArrayFieldHasherStage.__init__-46"><span class="linenos">46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_nulls</span> <span class="o">=</span> <span class="n">hash_nulls</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#ArrayFieldHasherStage">ArrayFieldHasherStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>hash_fields (list[list[str]]):</strong>  Fields from which to create an array of hashes. Hashes in output hash array correspond one-to-one with inner lists of fields.</li>
<li><strong>hash_destination (str, optional):</strong>  Record field in which to store the hashes. Will overwrite if field already exists. Defaults to "array_hash".</li>
<li><strong>hash_name_destination (str | None, optional):</strong>  Record field in which to store the array hash names. Defaults to "array_hash_name".</li>
<li><strong>hash_nulls (bool, optional):</strong>  Create hash when fields contain null values. Defaults to False.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="ArrayFieldHasherStage.process_record" class="classattr">
                                        <input id="ArrayFieldHasherStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="ArrayFieldHasherStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArrayFieldHasherStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArrayFieldHasherStage.process_record-74"><a href="#ArrayFieldHasherStage.process_record-74"><span class="linenos">74</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage.process_record-75"><a href="#ArrayFieldHasherStage.process_record-75"><span class="linenos">75</span></a>        <span class="n">hashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_hashes</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="ArrayFieldHasherStage.process_record-76"><a href="#ArrayFieldHasherStage.process_record-76"><span class="linenos">76</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_destination</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashes</span>
</span><span id="ArrayFieldHasherStage.process_record-77"><a href="#ArrayFieldHasherStage.process_record-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_name_destination</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArrayFieldHasherStage.process_record-78"><a href="#ArrayFieldHasherStage.process_record-78"><span class="linenos">78</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_name_destination</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_hash_names</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="ArrayFieldHasherStage.process_record-79"><a href="#ArrayFieldHasherStage.process_record-79"><span class="linenos">79</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="ArrayFieldHasherStage.unique_name" class="variable">unique_name</dd>
                <dd id="ArrayFieldHasherStage.pipeline" class="variable">pipeline</dd>
                <dd id="ArrayFieldHasherStage.add_downstream" class="function">add_downstream</dd>
                <dd id="ArrayFieldHasherStage.add_upstream" class="function">add_upstream</dd>
                <dd id="ArrayFieldHasherStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="ArrayFieldHasherStage.channels" class="variable">channels</dd>
                <dd id="ArrayFieldHasherStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="ArrayFieldHasherStage.log" class="variable">log</dd>
                <dd id="ArrayFieldHasherStage.reset_level" class="function">reset_level</dd>
                <dd id="ArrayFieldHasherStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="BatchLimitExceededException">
                            <input id="BatchLimitExceededException-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BatchLimitExceededException</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="BatchLimitExceededException-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BatchLimitExceededException"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BatchLimitExceededException-7"><a href="#BatchLimitExceededException-7"><span class="linenos"> 7</span></a><span class="k">class</span> <span class="nc">BatchLimitExceededException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="BatchLimitExceededException-8"><a href="#BatchLimitExceededException-8"><span class="linenos"> 8</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when pipeline is terminated due to batch limit&quot;&quot;&quot;</span>
</span><span id="BatchLimitExceededException-9"><a href="#BatchLimitExceededException-9"><span class="linenos"> 9</span></a>
</span><span id="BatchLimitExceededException-10"><a href="#BatchLimitExceededException-10"><span class="linenos">10</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Raised when pipeline is terminated due to batch limit</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="BatchLimitExceededException.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="BatchLimitExceededException.with_traceback" class="function">with_traceback</dd>
                <dd id="BatchLimitExceededException.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="BatchLimitStage">
                            <input id="BatchLimitStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BatchLimitStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="BatchLimitStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BatchLimitStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BatchLimitStage-13"><a href="#BatchLimitStage-13"><span class="linenos">13</span></a><span class="k">class</span> <span class="nc">BatchLimitStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="BatchLimitStage-14"><a href="#BatchLimitStage-14"><span class="linenos">14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raise an exception after a given number of batches.&quot;&quot;&quot;</span>
</span><span id="BatchLimitStage-15"><a href="#BatchLimitStage-15"><span class="linenos">15</span></a>
</span><span id="BatchLimitStage-16"><a href="#BatchLimitStage-16"><span class="linenos">16</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="BatchLimitStage-17"><a href="#BatchLimitStage-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BatchLimitStage-18"><a href="#BatchLimitStage-18"><span class="linenos">18</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BatchLimitStage-19"><a href="#BatchLimitStage-19"><span class="linenos">19</span></a>        <span class="n">batch_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="BatchLimitStage-20"><a href="#BatchLimitStage-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BatchLimitStage-21"><a href="#BatchLimitStage-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BatchLimitStage-22"><a href="#BatchLimitStage-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `BatchLimitStage`.</span>
</span><span id="BatchLimitStage-23"><a href="#BatchLimitStage-23"><span class="linenos">23</span></a><span class="sd">        WARNING: IN ORDER FOR THIS STAGE TO FUNCTION PROPERLY IT MUST BE IMMEDIATELY DOWNSTREAM OF ITS SOURCE STAGE:</span>
</span><span id="BatchLimitStage-24"><a href="#BatchLimitStage-24"><span class="linenos">24</span></a><span class="sd">        (source_stage &gt;&gt; empty_batch_stage)</span>
</span><span id="BatchLimitStage-25"><a href="#BatchLimitStage-25"><span class="linenos">25</span></a>
</span><span id="BatchLimitStage-26"><a href="#BatchLimitStage-26"><span class="linenos">26</span></a><span class="sd">        If you must place this stage upstream of a non-source stage, that stage must be instantiated with the process_empty_batches=True parameter.</span>
</span><span id="BatchLimitStage-27"><a href="#BatchLimitStage-27"><span class="linenos">27</span></a>
</span><span id="BatchLimitStage-28"><a href="#BatchLimitStage-28"><span class="linenos">28</span></a><span class="sd">        Args:</span>
</span><span id="BatchLimitStage-29"><a href="#BatchLimitStage-29"><span class="linenos">29</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="BatchLimitStage-30"><a href="#BatchLimitStage-30"><span class="linenos">30</span></a><span class="sd">            batch_limit(int, optional): Number of batches to process before raising BatchLimitExceeded exception.  Defaults to 10.  Does not raise if None or 0</span>
</span><span id="BatchLimitStage-31"><a href="#BatchLimitStage-31"><span class="linenos">31</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="BatchLimitStage-32"><a href="#BatchLimitStage-32"><span class="linenos">32</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BatchLimitStage-33"><a href="#BatchLimitStage-33"><span class="linenos">33</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="BatchLimitStage-34"><a href="#BatchLimitStage-34"><span class="linenos">34</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="BatchLimitStage-35"><a href="#BatchLimitStage-35"><span class="linenos">35</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="BatchLimitStage-36"><a href="#BatchLimitStage-36"><span class="linenos">36</span></a>            <span class="c1"># always one process: we want to count all batches</span>
</span><span id="BatchLimitStage-37"><a href="#BatchLimitStage-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="BatchLimitStage-38"><a href="#BatchLimitStage-38"><span class="linenos">38</span></a>            <span class="c1"># always raise an exception</span>
</span><span id="BatchLimitStage-39"><a href="#BatchLimitStage-39"><span class="linenos">39</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">,</span>
</span><span id="BatchLimitStage-40"><a href="#BatchLimitStage-40"><span class="linenos">40</span></a>            <span class="n">process_empty_batches</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="BatchLimitStage-41"><a href="#BatchLimitStage-41"><span class="linenos">41</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="BatchLimitStage-42"><a href="#BatchLimitStage-42"><span class="linenos">42</span></a>        <span class="p">)</span>
</span><span id="BatchLimitStage-43"><a href="#BatchLimitStage-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BatchLimitStage-44"><a href="#BatchLimitStage-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span> <span class="o">=</span> <span class="n">batch_limit</span>
</span><span id="BatchLimitStage-45"><a href="#BatchLimitStage-45"><span class="linenos">45</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="BatchLimitStage-46"><a href="#BatchLimitStage-46"><span class="linenos">46</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Batch limit must be greater than zero&quot;</span><span class="p">)</span>
</span><span id="BatchLimitStage-47"><a href="#BatchLimitStage-47"><span class="linenos">47</span></a>
</span><span id="BatchLimitStage-48"><a href="#BatchLimitStage-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="BatchLimitStage-49"><a href="#BatchLimitStage-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="BatchLimitStage-50"><a href="#BatchLimitStage-50"><span class="linenos">50</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span><span class="p">:</span>
</span><span id="BatchLimitStage-51"><a href="#BatchLimitStage-51"><span class="linenos">51</span></a>            <span class="k">raise</span> <span class="n">BatchLimitExceededException</span><span class="p">()</span>
</span><span id="BatchLimitStage-52"><a href="#BatchLimitStage-52"><span class="linenos">52</span></a>        <span class="k">return</span> <span class="n">batch</span>
</span></pre></div>


            <div class="docstring"><p>Raise an exception after a given number of batches.</p>
</div>


                            <div id="BatchLimitStage.__init__" class="classattr">
                                        <input id="BatchLimitStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">BatchLimitStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">batch_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="BatchLimitStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BatchLimitStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BatchLimitStage.__init__-16"><a href="#BatchLimitStage.__init__-16"><span class="linenos">16</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="BatchLimitStage.__init__-17"><a href="#BatchLimitStage.__init__-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-18"><a href="#BatchLimitStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-19"><a href="#BatchLimitStage.__init__-19"><span class="linenos">19</span></a>        <span class="n">batch_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-20"><a href="#BatchLimitStage.__init__-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-21"><a href="#BatchLimitStage.__init__-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BatchLimitStage.__init__-22"><a href="#BatchLimitStage.__init__-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `BatchLimitStage`.</span>
</span><span id="BatchLimitStage.__init__-23"><a href="#BatchLimitStage.__init__-23"><span class="linenos">23</span></a><span class="sd">        WARNING: IN ORDER FOR THIS STAGE TO FUNCTION PROPERLY IT MUST BE IMMEDIATELY DOWNSTREAM OF ITS SOURCE STAGE:</span>
</span><span id="BatchLimitStage.__init__-24"><a href="#BatchLimitStage.__init__-24"><span class="linenos">24</span></a><span class="sd">        (source_stage &gt;&gt; empty_batch_stage)</span>
</span><span id="BatchLimitStage.__init__-25"><a href="#BatchLimitStage.__init__-25"><span class="linenos">25</span></a>
</span><span id="BatchLimitStage.__init__-26"><a href="#BatchLimitStage.__init__-26"><span class="linenos">26</span></a><span class="sd">        If you must place this stage upstream of a non-source stage, that stage must be instantiated with the process_empty_batches=True parameter.</span>
</span><span id="BatchLimitStage.__init__-27"><a href="#BatchLimitStage.__init__-27"><span class="linenos">27</span></a>
</span><span id="BatchLimitStage.__init__-28"><a href="#BatchLimitStage.__init__-28"><span class="linenos">28</span></a><span class="sd">        Args:</span>
</span><span id="BatchLimitStage.__init__-29"><a href="#BatchLimitStage.__init__-29"><span class="linenos">29</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="BatchLimitStage.__init__-30"><a href="#BatchLimitStage.__init__-30"><span class="linenos">30</span></a><span class="sd">            batch_limit(int, optional): Number of batches to process before raising BatchLimitExceeded exception.  Defaults to 10.  Does not raise if None or 0</span>
</span><span id="BatchLimitStage.__init__-31"><a href="#BatchLimitStage.__init__-31"><span class="linenos">31</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="BatchLimitStage.__init__-32"><a href="#BatchLimitStage.__init__-32"><span class="linenos">32</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BatchLimitStage.__init__-33"><a href="#BatchLimitStage.__init__-33"><span class="linenos">33</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="BatchLimitStage.__init__-34"><a href="#BatchLimitStage.__init__-34"><span class="linenos">34</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-35"><a href="#BatchLimitStage.__init__-35"><span class="linenos">35</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-36"><a href="#BatchLimitStage.__init__-36"><span class="linenos">36</span></a>            <span class="c1"># always one process: we want to count all batches</span>
</span><span id="BatchLimitStage.__init__-37"><a href="#BatchLimitStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-38"><a href="#BatchLimitStage.__init__-38"><span class="linenos">38</span></a>            <span class="c1"># always raise an exception</span>
</span><span id="BatchLimitStage.__init__-39"><a href="#BatchLimitStage.__init__-39"><span class="linenos">39</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-40"><a href="#BatchLimitStage.__init__-40"><span class="linenos">40</span></a>            <span class="n">process_empty_batches</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-41"><a href="#BatchLimitStage.__init__-41"><span class="linenos">41</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="BatchLimitStage.__init__-42"><a href="#BatchLimitStage.__init__-42"><span class="linenos">42</span></a>        <span class="p">)</span>
</span><span id="BatchLimitStage.__init__-43"><a href="#BatchLimitStage.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BatchLimitStage.__init__-44"><a href="#BatchLimitStage.__init__-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span> <span class="o">=</span> <span class="n">batch_limit</span>
</span><span id="BatchLimitStage.__init__-45"><a href="#BatchLimitStage.__init__-45"><span class="linenos">45</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="BatchLimitStage.__init__-46"><a href="#BatchLimitStage.__init__-46"><span class="linenos">46</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Batch limit must be greater than zero&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#BatchLimitStage">BatchLimitStage</a></code>.
WARNING: IN ORDER FOR THIS STAGE TO FUNCTION PROPERLY IT MUST BE IMMEDIATELY DOWNSTREAM OF ITS SOURCE STAGE:
(source_stage &gt;&gt; empty_batch_stage)</p>

<p>If you must place this stage upstream of a non-source stage, that stage must be instantiated with the process_empty_batches=True parameter.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>batch_limit(int, optional):</strong>  Number of batches to process before raising BatchLimitExceeded exception.  Defaults to 10.  Does not raise if None or 0</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="BatchLimitStage.process_batch" class="classattr">
                                        <input id="BatchLimitStage.process_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_batch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span>:</span></span>

                <label class="view-source-button" for="BatchLimitStage.process_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BatchLimitStage.process_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BatchLimitStage.process_batch-48"><a href="#BatchLimitStage.process_batch-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="BatchLimitStage.process_batch-49"><a href="#BatchLimitStage.process_batch-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="BatchLimitStage.process_batch-50"><a href="#BatchLimitStage.process_batch-50"><span class="linenos">50</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_limit</span><span class="p">:</span>
</span><span id="BatchLimitStage.process_batch-51"><a href="#BatchLimitStage.process_batch-51"><span class="linenos">51</span></a>            <span class="k">raise</span> <span class="n">BatchLimitExceededException</span><span class="p">()</span>
</span><span id="BatchLimitStage.process_batch-52"><a href="#BatchLimitStage.process_batch-52"><span class="linenos">52</span></a>        <span class="k">return</span> <span class="n">batch</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="BatchLimitStage.unique_name" class="variable">unique_name</dd>
                <dd id="BatchLimitStage.pipeline" class="variable">pipeline</dd>
                <dd id="BatchLimitStage.add_downstream" class="function">add_downstream</dd>
                <dd id="BatchLimitStage.add_upstream" class="function">add_upstream</dd>
                <dd id="BatchLimitStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="BatchLimitStage.channels" class="variable">channels</dd>
                <dd id="BatchLimitStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="BatchLimitStage.log" class="variable">log</dd>
                <dd id="BatchLimitStage.reset_level" class="function">reset_level</dd>
                <dd id="BatchLimitStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="BranchStage">
                            <input id="BranchStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BranchStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="BranchStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BranchStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BranchStage-13"><a href="#BranchStage-13"><span class="linenos">13</span></a><span class="k">class</span> <span class="nc">BranchStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="BranchStage-14"><a href="#BranchStage-14"><span class="linenos">14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Stage that supports routing records to one of more channels.&quot;&quot;&quot;</span>
</span><span id="BranchStage-15"><a href="#BranchStage-15"><span class="linenos">15</span></a>
</span><span id="BranchStage-16"><a href="#BranchStage-16"><span class="linenos">16</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="BranchStage-17"><a href="#BranchStage-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BranchStage-18"><a href="#BranchStage-18"><span class="linenos">18</span></a>        <span class="n">channel_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Record</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]],</span>
</span><span id="BranchStage-19"><a href="#BranchStage-19"><span class="linenos">19</span></a>        <span class="n">single_channel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="BranchStage-20"><a href="#BranchStage-20"><span class="linenos">20</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BranchStage-21"><a href="#BranchStage-21"><span class="linenos">21</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="BranchStage-22"><a href="#BranchStage-22"><span class="linenos">22</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="BranchStage-23"><a href="#BranchStage-23"><span class="linenos">23</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BranchStage-24"><a href="#BranchStage-24"><span class="linenos">24</span></a>    <span class="p">):</span>
</span><span id="BranchStage-25"><a href="#BranchStage-25"><span class="linenos">25</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `BranchStage`.</span>
</span><span id="BranchStage-26"><a href="#BranchStage-26"><span class="linenos">26</span></a>
</span><span id="BranchStage-27"><a href="#BranchStage-27"><span class="linenos">27</span></a><span class="sd">        Args:</span>
</span><span id="BranchStage-28"><a href="#BranchStage-28"><span class="linenos">28</span></a><span class="sd">            channel_mapping (dict[str], Callable[[Record]], bool]): A dictionary of functions where the key is a channel name and the value is a function that returns a boolean representing whether a record is sent to that channel or not.</span>
</span><span id="BranchStage-29"><a href="#BranchStage-29"><span class="linenos">29</span></a><span class="sd">            single_channel(bool): If this flag is True the a record will only be sent to a single channel instead of all channels whose function returns true. This will be done in order `channel_mapping` since dictionaries are now sortable in Python 3.6+.</span>
</span><span id="BranchStage-30"><a href="#BranchStage-30"><span class="linenos">30</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="BranchStage-31"><a href="#BranchStage-31"><span class="linenos">31</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="BranchStage-32"><a href="#BranchStage-32"><span class="linenos">32</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="BranchStage-33"><a href="#BranchStage-33"><span class="linenos">33</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="BranchStage-34"><a href="#BranchStage-34"><span class="linenos">34</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BranchStage-35"><a href="#BranchStage-35"><span class="linenos">35</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="BranchStage-36"><a href="#BranchStage-36"><span class="linenos">36</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="BranchStage-37"><a href="#BranchStage-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="BranchStage-38"><a href="#BranchStage-38"><span class="linenos">38</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="BranchStage-39"><a href="#BranchStage-39"><span class="linenos">39</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="BranchStage-40"><a href="#BranchStage-40"><span class="linenos">40</span></a>        <span class="p">)</span>
</span><span id="BranchStage-41"><a href="#BranchStage-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">downstreams</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Stage</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="BranchStage-42"><a href="#BranchStage-42"><span class="linenos">42</span></a>            <span class="n">k</span><span class="p">:</span> <span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">channel_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="BranchStage-43"><a href="#BranchStage-43"><span class="linenos">43</span></a>        <span class="p">}</span>
</span><span id="BranchStage-44"><a href="#BranchStage-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">channel_mappings</span> <span class="o">=</span> <span class="n">channel_mapping</span>
</span><span id="BranchStage-45"><a href="#BranchStage-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">single_channel</span> <span class="o">=</span> <span class="n">single_channel</span>
</span><span id="BranchStage-46"><a href="#BranchStage-46"><span class="linenos">46</span></a>
</span><span id="BranchStage-47"><a href="#BranchStage-47"><span class="linenos">47</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">):</span>
</span><span id="BranchStage-48"><a href="#BranchStage-48"><span class="linenos">48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implements the identity map on records.&quot;&quot;&quot;</span>
</span><span id="BranchStage-49"><a href="#BranchStage-49"><span class="linenos">49</span></a>        <span class="k">return</span> <span class="n">record</span>
</span><span id="BranchStage-50"><a href="#BranchStage-50"><span class="linenos">50</span></a>
</span><span id="BranchStage-51"><a href="#BranchStage-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="nf">get_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="BranchStage-52"><a href="#BranchStage-52"><span class="linenos">52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps the record to it&#39;s downstream channels.&quot;&quot;&quot;</span>
</span><span id="BranchStage-53"><a href="#BranchStage-53"><span class="linenos">53</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_channel</span><span class="p">:</span>
</span><span id="BranchStage-54"><a href="#BranchStage-54"><span class="linenos">54</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_first_channel</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="BranchStage-55"><a href="#BranchStage-55"><span class="linenos">55</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BranchStage-56"><a href="#BranchStage-56"><span class="linenos">56</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_channels</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="BranchStage-57"><a href="#BranchStage-57"><span class="linenos">57</span></a>
</span><span id="BranchStage-58"><a href="#BranchStage-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">_get_first_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="BranchStage-59"><a href="#BranchStage-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for when we only want ta record to go into a single channel.&quot;&quot;&quot;</span>
</span><span id="BranchStage-60"><a href="#BranchStage-60"><span class="linenos">60</span></a>        <span class="k">for</span> <span class="n">channel</span><span class="p">,</span> <span class="n">mapper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="BranchStage-61"><a href="#BranchStage-61"><span class="linenos">61</span></a>            <span class="k">if</span> <span class="n">mapper</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
</span><span id="BranchStage-62"><a href="#BranchStage-62"><span class="linenos">62</span></a>                <span class="k">return</span> <span class="p">[</span><span class="n">channel</span><span class="p">]</span>
</span><span id="BranchStage-63"><a href="#BranchStage-63"><span class="linenos">63</span></a>        <span class="k">raise</span> <span class="n">NoChannelSelectedException</span><span class="p">(</span>
</span><span id="BranchStage-64"><a href="#BranchStage-64"><span class="linenos">64</span></a>            <span class="sa">f</span><span class="s2">&quot;This record was not assigned to a channel: </span><span class="si">{</span><span class="n">record</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="BranchStage-65"><a href="#BranchStage-65"><span class="linenos">65</span></a>        <span class="p">)</span>
</span><span id="BranchStage-66"><a href="#BranchStage-66"><span class="linenos">66</span></a>
</span><span id="BranchStage-67"><a href="#BranchStage-67"><span class="linenos">67</span></a>    <span class="k">def</span> <span class="nf">_get_all_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="BranchStage-68"><a href="#BranchStage-68"><span class="linenos">68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for when we want to allow a record to go into multiple channels.&quot;&quot;&quot;</span>
</span><span id="BranchStage-69"><a href="#BranchStage-69"><span class="linenos">69</span></a>        <span class="n">record_channels</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="BranchStage-70"><a href="#BranchStage-70"><span class="linenos">70</span></a>            <span class="n">channel</span>
</span><span id="BranchStage-71"><a href="#BranchStage-71"><span class="linenos">71</span></a>            <span class="k">for</span> <span class="n">channel</span><span class="p">,</span> <span class="n">mapper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="BranchStage-72"><a href="#BranchStage-72"><span class="linenos">72</span></a>            <span class="k">if</span> <span class="n">mapper</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="BranchStage-73"><a href="#BranchStage-73"><span class="linenos">73</span></a>        <span class="p">]</span>
</span><span id="BranchStage-74"><a href="#BranchStage-74"><span class="linenos">74</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record_channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="BranchStage-75"><a href="#BranchStage-75"><span class="linenos">75</span></a>            <span class="k">raise</span> <span class="n">NoChannelSelectedException</span><span class="p">(</span>
</span><span id="BranchStage-76"><a href="#BranchStage-76"><span class="linenos">76</span></a>                <span class="sa">f</span><span class="s2">&quot;This record was not assigned to a channel: </span><span class="si">{</span><span class="n">record</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="BranchStage-77"><a href="#BranchStage-77"><span class="linenos">77</span></a>            <span class="p">)</span>
</span><span id="BranchStage-78"><a href="#BranchStage-78"><span class="linenos">78</span></a>        <span class="k">return</span> <span class="n">record_channels</span>
</span></pre></div>


            <div class="docstring"><p>Stage that supports routing records to one of more channels.</p>
</div>


                            <div id="BranchStage.__init__" class="classattr">
                                        <input id="BranchStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">BranchStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">channel_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span>,</span><span class="param">	<span class="n">single_channel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="BranchStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BranchStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BranchStage.__init__-16"><a href="#BranchStage.__init__-16"><span class="linenos">16</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="BranchStage.__init__-17"><a href="#BranchStage.__init__-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BranchStage.__init__-18"><a href="#BranchStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">channel_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Record</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]],</span>
</span><span id="BranchStage.__init__-19"><a href="#BranchStage.__init__-19"><span class="linenos">19</span></a>        <span class="n">single_channel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="BranchStage.__init__-20"><a href="#BranchStage.__init__-20"><span class="linenos">20</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BranchStage.__init__-21"><a href="#BranchStage.__init__-21"><span class="linenos">21</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="BranchStage.__init__-22"><a href="#BranchStage.__init__-22"><span class="linenos">22</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="BranchStage.__init__-23"><a href="#BranchStage.__init__-23"><span class="linenos">23</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BranchStage.__init__-24"><a href="#BranchStage.__init__-24"><span class="linenos">24</span></a>    <span class="p">):</span>
</span><span id="BranchStage.__init__-25"><a href="#BranchStage.__init__-25"><span class="linenos">25</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `BranchStage`.</span>
</span><span id="BranchStage.__init__-26"><a href="#BranchStage.__init__-26"><span class="linenos">26</span></a>
</span><span id="BranchStage.__init__-27"><a href="#BranchStage.__init__-27"><span class="linenos">27</span></a><span class="sd">        Args:</span>
</span><span id="BranchStage.__init__-28"><a href="#BranchStage.__init__-28"><span class="linenos">28</span></a><span class="sd">            channel_mapping (dict[str], Callable[[Record]], bool]): A dictionary of functions where the key is a channel name and the value is a function that returns a boolean representing whether a record is sent to that channel or not.</span>
</span><span id="BranchStage.__init__-29"><a href="#BranchStage.__init__-29"><span class="linenos">29</span></a><span class="sd">            single_channel(bool): If this flag is True the a record will only be sent to a single channel instead of all channels whose function returns true. This will be done in order `channel_mapping` since dictionaries are now sortable in Python 3.6+.</span>
</span><span id="BranchStage.__init__-30"><a href="#BranchStage.__init__-30"><span class="linenos">30</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="BranchStage.__init__-31"><a href="#BranchStage.__init__-31"><span class="linenos">31</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="BranchStage.__init__-32"><a href="#BranchStage.__init__-32"><span class="linenos">32</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="BranchStage.__init__-33"><a href="#BranchStage.__init__-33"><span class="linenos">33</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="BranchStage.__init__-34"><a href="#BranchStage.__init__-34"><span class="linenos">34</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BranchStage.__init__-35"><a href="#BranchStage.__init__-35"><span class="linenos">35</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="BranchStage.__init__-36"><a href="#BranchStage.__init__-36"><span class="linenos">36</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="BranchStage.__init__-37"><a href="#BranchStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="BranchStage.__init__-38"><a href="#BranchStage.__init__-38"><span class="linenos">38</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="BranchStage.__init__-39"><a href="#BranchStage.__init__-39"><span class="linenos">39</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="BranchStage.__init__-40"><a href="#BranchStage.__init__-40"><span class="linenos">40</span></a>        <span class="p">)</span>
</span><span id="BranchStage.__init__-41"><a href="#BranchStage.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">downstreams</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Stage</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="BranchStage.__init__-42"><a href="#BranchStage.__init__-42"><span class="linenos">42</span></a>            <span class="n">k</span><span class="p">:</span> <span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">channel_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="BranchStage.__init__-43"><a href="#BranchStage.__init__-43"><span class="linenos">43</span></a>        <span class="p">}</span>
</span><span id="BranchStage.__init__-44"><a href="#BranchStage.__init__-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">channel_mappings</span> <span class="o">=</span> <span class="n">channel_mapping</span>
</span><span id="BranchStage.__init__-45"><a href="#BranchStage.__init__-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">single_channel</span> <span class="o">=</span> <span class="n">single_channel</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#BranchStage">BranchStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>channel_mapping (dict[str], Callable[[Record]], bool]):</strong>  A dictionary of functions where the key is a channel name and the value is a function that returns a boolean representing whether a record is sent to that channel or not.</li>
<li><strong>single_channel(bool):</strong>  If this flag is True the a record will only be sent to a single channel instead of all channels whose function returns true. This will be done in order <code>channel_mapping</code> since dictionaries are now sortable in Python 3.6+.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="BranchStage.process_record" class="classattr">
                                        <input id="BranchStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BranchStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BranchStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BranchStage.process_record-47"><a href="#BranchStage.process_record-47"><span class="linenos">47</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">):</span>
</span><span id="BranchStage.process_record-48"><a href="#BranchStage.process_record-48"><span class="linenos">48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implements the identity map on records.&quot;&quot;&quot;</span>
</span><span id="BranchStage.process_record-49"><a href="#BranchStage.process_record-49"><span class="linenos">49</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Implements the identity map on records.</p>
</div>


                            </div>
                            <div id="BranchStage.get_channels" class="classattr">
                                        <input id="BranchStage.get_channels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_channels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="BranchStage.get_channels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BranchStage.get_channels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BranchStage.get_channels-51"><a href="#BranchStage.get_channels-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="nf">get_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="BranchStage.get_channels-52"><a href="#BranchStage.get_channels-52"><span class="linenos">52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps the record to it&#39;s downstream channels.&quot;&quot;&quot;</span>
</span><span id="BranchStage.get_channels-53"><a href="#BranchStage.get_channels-53"><span class="linenos">53</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_channel</span><span class="p">:</span>
</span><span id="BranchStage.get_channels-54"><a href="#BranchStage.get_channels-54"><span class="linenos">54</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_first_channel</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="BranchStage.get_channels-55"><a href="#BranchStage.get_channels-55"><span class="linenos">55</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BranchStage.get_channels-56"><a href="#BranchStage.get_channels-56"><span class="linenos">56</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_channels</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Maps the record to it's downstream channels.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="BranchStage.unique_name" class="variable">unique_name</dd>
                <dd id="BranchStage.pipeline" class="variable">pipeline</dd>
                <dd id="BranchStage.add_downstream" class="function">add_downstream</dd>
                <dd id="BranchStage.add_upstream" class="function">add_upstream</dd>
                <dd id="BranchStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="BranchStage.channels" class="variable">channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="BranchStage.log" class="variable">log</dd>
                <dd id="BranchStage.reset_level" class="function">reset_level</dd>
                <dd id="BranchStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CleanCurrencyStage">
                            <input id="CleanCurrencyStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CleanCurrencyStage</span><wbr>(<span class="base">cluo.extensions.field_processor_stage.FieldProcessorStage</span>):

                <label class="view-source-button" for="CleanCurrencyStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CleanCurrencyStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CleanCurrencyStage-8"><a href="#CleanCurrencyStage-8"><span class="linenos"> 8</span></a><span class="k">class</span> <span class="nc">CleanCurrencyStage</span><span class="p">(</span><span class="n">FieldProcessorStage</span><span class="p">):</span>
</span><span id="CleanCurrencyStage-9"><a href="#CleanCurrencyStage-9"><span class="linenos"> 9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cleans currency values. Strips whitespace and converts to uppercase.&quot;&quot;&quot;</span>
</span><span id="CleanCurrencyStage-10"><a href="#CleanCurrencyStage-10"><span class="linenos">10</span></a>
</span><span id="CleanCurrencyStage-11"><a href="#CleanCurrencyStage-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CleanCurrencyStage-12"><a href="#CleanCurrencyStage-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-13"><a href="#CleanCurrencyStage-13"><span class="linenos">13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-14"><a href="#CleanCurrencyStage-14"><span class="linenos">14</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-15"><a href="#CleanCurrencyStage-15"><span class="linenos">15</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-16"><a href="#CleanCurrencyStage-16"><span class="linenos">16</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-17"><a href="#CleanCurrencyStage-17"><span class="linenos">17</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-18"><a href="#CleanCurrencyStage-18"><span class="linenos">18</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-19"><a href="#CleanCurrencyStage-19"><span class="linenos">19</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CleanCurrencyStage-20"><a href="#CleanCurrencyStage-20"><span class="linenos">20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize `CleanCurrencyStage`.</span>
</span><span id="CleanCurrencyStage-21"><a href="#CleanCurrencyStage-21"><span class="linenos">21</span></a>
</span><span id="CleanCurrencyStage-22"><a href="#CleanCurrencyStage-22"><span class="linenos">22</span></a><span class="sd">        Args:</span>
</span><span id="CleanCurrencyStage-23"><a href="#CleanCurrencyStage-23"><span class="linenos">23</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="CleanCurrencyStage-24"><a href="#CleanCurrencyStage-24"><span class="linenos">24</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="CleanCurrencyStage-25"><a href="#CleanCurrencyStage-25"><span class="linenos">25</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="CleanCurrencyStage-26"><a href="#CleanCurrencyStage-26"><span class="linenos">26</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="CleanCurrencyStage-27"><a href="#CleanCurrencyStage-27"><span class="linenos">27</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="CleanCurrencyStage-28"><a href="#CleanCurrencyStage-28"><span class="linenos">28</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="CleanCurrencyStage-29"><a href="#CleanCurrencyStage-29"><span class="linenos">29</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CleanCurrencyStage-30"><a href="#CleanCurrencyStage-30"><span class="linenos">30</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CleanCurrencyStage-31"><a href="#CleanCurrencyStage-31"><span class="linenos">31</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-32"><a href="#CleanCurrencyStage-32"><span class="linenos">32</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-33"><a href="#CleanCurrencyStage-33"><span class="linenos">33</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-34"><a href="#CleanCurrencyStage-34"><span class="linenos">34</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-35"><a href="#CleanCurrencyStage-35"><span class="linenos">35</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-36"><a href="#CleanCurrencyStage-36"><span class="linenos">36</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-37"><a href="#CleanCurrencyStage-37"><span class="linenos">37</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="CleanCurrencyStage-38"><a href="#CleanCurrencyStage-38"><span class="linenos">38</span></a>        <span class="p">)</span>
</span><span id="CleanCurrencyStage-39"><a href="#CleanCurrencyStage-39"><span class="linenos">39</span></a>
</span><span id="CleanCurrencyStage-40"><a href="#CleanCurrencyStage-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="CleanCurrencyStage-41"><a href="#CleanCurrencyStage-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">field_value</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Cleans currency values. Strips whitespace and converts to uppercase.</p>
</div>


                            <div id="CleanCurrencyStage.__init__" class="classattr">
                                        <input id="CleanCurrencyStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CleanCurrencyStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="CleanCurrencyStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CleanCurrencyStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CleanCurrencyStage.__init__-11"><a href="#CleanCurrencyStage.__init__-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CleanCurrencyStage.__init__-12"><a href="#CleanCurrencyStage.__init__-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-13"><a href="#CleanCurrencyStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-14"><a href="#CleanCurrencyStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-15"><a href="#CleanCurrencyStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-16"><a href="#CleanCurrencyStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-17"><a href="#CleanCurrencyStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-18"><a href="#CleanCurrencyStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-19"><a href="#CleanCurrencyStage.__init__-19"><span class="linenos">19</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CleanCurrencyStage.__init__-20"><a href="#CleanCurrencyStage.__init__-20"><span class="linenos">20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize `CleanCurrencyStage`.</span>
</span><span id="CleanCurrencyStage.__init__-21"><a href="#CleanCurrencyStage.__init__-21"><span class="linenos">21</span></a>
</span><span id="CleanCurrencyStage.__init__-22"><a href="#CleanCurrencyStage.__init__-22"><span class="linenos">22</span></a><span class="sd">        Args:</span>
</span><span id="CleanCurrencyStage.__init__-23"><a href="#CleanCurrencyStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="CleanCurrencyStage.__init__-24"><a href="#CleanCurrencyStage.__init__-24"><span class="linenos">24</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="CleanCurrencyStage.__init__-25"><a href="#CleanCurrencyStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="CleanCurrencyStage.__init__-26"><a href="#CleanCurrencyStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="CleanCurrencyStage.__init__-27"><a href="#CleanCurrencyStage.__init__-27"><span class="linenos">27</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="CleanCurrencyStage.__init__-28"><a href="#CleanCurrencyStage.__init__-28"><span class="linenos">28</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="CleanCurrencyStage.__init__-29"><a href="#CleanCurrencyStage.__init__-29"><span class="linenos">29</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CleanCurrencyStage.__init__-30"><a href="#CleanCurrencyStage.__init__-30"><span class="linenos">30</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CleanCurrencyStage.__init__-31"><a href="#CleanCurrencyStage.__init__-31"><span class="linenos">31</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-32"><a href="#CleanCurrencyStage.__init__-32"><span class="linenos">32</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-33"><a href="#CleanCurrencyStage.__init__-33"><span class="linenos">33</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-34"><a href="#CleanCurrencyStage.__init__-34"><span class="linenos">34</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-35"><a href="#CleanCurrencyStage.__init__-35"><span class="linenos">35</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-36"><a href="#CleanCurrencyStage.__init__-36"><span class="linenos">36</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-37"><a href="#CleanCurrencyStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="CleanCurrencyStage.__init__-38"><a href="#CleanCurrencyStage.__init__-38"><span class="linenos">38</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize <code><a href="#CleanCurrencyStage">CleanCurrencyStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (Iterable[str], optional):</strong>  Fields to operate on. Will operate on all fields if not set (None).</li>
<li><strong>allow_nulls (bool, optional):</strong>  Allow null values/fields if True, otherwise use error_handling_method</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="CleanCurrencyStage.process_field" class="classattr">
                                        <input id="CleanCurrencyStage.process_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="CleanCurrencyStage.process_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CleanCurrencyStage.process_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CleanCurrencyStage.process_field-40"><a href="#CleanCurrencyStage.process_field-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="CleanCurrencyStage.process_field-41"><a href="#CleanCurrencyStage.process_field-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">field_value</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.extensions.field_processor_stage.FieldProcessorStage</dt>
                                <dd id="CleanCurrencyStage.process_record" class="function">process_record</dd>

            </div>
            <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="CleanCurrencyStage.unique_name" class="variable">unique_name</dd>
                <dd id="CleanCurrencyStage.pipeline" class="variable">pipeline</dd>
                <dd id="CleanCurrencyStage.add_downstream" class="function">add_downstream</dd>
                <dd id="CleanCurrencyStage.add_upstream" class="function">add_upstream</dd>
                <dd id="CleanCurrencyStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="CleanCurrencyStage.channels" class="variable">channels</dd>
                <dd id="CleanCurrencyStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="CleanCurrencyStage.log" class="variable">log</dd>
                <dd id="CleanCurrencyStage.reset_level" class="function">reset_level</dd>
                <dd id="CleanCurrencyStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CleanUrlStage">
                            <input id="CleanUrlStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CleanUrlStage</span><wbr>(<span class="base">cluo.extensions.field_processor_stage.FieldProcessorStage</span>):

                <label class="view-source-button" for="CleanUrlStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CleanUrlStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CleanUrlStage-10"><a href="#CleanUrlStage-10"><span class="linenos"> 10</span></a><span class="k">class</span> <span class="nc">CleanUrlStage</span><span class="p">(</span><span class="n">FieldProcessorStage</span><span class="p">):</span>
</span><span id="CleanUrlStage-11"><a href="#CleanUrlStage-11"><span class="linenos"> 11</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse and standardize URL format.&quot;&quot;&quot;</span>
</span><span id="CleanUrlStage-12"><a href="#CleanUrlStage-12"><span class="linenos"> 12</span></a>
</span><span id="CleanUrlStage-13"><a href="#CleanUrlStage-13"><span class="linenos"> 13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CleanUrlStage-14"><a href="#CleanUrlStage-14"><span class="linenos"> 14</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanUrlStage-15"><a href="#CleanUrlStage-15"><span class="linenos"> 15</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CleanUrlStage-16"><a href="#CleanUrlStage-16"><span class="linenos"> 16</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage-17"><a href="#CleanUrlStage-17"><span class="linenos"> 17</span></a>        <span class="n">include_protocol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage-18"><a href="#CleanUrlStage-18"><span class="linenos"> 18</span></a>        <span class="n">include_subdomain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage-19"><a href="#CleanUrlStage-19"><span class="linenos"> 19</span></a>        <span class="n">include_path</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage-20"><a href="#CleanUrlStage-20"><span class="linenos"> 20</span></a>        <span class="n">include_query_string</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage-21"><a href="#CleanUrlStage-21"><span class="linenos"> 21</span></a>        <span class="n">null_if_invalid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CleanUrlStage-22"><a href="#CleanUrlStage-22"><span class="linenos"> 22</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CleanUrlStage-23"><a href="#CleanUrlStage-23"><span class="linenos"> 23</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="CleanUrlStage-24"><a href="#CleanUrlStage-24"><span class="linenos"> 24</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="CleanUrlStage-25"><a href="#CleanUrlStage-25"><span class="linenos"> 25</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CleanUrlStage-26"><a href="#CleanUrlStage-26"><span class="linenos"> 26</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CleanUrlStage-27"><a href="#CleanUrlStage-27"><span class="linenos"> 27</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize `CleanUrlStage`.</span>
</span><span id="CleanUrlStage-28"><a href="#CleanUrlStage-28"><span class="linenos"> 28</span></a>
</span><span id="CleanUrlStage-29"><a href="#CleanUrlStage-29"><span class="linenos"> 29</span></a><span class="sd">        Args:</span>
</span><span id="CleanUrlStage-30"><a href="#CleanUrlStage-30"><span class="linenos"> 30</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="CleanUrlStage-31"><a href="#CleanUrlStage-31"><span class="linenos"> 31</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="CleanUrlStage-32"><a href="#CleanUrlStage-32"><span class="linenos"> 32</span></a><span class="sd">            include_protocol (bool, optional): Specifies whether or not to include &#39;http(s)://&#39;. Defaults to True.</span>
</span><span id="CleanUrlStage-33"><a href="#CleanUrlStage-33"><span class="linenos"> 33</span></a><span class="sd">            include_subdomain (bool, optional): Specifies whether or not to include subdomains &#39;subdomain.domain.com&#39;. Defaults to True.</span>
</span><span id="CleanUrlStage-34"><a href="#CleanUrlStage-34"><span class="linenos"> 34</span></a><span class="sd">            include_path (bool, optional): Specifies whether or not to include URL path (including any query string). Defaults to True.</span>
</span><span id="CleanUrlStage-35"><a href="#CleanUrlStage-35"><span class="linenos"> 35</span></a><span class="sd">            include_query_string (bool, optional): Specifies whether or not to include any query string following the &#39;?&#39; character. Defaults to True. Ignored if path is excluded.</span>
</span><span id="CleanUrlStage-36"><a href="#CleanUrlStage-36"><span class="linenos"> 36</span></a><span class="sd">            null_if_invalid (bool, optional): If True, replaces invalid URLs with nulls instead of raising errors. Defaults to False.</span>
</span><span id="CleanUrlStage-37"><a href="#CleanUrlStage-37"><span class="linenos"> 37</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="CleanUrlStage-38"><a href="#CleanUrlStage-38"><span class="linenos"> 38</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="CleanUrlStage-39"><a href="#CleanUrlStage-39"><span class="linenos"> 39</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="CleanUrlStage-40"><a href="#CleanUrlStage-40"><span class="linenos"> 40</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="CleanUrlStage-41"><a href="#CleanUrlStage-41"><span class="linenos"> 41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CleanUrlStage-42"><a href="#CleanUrlStage-42"><span class="linenos"> 42</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CleanUrlStage-43"><a href="#CleanUrlStage-43"><span class="linenos"> 43</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanUrlStage-44"><a href="#CleanUrlStage-44"><span class="linenos"> 44</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="CleanUrlStage-45"><a href="#CleanUrlStage-45"><span class="linenos"> 45</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="CleanUrlStage-46"><a href="#CleanUrlStage-46"><span class="linenos"> 46</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="CleanUrlStage-47"><a href="#CleanUrlStage-47"><span class="linenos"> 47</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="CleanUrlStage-48"><a href="#CleanUrlStage-48"><span class="linenos"> 48</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="CleanUrlStage-49"><a href="#CleanUrlStage-49"><span class="linenos"> 49</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="CleanUrlStage-50"><a href="#CleanUrlStage-50"><span class="linenos"> 50</span></a>        <span class="p">)</span>
</span><span id="CleanUrlStage-51"><a href="#CleanUrlStage-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_protocol</span> <span class="o">=</span> <span class="n">include_protocol</span>
</span><span id="CleanUrlStage-52"><a href="#CleanUrlStage-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_subdomain</span> <span class="o">=</span> <span class="n">include_subdomain</span>
</span><span id="CleanUrlStage-53"><a href="#CleanUrlStage-53"><span class="linenos"> 53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_path</span> <span class="o">=</span> <span class="n">include_path</span>
</span><span id="CleanUrlStage-54"><a href="#CleanUrlStage-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_query_string</span> <span class="o">=</span> <span class="n">include_query_string</span>
</span><span id="CleanUrlStage-55"><a href="#CleanUrlStage-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">null_if_invalid</span> <span class="o">=</span> <span class="n">null_if_invalid</span>
</span><span id="CleanUrlStage-56"><a href="#CleanUrlStage-56"><span class="linenos"> 56</span></a>
</span><span id="CleanUrlStage-57"><a href="#CleanUrlStage-57"><span class="linenos"> 57</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="CleanUrlStage-58"><a href="#CleanUrlStage-58"><span class="linenos"> 58</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_url</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span>
</span><span id="CleanUrlStage-59"><a href="#CleanUrlStage-59"><span class="linenos"> 59</span></a>
</span><span id="CleanUrlStage-60"><a href="#CleanUrlStage-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="nf">_get_protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsed_url</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="CleanUrlStage-61"><a href="#CleanUrlStage-61"><span class="linenos"> 61</span></a>        <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
</span><span id="CleanUrlStage-62"><a href="#CleanUrlStage-62"><span class="linenos"> 62</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://&quot;</span>
</span><span id="CleanUrlStage-63"><a href="#CleanUrlStage-63"><span class="linenos"> 63</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CleanUrlStage-64"><a href="#CleanUrlStage-64"><span class="linenos"> 64</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;URL contains no protocol&quot;</span><span class="p">)</span>
</span><span id="CleanUrlStage-65"><a href="#CleanUrlStage-65"><span class="linenos"> 65</span></a>
</span><span id="CleanUrlStage-66"><a href="#CleanUrlStage-66"><span class="linenos"> 66</span></a>    <span class="k">def</span> <span class="nf">_get_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsed_url</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="CleanUrlStage-67"><a href="#CleanUrlStage-67"><span class="linenos"> 67</span></a>        <span class="n">full_domain</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="CleanUrlStage-68"><a href="#CleanUrlStage-68"><span class="linenos"> 68</span></a>        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;.+</span><span class="se">\\</span><span class="s2">..+&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">full_domain</span><span class="p">):</span>
</span><span id="CleanUrlStage-69"><a href="#CleanUrlStage-69"><span class="linenos"> 69</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_subdomain</span><span class="p">:</span>
</span><span id="CleanUrlStage-70"><a href="#CleanUrlStage-70"><span class="linenos"> 70</span></a>                <span class="k">return</span> <span class="n">full_domain</span>
</span><span id="CleanUrlStage-71"><a href="#CleanUrlStage-71"><span class="linenos"> 71</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CleanUrlStage-72"><a href="#CleanUrlStage-72"><span class="linenos"> 72</span></a>                <span class="k">return</span> <span class="n">full_domain</span><span class="p">[</span>
</span><span id="CleanUrlStage-73"><a href="#CleanUrlStage-73"><span class="linenos"> 73</span></a>                    <span class="n">full_domain</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">full_domain</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="CleanUrlStage-74"><a href="#CleanUrlStage-74"><span class="linenos"> 74</span></a>                <span class="p">]</span>
</span><span id="CleanUrlStage-75"><a href="#CleanUrlStage-75"><span class="linenos"> 75</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CleanUrlStage-76"><a href="#CleanUrlStage-76"><span class="linenos"> 76</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;URL contains no valid domain&quot;</span><span class="p">)</span>
</span><span id="CleanUrlStage-77"><a href="#CleanUrlStage-77"><span class="linenos"> 77</span></a>
</span><span id="CleanUrlStage-78"><a href="#CleanUrlStage-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="nf">_get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsed_url</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="CleanUrlStage-79"><a href="#CleanUrlStage-79"><span class="linenos"> 79</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span>
</span><span id="CleanUrlStage-80"><a href="#CleanUrlStage-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="CleanUrlStage-81"><a href="#CleanUrlStage-81"><span class="linenos"> 81</span></a>            <span class="c1"># Trim trailing slash</span>
</span><span id="CleanUrlStage-82"><a href="#CleanUrlStage-82"><span class="linenos"> 82</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CleanUrlStage-83"><a href="#CleanUrlStage-83"><span class="linenos"> 83</span></a>        <span class="k">return</span> <span class="n">path</span>
</span><span id="CleanUrlStage-84"><a href="#CleanUrlStage-84"><span class="linenos"> 84</span></a>
</span><span id="CleanUrlStage-85"><a href="#CleanUrlStage-85"><span class="linenos"> 85</span></a>    <span class="k">def</span> <span class="nf">_get_query_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsed_url</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="CleanUrlStage-86"><a href="#CleanUrlStage-86"><span class="linenos"> 86</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;?</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">query</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="CleanUrlStage-87"><a href="#CleanUrlStage-87"><span class="linenos"> 87</span></a>
</span><span id="CleanUrlStage-88"><a href="#CleanUrlStage-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">clean_url</span><span class="p">(</span>
</span><span id="CleanUrlStage-89"><a href="#CleanUrlStage-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanUrlStage-90"><a href="#CleanUrlStage-90"><span class="linenos"> 90</span></a>        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="CleanUrlStage-91"><a href="#CleanUrlStage-91"><span class="linenos"> 91</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CleanUrlStage-92"><a href="#CleanUrlStage-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean a URL string</span>
</span><span id="CleanUrlStage-93"><a href="#CleanUrlStage-93"><span class="linenos"> 93</span></a>
</span><span id="CleanUrlStage-94"><a href="#CleanUrlStage-94"><span class="linenos"> 94</span></a><span class="sd">        Args:</span>
</span><span id="CleanUrlStage-95"><a href="#CleanUrlStage-95"><span class="linenos"> 95</span></a><span class="sd">            url (str): The raw URL string.</span>
</span><span id="CleanUrlStage-96"><a href="#CleanUrlStage-96"><span class="linenos"> 96</span></a>
</span><span id="CleanUrlStage-97"><a href="#CleanUrlStage-97"><span class="linenos"> 97</span></a><span class="sd">        Raises:</span>
</span><span id="CleanUrlStage-98"><a href="#CleanUrlStage-98"><span class="linenos"> 98</span></a><span class="sd">            Exception: Raised if `include_protocol` is True but no protocol is found in `url`.</span>
</span><span id="CleanUrlStage-99"><a href="#CleanUrlStage-99"><span class="linenos"> 99</span></a><span class="sd">            Exception: Raised if `url` contains no domain (e.g. &#39;example.com&#39;).</span>
</span><span id="CleanUrlStage-100"><a href="#CleanUrlStage-100"><span class="linenos">100</span></a>
</span><span id="CleanUrlStage-101"><a href="#CleanUrlStage-101"><span class="linenos">101</span></a><span class="sd">        Returns:</span>
</span><span id="CleanUrlStage-102"><a href="#CleanUrlStage-102"><span class="linenos">102</span></a><span class="sd">            str: Cleaned URL string</span>
</span><span id="CleanUrlStage-103"><a href="#CleanUrlStage-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CleanUrlStage-104"><a href="#CleanUrlStage-104"><span class="linenos">104</span></a>        <span class="n">parsed_url</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="CleanUrlStage-105"><a href="#CleanUrlStage-105"><span class="linenos">105</span></a>            <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">if</span> <span class="s2">&quot;//&quot;</span> <span class="ow">in</span> <span class="n">url</span> <span class="k">else</span> <span class="n">urlparse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;//</span><span class="si">{</span><span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CleanUrlStage-106"><a href="#CleanUrlStage-106"><span class="linenos">106</span></a>        <span class="p">)</span>  <span class="c1"># If no protocol, adding &#39;//&#39; parses into netloc instead of path</span>
</span><span id="CleanUrlStage-107"><a href="#CleanUrlStage-107"><span class="linenos">107</span></a>        <span class="n">cleaned_url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="CleanUrlStage-108"><a href="#CleanUrlStage-108"><span class="linenos">108</span></a>
</span><span id="CleanUrlStage-109"><a href="#CleanUrlStage-109"><span class="linenos">109</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CleanUrlStage-110"><a href="#CleanUrlStage-110"><span class="linenos">110</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_protocol</span><span class="p">:</span>
</span><span id="CleanUrlStage-111"><a href="#CleanUrlStage-111"><span class="linenos">111</span></a>                <span class="n">cleaned_url</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_protocol</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>
</span><span id="CleanUrlStage-112"><a href="#CleanUrlStage-112"><span class="linenos">112</span></a>
</span><span id="CleanUrlStage-113"><a href="#CleanUrlStage-113"><span class="linenos">113</span></a>            <span class="n">cleaned_url</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_domain</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>
</span><span id="CleanUrlStage-114"><a href="#CleanUrlStage-114"><span class="linenos">114</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="CleanUrlStage-115"><a href="#CleanUrlStage-115"><span class="linenos">115</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">null_if_invalid</span><span class="p">:</span>
</span><span id="CleanUrlStage-116"><a href="#CleanUrlStage-116"><span class="linenos">116</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CleanUrlStage-117"><a href="#CleanUrlStage-117"><span class="linenos">117</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CleanUrlStage-118"><a href="#CleanUrlStage-118"><span class="linenos">118</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="CleanUrlStage-119"><a href="#CleanUrlStage-119"><span class="linenos">119</span></a>
</span><span id="CleanUrlStage-120"><a href="#CleanUrlStage-120"><span class="linenos">120</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_path</span><span class="p">:</span>
</span><span id="CleanUrlStage-121"><a href="#CleanUrlStage-121"><span class="linenos">121</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_path</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>
</span><span id="CleanUrlStage-122"><a href="#CleanUrlStage-122"><span class="linenos">122</span></a>            <span class="n">cleaned_url</span> <span class="o">+=</span> <span class="n">path</span>
</span><span id="CleanUrlStage-123"><a href="#CleanUrlStage-123"><span class="linenos">123</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_query_string</span><span class="p">:</span>
</span><span id="CleanUrlStage-124"><a href="#CleanUrlStage-124"><span class="linenos">124</span></a>                <span class="n">cleaned_url</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_string</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>
</span><span id="CleanUrlStage-125"><a href="#CleanUrlStage-125"><span class="linenos">125</span></a>
</span><span id="CleanUrlStage-126"><a href="#CleanUrlStage-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">cleaned_url</span>
</span></pre></div>


            <div class="docstring"><p>Parse and standardize URL format.</p>
</div>


                            <div id="CleanUrlStage.__init__" class="classattr">
                                        <input id="CleanUrlStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CleanUrlStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_protocol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_subdomain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_path</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_query_string</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">null_if_invalid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="CleanUrlStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CleanUrlStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CleanUrlStage.__init__-13"><a href="#CleanUrlStage.__init__-13"><span class="linenos">13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CleanUrlStage.__init__-14"><a href="#CleanUrlStage.__init__-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-15"><a href="#CleanUrlStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-16"><a href="#CleanUrlStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-17"><a href="#CleanUrlStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">include_protocol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-18"><a href="#CleanUrlStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">include_subdomain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-19"><a href="#CleanUrlStage.__init__-19"><span class="linenos">19</span></a>        <span class="n">include_path</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-20"><a href="#CleanUrlStage.__init__-20"><span class="linenos">20</span></a>        <span class="n">include_query_string</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-21"><a href="#CleanUrlStage.__init__-21"><span class="linenos">21</span></a>        <span class="n">null_if_invalid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-22"><a href="#CleanUrlStage.__init__-22"><span class="linenos">22</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-23"><a href="#CleanUrlStage.__init__-23"><span class="linenos">23</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-24"><a href="#CleanUrlStage.__init__-24"><span class="linenos">24</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-25"><a href="#CleanUrlStage.__init__-25"><span class="linenos">25</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-26"><a href="#CleanUrlStage.__init__-26"><span class="linenos">26</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CleanUrlStage.__init__-27"><a href="#CleanUrlStage.__init__-27"><span class="linenos">27</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize `CleanUrlStage`.</span>
</span><span id="CleanUrlStage.__init__-28"><a href="#CleanUrlStage.__init__-28"><span class="linenos">28</span></a>
</span><span id="CleanUrlStage.__init__-29"><a href="#CleanUrlStage.__init__-29"><span class="linenos">29</span></a><span class="sd">        Args:</span>
</span><span id="CleanUrlStage.__init__-30"><a href="#CleanUrlStage.__init__-30"><span class="linenos">30</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="CleanUrlStage.__init__-31"><a href="#CleanUrlStage.__init__-31"><span class="linenos">31</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="CleanUrlStage.__init__-32"><a href="#CleanUrlStage.__init__-32"><span class="linenos">32</span></a><span class="sd">            include_protocol (bool, optional): Specifies whether or not to include &#39;http(s)://&#39;. Defaults to True.</span>
</span><span id="CleanUrlStage.__init__-33"><a href="#CleanUrlStage.__init__-33"><span class="linenos">33</span></a><span class="sd">            include_subdomain (bool, optional): Specifies whether or not to include subdomains &#39;subdomain.domain.com&#39;. Defaults to True.</span>
</span><span id="CleanUrlStage.__init__-34"><a href="#CleanUrlStage.__init__-34"><span class="linenos">34</span></a><span class="sd">            include_path (bool, optional): Specifies whether or not to include URL path (including any query string). Defaults to True.</span>
</span><span id="CleanUrlStage.__init__-35"><a href="#CleanUrlStage.__init__-35"><span class="linenos">35</span></a><span class="sd">            include_query_string (bool, optional): Specifies whether or not to include any query string following the &#39;?&#39; character. Defaults to True. Ignored if path is excluded.</span>
</span><span id="CleanUrlStage.__init__-36"><a href="#CleanUrlStage.__init__-36"><span class="linenos">36</span></a><span class="sd">            null_if_invalid (bool, optional): If True, replaces invalid URLs with nulls instead of raising errors. Defaults to False.</span>
</span><span id="CleanUrlStage.__init__-37"><a href="#CleanUrlStage.__init__-37"><span class="linenos">37</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="CleanUrlStage.__init__-38"><a href="#CleanUrlStage.__init__-38"><span class="linenos">38</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="CleanUrlStage.__init__-39"><a href="#CleanUrlStage.__init__-39"><span class="linenos">39</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="CleanUrlStage.__init__-40"><a href="#CleanUrlStage.__init__-40"><span class="linenos">40</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="CleanUrlStage.__init__-41"><a href="#CleanUrlStage.__init__-41"><span class="linenos">41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CleanUrlStage.__init__-42"><a href="#CleanUrlStage.__init__-42"><span class="linenos">42</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CleanUrlStage.__init__-43"><a href="#CleanUrlStage.__init__-43"><span class="linenos">43</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-44"><a href="#CleanUrlStage.__init__-44"><span class="linenos">44</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-45"><a href="#CleanUrlStage.__init__-45"><span class="linenos">45</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-46"><a href="#CleanUrlStage.__init__-46"><span class="linenos">46</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-47"><a href="#CleanUrlStage.__init__-47"><span class="linenos">47</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-48"><a href="#CleanUrlStage.__init__-48"><span class="linenos">48</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-49"><a href="#CleanUrlStage.__init__-49"><span class="linenos">49</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="CleanUrlStage.__init__-50"><a href="#CleanUrlStage.__init__-50"><span class="linenos">50</span></a>        <span class="p">)</span>
</span><span id="CleanUrlStage.__init__-51"><a href="#CleanUrlStage.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_protocol</span> <span class="o">=</span> <span class="n">include_protocol</span>
</span><span id="CleanUrlStage.__init__-52"><a href="#CleanUrlStage.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_subdomain</span> <span class="o">=</span> <span class="n">include_subdomain</span>
</span><span id="CleanUrlStage.__init__-53"><a href="#CleanUrlStage.__init__-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_path</span> <span class="o">=</span> <span class="n">include_path</span>
</span><span id="CleanUrlStage.__init__-54"><a href="#CleanUrlStage.__init__-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_query_string</span> <span class="o">=</span> <span class="n">include_query_string</span>
</span><span id="CleanUrlStage.__init__-55"><a href="#CleanUrlStage.__init__-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">null_if_invalid</span> <span class="o">=</span> <span class="n">null_if_invalid</span>
</span></pre></div>


            <div class="docstring"><p>Initialize <code><a href="#CleanUrlStage">CleanUrlStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (Iterable[str], optional):</strong>  Fields to operate on. Will operate on all fields if not set (None).</li>
<li><strong>allow_nulls (bool, optional):</strong>  Allow null values/fields if True, otherwise use error_handling_method</li>
<li><strong>include_protocol (bool, optional):</strong>  Specifies whether or not to include 'http(s)://'. Defaults to True.</li>
<li><strong>include_subdomain (bool, optional):</strong>  Specifies whether or not to include subdomains 'subdomain.domain.com'. Defaults to True.</li>
<li><strong>include_path (bool, optional):</strong>  Specifies whether or not to include URL path (including any query string). Defaults to True.</li>
<li><strong>include_query_string (bool, optional):</strong>  Specifies whether or not to include any query string following the '?' character. Defaults to True. Ignored if path is excluded.</li>
<li><strong>null_if_invalid (bool, optional):</strong>  If True, replaces invalid URLs with nulls instead of raising errors. Defaults to False.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="CleanUrlStage.process_field" class="classattr">
                                        <input id="CleanUrlStage.process_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="CleanUrlStage.process_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CleanUrlStage.process_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CleanUrlStage.process_field-57"><a href="#CleanUrlStage.process_field-57"><span class="linenos">57</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="CleanUrlStage.process_field-58"><a href="#CleanUrlStage.process_field-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_url</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="CleanUrlStage.clean_url" class="classattr">
                                        <input id="CleanUrlStage.clean_url-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clean_url</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="CleanUrlStage.clean_url-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CleanUrlStage.clean_url"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CleanUrlStage.clean_url-88"><a href="#CleanUrlStage.clean_url-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">clean_url</span><span class="p">(</span>
</span><span id="CleanUrlStage.clean_url-89"><a href="#CleanUrlStage.clean_url-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CleanUrlStage.clean_url-90"><a href="#CleanUrlStage.clean_url-90"><span class="linenos"> 90</span></a>        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="CleanUrlStage.clean_url-91"><a href="#CleanUrlStage.clean_url-91"><span class="linenos"> 91</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CleanUrlStage.clean_url-92"><a href="#CleanUrlStage.clean_url-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean a URL string</span>
</span><span id="CleanUrlStage.clean_url-93"><a href="#CleanUrlStage.clean_url-93"><span class="linenos"> 93</span></a>
</span><span id="CleanUrlStage.clean_url-94"><a href="#CleanUrlStage.clean_url-94"><span class="linenos"> 94</span></a><span class="sd">        Args:</span>
</span><span id="CleanUrlStage.clean_url-95"><a href="#CleanUrlStage.clean_url-95"><span class="linenos"> 95</span></a><span class="sd">            url (str): The raw URL string.</span>
</span><span id="CleanUrlStage.clean_url-96"><a href="#CleanUrlStage.clean_url-96"><span class="linenos"> 96</span></a>
</span><span id="CleanUrlStage.clean_url-97"><a href="#CleanUrlStage.clean_url-97"><span class="linenos"> 97</span></a><span class="sd">        Raises:</span>
</span><span id="CleanUrlStage.clean_url-98"><a href="#CleanUrlStage.clean_url-98"><span class="linenos"> 98</span></a><span class="sd">            Exception: Raised if `include_protocol` is True but no protocol is found in `url`.</span>
</span><span id="CleanUrlStage.clean_url-99"><a href="#CleanUrlStage.clean_url-99"><span class="linenos"> 99</span></a><span class="sd">            Exception: Raised if `url` contains no domain (e.g. &#39;example.com&#39;).</span>
</span><span id="CleanUrlStage.clean_url-100"><a href="#CleanUrlStage.clean_url-100"><span class="linenos">100</span></a>
</span><span id="CleanUrlStage.clean_url-101"><a href="#CleanUrlStage.clean_url-101"><span class="linenos">101</span></a><span class="sd">        Returns:</span>
</span><span id="CleanUrlStage.clean_url-102"><a href="#CleanUrlStage.clean_url-102"><span class="linenos">102</span></a><span class="sd">            str: Cleaned URL string</span>
</span><span id="CleanUrlStage.clean_url-103"><a href="#CleanUrlStage.clean_url-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CleanUrlStage.clean_url-104"><a href="#CleanUrlStage.clean_url-104"><span class="linenos">104</span></a>        <span class="n">parsed_url</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="CleanUrlStage.clean_url-105"><a href="#CleanUrlStage.clean_url-105"><span class="linenos">105</span></a>            <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">if</span> <span class="s2">&quot;//&quot;</span> <span class="ow">in</span> <span class="n">url</span> <span class="k">else</span> <span class="n">urlparse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;//</span><span class="si">{</span><span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CleanUrlStage.clean_url-106"><a href="#CleanUrlStage.clean_url-106"><span class="linenos">106</span></a>        <span class="p">)</span>  <span class="c1"># If no protocol, adding &#39;//&#39; parses into netloc instead of path</span>
</span><span id="CleanUrlStage.clean_url-107"><a href="#CleanUrlStage.clean_url-107"><span class="linenos">107</span></a>        <span class="n">cleaned_url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="CleanUrlStage.clean_url-108"><a href="#CleanUrlStage.clean_url-108"><span class="linenos">108</span></a>
</span><span id="CleanUrlStage.clean_url-109"><a href="#CleanUrlStage.clean_url-109"><span class="linenos">109</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CleanUrlStage.clean_url-110"><a href="#CleanUrlStage.clean_url-110"><span class="linenos">110</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_protocol</span><span class="p">:</span>
</span><span id="CleanUrlStage.clean_url-111"><a href="#CleanUrlStage.clean_url-111"><span class="linenos">111</span></a>                <span class="n">cleaned_url</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_protocol</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>
</span><span id="CleanUrlStage.clean_url-112"><a href="#CleanUrlStage.clean_url-112"><span class="linenos">112</span></a>
</span><span id="CleanUrlStage.clean_url-113"><a href="#CleanUrlStage.clean_url-113"><span class="linenos">113</span></a>            <span class="n">cleaned_url</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_domain</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>
</span><span id="CleanUrlStage.clean_url-114"><a href="#CleanUrlStage.clean_url-114"><span class="linenos">114</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="CleanUrlStage.clean_url-115"><a href="#CleanUrlStage.clean_url-115"><span class="linenos">115</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">null_if_invalid</span><span class="p">:</span>
</span><span id="CleanUrlStage.clean_url-116"><a href="#CleanUrlStage.clean_url-116"><span class="linenos">116</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CleanUrlStage.clean_url-117"><a href="#CleanUrlStage.clean_url-117"><span class="linenos">117</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CleanUrlStage.clean_url-118"><a href="#CleanUrlStage.clean_url-118"><span class="linenos">118</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="CleanUrlStage.clean_url-119"><a href="#CleanUrlStage.clean_url-119"><span class="linenos">119</span></a>
</span><span id="CleanUrlStage.clean_url-120"><a href="#CleanUrlStage.clean_url-120"><span class="linenos">120</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_path</span><span class="p">:</span>
</span><span id="CleanUrlStage.clean_url-121"><a href="#CleanUrlStage.clean_url-121"><span class="linenos">121</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_path</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>
</span><span id="CleanUrlStage.clean_url-122"><a href="#CleanUrlStage.clean_url-122"><span class="linenos">122</span></a>            <span class="n">cleaned_url</span> <span class="o">+=</span> <span class="n">path</span>
</span><span id="CleanUrlStage.clean_url-123"><a href="#CleanUrlStage.clean_url-123"><span class="linenos">123</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_query_string</span><span class="p">:</span>
</span><span id="CleanUrlStage.clean_url-124"><a href="#CleanUrlStage.clean_url-124"><span class="linenos">124</span></a>                <span class="n">cleaned_url</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_string</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>
</span><span id="CleanUrlStage.clean_url-125"><a href="#CleanUrlStage.clean_url-125"><span class="linenos">125</span></a>
</span><span id="CleanUrlStage.clean_url-126"><a href="#CleanUrlStage.clean_url-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">cleaned_url</span>
</span></pre></div>


            <div class="docstring"><p>Clean a URL string</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>url (str):</strong>  The raw URL string.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>Exception:</strong>  Raised if <code>include_protocol</code> is True but no protocol is found in <code>url</code>.</li>
<li><strong>Exception:</strong>  Raised if <code>url</code> contains no domain (e.g. 'example.com').</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>str: Cleaned URL string</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.extensions.field_processor_stage.FieldProcessorStage</dt>
                                <dd id="CleanUrlStage.process_record" class="function">process_record</dd>

            </div>
            <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="CleanUrlStage.unique_name" class="variable">unique_name</dd>
                <dd id="CleanUrlStage.pipeline" class="variable">pipeline</dd>
                <dd id="CleanUrlStage.add_downstream" class="function">add_downstream</dd>
                <dd id="CleanUrlStage.add_upstream" class="function">add_upstream</dd>
                <dd id="CleanUrlStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="CleanUrlStage.channels" class="variable">channels</dd>
                <dd id="CleanUrlStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="CleanUrlStage.log" class="variable">log</dd>
                <dd id="CleanUrlStage.reset_level" class="function">reset_level</dd>
                <dd id="CleanUrlStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DedupeBatchStage">
                            <input id="DedupeBatchStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DedupeBatchStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="DedupeBatchStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DedupeBatchStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DedupeBatchStage-5"><a href="#DedupeBatchStage-5"><span class="linenos"> 5</span></a><span class="k">class</span> <span class="nc">DedupeBatchStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="DedupeBatchStage-6"><a href="#DedupeBatchStage-6"><span class="linenos"> 6</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes duplicate records from batch based on specified key.&quot;&quot;&quot;</span>
</span><span id="DedupeBatchStage-7"><a href="#DedupeBatchStage-7"><span class="linenos"> 7</span></a>
</span><span id="DedupeBatchStage-8"><a href="#DedupeBatchStage-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DedupeBatchStage-9"><a href="#DedupeBatchStage-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DedupeBatchStage-10"><a href="#DedupeBatchStage-10"><span class="linenos">10</span></a>        <span class="n">unique_key</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="DedupeBatchStage-11"><a href="#DedupeBatchStage-11"><span class="linenos">11</span></a>        <span class="n">first_record</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DedupeBatchStage-12"><a href="#DedupeBatchStage-12"><span class="linenos">12</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DedupeBatchStage-13"><a href="#DedupeBatchStage-13"><span class="linenos">13</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DedupeBatchStage-14"><a href="#DedupeBatchStage-14"><span class="linenos">14</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DedupeBatchStage-15"><a href="#DedupeBatchStage-15"><span class="linenos">15</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `DedupeBatchStage`.</span>
</span><span id="DedupeBatchStage-16"><a href="#DedupeBatchStage-16"><span class="linenos">16</span></a>
</span><span id="DedupeBatchStage-17"><a href="#DedupeBatchStage-17"><span class="linenos">17</span></a><span class="sd">        Args:</span>
</span><span id="DedupeBatchStage-18"><a href="#DedupeBatchStage-18"><span class="linenos">18</span></a><span class="sd">            unique_key (list[str]): List of keys to use for deduplication.</span>
</span><span id="DedupeBatchStage-19"><a href="#DedupeBatchStage-19"><span class="linenos">19</span></a><span class="sd">            first_record (bool, optional): Pick first record in order if True, else pick last record in order</span>
</span><span id="DedupeBatchStage-20"><a href="#DedupeBatchStage-20"><span class="linenos">20</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="DedupeBatchStage-21"><a href="#DedupeBatchStage-21"><span class="linenos">21</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="DedupeBatchStage-22"><a href="#DedupeBatchStage-22"><span class="linenos">22</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DedupeBatchStage-23"><a href="#DedupeBatchStage-23"><span class="linenos">23</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DedupeBatchStage-24"><a href="#DedupeBatchStage-24"><span class="linenos">24</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DedupeBatchStage-25"><a href="#DedupeBatchStage-25"><span class="linenos">25</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="DedupeBatchStage-26"><a href="#DedupeBatchStage-26"><span class="linenos">26</span></a>            <span class="c1"># always one process: only used if .process_record method is implemented</span>
</span><span id="DedupeBatchStage-27"><a href="#DedupeBatchStage-27"><span class="linenos">27</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="DedupeBatchStage-28"><a href="#DedupeBatchStage-28"><span class="linenos">28</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="DedupeBatchStage-29"><a href="#DedupeBatchStage-29"><span class="linenos">29</span></a>        <span class="p">)</span>
</span><span id="DedupeBatchStage-30"><a href="#DedupeBatchStage-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_key</span> <span class="o">=</span> <span class="n">unique_key</span>
</span><span id="DedupeBatchStage-31"><a href="#DedupeBatchStage-31"><span class="linenos">31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_record</span> <span class="o">=</span> <span class="n">first_record</span>
</span><span id="DedupeBatchStage-32"><a href="#DedupeBatchStage-32"><span class="linenos">32</span></a>
</span><span id="DedupeBatchStage-33"><a href="#DedupeBatchStage-33"><span class="linenos">33</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="DedupeBatchStage-34"><a href="#DedupeBatchStage-34"><span class="linenos">34</span></a>        <span class="k">return</span> <span class="n">batch</span><span class="o">.</span><span class="n">deduplicate</span><span class="p">(</span>
</span><span id="DedupeBatchStage-35"><a href="#DedupeBatchStage-35"><span class="linenos">35</span></a>            <span class="n">unique_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_key</span><span class="p">,</span> <span class="n">first_record</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_record</span>
</span><span id="DedupeBatchStage-36"><a href="#DedupeBatchStage-36"><span class="linenos">36</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Removes duplicate records from batch based on specified key.</p>
</div>


                            <div id="DedupeBatchStage.__init__" class="classattr">
                                        <input id="DedupeBatchStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DedupeBatchStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">unique_key</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">first_record</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="DedupeBatchStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DedupeBatchStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DedupeBatchStage.__init__-8"><a href="#DedupeBatchStage.__init__-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DedupeBatchStage.__init__-9"><a href="#DedupeBatchStage.__init__-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DedupeBatchStage.__init__-10"><a href="#DedupeBatchStage.__init__-10"><span class="linenos">10</span></a>        <span class="n">unique_key</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="DedupeBatchStage.__init__-11"><a href="#DedupeBatchStage.__init__-11"><span class="linenos">11</span></a>        <span class="n">first_record</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DedupeBatchStage.__init__-12"><a href="#DedupeBatchStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DedupeBatchStage.__init__-13"><a href="#DedupeBatchStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DedupeBatchStage.__init__-14"><a href="#DedupeBatchStage.__init__-14"><span class="linenos">14</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DedupeBatchStage.__init__-15"><a href="#DedupeBatchStage.__init__-15"><span class="linenos">15</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `DedupeBatchStage`.</span>
</span><span id="DedupeBatchStage.__init__-16"><a href="#DedupeBatchStage.__init__-16"><span class="linenos">16</span></a>
</span><span id="DedupeBatchStage.__init__-17"><a href="#DedupeBatchStage.__init__-17"><span class="linenos">17</span></a><span class="sd">        Args:</span>
</span><span id="DedupeBatchStage.__init__-18"><a href="#DedupeBatchStage.__init__-18"><span class="linenos">18</span></a><span class="sd">            unique_key (list[str]): List of keys to use for deduplication.</span>
</span><span id="DedupeBatchStage.__init__-19"><a href="#DedupeBatchStage.__init__-19"><span class="linenos">19</span></a><span class="sd">            first_record (bool, optional): Pick first record in order if True, else pick last record in order</span>
</span><span id="DedupeBatchStage.__init__-20"><a href="#DedupeBatchStage.__init__-20"><span class="linenos">20</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="DedupeBatchStage.__init__-21"><a href="#DedupeBatchStage.__init__-21"><span class="linenos">21</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="DedupeBatchStage.__init__-22"><a href="#DedupeBatchStage.__init__-22"><span class="linenos">22</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DedupeBatchStage.__init__-23"><a href="#DedupeBatchStage.__init__-23"><span class="linenos">23</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DedupeBatchStage.__init__-24"><a href="#DedupeBatchStage.__init__-24"><span class="linenos">24</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DedupeBatchStage.__init__-25"><a href="#DedupeBatchStage.__init__-25"><span class="linenos">25</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="DedupeBatchStage.__init__-26"><a href="#DedupeBatchStage.__init__-26"><span class="linenos">26</span></a>            <span class="c1"># always one process: only used if .process_record method is implemented</span>
</span><span id="DedupeBatchStage.__init__-27"><a href="#DedupeBatchStage.__init__-27"><span class="linenos">27</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="DedupeBatchStage.__init__-28"><a href="#DedupeBatchStage.__init__-28"><span class="linenos">28</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="DedupeBatchStage.__init__-29"><a href="#DedupeBatchStage.__init__-29"><span class="linenos">29</span></a>        <span class="p">)</span>
</span><span id="DedupeBatchStage.__init__-30"><a href="#DedupeBatchStage.__init__-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_key</span> <span class="o">=</span> <span class="n">unique_key</span>
</span><span id="DedupeBatchStage.__init__-31"><a href="#DedupeBatchStage.__init__-31"><span class="linenos">31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_record</span> <span class="o">=</span> <span class="n">first_record</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#DedupeBatchStage">DedupeBatchStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>unique_key (list[str]):</strong>  List of keys to use for deduplication.</li>
<li><strong>first_record (bool, optional):</strong>  Pick first record in order if True, else pick last record in order</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="DedupeBatchStage.process_batch" class="classattr">
                                        <input id="DedupeBatchStage.process_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_batch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span>:</span></span>

                <label class="view-source-button" for="DedupeBatchStage.process_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DedupeBatchStage.process_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DedupeBatchStage.process_batch-33"><a href="#DedupeBatchStage.process_batch-33"><span class="linenos">33</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="DedupeBatchStage.process_batch-34"><a href="#DedupeBatchStage.process_batch-34"><span class="linenos">34</span></a>        <span class="k">return</span> <span class="n">batch</span><span class="o">.</span><span class="n">deduplicate</span><span class="p">(</span>
</span><span id="DedupeBatchStage.process_batch-35"><a href="#DedupeBatchStage.process_batch-35"><span class="linenos">35</span></a>            <span class="n">unique_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_key</span><span class="p">,</span> <span class="n">first_record</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_record</span>
</span><span id="DedupeBatchStage.process_batch-36"><a href="#DedupeBatchStage.process_batch-36"><span class="linenos">36</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="DedupeBatchStage.unique_name" class="variable">unique_name</dd>
                <dd id="DedupeBatchStage.pipeline" class="variable">pipeline</dd>
                <dd id="DedupeBatchStage.add_downstream" class="function">add_downstream</dd>
                <dd id="DedupeBatchStage.add_upstream" class="function">add_upstream</dd>
                <dd id="DedupeBatchStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="DedupeBatchStage.channels" class="variable">channels</dd>
                <dd id="DedupeBatchStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="DedupeBatchStage.log" class="variable">log</dd>
                <dd id="DedupeBatchStage.reset_level" class="function">reset_level</dd>
                <dd id="DedupeBatchStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DropFieldsStage">
                            <input id="DropFieldsStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DropFieldsStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="DropFieldsStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DropFieldsStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DropFieldsStage-5"><a href="#DropFieldsStage-5"><span class="linenos"> 5</span></a><span class="k">class</span> <span class="nc">DropFieldsStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="DropFieldsStage-6"><a href="#DropFieldsStage-6"><span class="linenos"> 6</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Drop field from each record in batch.&quot;&quot;&quot;</span>
</span><span id="DropFieldsStage-7"><a href="#DropFieldsStage-7"><span class="linenos"> 7</span></a>
</span><span id="DropFieldsStage-8"><a href="#DropFieldsStage-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DropFieldsStage-9"><a href="#DropFieldsStage-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DropFieldsStage-10"><a href="#DropFieldsStage-10"><span class="linenos">10</span></a>        <span class="n">drop_fields</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="DropFieldsStage-11"><a href="#DropFieldsStage-11"><span class="linenos">11</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DropFieldsStage-12"><a href="#DropFieldsStage-12"><span class="linenos">12</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DropFieldsStage-13"><a href="#DropFieldsStage-13"><span class="linenos">13</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="DropFieldsStage-14"><a href="#DropFieldsStage-14"><span class="linenos">14</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DropFieldsStage-15"><a href="#DropFieldsStage-15"><span class="linenos">15</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DropFieldsStage-16"><a href="#DropFieldsStage-16"><span class="linenos">16</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `DropFieldsStage`.</span>
</span><span id="DropFieldsStage-17"><a href="#DropFieldsStage-17"><span class="linenos">17</span></a>
</span><span id="DropFieldsStage-18"><a href="#DropFieldsStage-18"><span class="linenos">18</span></a><span class="sd">        Args:</span>
</span><span id="DropFieldsStage-19"><a href="#DropFieldsStage-19"><span class="linenos">19</span></a><span class="sd">            drop_fields (set[str]): Fields that should be dropped.</span>
</span><span id="DropFieldsStage-20"><a href="#DropFieldsStage-20"><span class="linenos">20</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="DropFieldsStage-21"><a href="#DropFieldsStage-21"><span class="linenos">21</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="DropFieldsStage-22"><a href="#DropFieldsStage-22"><span class="linenos">22</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="DropFieldsStage-23"><a href="#DropFieldsStage-23"><span class="linenos">23</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="DropFieldsStage-24"><a href="#DropFieldsStage-24"><span class="linenos">24</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DropFieldsStage-25"><a href="#DropFieldsStage-25"><span class="linenos">25</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DropFieldsStage-26"><a href="#DropFieldsStage-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DropFieldsStage-27"><a href="#DropFieldsStage-27"><span class="linenos">27</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="DropFieldsStage-28"><a href="#DropFieldsStage-28"><span class="linenos">28</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="DropFieldsStage-29"><a href="#DropFieldsStage-29"><span class="linenos">29</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="DropFieldsStage-30"><a href="#DropFieldsStage-30"><span class="linenos">30</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="DropFieldsStage-31"><a href="#DropFieldsStage-31"><span class="linenos">31</span></a>        <span class="p">)</span>
</span><span id="DropFieldsStage-32"><a href="#DropFieldsStage-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">drop_fields</span> <span class="o">=</span> <span class="n">drop_fields</span>
</span><span id="DropFieldsStage-33"><a href="#DropFieldsStage-33"><span class="linenos">33</span></a>
</span><span id="DropFieldsStage-34"><a href="#DropFieldsStage-34"><span class="linenos">34</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="DropFieldsStage-35"><a href="#DropFieldsStage-35"><span class="linenos">35</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DropFieldsStage-36"><a href="#DropFieldsStage-36"><span class="linenos">36</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_fields</span>
</span><span id="DropFieldsStage-37"><a href="#DropFieldsStage-37"><span class="linenos">37</span></a>        <span class="p">}</span>
</span><span id="DropFieldsStage-38"><a href="#DropFieldsStage-38"><span class="linenos">38</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Drop field from each record in batch.</p>
</div>


                            <div id="DropFieldsStage.__init__" class="classattr">
                                        <input id="DropFieldsStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DropFieldsStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">drop_fields</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="DropFieldsStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DropFieldsStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DropFieldsStage.__init__-8"><a href="#DropFieldsStage.__init__-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DropFieldsStage.__init__-9"><a href="#DropFieldsStage.__init__-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-10"><a href="#DropFieldsStage.__init__-10"><span class="linenos">10</span></a>        <span class="n">drop_fields</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="DropFieldsStage.__init__-11"><a href="#DropFieldsStage.__init__-11"><span class="linenos">11</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-12"><a href="#DropFieldsStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-13"><a href="#DropFieldsStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-14"><a href="#DropFieldsStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-15"><a href="#DropFieldsStage.__init__-15"><span class="linenos">15</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DropFieldsStage.__init__-16"><a href="#DropFieldsStage.__init__-16"><span class="linenos">16</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `DropFieldsStage`.</span>
</span><span id="DropFieldsStage.__init__-17"><a href="#DropFieldsStage.__init__-17"><span class="linenos">17</span></a>
</span><span id="DropFieldsStage.__init__-18"><a href="#DropFieldsStage.__init__-18"><span class="linenos">18</span></a><span class="sd">        Args:</span>
</span><span id="DropFieldsStage.__init__-19"><a href="#DropFieldsStage.__init__-19"><span class="linenos">19</span></a><span class="sd">            drop_fields (set[str]): Fields that should be dropped.</span>
</span><span id="DropFieldsStage.__init__-20"><a href="#DropFieldsStage.__init__-20"><span class="linenos">20</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="DropFieldsStage.__init__-21"><a href="#DropFieldsStage.__init__-21"><span class="linenos">21</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="DropFieldsStage.__init__-22"><a href="#DropFieldsStage.__init__-22"><span class="linenos">22</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="DropFieldsStage.__init__-23"><a href="#DropFieldsStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="DropFieldsStage.__init__-24"><a href="#DropFieldsStage.__init__-24"><span class="linenos">24</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DropFieldsStage.__init__-25"><a href="#DropFieldsStage.__init__-25"><span class="linenos">25</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DropFieldsStage.__init__-26"><a href="#DropFieldsStage.__init__-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-27"><a href="#DropFieldsStage.__init__-27"><span class="linenos">27</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-28"><a href="#DropFieldsStage.__init__-28"><span class="linenos">28</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-29"><a href="#DropFieldsStage.__init__-29"><span class="linenos">29</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-30"><a href="#DropFieldsStage.__init__-30"><span class="linenos">30</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="DropFieldsStage.__init__-31"><a href="#DropFieldsStage.__init__-31"><span class="linenos">31</span></a>        <span class="p">)</span>
</span><span id="DropFieldsStage.__init__-32"><a href="#DropFieldsStage.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">drop_fields</span> <span class="o">=</span> <span class="n">drop_fields</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#DropFieldsStage">DropFieldsStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>drop_fields (set[str]):</strong>  Fields that should be dropped.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="DropFieldsStage.process_record" class="classattr">
                                        <input id="DropFieldsStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="DropFieldsStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DropFieldsStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DropFieldsStage.process_record-34"><a href="#DropFieldsStage.process_record-34"><span class="linenos">34</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="DropFieldsStage.process_record-35"><a href="#DropFieldsStage.process_record-35"><span class="linenos">35</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DropFieldsStage.process_record-36"><a href="#DropFieldsStage.process_record-36"><span class="linenos">36</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_fields</span>
</span><span id="DropFieldsStage.process_record-37"><a href="#DropFieldsStage.process_record-37"><span class="linenos">37</span></a>        <span class="p">}</span>
</span><span id="DropFieldsStage.process_record-38"><a href="#DropFieldsStage.process_record-38"><span class="linenos">38</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="DropFieldsStage.unique_name" class="variable">unique_name</dd>
                <dd id="DropFieldsStage.pipeline" class="variable">pipeline</dd>
                <dd id="DropFieldsStage.add_downstream" class="function">add_downstream</dd>
                <dd id="DropFieldsStage.add_upstream" class="function">add_upstream</dd>
                <dd id="DropFieldsStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="DropFieldsStage.channels" class="variable">channels</dd>
                <dd id="DropFieldsStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="DropFieldsStage.log" class="variable">log</dd>
                <dd id="DropFieldsStage.reset_level" class="function">reset_level</dd>
                <dd id="DropFieldsStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="EmptyBatchException">
                            <input id="EmptyBatchException-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EmptyBatchException</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="EmptyBatchException-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyBatchException"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyBatchException-5"><a href="#EmptyBatchException-5"><span class="linenos">5</span></a><span class="k">class</span> <span class="nc">EmptyBatchException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="EmptyBatchException-6"><a href="#EmptyBatchException-6"><span class="linenos">6</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when stage processes an empty batch&quot;&quot;&quot;</span>
</span><span id="EmptyBatchException-7"><a href="#EmptyBatchException-7"><span class="linenos">7</span></a>
</span><span id="EmptyBatchException-8"><a href="#EmptyBatchException-8"><span class="linenos">8</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Raised when stage processes an empty batch</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="EmptyBatchException.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="EmptyBatchException.with_traceback" class="function">with_traceback</dd>
                <dd id="EmptyBatchException.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="EmptyBatchStage">
                            <input id="EmptyBatchStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EmptyBatchStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="EmptyBatchStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyBatchStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyBatchStage-11"><a href="#EmptyBatchStage-11"><span class="linenos">11</span></a><span class="k">class</span> <span class="nc">EmptyBatchStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="EmptyBatchStage-12"><a href="#EmptyBatchStage-12"><span class="linenos">12</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raise an exception on an empty batch.&quot;&quot;&quot;</span>
</span><span id="EmptyBatchStage-13"><a href="#EmptyBatchStage-13"><span class="linenos">13</span></a>
</span><span id="EmptyBatchStage-14"><a href="#EmptyBatchStage-14"><span class="linenos">14</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyBatchStage-15"><a href="#EmptyBatchStage-15"><span class="linenos">15</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `EmptyBatchStage`.</span>
</span><span id="EmptyBatchStage-16"><a href="#EmptyBatchStage-16"><span class="linenos">16</span></a><span class="sd">        WARNING: IN ORDER FOR THIS STAGE TO FUNCTION PROPERLY IT MUST BE IMMEDIATELY DOWNSTREAM OF ITS SOURCE STAGE:</span>
</span><span id="EmptyBatchStage-17"><a href="#EmptyBatchStage-17"><span class="linenos">17</span></a><span class="sd">        (source_stage &gt;&gt; empty_batch_stage)</span>
</span><span id="EmptyBatchStage-18"><a href="#EmptyBatchStage-18"><span class="linenos">18</span></a>
</span><span id="EmptyBatchStage-19"><a href="#EmptyBatchStage-19"><span class="linenos">19</span></a><span class="sd">        If you must place this stage upstream of a non-source stage, that stage must be instantiated with the process_empty_batches=True parameter.</span>
</span><span id="EmptyBatchStage-20"><a href="#EmptyBatchStage-20"><span class="linenos">20</span></a>
</span><span id="EmptyBatchStage-21"><a href="#EmptyBatchStage-21"><span class="linenos">21</span></a><span class="sd">        Args:</span>
</span><span id="EmptyBatchStage-22"><a href="#EmptyBatchStage-22"><span class="linenos">22</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="EmptyBatchStage-23"><a href="#EmptyBatchStage-23"><span class="linenos">23</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="EmptyBatchStage-24"><a href="#EmptyBatchStage-24"><span class="linenos">24</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyBatchStage-25"><a href="#EmptyBatchStage-25"><span class="linenos">25</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="EmptyBatchStage-26"><a href="#EmptyBatchStage-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="EmptyBatchStage-27"><a href="#EmptyBatchStage-27"><span class="linenos">27</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="EmptyBatchStage-28"><a href="#EmptyBatchStage-28"><span class="linenos">28</span></a>            <span class="c1"># always one process: first empty batch</span>
</span><span id="EmptyBatchStage-29"><a href="#EmptyBatchStage-29"><span class="linenos">29</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="EmptyBatchStage-30"><a href="#EmptyBatchStage-30"><span class="linenos">30</span></a>            <span class="c1"># always raise an exception</span>
</span><span id="EmptyBatchStage-31"><a href="#EmptyBatchStage-31"><span class="linenos">31</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">,</span>
</span><span id="EmptyBatchStage-32"><a href="#EmptyBatchStage-32"><span class="linenos">32</span></a>            <span class="c1"># force the stage to be called even when the batch is empty</span>
</span><span id="EmptyBatchStage-33"><a href="#EmptyBatchStage-33"><span class="linenos">33</span></a>            <span class="n">process_empty_batches</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="EmptyBatchStage-34"><a href="#EmptyBatchStage-34"><span class="linenos">34</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="EmptyBatchStage-35"><a href="#EmptyBatchStage-35"><span class="linenos">35</span></a>        <span class="p">)</span>
</span><span id="EmptyBatchStage-36"><a href="#EmptyBatchStage-36"><span class="linenos">36</span></a>
</span><span id="EmptyBatchStage-37"><a href="#EmptyBatchStage-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="EmptyBatchStage-38"><a href="#EmptyBatchStage-38"><span class="linenos">38</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EmptyBatchStage-39"><a href="#EmptyBatchStage-39"><span class="linenos">39</span></a>            <span class="k">raise</span> <span class="n">EmptyBatchException</span><span class="p">()</span>
</span><span id="EmptyBatchStage-40"><a href="#EmptyBatchStage-40"><span class="linenos">40</span></a>        <span class="k">return</span> <span class="n">batch</span>
</span></pre></div>


            <div class="docstring"><p>Raise an exception on an empty batch.</p>
</div>


                            <div id="EmptyBatchStage.__init__" class="classattr">
                                        <input id="EmptyBatchStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EmptyBatchStage</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="EmptyBatchStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyBatchStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyBatchStage.__init__-14"><a href="#EmptyBatchStage.__init__-14"><span class="linenos">14</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyBatchStage.__init__-15"><a href="#EmptyBatchStage.__init__-15"><span class="linenos">15</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `EmptyBatchStage`.</span>
</span><span id="EmptyBatchStage.__init__-16"><a href="#EmptyBatchStage.__init__-16"><span class="linenos">16</span></a><span class="sd">        WARNING: IN ORDER FOR THIS STAGE TO FUNCTION PROPERLY IT MUST BE IMMEDIATELY DOWNSTREAM OF ITS SOURCE STAGE:</span>
</span><span id="EmptyBatchStage.__init__-17"><a href="#EmptyBatchStage.__init__-17"><span class="linenos">17</span></a><span class="sd">        (source_stage &gt;&gt; empty_batch_stage)</span>
</span><span id="EmptyBatchStage.__init__-18"><a href="#EmptyBatchStage.__init__-18"><span class="linenos">18</span></a>
</span><span id="EmptyBatchStage.__init__-19"><a href="#EmptyBatchStage.__init__-19"><span class="linenos">19</span></a><span class="sd">        If you must place this stage upstream of a non-source stage, that stage must be instantiated with the process_empty_batches=True parameter.</span>
</span><span id="EmptyBatchStage.__init__-20"><a href="#EmptyBatchStage.__init__-20"><span class="linenos">20</span></a>
</span><span id="EmptyBatchStage.__init__-21"><a href="#EmptyBatchStage.__init__-21"><span class="linenos">21</span></a><span class="sd">        Args:</span>
</span><span id="EmptyBatchStage.__init__-22"><a href="#EmptyBatchStage.__init__-22"><span class="linenos">22</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="EmptyBatchStage.__init__-23"><a href="#EmptyBatchStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="EmptyBatchStage.__init__-24"><a href="#EmptyBatchStage.__init__-24"><span class="linenos">24</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyBatchStage.__init__-25"><a href="#EmptyBatchStage.__init__-25"><span class="linenos">25</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="EmptyBatchStage.__init__-26"><a href="#EmptyBatchStage.__init__-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="EmptyBatchStage.__init__-27"><a href="#EmptyBatchStage.__init__-27"><span class="linenos">27</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="EmptyBatchStage.__init__-28"><a href="#EmptyBatchStage.__init__-28"><span class="linenos">28</span></a>            <span class="c1"># always one process: first empty batch</span>
</span><span id="EmptyBatchStage.__init__-29"><a href="#EmptyBatchStage.__init__-29"><span class="linenos">29</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="EmptyBatchStage.__init__-30"><a href="#EmptyBatchStage.__init__-30"><span class="linenos">30</span></a>            <span class="c1"># always raise an exception</span>
</span><span id="EmptyBatchStage.__init__-31"><a href="#EmptyBatchStage.__init__-31"><span class="linenos">31</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">,</span>
</span><span id="EmptyBatchStage.__init__-32"><a href="#EmptyBatchStage.__init__-32"><span class="linenos">32</span></a>            <span class="c1"># force the stage to be called even when the batch is empty</span>
</span><span id="EmptyBatchStage.__init__-33"><a href="#EmptyBatchStage.__init__-33"><span class="linenos">33</span></a>            <span class="n">process_empty_batches</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="EmptyBatchStage.__init__-34"><a href="#EmptyBatchStage.__init__-34"><span class="linenos">34</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="EmptyBatchStage.__init__-35"><a href="#EmptyBatchStage.__init__-35"><span class="linenos">35</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#EmptyBatchStage">EmptyBatchStage</a></code>.
WARNING: IN ORDER FOR THIS STAGE TO FUNCTION PROPERLY IT MUST BE IMMEDIATELY DOWNSTREAM OF ITS SOURCE STAGE:
(source_stage &gt;&gt; empty_batch_stage)</p>

<p>If you must place this stage upstream of a non-source stage, that stage must be instantiated with the process_empty_batches=True parameter.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="EmptyBatchStage.process_batch" class="classattr">
                                        <input id="EmptyBatchStage.process_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_batch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span>:</span></span>

                <label class="view-source-button" for="EmptyBatchStage.process_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyBatchStage.process_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyBatchStage.process_batch-37"><a href="#EmptyBatchStage.process_batch-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="EmptyBatchStage.process_batch-38"><a href="#EmptyBatchStage.process_batch-38"><span class="linenos">38</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EmptyBatchStage.process_batch-39"><a href="#EmptyBatchStage.process_batch-39"><span class="linenos">39</span></a>            <span class="k">raise</span> <span class="n">EmptyBatchException</span><span class="p">()</span>
</span><span id="EmptyBatchStage.process_batch-40"><a href="#EmptyBatchStage.process_batch-40"><span class="linenos">40</span></a>        <span class="k">return</span> <span class="n">batch</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="EmptyBatchStage.unique_name" class="variable">unique_name</dd>
                <dd id="EmptyBatchStage.pipeline" class="variable">pipeline</dd>
                <dd id="EmptyBatchStage.add_downstream" class="function">add_downstream</dd>
                <dd id="EmptyBatchStage.add_upstream" class="function">add_upstream</dd>
                <dd id="EmptyBatchStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="EmptyBatchStage.channels" class="variable">channels</dd>
                <dd id="EmptyBatchStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="EmptyBatchStage.log" class="variable">log</dd>
                <dd id="EmptyBatchStage.reset_level" class="function">reset_level</dd>
                <dd id="EmptyBatchStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="EmptyStringNullifierStage">
                            <input id="EmptyStringNullifierStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EmptyStringNullifierStage</span><wbr>(<span class="base">cluo.extensions.field_processor_stage.FieldProcessorStage</span>):

                <label class="view-source-button" for="EmptyStringNullifierStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyStringNullifierStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyStringNullifierStage-8"><a href="#EmptyStringNullifierStage-8"><span class="linenos"> 8</span></a><span class="k">class</span> <span class="nc">EmptyStringNullifierStage</span><span class="p">(</span><span class="n">FieldProcessorStage</span><span class="p">):</span>
</span><span id="EmptyStringNullifierStage-9"><a href="#EmptyStringNullifierStage-9"><span class="linenos"> 9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets empty strings and strings that are only whitespace equal to `None`.&quot;&quot;&quot;</span>
</span><span id="EmptyStringNullifierStage-10"><a href="#EmptyStringNullifierStage-10"><span class="linenos">10</span></a>
</span><span id="EmptyStringNullifierStage-11"><a href="#EmptyStringNullifierStage-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EmptyStringNullifierStage-12"><a href="#EmptyStringNullifierStage-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-13"><a href="#EmptyStringNullifierStage-13"><span class="linenos">13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-14"><a href="#EmptyStringNullifierStage-14"><span class="linenos">14</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-15"><a href="#EmptyStringNullifierStage-15"><span class="linenos">15</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-16"><a href="#EmptyStringNullifierStage-16"><span class="linenos">16</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-17"><a href="#EmptyStringNullifierStage-17"><span class="linenos">17</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-18"><a href="#EmptyStringNullifierStage-18"><span class="linenos">18</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-19"><a href="#EmptyStringNullifierStage-19"><span class="linenos">19</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyStringNullifierStage-20"><a href="#EmptyStringNullifierStage-20"><span class="linenos">20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `EmptyStringNullifierStage`.</span>
</span><span id="EmptyStringNullifierStage-21"><a href="#EmptyStringNullifierStage-21"><span class="linenos">21</span></a>
</span><span id="EmptyStringNullifierStage-22"><a href="#EmptyStringNullifierStage-22"><span class="linenos">22</span></a><span class="sd">        Args:</span>
</span><span id="EmptyStringNullifierStage-23"><a href="#EmptyStringNullifierStage-23"><span class="linenos">23</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="EmptyStringNullifierStage-24"><a href="#EmptyStringNullifierStage-24"><span class="linenos">24</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="EmptyStringNullifierStage-25"><a href="#EmptyStringNullifierStage-25"><span class="linenos">25</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="EmptyStringNullifierStage-26"><a href="#EmptyStringNullifierStage-26"><span class="linenos">26</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="EmptyStringNullifierStage-27"><a href="#EmptyStringNullifierStage-27"><span class="linenos">27</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="EmptyStringNullifierStage-28"><a href="#EmptyStringNullifierStage-28"><span class="linenos">28</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="EmptyStringNullifierStage-29"><a href="#EmptyStringNullifierStage-29"><span class="linenos">29</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyStringNullifierStage-30"><a href="#EmptyStringNullifierStage-30"><span class="linenos">30</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="EmptyStringNullifierStage-31"><a href="#EmptyStringNullifierStage-31"><span class="linenos">31</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-32"><a href="#EmptyStringNullifierStage-32"><span class="linenos">32</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-33"><a href="#EmptyStringNullifierStage-33"><span class="linenos">33</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-34"><a href="#EmptyStringNullifierStage-34"><span class="linenos">34</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-35"><a href="#EmptyStringNullifierStage-35"><span class="linenos">35</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-36"><a href="#EmptyStringNullifierStage-36"><span class="linenos">36</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-37"><a href="#EmptyStringNullifierStage-37"><span class="linenos">37</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage-38"><a href="#EmptyStringNullifierStage-38"><span class="linenos">38</span></a>        <span class="p">)</span>
</span><span id="EmptyStringNullifierStage-39"><a href="#EmptyStringNullifierStage-39"><span class="linenos">39</span></a>
</span><span id="EmptyStringNullifierStage-40"><a href="#EmptyStringNullifierStage-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="EmptyStringNullifierStage-41"><a href="#EmptyStringNullifierStage-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="EmptyStringNullifierStage-42"><a href="#EmptyStringNullifierStage-42"><span class="linenos">42</span></a>            <span class="kc">None</span>
</span><span id="EmptyStringNullifierStage-43"><a href="#EmptyStringNullifierStage-43"><span class="linenos">43</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span id="EmptyStringNullifierStage-44"><a href="#EmptyStringNullifierStage-44"><span class="linenos">44</span></a>            <span class="k">else</span> <span class="n">field_value</span>
</span><span id="EmptyStringNullifierStage-45"><a href="#EmptyStringNullifierStage-45"><span class="linenos">45</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets empty strings and strings that are only whitespace equal to <code>None</code>.</p>
</div>


                            <div id="EmptyStringNullifierStage.__init__" class="classattr">
                                        <input id="EmptyStringNullifierStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EmptyStringNullifierStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="EmptyStringNullifierStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyStringNullifierStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyStringNullifierStage.__init__-11"><a href="#EmptyStringNullifierStage.__init__-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EmptyStringNullifierStage.__init__-12"><a href="#EmptyStringNullifierStage.__init__-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-13"><a href="#EmptyStringNullifierStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-14"><a href="#EmptyStringNullifierStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-15"><a href="#EmptyStringNullifierStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-16"><a href="#EmptyStringNullifierStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-17"><a href="#EmptyStringNullifierStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-18"><a href="#EmptyStringNullifierStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-19"><a href="#EmptyStringNullifierStage.__init__-19"><span class="linenos">19</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyStringNullifierStage.__init__-20"><a href="#EmptyStringNullifierStage.__init__-20"><span class="linenos">20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `EmptyStringNullifierStage`.</span>
</span><span id="EmptyStringNullifierStage.__init__-21"><a href="#EmptyStringNullifierStage.__init__-21"><span class="linenos">21</span></a>
</span><span id="EmptyStringNullifierStage.__init__-22"><a href="#EmptyStringNullifierStage.__init__-22"><span class="linenos">22</span></a><span class="sd">        Args:</span>
</span><span id="EmptyStringNullifierStage.__init__-23"><a href="#EmptyStringNullifierStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="EmptyStringNullifierStage.__init__-24"><a href="#EmptyStringNullifierStage.__init__-24"><span class="linenos">24</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="EmptyStringNullifierStage.__init__-25"><a href="#EmptyStringNullifierStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="EmptyStringNullifierStage.__init__-26"><a href="#EmptyStringNullifierStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="EmptyStringNullifierStage.__init__-27"><a href="#EmptyStringNullifierStage.__init__-27"><span class="linenos">27</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="EmptyStringNullifierStage.__init__-28"><a href="#EmptyStringNullifierStage.__init__-28"><span class="linenos">28</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="EmptyStringNullifierStage.__init__-29"><a href="#EmptyStringNullifierStage.__init__-29"><span class="linenos">29</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyStringNullifierStage.__init__-30"><a href="#EmptyStringNullifierStage.__init__-30"><span class="linenos">30</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="EmptyStringNullifierStage.__init__-31"><a href="#EmptyStringNullifierStage.__init__-31"><span class="linenos">31</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-32"><a href="#EmptyStringNullifierStage.__init__-32"><span class="linenos">32</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-33"><a href="#EmptyStringNullifierStage.__init__-33"><span class="linenos">33</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-34"><a href="#EmptyStringNullifierStage.__init__-34"><span class="linenos">34</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-35"><a href="#EmptyStringNullifierStage.__init__-35"><span class="linenos">35</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-36"><a href="#EmptyStringNullifierStage.__init__-36"><span class="linenos">36</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-37"><a href="#EmptyStringNullifierStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="EmptyStringNullifierStage.__init__-38"><a href="#EmptyStringNullifierStage.__init__-38"><span class="linenos">38</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#EmptyStringNullifierStage">EmptyStringNullifierStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (Iterable[str], optional):</strong>  Fields to operate on. Will operate on all fields if not set (None).</li>
<li><strong>allow_nulls (bool, optional):</strong>  Allow null values/fields if True, otherwise use error_handling_method</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="EmptyStringNullifierStage.process_field" class="classattr">
                                        <input id="EmptyStringNullifierStage.process_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="EmptyStringNullifierStage.process_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyStringNullifierStage.process_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyStringNullifierStage.process_field-40"><a href="#EmptyStringNullifierStage.process_field-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="EmptyStringNullifierStage.process_field-41"><a href="#EmptyStringNullifierStage.process_field-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="EmptyStringNullifierStage.process_field-42"><a href="#EmptyStringNullifierStage.process_field-42"><span class="linenos">42</span></a>            <span class="kc">None</span>
</span><span id="EmptyStringNullifierStage.process_field-43"><a href="#EmptyStringNullifierStage.process_field-43"><span class="linenos">43</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span id="EmptyStringNullifierStage.process_field-44"><a href="#EmptyStringNullifierStage.process_field-44"><span class="linenos">44</span></a>            <span class="k">else</span> <span class="n">field_value</span>
</span><span id="EmptyStringNullifierStage.process_field-45"><a href="#EmptyStringNullifierStage.process_field-45"><span class="linenos">45</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.extensions.field_processor_stage.FieldProcessorStage</dt>
                                <dd id="EmptyStringNullifierStage.process_record" class="function">process_record</dd>

            </div>
            <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="EmptyStringNullifierStage.unique_name" class="variable">unique_name</dd>
                <dd id="EmptyStringNullifierStage.pipeline" class="variable">pipeline</dd>
                <dd id="EmptyStringNullifierStage.add_downstream" class="function">add_downstream</dd>
                <dd id="EmptyStringNullifierStage.add_upstream" class="function">add_upstream</dd>
                <dd id="EmptyStringNullifierStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="EmptyStringNullifierStage.channels" class="variable">channels</dd>
                <dd id="EmptyStringNullifierStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="EmptyStringNullifierStage.log" class="variable">log</dd>
                <dd id="EmptyStringNullifierStage.reset_level" class="function">reset_level</dd>
                <dd id="EmptyStringNullifierStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="FieldHasherStage">
                            <input id="FieldHasherStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FieldHasherStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="FieldHasherStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FieldHasherStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FieldHasherStage-7"><a href="#FieldHasherStage-7"><span class="linenos"> 7</span></a><span class="k">class</span> <span class="nc">FieldHasherStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="FieldHasherStage-8"><a href="#FieldHasherStage-8"><span class="linenos"> 8</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Attach hash of 1 or more fields to record.&quot;&quot;&quot;</span>
</span><span id="FieldHasherStage-9"><a href="#FieldHasherStage-9"><span class="linenos"> 9</span></a>
</span><span id="FieldHasherStage-10"><a href="#FieldHasherStage-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="FieldHasherStage-11"><a href="#FieldHasherStage-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldHasherStage-12"><a href="#FieldHasherStage-12"><span class="linenos">12</span></a>        <span class="n">hash_destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="FieldHasherStage-13"><a href="#FieldHasherStage-13"><span class="linenos">13</span></a>        <span class="n">hash_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FieldHasherStage-14"><a href="#FieldHasherStage-14"><span class="linenos">14</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FieldHasherStage-15"><a href="#FieldHasherStage-15"><span class="linenos">15</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="FieldHasherStage-16"><a href="#FieldHasherStage-16"><span class="linenos">16</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="FieldHasherStage-17"><a href="#FieldHasherStage-17"><span class="linenos">17</span></a>        <span class="n">streamsets_compatible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FieldHasherStage-18"><a href="#FieldHasherStage-18"><span class="linenos">18</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FieldHasherStage-19"><a href="#FieldHasherStage-19"><span class="linenos">19</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldHasherStage-20"><a href="#FieldHasherStage-20"><span class="linenos">20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FieldHasherStage-21"><a href="#FieldHasherStage-21"><span class="linenos">21</span></a><span class="sd">        Initialize the `FieldHasherStage`.</span>
</span><span id="FieldHasherStage-22"><a href="#FieldHasherStage-22"><span class="linenos">22</span></a>
</span><span id="FieldHasherStage-23"><a href="#FieldHasherStage-23"><span class="linenos">23</span></a><span class="sd">        Args:</span>
</span><span id="FieldHasherStage-24"><a href="#FieldHasherStage-24"><span class="linenos">24</span></a><span class="sd">            hash_destination (str): Record field in which to store the hash. Will overwrite if field already exists.</span>
</span><span id="FieldHasherStage-25"><a href="#FieldHasherStage-25"><span class="linenos">25</span></a><span class="sd">            hash_fields (list[str], optional): Fields to use in hashing. Defaults to None. Will hash entire record if None.</span>
</span><span id="FieldHasherStage-26"><a href="#FieldHasherStage-26"><span class="linenos">26</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="FieldHasherStage-27"><a href="#FieldHasherStage-27"><span class="linenos">27</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="FieldHasherStage-28"><a href="#FieldHasherStage-28"><span class="linenos">28</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="FieldHasherStage-29"><a href="#FieldHasherStage-29"><span class="linenos">29</span></a><span class="sd">            streamsets_compatible (bool, optional): generate streamsets compatible hashes.  Use for pipelines that replace existing streamsets pipelines.  Defaults to False.</span>
</span><span id="FieldHasherStage-30"><a href="#FieldHasherStage-30"><span class="linenos">30</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="FieldHasherStage-31"><a href="#FieldHasherStage-31"><span class="linenos">31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FieldHasherStage-32"><a href="#FieldHasherStage-32"><span class="linenos">32</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="FieldHasherStage-33"><a href="#FieldHasherStage-33"><span class="linenos">33</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldHasherStage-34"><a href="#FieldHasherStage-34"><span class="linenos">34</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="FieldHasherStage-35"><a href="#FieldHasherStage-35"><span class="linenos">35</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="FieldHasherStage-36"><a href="#FieldHasherStage-36"><span class="linenos">36</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="FieldHasherStage-37"><a href="#FieldHasherStage-37"><span class="linenos">37</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="FieldHasherStage-38"><a href="#FieldHasherStage-38"><span class="linenos">38</span></a>        <span class="p">)</span>
</span><span id="FieldHasherStage-39"><a href="#FieldHasherStage-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">hash_fields</span>
</span><span id="FieldHasherStage-40"><a href="#FieldHasherStage-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_destination</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">hash_destination</span>
</span><span id="FieldHasherStage-41"><a href="#FieldHasherStage-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamsets_compatible</span> <span class="o">=</span> <span class="n">streamsets_compatible</span>
</span><span id="FieldHasherStage-42"><a href="#FieldHasherStage-42"><span class="linenos">42</span></a>
</span><span id="FieldHasherStage-43"><a href="#FieldHasherStage-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="nf">_make_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FieldHasherStage-44"><a href="#FieldHasherStage-44"><span class="linenos">44</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamsets_compatible</span><span class="p">:</span>
</span><span id="FieldHasherStage-45"><a href="#FieldHasherStage-45"><span class="linenos">45</span></a>            <span class="k">return</span> <span class="n">make_hash</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span><span class="p">)</span>
</span><span id="FieldHasherStage-46"><a href="#FieldHasherStage-46"><span class="linenos">46</span></a>        <span class="n">hash_fields</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="FieldHasherStage-47"><a href="#FieldHasherStage-47"><span class="linenos">47</span></a>            <span class="nb">set</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="FieldHasherStage-48"><a href="#FieldHasherStage-48"><span class="linenos">48</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="FieldHasherStage-49"><a href="#FieldHasherStage-49"><span class="linenos">49</span></a>            <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span><span class="p">)</span>
</span><span id="FieldHasherStage-50"><a href="#FieldHasherStage-50"><span class="linenos">50</span></a>        <span class="p">)</span>
</span><span id="FieldHasherStage-51"><a href="#FieldHasherStage-51"><span class="linenos">51</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">hash_fields</span><span class="p">]</span>
</span><span id="FieldHasherStage-52"><a href="#FieldHasherStage-52"><span class="linenos">52</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="FieldHasherStage-53"><a href="#FieldHasherStage-53"><span class="linenos">53</span></a>            <span class="k">return</span> <span class="n">hash_nested_primitive</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="FieldHasherStage-54"><a href="#FieldHasherStage-54"><span class="linenos">54</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="FieldHasherStage-55"><a href="#FieldHasherStage-55"><span class="linenos">55</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Record is not hashable: </span><span class="si">{</span><span class="n">record</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FieldHasherStage-56"><a href="#FieldHasherStage-56"><span class="linenos">56</span></a>            <span class="k">raise</span> <span class="n">e</span>
</span><span id="FieldHasherStage-57"><a href="#FieldHasherStage-57"><span class="linenos">57</span></a>
</span><span id="FieldHasherStage-58"><a href="#FieldHasherStage-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="FieldHasherStage-59"><a href="#FieldHasherStage-59"><span class="linenos">59</span></a>        <span class="n">hash_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_hash</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="FieldHasherStage-60"><a href="#FieldHasherStage-60"><span class="linenos">60</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_destination</span><span class="p">]</span> <span class="o">=</span> <span class="n">hash_value</span>
</span><span id="FieldHasherStage-61"><a href="#FieldHasherStage-61"><span class="linenos">61</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Attach hash of 1 or more fields to record.</p>
</div>


                            <div id="FieldHasherStage.__init__" class="classattr">
                                        <input id="FieldHasherStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">FieldHasherStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">hash_destination</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">hash_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">streamsets_compatible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="FieldHasherStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FieldHasherStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FieldHasherStage.__init__-10"><a href="#FieldHasherStage.__init__-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="FieldHasherStage.__init__-11"><a href="#FieldHasherStage.__init__-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-12"><a href="#FieldHasherStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">hash_destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-13"><a href="#FieldHasherStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">hash_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-14"><a href="#FieldHasherStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-15"><a href="#FieldHasherStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-16"><a href="#FieldHasherStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-17"><a href="#FieldHasherStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">streamsets_compatible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-18"><a href="#FieldHasherStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-19"><a href="#FieldHasherStage.__init__-19"><span class="linenos">19</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldHasherStage.__init__-20"><a href="#FieldHasherStage.__init__-20"><span class="linenos">20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FieldHasherStage.__init__-21"><a href="#FieldHasherStage.__init__-21"><span class="linenos">21</span></a><span class="sd">        Initialize the `FieldHasherStage`.</span>
</span><span id="FieldHasherStage.__init__-22"><a href="#FieldHasherStage.__init__-22"><span class="linenos">22</span></a>
</span><span id="FieldHasherStage.__init__-23"><a href="#FieldHasherStage.__init__-23"><span class="linenos">23</span></a><span class="sd">        Args:</span>
</span><span id="FieldHasherStage.__init__-24"><a href="#FieldHasherStage.__init__-24"><span class="linenos">24</span></a><span class="sd">            hash_destination (str): Record field in which to store the hash. Will overwrite if field already exists.</span>
</span><span id="FieldHasherStage.__init__-25"><a href="#FieldHasherStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            hash_fields (list[str], optional): Fields to use in hashing. Defaults to None. Will hash entire record if None.</span>
</span><span id="FieldHasherStage.__init__-26"><a href="#FieldHasherStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="FieldHasherStage.__init__-27"><a href="#FieldHasherStage.__init__-27"><span class="linenos">27</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="FieldHasherStage.__init__-28"><a href="#FieldHasherStage.__init__-28"><span class="linenos">28</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="FieldHasherStage.__init__-29"><a href="#FieldHasherStage.__init__-29"><span class="linenos">29</span></a><span class="sd">            streamsets_compatible (bool, optional): generate streamsets compatible hashes.  Use for pipelines that replace existing streamsets pipelines.  Defaults to False.</span>
</span><span id="FieldHasherStage.__init__-30"><a href="#FieldHasherStage.__init__-30"><span class="linenos">30</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="FieldHasherStage.__init__-31"><a href="#FieldHasherStage.__init__-31"><span class="linenos">31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FieldHasherStage.__init__-32"><a href="#FieldHasherStage.__init__-32"><span class="linenos">32</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="FieldHasherStage.__init__-33"><a href="#FieldHasherStage.__init__-33"><span class="linenos">33</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-34"><a href="#FieldHasherStage.__init__-34"><span class="linenos">34</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-35"><a href="#FieldHasherStage.__init__-35"><span class="linenos">35</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-36"><a href="#FieldHasherStage.__init__-36"><span class="linenos">36</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-37"><a href="#FieldHasherStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="FieldHasherStage.__init__-38"><a href="#FieldHasherStage.__init__-38"><span class="linenos">38</span></a>        <span class="p">)</span>
</span><span id="FieldHasherStage.__init__-39"><a href="#FieldHasherStage.__init__-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">hash_fields</span>
</span><span id="FieldHasherStage.__init__-40"><a href="#FieldHasherStage.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_destination</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">hash_destination</span>
</span><span id="FieldHasherStage.__init__-41"><a href="#FieldHasherStage.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamsets_compatible</span> <span class="o">=</span> <span class="n">streamsets_compatible</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#FieldHasherStage">FieldHasherStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>hash_destination (str):</strong>  Record field in which to store the hash. Will overwrite if field already exists.</li>
<li><strong>hash_fields (list[str], optional):</strong>  Fields to use in hashing. Defaults to None. Will hash entire record if None.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>streamsets_compatible (bool, optional):</strong>  generate streamsets compatible hashes.  Use for pipelines that replace existing streamsets pipelines.  Defaults to False.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="FieldHasherStage.process_record" class="classattr">
                                        <input id="FieldHasherStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="FieldHasherStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FieldHasherStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FieldHasherStage.process_record-58"><a href="#FieldHasherStage.process_record-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="FieldHasherStage.process_record-59"><a href="#FieldHasherStage.process_record-59"><span class="linenos">59</span></a>        <span class="n">hash_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_hash</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="FieldHasherStage.process_record-60"><a href="#FieldHasherStage.process_record-60"><span class="linenos">60</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_destination</span><span class="p">]</span> <span class="o">=</span> <span class="n">hash_value</span>
</span><span id="FieldHasherStage.process_record-61"><a href="#FieldHasherStage.process_record-61"><span class="linenos">61</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="FieldHasherStage.unique_name" class="variable">unique_name</dd>
                <dd id="FieldHasherStage.pipeline" class="variable">pipeline</dd>
                <dd id="FieldHasherStage.add_downstream" class="function">add_downstream</dd>
                <dd id="FieldHasherStage.add_upstream" class="function">add_upstream</dd>
                <dd id="FieldHasherStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="FieldHasherStage.channels" class="variable">channels</dd>
                <dd id="FieldHasherStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="FieldHasherStage.log" class="variable">log</dd>
                <dd id="FieldHasherStage.reset_level" class="function">reset_level</dd>
                <dd id="FieldHasherStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="FieldSurvivorshipStage">
                            <input id="FieldSurvivorshipStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FieldSurvivorshipStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="FieldSurvivorshipStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FieldSurvivorshipStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FieldSurvivorshipStage-10"><a href="#FieldSurvivorshipStage-10"><span class="linenos"> 10</span></a><span class="k">class</span> <span class="nc">FieldSurvivorshipStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="FieldSurvivorshipStage-11"><a href="#FieldSurvivorshipStage-11"><span class="linenos"> 11</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Survive data by field according to survivorship rules.&quot;&quot;&quot;</span>
</span><span id="FieldSurvivorshipStage-12"><a href="#FieldSurvivorshipStage-12"><span class="linenos"> 12</span></a>
</span><span id="FieldSurvivorshipStage-13"><a href="#FieldSurvivorshipStage-13"><span class="linenos"> 13</span></a>    <span class="c1"># TODO: Remove</span>
</span><span id="FieldSurvivorshipStage-14"><a href="#FieldSurvivorshipStage-14"><span class="linenos"> 14</span></a>    <span class="n">default_order</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="FieldSurvivorshipStage-15"><a href="#FieldSurvivorshipStage-15"><span class="linenos"> 15</span></a>        <span class="s2">&quot;data_steward&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-16"><a href="#FieldSurvivorshipStage-16"><span class="linenos"> 16</span></a>        <span class="s2">&quot;salesforce&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-17"><a href="#FieldSurvivorshipStage-17"><span class="linenos"> 17</span></a>        <span class="s2">&quot;aim&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-18"><a href="#FieldSurvivorshipStage-18"><span class="linenos"> 18</span></a>        <span class="s2">&quot;pitchbook&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-19"><a href="#FieldSurvivorshipStage-19"><span class="linenos"> 19</span></a>        <span class="s2">&quot;crunchbase&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-20"><a href="#FieldSurvivorshipStage-20"><span class="linenos"> 20</span></a>        <span class="s2">&quot;affinity&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-21"><a href="#FieldSurvivorshipStage-21"><span class="linenos"> 21</span></a>        <span class="s2">&quot;f6s&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-22"><a href="#FieldSurvivorshipStage-22"><span class="linenos"> 22</span></a>        <span class="s2">&quot;airtable_investors&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-23"><a href="#FieldSurvivorshipStage-23"><span class="linenos"> 23</span></a>        <span class="s2">&quot;paperstreet&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-24"><a href="#FieldSurvivorshipStage-24"><span class="linenos"> 24</span></a>        <span class="s2">&quot;ltse&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-25"><a href="#FieldSurvivorshipStage-25"><span class="linenos"> 25</span></a>    <span class="p">]</span>
</span><span id="FieldSurvivorshipStage-26"><a href="#FieldSurvivorshipStage-26"><span class="linenos"> 26</span></a>
</span><span id="FieldSurvivorshipStage-27"><a href="#FieldSurvivorshipStage-27"><span class="linenos"> 27</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-28"><a href="#FieldSurvivorshipStage-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-29"><a href="#FieldSurvivorshipStage-29"><span class="linenos"> 29</span></a>        <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
</span><span id="FieldSurvivorshipStage-30"><a href="#FieldSurvivorshipStage-30"><span class="linenos"> 30</span></a>            <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="FieldSurvivorshipStage-31"><a href="#FieldSurvivorshipStage-31"><span class="linenos"> 31</span></a>            <span class="nb">dict</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
</span><span id="FieldSurvivorshipStage-32"><a href="#FieldSurvivorshipStage-32"><span class="linenos"> 32</span></a>        <span class="p">],</span>
</span><span id="FieldSurvivorshipStage-33"><a href="#FieldSurvivorshipStage-33"><span class="linenos"> 33</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-34"><a href="#FieldSurvivorshipStage-34"><span class="linenos"> 34</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-35"><a href="#FieldSurvivorshipStage-35"><span class="linenos"> 35</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-36"><a href="#FieldSurvivorshipStage-36"><span class="linenos"> 36</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-37"><a href="#FieldSurvivorshipStage-37"><span class="linenos"> 37</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-38"><a href="#FieldSurvivorshipStage-38"><span class="linenos"> 38</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `FieldSurvivorshipStage`.</span>
</span><span id="FieldSurvivorshipStage-39"><a href="#FieldSurvivorshipStage-39"><span class="linenos"> 39</span></a>
</span><span id="FieldSurvivorshipStage-40"><a href="#FieldSurvivorshipStage-40"><span class="linenos"> 40</span></a><span class="sd">        Args:</span>
</span><span id="FieldSurvivorshipStage-41"><a href="#FieldSurvivorshipStage-41"><span class="linenos"> 41</span></a><span class="sd">            config: (dict): Configuration for the stage. Maps field names or tuples of field names to survivorship rules (and source order for `&quot;source_priority&quot;` rule.)  Tuple-keyed rules survive all the fields in the tuple as a group.  All fields are survived from the same match record.  Match records qualify if at least one of the record&#39;s tuple field values is non-empty.  They are not required to have non-empty values for all tuple fields.</span>
</span><span id="FieldSurvivorshipStage-42"><a href="#FieldSurvivorshipStage-42"><span class="linenos"> 42</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="FieldSurvivorshipStage-43"><a href="#FieldSurvivorshipStage-43"><span class="linenos"> 43</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="FieldSurvivorshipStage-44"><a href="#FieldSurvivorshipStage-44"><span class="linenos"> 44</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="FieldSurvivorshipStage-45"><a href="#FieldSurvivorshipStage-45"><span class="linenos"> 45</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="FieldSurvivorshipStage-46"><a href="#FieldSurvivorshipStage-46"><span class="linenos"> 46</span></a>
</span><span id="FieldSurvivorshipStage-47"><a href="#FieldSurvivorshipStage-47"><span class="linenos"> 47</span></a><span class="sd">        example config</span>
</span><span id="FieldSurvivorshipStage-48"><a href="#FieldSurvivorshipStage-48"><span class="linenos"> 48</span></a><span class="sd">                ```py</span>
</span><span id="FieldSurvivorshipStage-49"><a href="#FieldSurvivorshipStage-49"><span class="linenos"> 49</span></a><span class="sd">        {</span>
</span><span id="FieldSurvivorshipStage-50"><a href="#FieldSurvivorshipStage-50"><span class="linenos"> 50</span></a><span class="sd">            &quot;company_name&quot;: {</span>
</span><span id="FieldSurvivorshipStage-51"><a href="#FieldSurvivorshipStage-51"><span class="linenos"> 51</span></a><span class="sd">                &quot;rule&quot;: &quot;source_priority&quot;,</span>
</span><span id="FieldSurvivorshipStage-52"><a href="#FieldSurvivorshipStage-52"><span class="linenos"> 52</span></a><span class="sd">                &quot;order&quot;: [&quot;aim&quot;, &quot;salesforce&quot;, &quot;crunchbase&quot;],</span>
</span><span id="FieldSurvivorshipStage-53"><a href="#FieldSurvivorshipStage-53"><span class="linenos"> 53</span></a><span class="sd">            },</span>
</span><span id="FieldSurvivorshipStage-54"><a href="#FieldSurvivorshipStage-54"><span class="linenos"> 54</span></a><span class="sd">            &quot;data_source_key&quot;: {</span>
</span><span id="FieldSurvivorshipStage-55"><a href="#FieldSurvivorshipStage-55"><span class="linenos"> 55</span></a><span class="sd">                &quot;rule&quot;: &quot;source_priority&quot;,</span>
</span><span id="FieldSurvivorshipStage-56"><a href="#FieldSurvivorshipStage-56"><span class="linenos"> 56</span></a><span class="sd">                # sources can be grouped together as tuples</span>
</span><span id="FieldSurvivorshipStage-57"><a href="#FieldSurvivorshipStage-57"><span class="linenos"> 57</span></a><span class="sd">                # records from grouped sources are ranked at the same level</span>
</span><span id="FieldSurvivorshipStage-58"><a href="#FieldSurvivorshipStage-58"><span class="linenos"> 58</span></a><span class="sd">                # and resolve to the most recent record from any of the grouped sources</span>
</span><span id="FieldSurvivorshipStage-59"><a href="#FieldSurvivorshipStage-59"><span class="linenos"> 59</span></a><span class="sd">                &quot;order&quot;: [&quot;affinity&quot;, (&quot;aim&quot;, &quot;salesforce&quot;, &quot;bee&quot;), &quot;crunchbase&quot;],</span>
</span><span id="FieldSurvivorshipStage-60"><a href="#FieldSurvivorshipStage-60"><span class="linenos"> 60</span></a><span class="sd">            },</span>
</span><span id="FieldSurvivorshipStage-61"><a href="#FieldSurvivorshipStage-61"><span class="linenos"> 61</span></a><span class="sd">            &quot;investor_type&quot;: {&quot;rule&quot;: &quot;aggregate&quot;},</span>
</span><span id="FieldSurvivorshipStage-62"><a href="#FieldSurvivorshipStage-62"><span class="linenos"> 62</span></a><span class="sd">            &quot;all_categories&quot;: {&quot;rule&quot;: &quot;aggregate&quot;},</span>
</span><span id="FieldSurvivorshipStage-63"><a href="#FieldSurvivorshipStage-63"><span class="linenos"> 63</span></a><span class="sd">            &quot;state_province&quot;: {&quot;rule&quot;: &quot;recency&quot;, &quot;include_nulls&quot;: False},</span>
</span><span id="FieldSurvivorshipStage-64"><a href="#FieldSurvivorshipStage-64"><span class="linenos"> 64</span></a><span class="sd">            &quot;point_of_contact&quot;: {&quot;rule&quot;: &quot;frequency&quot;},</span>
</span><span id="FieldSurvivorshipStage-65"><a href="#FieldSurvivorshipStage-65"><span class="linenos"> 65</span></a><span class="sd">            # survives all four fields as a group</span>
</span><span id="FieldSurvivorshipStage-66"><a href="#FieldSurvivorshipStage-66"><span class="linenos"> 66</span></a><span class="sd">            (&quot;city&quot;, &quot;state_province&quot;, &quot;postal_code&quot;, &quot;country_of_origin&quot;): {</span>
</span><span id="FieldSurvivorshipStage-67"><a href="#FieldSurvivorshipStage-67"><span class="linenos"> 67</span></a><span class="sd">                &quot;rule&quot;: &quot;source_priority&quot;,</span>
</span><span id="FieldSurvivorshipStage-68"><a href="#FieldSurvivorshipStage-68"><span class="linenos"> 68</span></a><span class="sd">                &quot;order&quot;: [&quot;affinity&quot;, &quot;aim&quot;, &quot;salesforce&quot;, &quot;crunchbase&quot;],</span>
</span><span id="FieldSurvivorshipStage-69"><a href="#FieldSurvivorshipStage-69"><span class="linenos"> 69</span></a><span class="sd">            },</span>
</span><span id="FieldSurvivorshipStage-70"><a href="#FieldSurvivorshipStage-70"><span class="linenos"> 70</span></a><span class="sd">        }</span>
</span><span id="FieldSurvivorshipStage-71"><a href="#FieldSurvivorshipStage-71"><span class="linenos"> 71</span></a><span class="sd">                ```</span>
</span><span id="FieldSurvivorshipStage-72"><a href="#FieldSurvivorshipStage-72"><span class="linenos"> 72</span></a>
</span><span id="FieldSurvivorshipStage-73"><a href="#FieldSurvivorshipStage-73"><span class="linenos"> 73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FieldSurvivorshipStage-74"><a href="#FieldSurvivorshipStage-74"><span class="linenos"> 74</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-75"><a href="#FieldSurvivorshipStage-75"><span class="linenos"> 75</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-76"><a href="#FieldSurvivorshipStage-76"><span class="linenos"> 76</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-77"><a href="#FieldSurvivorshipStage-77"><span class="linenos"> 77</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-78"><a href="#FieldSurvivorshipStage-78"><span class="linenos"> 78</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-79"><a href="#FieldSurvivorshipStage-79"><span class="linenos"> 79</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-80"><a href="#FieldSurvivorshipStage-80"><span class="linenos"> 80</span></a>        <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-81"><a href="#FieldSurvivorshipStage-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">match_field</span> <span class="o">=</span> <span class="s2">&quot;matches&quot;</span>
</span><span id="FieldSurvivorshipStage-82"><a href="#FieldSurvivorshipStage-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span><span id="FieldSurvivorshipStage-83"><a href="#FieldSurvivorshipStage-83"><span class="linenos"> 83</span></a>        <span class="c1"># set after first call to process_record</span>
</span><span id="FieldSurvivorshipStage-84"><a href="#FieldSurvivorshipStage-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FieldSurvivorshipStage-85"><a href="#FieldSurvivorshipStage-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accepted_rules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="FieldSurvivorshipStage-86"><a href="#FieldSurvivorshipStage-86"><span class="linenos"> 86</span></a>            <span class="s2">&quot;source_priority&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-87"><a href="#FieldSurvivorshipStage-87"><span class="linenos"> 87</span></a>            <span class="s2">&quot;recency&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-88"><a href="#FieldSurvivorshipStage-88"><span class="linenos"> 88</span></a>            <span class="s2">&quot;frequency&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-89"><a href="#FieldSurvivorshipStage-89"><span class="linenos"> 89</span></a>            <span class="s2">&quot;aggregate&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-90"><a href="#FieldSurvivorshipStage-90"><span class="linenos"> 90</span></a>        <span class="p">]</span>
</span><span id="FieldSurvivorshipStage-91"><a href="#FieldSurvivorshipStage-91"><span class="linenos"> 91</span></a>
</span><span id="FieldSurvivorshipStage-92"><a href="#FieldSurvivorshipStage-92"><span class="linenos"> 92</span></a>    <span class="k">def</span> <span class="nf">_validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-93"><a href="#FieldSurvivorshipStage-93"><span class="linenos"> 93</span></a>        <span class="c1"># config must have at least one rule</span>
</span><span id="FieldSurvivorshipStage-94"><a href="#FieldSurvivorshipStage-94"><span class="linenos"> 94</span></a>        <span class="k">def</span> <span class="nf">_check_nonempty_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-95"><a href="#FieldSurvivorshipStage-95"><span class="linenos"> 95</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-96"><a href="#FieldSurvivorshipStage-96"><span class="linenos"> 96</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;survivorship config must have at least one rule&quot;</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-97"><a href="#FieldSurvivorshipStage-97"><span class="linenos"> 97</span></a>
</span><span id="FieldSurvivorshipStage-98"><a href="#FieldSurvivorshipStage-98"><span class="linenos"> 98</span></a>        <span class="c1"># config cannot have more than one rule per field</span>
</span><span id="FieldSurvivorshipStage-99"><a href="#FieldSurvivorshipStage-99"><span class="linenos"> 99</span></a>        <span class="k">def</span> <span class="nf">_flatten_list</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-100"><a href="#FieldSurvivorshipStage-100"><span class="linenos">100</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">list_of_lists</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-101"><a href="#FieldSurvivorshipStage-101"><span class="linenos">101</span></a>
</span><span id="FieldSurvivorshipStage-102"><a href="#FieldSurvivorshipStage-102"><span class="linenos">102</span></a>        <span class="k">def</span> <span class="nf">_get_duplicates</span><span class="p">(</span><span class="n">key_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-103"><a href="#FieldSurvivorshipStage-103"><span class="linenos">103</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">key_list</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-104"><a href="#FieldSurvivorshipStage-104"><span class="linenos">104</span></a>
</span><span id="FieldSurvivorshipStage-105"><a href="#FieldSurvivorshipStage-105"><span class="linenos">105</span></a>        <span class="k">def</span> <span class="nf">_invalid_order</span><span class="p">(</span><span class="n">order_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-106"><a href="#FieldSurvivorshipStage-106"><span class="linenos">106</span></a>            <span class="c1"># invalid order if empty list or any key is not a string or a tuple of strings</span>
</span><span id="FieldSurvivorshipStage-107"><a href="#FieldSurvivorshipStage-107"><span class="linenos">107</span></a>            <span class="n">order_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">order_list</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">order_list</span>
</span><span id="FieldSurvivorshipStage-108"><a href="#FieldSurvivorshipStage-108"><span class="linenos">108</span></a>            <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="n">order_list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-109"><a href="#FieldSurvivorshipStage-109"><span class="linenos">109</span></a>                <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">order_list</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">))]</span>
</span><span id="FieldSurvivorshipStage-110"><a href="#FieldSurvivorshipStage-110"><span class="linenos">110</span></a>            <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="FieldSurvivorshipStage-111"><a href="#FieldSurvivorshipStage-111"><span class="linenos">111</span></a>
</span><span id="FieldSurvivorshipStage-112"><a href="#FieldSurvivorshipStage-112"><span class="linenos">112</span></a>        <span class="k">def</span> <span class="nf">_check_duplicate_keys</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-113"><a href="#FieldSurvivorshipStage-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="n">duplicate_keys</span> <span class="o">:=</span> <span class="n">_get_duplicates</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-114"><a href="#FieldSurvivorshipStage-114"><span class="linenos">114</span></a>                <span class="n">_flatten_list</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-115"><a href="#FieldSurvivorshipStage-115"><span class="linenos">115</span></a>                    <span class="p">[</span>
</span><span id="FieldSurvivorshipStage-116"><a href="#FieldSurvivorshipStage-116"><span class="linenos">116</span></a>                        <span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-117"><a href="#FieldSurvivorshipStage-117"><span class="linenos">117</span></a>                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
</span><span id="FieldSurvivorshipStage-118"><a href="#FieldSurvivorshipStage-118"><span class="linenos">118</span></a>                    <span class="p">]</span>
</span><span id="FieldSurvivorshipStage-119"><a href="#FieldSurvivorshipStage-119"><span class="linenos">119</span></a>                <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-120"><a href="#FieldSurvivorshipStage-120"><span class="linenos">120</span></a>            <span class="p">):</span>
</span><span id="FieldSurvivorshipStage-121"><a href="#FieldSurvivorshipStage-121"><span class="linenos">121</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-122"><a href="#FieldSurvivorshipStage-122"><span class="linenos">122</span></a>                    <span class="sa">f</span><span class="s2">&quot;survivorship config must have no more than one rule per field.  multiple rules specified for </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">duplicate_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="FieldSurvivorshipStage-123"><a href="#FieldSurvivorshipStage-123"><span class="linenos">123</span></a>                <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-124"><a href="#FieldSurvivorshipStage-124"><span class="linenos">124</span></a>
</span><span id="FieldSurvivorshipStage-125"><a href="#FieldSurvivorshipStage-125"><span class="linenos">125</span></a>        <span class="k">def</span> <span class="nf">_check_aggregate_rules</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-126"><a href="#FieldSurvivorshipStage-126"><span class="linenos">126</span></a>            <span class="c1"># aggregate survivorship rule must not target more than one field</span>
</span><span id="FieldSurvivorshipStage-127"><a href="#FieldSurvivorshipStage-127"><span class="linenos">127</span></a>            <span class="k">if</span> <span class="n">list_sourced_aggregates</span> <span class="o">:=</span> <span class="p">[</span>
</span><span id="FieldSurvivorshipStage-128"><a href="#FieldSurvivorshipStage-128"><span class="linenos">128</span></a>                <span class="n">key</span>
</span><span id="FieldSurvivorshipStage-129"><a href="#FieldSurvivorshipStage-129"><span class="linenos">129</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-130"><a href="#FieldSurvivorshipStage-130"><span class="linenos">130</span></a>                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;aggregate&quot;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-131"><a href="#FieldSurvivorshipStage-131"><span class="linenos">131</span></a>            <span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-132"><a href="#FieldSurvivorshipStage-132"><span class="linenos">132</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-133"><a href="#FieldSurvivorshipStage-133"><span class="linenos">133</span></a>                    <span class="sa">f</span><span class="s2">&quot;aggregate survivorship rules cannot be configured for field groups: </span><span class="si">{</span><span class="n">list_sourced_aggregates</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="FieldSurvivorshipStage-134"><a href="#FieldSurvivorshipStage-134"><span class="linenos">134</span></a>                <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-135"><a href="#FieldSurvivorshipStage-135"><span class="linenos">135</span></a>
</span><span id="FieldSurvivorshipStage-136"><a href="#FieldSurvivorshipStage-136"><span class="linenos">136</span></a>        <span class="k">def</span> <span class="nf">_check_source_priority_rules</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-137"><a href="#FieldSurvivorshipStage-137"><span class="linenos">137</span></a>            <span class="k">if</span> <span class="n">bad_source_priority_keys</span> <span class="o">:=</span> <span class="p">[</span>
</span><span id="FieldSurvivorshipStage-138"><a href="#FieldSurvivorshipStage-138"><span class="linenos">138</span></a>                <span class="n">key</span>
</span><span id="FieldSurvivorshipStage-139"><a href="#FieldSurvivorshipStage-139"><span class="linenos">139</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-140"><a href="#FieldSurvivorshipStage-140"><span class="linenos">140</span></a>                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;source_priority&quot;</span>
</span><span id="FieldSurvivorshipStage-141"><a href="#FieldSurvivorshipStage-141"><span class="linenos">141</span></a>                <span class="ow">and</span> <span class="n">_invalid_order</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="FieldSurvivorshipStage-142"><a href="#FieldSurvivorshipStage-142"><span class="linenos">142</span></a>            <span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-143"><a href="#FieldSurvivorshipStage-143"><span class="linenos">143</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-144"><a href="#FieldSurvivorshipStage-144"><span class="linenos">144</span></a>                    <span class="sa">f</span><span class="s1">&#39;source_priority survivorship rules must include a list of data sources in &quot;order&quot; key: </span><span class="si">{</span><span class="n">bad_source_priority_keys</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="FieldSurvivorshipStage-145"><a href="#FieldSurvivorshipStage-145"><span class="linenos">145</span></a>                <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-146"><a href="#FieldSurvivorshipStage-146"><span class="linenos">146</span></a>
</span><span id="FieldSurvivorshipStage-147"><a href="#FieldSurvivorshipStage-147"><span class="linenos">147</span></a>        <span class="k">def</span> <span class="nf">_check_recency_rules</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-148"><a href="#FieldSurvivorshipStage-148"><span class="linenos">148</span></a>            <span class="k">if</span> <span class="n">bad_recency_keys</span> <span class="o">:=</span> <span class="p">[</span>
</span><span id="FieldSurvivorshipStage-149"><a href="#FieldSurvivorshipStage-149"><span class="linenos">149</span></a>                <span class="n">key</span>
</span><span id="FieldSurvivorshipStage-150"><a href="#FieldSurvivorshipStage-150"><span class="linenos">150</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-151"><a href="#FieldSurvivorshipStage-151"><span class="linenos">151</span></a>                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;recency&quot;</span>
</span><span id="FieldSurvivorshipStage-152"><a href="#FieldSurvivorshipStage-152"><span class="linenos">152</span></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;include_nulls&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="nb">bool</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="FieldSurvivorshipStage-153"><a href="#FieldSurvivorshipStage-153"><span class="linenos">153</span></a>            <span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-154"><a href="#FieldSurvivorshipStage-154"><span class="linenos">154</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-155"><a href="#FieldSurvivorshipStage-155"><span class="linenos">155</span></a>                    <span class="sa">f</span><span class="s1">&#39;recency survivorship key &quot;include_nulls&quot; must supply a boolean value: </span><span class="si">{</span><span class="n">bad_recency_keys</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="FieldSurvivorshipStage-156"><a href="#FieldSurvivorshipStage-156"><span class="linenos">156</span></a>                <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-157"><a href="#FieldSurvivorshipStage-157"><span class="linenos">157</span></a>
</span><span id="FieldSurvivorshipStage-158"><a href="#FieldSurvivorshipStage-158"><span class="linenos">158</span></a>        <span class="k">def</span> <span class="nf">_check_valid_rules</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-159"><a href="#FieldSurvivorshipStage-159"><span class="linenos">159</span></a>            <span class="k">if</span> <span class="n">invalid_rule_keys</span> <span class="o">:=</span> <span class="p">[</span>
</span><span id="FieldSurvivorshipStage-160"><a href="#FieldSurvivorshipStage-160"><span class="linenos">160</span></a>                <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">))</span>
</span><span id="FieldSurvivorshipStage-161"><a href="#FieldSurvivorshipStage-161"><span class="linenos">161</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-162"><a href="#FieldSurvivorshipStage-162"><span class="linenos">162</span></a>                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_rules</span>
</span><span id="FieldSurvivorshipStage-163"><a href="#FieldSurvivorshipStage-163"><span class="linenos">163</span></a>            <span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-164"><a href="#FieldSurvivorshipStage-164"><span class="linenos">164</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-165"><a href="#FieldSurvivorshipStage-165"><span class="linenos">165</span></a>                    <span class="sa">f</span><span class="s2">&quot;survivorship config includes invalid rule type(s): </span><span class="si">{</span><span class="n">invalid_rule_keys</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="FieldSurvivorshipStage-166"><a href="#FieldSurvivorshipStage-166"><span class="linenos">166</span></a>                <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-167"><a href="#FieldSurvivorshipStage-167"><span class="linenos">167</span></a>
</span><span id="FieldSurvivorshipStage-168"><a href="#FieldSurvivorshipStage-168"><span class="linenos">168</span></a>        <span class="n">_check_nonempty_config</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-169"><a href="#FieldSurvivorshipStage-169"><span class="linenos">169</span></a>        <span class="n">_check_duplicate_keys</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-170"><a href="#FieldSurvivorshipStage-170"><span class="linenos">170</span></a>        <span class="n">_check_aggregate_rules</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-171"><a href="#FieldSurvivorshipStage-171"><span class="linenos">171</span></a>        <span class="n">_check_source_priority_rules</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-172"><a href="#FieldSurvivorshipStage-172"><span class="linenos">172</span></a>        <span class="n">_check_recency_rules</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-173"><a href="#FieldSurvivorshipStage-173"><span class="linenos">173</span></a>        <span class="n">_check_valid_rules</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-174"><a href="#FieldSurvivorshipStage-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FieldSurvivorshipStage-175"><a href="#FieldSurvivorshipStage-175"><span class="linenos">175</span></a>
</span><span id="FieldSurvivorshipStage-176"><a href="#FieldSurvivorshipStage-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="nf">_collect_fields_from_match_and_records</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-177"><a href="#FieldSurvivorshipStage-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-178"><a href="#FieldSurvivorshipStage-178"><span class="linenos">178</span></a>        <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-179"><a href="#FieldSurvivorshipStage-179"><span class="linenos">179</span></a>        <span class="n">any_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage-180"><a href="#FieldSurvivorshipStage-180"><span class="linenos">180</span></a>        <span class="n">required_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="FieldSurvivorshipStage-181"><a href="#FieldSurvivorshipStage-181"><span class="linenos">181</span></a>        <span class="n">include_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-182"><a href="#FieldSurvivorshipStage-182"><span class="linenos">182</span></a>    <span class="p">):</span>
</span><span id="FieldSurvivorshipStage-183"><a href="#FieldSurvivorshipStage-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FieldSurvivorshipStage-184"><a href="#FieldSurvivorshipStage-184"><span class="linenos">184</span></a><span class="sd">        to qualify:</span>
</span><span id="FieldSurvivorshipStage-185"><a href="#FieldSurvivorshipStage-185"><span class="linenos">185</span></a><span class="sd">            - a record must include keys for all values in any_fields + required_fields</span>
</span><span id="FieldSurvivorshipStage-186"><a href="#FieldSurvivorshipStage-186"><span class="linenos">186</span></a><span class="sd">            - a record must have at least one non-empty value from any_fields</span>
</span><span id="FieldSurvivorshipStage-187"><a href="#FieldSurvivorshipStage-187"><span class="linenos">187</span></a><span class="sd">            - a record must have non-empty values for all fields in required_fields</span>
</span><span id="FieldSurvivorshipStage-188"><a href="#FieldSurvivorshipStage-188"><span class="linenos">188</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FieldSurvivorshipStage-189"><a href="#FieldSurvivorshipStage-189"><span class="linenos">189</span></a>
</span><span id="FieldSurvivorshipStage-190"><a href="#FieldSurvivorshipStage-190"><span class="linenos">190</span></a>        <span class="k">def</span> <span class="nf">_values_are_populated</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-191"><a href="#FieldSurvivorshipStage-191"><span class="linenos">191</span></a>            <span class="n">match</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage-192"><a href="#FieldSurvivorshipStage-192"><span class="linenos">192</span></a>            <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage-193"><a href="#FieldSurvivorshipStage-193"><span class="linenos">193</span></a>            <span class="n">required_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage-194"><a href="#FieldSurvivorshipStage-194"><span class="linenos">194</span></a>            <span class="n">include_nulls</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-195"><a href="#FieldSurvivorshipStage-195"><span class="linenos">195</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-196"><a href="#FieldSurvivorshipStage-196"><span class="linenos">196</span></a>            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-197"><a href="#FieldSurvivorshipStage-197"><span class="linenos">197</span></a>                <span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">include_nulls</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-198"><a href="#FieldSurvivorshipStage-198"><span class="linenos">198</span></a>                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-199"><a href="#FieldSurvivorshipStage-199"><span class="linenos">199</span></a>            <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="FieldSurvivorshipStage-200"><a href="#FieldSurvivorshipStage-200"><span class="linenos">200</span></a>                <span class="ow">not</span> <span class="n">required_fields</span>
</span><span id="FieldSurvivorshipStage-201"><a href="#FieldSurvivorshipStage-201"><span class="linenos">201</span></a>                <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-202"><a href="#FieldSurvivorshipStage-202"><span class="linenos">202</span></a>                    <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="FieldSurvivorshipStage-203"><a href="#FieldSurvivorshipStage-203"><span class="linenos">203</span></a>                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required_fields</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-204"><a href="#FieldSurvivorshipStage-204"><span class="linenos">204</span></a>                <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-205"><a href="#FieldSurvivorshipStage-205"><span class="linenos">205</span></a>            <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-206"><a href="#FieldSurvivorshipStage-206"><span class="linenos">206</span></a>
</span><span id="FieldSurvivorshipStage-207"><a href="#FieldSurvivorshipStage-207"><span class="linenos">207</span></a>        <span class="c1"># matches qualify if any of the fields in the list are populated</span>
</span><span id="FieldSurvivorshipStage-208"><a href="#FieldSurvivorshipStage-208"><span class="linenos">208</span></a>        <span class="n">all_data</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-209"><a href="#FieldSurvivorshipStage-209"><span class="linenos">209</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FieldSurvivorshipStage-210"><a href="#FieldSurvivorshipStage-210"><span class="linenos">210</span></a>        <span class="n">all_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">any_fields</span> <span class="o">+</span> <span class="n">required_fields</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-211"><a href="#FieldSurvivorshipStage-211"><span class="linenos">211</span></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">all_data</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-212"><a href="#FieldSurvivorshipStage-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">all_fields</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="ow">and</span> <span class="n">_values_are_populated</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-213"><a href="#FieldSurvivorshipStage-213"><span class="linenos">213</span></a>                <span class="n">match</span><span class="p">,</span> <span class="n">any_fields</span><span class="p">,</span> <span class="n">required_fields</span><span class="p">,</span> <span class="n">include_nulls</span>
</span><span id="FieldSurvivorshipStage-214"><a href="#FieldSurvivorshipStage-214"><span class="linenos">214</span></a>            <span class="p">):</span>
</span><span id="FieldSurvivorshipStage-215"><a href="#FieldSurvivorshipStage-215"><span class="linenos">215</span></a>                <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">field</span><span class="p">:</span> <span class="n">match</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">all_fields</span><span class="p">})</span>
</span><span id="FieldSurvivorshipStage-216"><a href="#FieldSurvivorshipStage-216"><span class="linenos">216</span></a>        <span class="k">return</span> <span class="n">options</span>
</span><span id="FieldSurvivorshipStage-217"><a href="#FieldSurvivorshipStage-217"><span class="linenos">217</span></a>
</span><span id="FieldSurvivorshipStage-218"><a href="#FieldSurvivorshipStage-218"><span class="linenos">218</span></a>    <span class="k">def</span> <span class="nf">_get_most_frequent_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-219"><a href="#FieldSurvivorshipStage-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_list</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-220"><a href="#FieldSurvivorshipStage-220"><span class="linenos">220</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="FieldSurvivorshipStage-221"><a href="#FieldSurvivorshipStage-221"><span class="linenos">221</span></a>        <span class="n">hashed_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">hash_nested_primitive</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-222"><a href="#FieldSurvivorshipStage-222"><span class="linenos">222</span></a>        <span class="n">hash_lookup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">hashed_pairs</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-223"><a href="#FieldSurvivorshipStage-223"><span class="linenos">223</span></a>        <span class="n">hashed_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hashed_pairs</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-224"><a href="#FieldSurvivorshipStage-224"><span class="linenos">224</span></a>        <span class="k">return</span> <span class="n">hash_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">hashed_list</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="FieldSurvivorshipStage-225"><a href="#FieldSurvivorshipStage-225"><span class="linenos">225</span></a>
</span><span id="FieldSurvivorshipStage-226"><a href="#FieldSurvivorshipStage-226"><span class="linenos">226</span></a>    <span class="k">def</span> <span class="nf">_get_most_recent_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-227"><a href="#FieldSurvivorshipStage-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_list</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-228"><a href="#FieldSurvivorshipStage-228"><span class="linenos">228</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="FieldSurvivorshipStage-229"><a href="#FieldSurvivorshipStage-229"><span class="linenos">229</span></a>        <span class="k">return</span> <span class="n">value_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-230"><a href="#FieldSurvivorshipStage-230"><span class="linenos">230</span></a>
</span><span id="FieldSurvivorshipStage-231"><a href="#FieldSurvivorshipStage-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">_flatten_source_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_order</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-232"><a href="#FieldSurvivorshipStage-232"><span class="linenos">232</span></a>        <span class="n">retval</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FieldSurvivorshipStage-233"><a href="#FieldSurvivorshipStage-233"><span class="linenos">233</span></a>        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">source_order</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-234"><a href="#FieldSurvivorshipStage-234"><span class="linenos">234</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="FieldSurvivorshipStage-235"><a href="#FieldSurvivorshipStage-235"><span class="linenos">235</span></a>                <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-236"><a href="#FieldSurvivorshipStage-236"><span class="linenos">236</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-237"><a href="#FieldSurvivorshipStage-237"><span class="linenos">237</span></a>                <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-238"><a href="#FieldSurvivorshipStage-238"><span class="linenos">238</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="FieldSurvivorshipStage-239"><a href="#FieldSurvivorshipStage-239"><span class="linenos">239</span></a>
</span><span id="FieldSurvivorshipStage-240"><a href="#FieldSurvivorshipStage-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">_rank_source_order</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-241"><a href="#FieldSurvivorshipStage-241"><span class="linenos">241</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">source_order</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]]</span>
</span><span id="FieldSurvivorshipStage-242"><a href="#FieldSurvivorshipStage-242"><span class="linenos">242</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-243"><a href="#FieldSurvivorshipStage-243"><span class="linenos">243</span></a>        <span class="c1"># build the source order rank dictionary: keys = data_source, values = relative rank</span>
</span><span id="FieldSurvivorshipStage-244"><a href="#FieldSurvivorshipStage-244"><span class="linenos">244</span></a>        <span class="n">retval</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="FieldSurvivorshipStage-245"><a href="#FieldSurvivorshipStage-245"><span class="linenos">245</span></a>        <span class="k">for</span> <span class="n">source_rank</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">source_order</span><span class="p">):</span>
</span><span id="FieldSurvivorshipStage-246"><a href="#FieldSurvivorshipStage-246"><span class="linenos">246</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="FieldSurvivorshipStage-247"><a href="#FieldSurvivorshipStage-247"><span class="linenos">247</span></a>                <span class="k">for</span> <span class="n">sub_source</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-248"><a href="#FieldSurvivorshipStage-248"><span class="linenos">248</span></a>                    <span class="n">retval</span><span class="p">[</span><span class="n">sub_source</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_rank</span>
</span><span id="FieldSurvivorshipStage-249"><a href="#FieldSurvivorshipStage-249"><span class="linenos">249</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-250"><a href="#FieldSurvivorshipStage-250"><span class="linenos">250</span></a>                <span class="n">retval</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_rank</span>
</span><span id="FieldSurvivorshipStage-251"><a href="#FieldSurvivorshipStage-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="FieldSurvivorshipStage-252"><a href="#FieldSurvivorshipStage-252"><span class="linenos">252</span></a>
</span><span id="FieldSurvivorshipStage-253"><a href="#FieldSurvivorshipStage-253"><span class="linenos">253</span></a>    <span class="k">def</span> <span class="nf">_get_value_by_source_priority</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-254"><a href="#FieldSurvivorshipStage-254"><span class="linenos">254</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-255"><a href="#FieldSurvivorshipStage-255"><span class="linenos">255</span></a>        <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-256"><a href="#FieldSurvivorshipStage-256"><span class="linenos">256</span></a>        <span class="n">field_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage-257"><a href="#FieldSurvivorshipStage-257"><span class="linenos">257</span></a>        <span class="n">source_order</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]],</span>
</span><span id="FieldSurvivorshipStage-258"><a href="#FieldSurvivorshipStage-258"><span class="linenos">258</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-259"><a href="#FieldSurvivorshipStage-259"><span class="linenos">259</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_fields_from_match_and_records</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-260"><a href="#FieldSurvivorshipStage-260"><span class="linenos">260</span></a>            <span class="n">record</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-261"><a href="#FieldSurvivorshipStage-261"><span class="linenos">261</span></a>            <span class="n">field_list</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-262"><a href="#FieldSurvivorshipStage-262"><span class="linenos">262</span></a>            <span class="n">required_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;data_source&quot;</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage-263"><a href="#FieldSurvivorshipStage-263"><span class="linenos">263</span></a>        <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-264"><a href="#FieldSurvivorshipStage-264"><span class="linenos">264</span></a>        <span class="c1"># flattened source order list for filtering</span>
</span><span id="FieldSurvivorshipStage-265"><a href="#FieldSurvivorshipStage-265"><span class="linenos">265</span></a>        <span class="n">flat_source_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_source_order</span><span class="p">(</span><span class="n">source_order</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-266"><a href="#FieldSurvivorshipStage-266"><span class="linenos">266</span></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="FieldSurvivorshipStage-267"><a href="#FieldSurvivorshipStage-267"><span class="linenos">267</span></a>            <span class="n">option</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span> <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;data_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">flat_source_order</span>
</span><span id="FieldSurvivorshipStage-268"><a href="#FieldSurvivorshipStage-268"><span class="linenos">268</span></a>        <span class="p">]</span>
</span><span id="FieldSurvivorshipStage-269"><a href="#FieldSurvivorshipStage-269"><span class="linenos">269</span></a>        <span class="c1"># source order rank by data source for sorting</span>
</span><span id="FieldSurvivorshipStage-270"><a href="#FieldSurvivorshipStage-270"><span class="linenos">270</span></a>        <span class="n">rank_by_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rank_source_order</span><span class="p">(</span><span class="n">source_order</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-271"><a href="#FieldSurvivorshipStage-271"><span class="linenos">271</span></a>        <span class="n">sorted_options</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-272"><a href="#FieldSurvivorshipStage-272"><span class="linenos">272</span></a>            <span class="n">filtered</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">rank_by_source</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;data_source&quot;</span><span class="p">]]</span>
</span><span id="FieldSurvivorshipStage-273"><a href="#FieldSurvivorshipStage-273"><span class="linenos">273</span></a>        <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-274"><a href="#FieldSurvivorshipStage-274"><span class="linenos">274</span></a>        <span class="c1"># if no registered sources have data null out the field</span>
</span><span id="FieldSurvivorshipStage-275"><a href="#FieldSurvivorshipStage-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_options</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-276"><a href="#FieldSurvivorshipStage-276"><span class="linenos">276</span></a>            <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">}</span>
</span><span id="FieldSurvivorshipStage-277"><a href="#FieldSurvivorshipStage-277"><span class="linenos">277</span></a>        <span class="n">best_match_data_source</span> <span class="o">=</span> <span class="n">sorted_options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;data_source&quot;</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-278"><a href="#FieldSurvivorshipStage-278"><span class="linenos">278</span></a>        <span class="n">most_recent_value_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_most_recent_value</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-279"><a href="#FieldSurvivorshipStage-279"><span class="linenos">279</span></a>            <span class="p">[</span>
</span><span id="FieldSurvivorshipStage-280"><a href="#FieldSurvivorshipStage-280"><span class="linenos">280</span></a>                <span class="p">[</span><span class="n">option</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-281"><a href="#FieldSurvivorshipStage-281"><span class="linenos">281</span></a>                <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span>
</span><span id="FieldSurvivorshipStage-282"><a href="#FieldSurvivorshipStage-282"><span class="linenos">282</span></a>                <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;data_source&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">best_match_data_source</span>
</span><span id="FieldSurvivorshipStage-283"><a href="#FieldSurvivorshipStage-283"><span class="linenos">283</span></a>            <span class="p">]</span>
</span><span id="FieldSurvivorshipStage-284"><a href="#FieldSurvivorshipStage-284"><span class="linenos">284</span></a>        <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-285"><a href="#FieldSurvivorshipStage-285"><span class="linenos">285</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">field_list</span><span class="p">,</span> <span class="n">most_recent_value_list</span><span class="p">))</span>
</span><span id="FieldSurvivorshipStage-286"><a href="#FieldSurvivorshipStage-286"><span class="linenos">286</span></a>
</span><span id="FieldSurvivorshipStage-287"><a href="#FieldSurvivorshipStage-287"><span class="linenos">287</span></a>    <span class="k">def</span> <span class="nf">_get_value_by_recency</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-288"><a href="#FieldSurvivorshipStage-288"><span class="linenos">288</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">,</span> <span class="n">field_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">include_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FieldSurvivorshipStage-289"><a href="#FieldSurvivorshipStage-289"><span class="linenos">289</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-290"><a href="#FieldSurvivorshipStage-290"><span class="linenos">290</span></a>        <span class="n">STRPTIME_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span>
</span><span id="FieldSurvivorshipStage-291"><a href="#FieldSurvivorshipStage-291"><span class="linenos">291</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_fields_from_match_and_records</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-292"><a href="#FieldSurvivorshipStage-292"><span class="linenos">292</span></a>            <span class="n">record</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-293"><a href="#FieldSurvivorshipStage-293"><span class="linenos">293</span></a>            <span class="n">field_list</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-294"><a href="#FieldSurvivorshipStage-294"><span class="linenos">294</span></a>            <span class="c1"># TODO: Genericize</span>
</span><span id="FieldSurvivorshipStage-295"><a href="#FieldSurvivorshipStage-295"><span class="linenos">295</span></a>            <span class="n">required_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage-296"><a href="#FieldSurvivorshipStage-296"><span class="linenos">296</span></a>            <span class="n">include_nulls</span><span class="o">=</span><span class="n">include_nulls</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-297"><a href="#FieldSurvivorshipStage-297"><span class="linenos">297</span></a>        <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-298"><a href="#FieldSurvivorshipStage-298"><span class="linenos">298</span></a>        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-299"><a href="#FieldSurvivorshipStage-299"><span class="linenos">299</span></a>            <span class="n">option</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-300"><a href="#FieldSurvivorshipStage-300"><span class="linenos">300</span></a>                <span class="p">{</span>
</span><span id="FieldSurvivorshipStage-301"><a href="#FieldSurvivorshipStage-301"><span class="linenos">301</span></a>                    <span class="s2">&quot;ts_updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-302"><a href="#FieldSurvivorshipStage-302"><span class="linenos">302</span></a>                        <span class="n">option</span><span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span> <span class="n">STRPTIME_FORMAT</span>
</span><span id="FieldSurvivorshipStage-303"><a href="#FieldSurvivorshipStage-303"><span class="linenos">303</span></a>                    <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-304"><a href="#FieldSurvivorshipStage-304"><span class="linenos">304</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option</span><span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-305"><a href="#FieldSurvivorshipStage-305"><span class="linenos">305</span></a>                    <span class="k">else</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-306"><a href="#FieldSurvivorshipStage-306"><span class="linenos">306</span></a>                <span class="p">}</span>
</span><span id="FieldSurvivorshipStage-307"><a href="#FieldSurvivorshipStage-307"><span class="linenos">307</span></a>            <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-308"><a href="#FieldSurvivorshipStage-308"><span class="linenos">308</span></a>        <span class="n">sorted_options</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-309"><a href="#FieldSurvivorshipStage-309"><span class="linenos">309</span></a>        <span class="c1"># if no sources have data null out the field</span>
</span><span id="FieldSurvivorshipStage-310"><a href="#FieldSurvivorshipStage-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_options</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-311"><a href="#FieldSurvivorshipStage-311"><span class="linenos">311</span></a>            <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">}</span>
</span><span id="FieldSurvivorshipStage-312"><a href="#FieldSurvivorshipStage-312"><span class="linenos">312</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">sorted_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">}</span>
</span><span id="FieldSurvivorshipStage-313"><a href="#FieldSurvivorshipStage-313"><span class="linenos">313</span></a>
</span><span id="FieldSurvivorshipStage-314"><a href="#FieldSurvivorshipStage-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="nf">_get_value_by_frequency</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-315"><a href="#FieldSurvivorshipStage-315"><span class="linenos">315</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">,</span> <span class="n">field_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-316"><a href="#FieldSurvivorshipStage-316"><span class="linenos">316</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-317"><a href="#FieldSurvivorshipStage-317"><span class="linenos">317</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_fields_from_match_and_records</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">field_list</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-318"><a href="#FieldSurvivorshipStage-318"><span class="linenos">318</span></a>        <span class="n">most_frequent_value_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_most_frequent_value</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-319"><a href="#FieldSurvivorshipStage-319"><span class="linenos">319</span></a>            <span class="p">[[</span><span class="n">option</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">]</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-320"><a href="#FieldSurvivorshipStage-320"><span class="linenos">320</span></a>        <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-321"><a href="#FieldSurvivorshipStage-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">field_list</span><span class="p">,</span> <span class="n">most_frequent_value_list</span><span class="p">))</span>
</span><span id="FieldSurvivorshipStage-322"><a href="#FieldSurvivorshipStage-322"><span class="linenos">322</span></a>
</span><span id="FieldSurvivorshipStage-323"><a href="#FieldSurvivorshipStage-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="nf">_get_value_by_aggregation</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-324"><a href="#FieldSurvivorshipStage-324"><span class="linenos">324</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">,</span> <span class="n">field_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-325"><a href="#FieldSurvivorshipStage-325"><span class="linenos">325</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="FieldSurvivorshipStage-326"><a href="#FieldSurvivorshipStage-326"><span class="linenos">326</span></a>        <span class="n">collected</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FieldSurvivorshipStage-327"><a href="#FieldSurvivorshipStage-327"><span class="linenos">327</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_fields_from_match_and_records</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">field_list</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-328"><a href="#FieldSurvivorshipStage-328"><span class="linenos">328</span></a>        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-329"><a href="#FieldSurvivorshipStage-329"><span class="linenos">329</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">option</span><span class="p">[</span><span class="n">field_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="FieldSurvivorshipStage-330"><a href="#FieldSurvivorshipStage-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="FieldSurvivorshipStage-331"><a href="#FieldSurvivorshipStage-331"><span class="linenos">331</span></a>                <span class="n">collected</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-332"><a href="#FieldSurvivorshipStage-332"><span class="linenos">332</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="FieldSurvivorshipStage-333"><a href="#FieldSurvivorshipStage-333"><span class="linenos">333</span></a>                <span class="n">collected</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</span><span id="FieldSurvivorshipStage-334"><a href="#FieldSurvivorshipStage-334"><span class="linenos">334</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-335"><a href="#FieldSurvivorshipStage-335"><span class="linenos">335</span></a>                <span class="n">collected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-336"><a href="#FieldSurvivorshipStage-336"><span class="linenos">336</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">field_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">collected</span><span class="p">)))}</span>
</span><span id="FieldSurvivorshipStage-337"><a href="#FieldSurvivorshipStage-337"><span class="linenos">337</span></a>
</span><span id="FieldSurvivorshipStage-338"><a href="#FieldSurvivorshipStage-338"><span class="linenos">338</span></a>    <span class="k">def</span> <span class="nf">_process_single_field</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-339"><a href="#FieldSurvivorshipStage-339"><span class="linenos">339</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-340"><a href="#FieldSurvivorshipStage-340"><span class="linenos">340</span></a>        <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-341"><a href="#FieldSurvivorshipStage-341"><span class="linenos">341</span></a>        <span class="n">field_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage-342"><a href="#FieldSurvivorshipStage-342"><span class="linenos">342</span></a>        <span class="n">rule</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="FieldSurvivorshipStage-343"><a href="#FieldSurvivorshipStage-343"><span class="linenos">343</span></a>        <span class="n">order</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">default_order</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-344"><a href="#FieldSurvivorshipStage-344"><span class="linenos">344</span></a>        <span class="n">include_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-345"><a href="#FieldSurvivorshipStage-345"><span class="linenos">345</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-346"><a href="#FieldSurvivorshipStage-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">rule</span> <span class="o">==</span> <span class="s2">&quot;source_priority&quot;</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-347"><a href="#FieldSurvivorshipStage-347"><span class="linenos">347</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_by_source_priority</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">field_list</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="FieldSurvivorshipStage-348"><a href="#FieldSurvivorshipStage-348"><span class="linenos">348</span></a>        <span class="k">elif</span> <span class="n">rule</span> <span class="o">==</span> <span class="s2">&quot;recency&quot;</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-349"><a href="#FieldSurvivorshipStage-349"><span class="linenos">349</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_by_recency</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-350"><a href="#FieldSurvivorshipStage-350"><span class="linenos">350</span></a>                <span class="n">record</span><span class="p">,</span> <span class="n">field_list</span><span class="p">,</span> <span class="n">include_nulls</span><span class="o">=</span><span class="n">include_nulls</span>
</span><span id="FieldSurvivorshipStage-351"><a href="#FieldSurvivorshipStage-351"><span class="linenos">351</span></a>            <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-352"><a href="#FieldSurvivorshipStage-352"><span class="linenos">352</span></a>        <span class="k">elif</span> <span class="n">rule</span> <span class="o">==</span> <span class="s2">&quot;frequency&quot;</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-353"><a href="#FieldSurvivorshipStage-353"><span class="linenos">353</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_by_frequency</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">field_list</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-354"><a href="#FieldSurvivorshipStage-354"><span class="linenos">354</span></a>        <span class="k">elif</span> <span class="n">rule</span> <span class="o">==</span> <span class="s2">&quot;aggregate&quot;</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-355"><a href="#FieldSurvivorshipStage-355"><span class="linenos">355</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_by_aggregation</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">field_list</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-356"><a href="#FieldSurvivorshipStage-356"><span class="linenos">356</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-357"><a href="#FieldSurvivorshipStage-357"><span class="linenos">357</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown rule: </span><span class="si">{</span><span class="n">rule</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-358"><a href="#FieldSurvivorshipStage-358"><span class="linenos">358</span></a>
</span><span id="FieldSurvivorshipStage-359"><a href="#FieldSurvivorshipStage-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-360"><a href="#FieldSurvivorshipStage-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validated</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage-361"><a href="#FieldSurvivorshipStage-361"><span class="linenos">361</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage-362"><a href="#FieldSurvivorshipStage-362"><span class="linenos">362</span></a>
</span><span id="FieldSurvivorshipStage-363"><a href="#FieldSurvivorshipStage-363"><span class="linenos">363</span></a>        <span class="k">for</span> <span class="n">field_list_raw</span><span class="p">,</span> <span class="n">sub_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="FieldSurvivorshipStage-364"><a href="#FieldSurvivorshipStage-364"><span class="linenos">364</span></a>            <span class="n">field_list</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="FieldSurvivorshipStage-365"><a href="#FieldSurvivorshipStage-365"><span class="linenos">365</span></a>                <span class="p">[</span><span class="n">field_list_raw</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage-366"><a href="#FieldSurvivorshipStage-366"><span class="linenos">366</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_list_raw</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-367"><a href="#FieldSurvivorshipStage-367"><span class="linenos">367</span></a>                <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">field_list_raw</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage-368"><a href="#FieldSurvivorshipStage-368"><span class="linenos">368</span></a>            <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-369"><a href="#FieldSurvivorshipStage-369"><span class="linenos">369</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_single_field</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage-370"><a href="#FieldSurvivorshipStage-370"><span class="linenos">370</span></a>                <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-371"><a href="#FieldSurvivorshipStage-371"><span class="linenos">371</span></a>                <span class="n">field_list</span><span class="o">=</span><span class="n">field_list</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-372"><a href="#FieldSurvivorshipStage-372"><span class="linenos">372</span></a>                <span class="n">rule</span><span class="o">=</span><span class="n">sub_config</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage-373"><a href="#FieldSurvivorshipStage-373"><span class="linenos">373</span></a>                <span class="n">order</span><span class="o">=</span><span class="n">sub_config</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="FieldSurvivorshipStage-374"><a href="#FieldSurvivorshipStage-374"><span class="linenos">374</span></a>                <span class="k">if</span> <span class="n">sub_config</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;source_priority&quot;</span>
</span><span id="FieldSurvivorshipStage-375"><a href="#FieldSurvivorshipStage-375"><span class="linenos">375</span></a>                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage-376"><a href="#FieldSurvivorshipStage-376"><span class="linenos">376</span></a>                <span class="n">include_nulls</span><span class="o">=</span><span class="n">sub_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;include_nulls&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
</span><span id="FieldSurvivorshipStage-377"><a href="#FieldSurvivorshipStage-377"><span class="linenos">377</span></a>            <span class="p">)</span>
</span><span id="FieldSurvivorshipStage-378"><a href="#FieldSurvivorshipStage-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Survive data by field according to survivorship rules.</p>
</div>


                            <div id="FieldSurvivorshipStage.__init__" class="classattr">
                                        <input id="FieldSurvivorshipStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">FieldSurvivorshipStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;rule&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="FieldSurvivorshipStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FieldSurvivorshipStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FieldSurvivorshipStage.__init__-27"><a href="#FieldSurvivorshipStage.__init__-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage.__init__-28"><a href="#FieldSurvivorshipStage.__init__-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-29"><a href="#FieldSurvivorshipStage.__init__-29"><span class="linenos">29</span></a>        <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
</span><span id="FieldSurvivorshipStage.__init__-30"><a href="#FieldSurvivorshipStage.__init__-30"><span class="linenos">30</span></a>            <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="FieldSurvivorshipStage.__init__-31"><a href="#FieldSurvivorshipStage.__init__-31"><span class="linenos">31</span></a>            <span class="nb">dict</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
</span><span id="FieldSurvivorshipStage.__init__-32"><a href="#FieldSurvivorshipStage.__init__-32"><span class="linenos">32</span></a>        <span class="p">],</span>
</span><span id="FieldSurvivorshipStage.__init__-33"><a href="#FieldSurvivorshipStage.__init__-33"><span class="linenos">33</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-34"><a href="#FieldSurvivorshipStage.__init__-34"><span class="linenos">34</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-35"><a href="#FieldSurvivorshipStage.__init__-35"><span class="linenos">35</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-36"><a href="#FieldSurvivorshipStage.__init__-36"><span class="linenos">36</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-37"><a href="#FieldSurvivorshipStage.__init__-37"><span class="linenos">37</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage.__init__-38"><a href="#FieldSurvivorshipStage.__init__-38"><span class="linenos">38</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `FieldSurvivorshipStage`.</span>
</span><span id="FieldSurvivorshipStage.__init__-39"><a href="#FieldSurvivorshipStage.__init__-39"><span class="linenos">39</span></a>
</span><span id="FieldSurvivorshipStage.__init__-40"><a href="#FieldSurvivorshipStage.__init__-40"><span class="linenos">40</span></a><span class="sd">        Args:</span>
</span><span id="FieldSurvivorshipStage.__init__-41"><a href="#FieldSurvivorshipStage.__init__-41"><span class="linenos">41</span></a><span class="sd">            config: (dict): Configuration for the stage. Maps field names or tuples of field names to survivorship rules (and source order for `&quot;source_priority&quot;` rule.)  Tuple-keyed rules survive all the fields in the tuple as a group.  All fields are survived from the same match record.  Match records qualify if at least one of the record&#39;s tuple field values is non-empty.  They are not required to have non-empty values for all tuple fields.</span>
</span><span id="FieldSurvivorshipStage.__init__-42"><a href="#FieldSurvivorshipStage.__init__-42"><span class="linenos">42</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="FieldSurvivorshipStage.__init__-43"><a href="#FieldSurvivorshipStage.__init__-43"><span class="linenos">43</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="FieldSurvivorshipStage.__init__-44"><a href="#FieldSurvivorshipStage.__init__-44"><span class="linenos">44</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="FieldSurvivorshipStage.__init__-45"><a href="#FieldSurvivorshipStage.__init__-45"><span class="linenos">45</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="FieldSurvivorshipStage.__init__-46"><a href="#FieldSurvivorshipStage.__init__-46"><span class="linenos">46</span></a>
</span><span id="FieldSurvivorshipStage.__init__-47"><a href="#FieldSurvivorshipStage.__init__-47"><span class="linenos">47</span></a><span class="sd">        example config</span>
</span><span id="FieldSurvivorshipStage.__init__-48"><a href="#FieldSurvivorshipStage.__init__-48"><span class="linenos">48</span></a><span class="sd">                ```py</span>
</span><span id="FieldSurvivorshipStage.__init__-49"><a href="#FieldSurvivorshipStage.__init__-49"><span class="linenos">49</span></a><span class="sd">        {</span>
</span><span id="FieldSurvivorshipStage.__init__-50"><a href="#FieldSurvivorshipStage.__init__-50"><span class="linenos">50</span></a><span class="sd">            &quot;company_name&quot;: {</span>
</span><span id="FieldSurvivorshipStage.__init__-51"><a href="#FieldSurvivorshipStage.__init__-51"><span class="linenos">51</span></a><span class="sd">                &quot;rule&quot;: &quot;source_priority&quot;,</span>
</span><span id="FieldSurvivorshipStage.__init__-52"><a href="#FieldSurvivorshipStage.__init__-52"><span class="linenos">52</span></a><span class="sd">                &quot;order&quot;: [&quot;aim&quot;, &quot;salesforce&quot;, &quot;crunchbase&quot;],</span>
</span><span id="FieldSurvivorshipStage.__init__-53"><a href="#FieldSurvivorshipStage.__init__-53"><span class="linenos">53</span></a><span class="sd">            },</span>
</span><span id="FieldSurvivorshipStage.__init__-54"><a href="#FieldSurvivorshipStage.__init__-54"><span class="linenos">54</span></a><span class="sd">            &quot;data_source_key&quot;: {</span>
</span><span id="FieldSurvivorshipStage.__init__-55"><a href="#FieldSurvivorshipStage.__init__-55"><span class="linenos">55</span></a><span class="sd">                &quot;rule&quot;: &quot;source_priority&quot;,</span>
</span><span id="FieldSurvivorshipStage.__init__-56"><a href="#FieldSurvivorshipStage.__init__-56"><span class="linenos">56</span></a><span class="sd">                # sources can be grouped together as tuples</span>
</span><span id="FieldSurvivorshipStage.__init__-57"><a href="#FieldSurvivorshipStage.__init__-57"><span class="linenos">57</span></a><span class="sd">                # records from grouped sources are ranked at the same level</span>
</span><span id="FieldSurvivorshipStage.__init__-58"><a href="#FieldSurvivorshipStage.__init__-58"><span class="linenos">58</span></a><span class="sd">                # and resolve to the most recent record from any of the grouped sources</span>
</span><span id="FieldSurvivorshipStage.__init__-59"><a href="#FieldSurvivorshipStage.__init__-59"><span class="linenos">59</span></a><span class="sd">                &quot;order&quot;: [&quot;affinity&quot;, (&quot;aim&quot;, &quot;salesforce&quot;, &quot;bee&quot;), &quot;crunchbase&quot;],</span>
</span><span id="FieldSurvivorshipStage.__init__-60"><a href="#FieldSurvivorshipStage.__init__-60"><span class="linenos">60</span></a><span class="sd">            },</span>
</span><span id="FieldSurvivorshipStage.__init__-61"><a href="#FieldSurvivorshipStage.__init__-61"><span class="linenos">61</span></a><span class="sd">            &quot;investor_type&quot;: {&quot;rule&quot;: &quot;aggregate&quot;},</span>
</span><span id="FieldSurvivorshipStage.__init__-62"><a href="#FieldSurvivorshipStage.__init__-62"><span class="linenos">62</span></a><span class="sd">            &quot;all_categories&quot;: {&quot;rule&quot;: &quot;aggregate&quot;},</span>
</span><span id="FieldSurvivorshipStage.__init__-63"><a href="#FieldSurvivorshipStage.__init__-63"><span class="linenos">63</span></a><span class="sd">            &quot;state_province&quot;: {&quot;rule&quot;: &quot;recency&quot;, &quot;include_nulls&quot;: False},</span>
</span><span id="FieldSurvivorshipStage.__init__-64"><a href="#FieldSurvivorshipStage.__init__-64"><span class="linenos">64</span></a><span class="sd">            &quot;point_of_contact&quot;: {&quot;rule&quot;: &quot;frequency&quot;},</span>
</span><span id="FieldSurvivorshipStage.__init__-65"><a href="#FieldSurvivorshipStage.__init__-65"><span class="linenos">65</span></a><span class="sd">            # survives all four fields as a group</span>
</span><span id="FieldSurvivorshipStage.__init__-66"><a href="#FieldSurvivorshipStage.__init__-66"><span class="linenos">66</span></a><span class="sd">            (&quot;city&quot;, &quot;state_province&quot;, &quot;postal_code&quot;, &quot;country_of_origin&quot;): {</span>
</span><span id="FieldSurvivorshipStage.__init__-67"><a href="#FieldSurvivorshipStage.__init__-67"><span class="linenos">67</span></a><span class="sd">                &quot;rule&quot;: &quot;source_priority&quot;,</span>
</span><span id="FieldSurvivorshipStage.__init__-68"><a href="#FieldSurvivorshipStage.__init__-68"><span class="linenos">68</span></a><span class="sd">                &quot;order&quot;: [&quot;affinity&quot;, &quot;aim&quot;, &quot;salesforce&quot;, &quot;crunchbase&quot;],</span>
</span><span id="FieldSurvivorshipStage.__init__-69"><a href="#FieldSurvivorshipStage.__init__-69"><span class="linenos">69</span></a><span class="sd">            },</span>
</span><span id="FieldSurvivorshipStage.__init__-70"><a href="#FieldSurvivorshipStage.__init__-70"><span class="linenos">70</span></a><span class="sd">        }</span>
</span><span id="FieldSurvivorshipStage.__init__-71"><a href="#FieldSurvivorshipStage.__init__-71"><span class="linenos">71</span></a><span class="sd">                ```</span>
</span><span id="FieldSurvivorshipStage.__init__-72"><a href="#FieldSurvivorshipStage.__init__-72"><span class="linenos">72</span></a>
</span><span id="FieldSurvivorshipStage.__init__-73"><a href="#FieldSurvivorshipStage.__init__-73"><span class="linenos">73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FieldSurvivorshipStage.__init__-74"><a href="#FieldSurvivorshipStage.__init__-74"><span class="linenos">74</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage.__init__-75"><a href="#FieldSurvivorshipStage.__init__-75"><span class="linenos">75</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-76"><a href="#FieldSurvivorshipStage.__init__-76"><span class="linenos">76</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-77"><a href="#FieldSurvivorshipStage.__init__-77"><span class="linenos">77</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-78"><a href="#FieldSurvivorshipStage.__init__-78"><span class="linenos">78</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-79"><a href="#FieldSurvivorshipStage.__init__-79"><span class="linenos">79</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-80"><a href="#FieldSurvivorshipStage.__init__-80"><span class="linenos">80</span></a>        <span class="p">)</span>
</span><span id="FieldSurvivorshipStage.__init__-81"><a href="#FieldSurvivorshipStage.__init__-81"><span class="linenos">81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">match_field</span> <span class="o">=</span> <span class="s2">&quot;matches&quot;</span>
</span><span id="FieldSurvivorshipStage.__init__-82"><a href="#FieldSurvivorshipStage.__init__-82"><span class="linenos">82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span><span id="FieldSurvivorshipStage.__init__-83"><a href="#FieldSurvivorshipStage.__init__-83"><span class="linenos">83</span></a>        <span class="c1"># set after first call to process_record</span>
</span><span id="FieldSurvivorshipStage.__init__-84"><a href="#FieldSurvivorshipStage.__init__-84"><span class="linenos">84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FieldSurvivorshipStage.__init__-85"><a href="#FieldSurvivorshipStage.__init__-85"><span class="linenos">85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accepted_rules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="FieldSurvivorshipStage.__init__-86"><a href="#FieldSurvivorshipStage.__init__-86"><span class="linenos">86</span></a>            <span class="s2">&quot;source_priority&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-87"><a href="#FieldSurvivorshipStage.__init__-87"><span class="linenos">87</span></a>            <span class="s2">&quot;recency&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-88"><a href="#FieldSurvivorshipStage.__init__-88"><span class="linenos">88</span></a>            <span class="s2">&quot;frequency&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-89"><a href="#FieldSurvivorshipStage.__init__-89"><span class="linenos">89</span></a>            <span class="s2">&quot;aggregate&quot;</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.__init__-90"><a href="#FieldSurvivorshipStage.__init__-90"><span class="linenos">90</span></a>        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#FieldSurvivorshipStage">FieldSurvivorshipStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>config:</strong>  (dict): Configuration for the stage. Maps field names or tuples of field names to survivorship rules (and source order for <code>"source_priority"</code> rule.)  Tuple-keyed rules survive all the fields in the tuple as a group.  All fields are survived from the same match record.  Match records qualify if at least one of the record's tuple field values is non-empty.  They are not required to have non-empty values for all tuple fields.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>

<p>example config</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">{</span>
    <span class="s2">&quot;company_name&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="s2">&quot;source_priority&quot;</span><span class="p">,</span>
        <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;aim&quot;</span><span class="p">,</span> <span class="s2">&quot;salesforce&quot;</span><span class="p">,</span> <span class="s2">&quot;crunchbase&quot;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;data_source_key&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="s2">&quot;source_priority&quot;</span><span class="p">,</span>
        <span class="c1"># sources can be grouped together as tuples</span>
        <span class="c1"># records from grouped sources are ranked at the same level</span>
        <span class="c1"># and resolve to the most recent record from any of the grouped sources</span>
        <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;affinity&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;aim&quot;</span><span class="p">,</span> <span class="s2">&quot;salesforce&quot;</span><span class="p">,</span> <span class="s2">&quot;bee&quot;</span><span class="p">),</span> <span class="s2">&quot;crunchbase&quot;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;investor_type&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="s2">&quot;aggregate&quot;</span><span class="p">},</span>
    <span class="s2">&quot;all_categories&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="s2">&quot;aggregate&quot;</span><span class="p">},</span>
    <span class="s2">&quot;state_province&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="s2">&quot;recency&quot;</span><span class="p">,</span> <span class="s2">&quot;include_nulls&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="s2">&quot;point_of_contact&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="s2">&quot;frequency&quot;</span><span class="p">},</span>
    <span class="c1"># survives all four fields as a group</span>
    <span class="p">(</span><span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;state_province&quot;</span><span class="p">,</span> <span class="s2">&quot;postal_code&quot;</span><span class="p">,</span> <span class="s2">&quot;country_of_origin&quot;</span><span class="p">):</span> <span class="p">{</span>
        <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="s2">&quot;source_priority&quot;</span><span class="p">,</span>
        <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;affinity&quot;</span><span class="p">,</span> <span class="s2">&quot;aim&quot;</span><span class="p">,</span> <span class="s2">&quot;salesforce&quot;</span><span class="p">,</span> <span class="s2">&quot;crunchbase&quot;</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="FieldSurvivorshipStage.process_record" class="classattr">
                                        <input id="FieldSurvivorshipStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="FieldSurvivorshipStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FieldSurvivorshipStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FieldSurvivorshipStage.process_record-359"><a href="#FieldSurvivorshipStage.process_record-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage.process_record-360"><a href="#FieldSurvivorshipStage.process_record-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validated</span><span class="p">:</span>
</span><span id="FieldSurvivorshipStage.process_record-361"><a href="#FieldSurvivorshipStage.process_record-361"><span class="linenos">361</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">()</span>
</span><span id="FieldSurvivorshipStage.process_record-362"><a href="#FieldSurvivorshipStage.process_record-362"><span class="linenos">362</span></a>
</span><span id="FieldSurvivorshipStage.process_record-363"><a href="#FieldSurvivorshipStage.process_record-363"><span class="linenos">363</span></a>        <span class="k">for</span> <span class="n">field_list_raw</span><span class="p">,</span> <span class="n">sub_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="FieldSurvivorshipStage.process_record-364"><a href="#FieldSurvivorshipStage.process_record-364"><span class="linenos">364</span></a>            <span class="n">field_list</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="FieldSurvivorshipStage.process_record-365"><a href="#FieldSurvivorshipStage.process_record-365"><span class="linenos">365</span></a>                <span class="p">[</span><span class="n">field_list_raw</span><span class="p">]</span>
</span><span id="FieldSurvivorshipStage.process_record-366"><a href="#FieldSurvivorshipStage.process_record-366"><span class="linenos">366</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_list_raw</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage.process_record-367"><a href="#FieldSurvivorshipStage.process_record-367"><span class="linenos">367</span></a>                <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">field_list_raw</span><span class="p">)</span>
</span><span id="FieldSurvivorshipStage.process_record-368"><a href="#FieldSurvivorshipStage.process_record-368"><span class="linenos">368</span></a>            <span class="p">)</span>
</span><span id="FieldSurvivorshipStage.process_record-369"><a href="#FieldSurvivorshipStage.process_record-369"><span class="linenos">369</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_single_field</span><span class="p">(</span>
</span><span id="FieldSurvivorshipStage.process_record-370"><a href="#FieldSurvivorshipStage.process_record-370"><span class="linenos">370</span></a>                <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.process_record-371"><a href="#FieldSurvivorshipStage.process_record-371"><span class="linenos">371</span></a>                <span class="n">field_list</span><span class="o">=</span><span class="n">field_list</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.process_record-372"><a href="#FieldSurvivorshipStage.process_record-372"><span class="linenos">372</span></a>                <span class="n">rule</span><span class="o">=</span><span class="n">sub_config</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">],</span>
</span><span id="FieldSurvivorshipStage.process_record-373"><a href="#FieldSurvivorshipStage.process_record-373"><span class="linenos">373</span></a>                <span class="n">order</span><span class="o">=</span><span class="n">sub_config</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="FieldSurvivorshipStage.process_record-374"><a href="#FieldSurvivorshipStage.process_record-374"><span class="linenos">374</span></a>                <span class="k">if</span> <span class="n">sub_config</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;source_priority&quot;</span>
</span><span id="FieldSurvivorshipStage.process_record-375"><a href="#FieldSurvivorshipStage.process_record-375"><span class="linenos">375</span></a>                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="FieldSurvivorshipStage.process_record-376"><a href="#FieldSurvivorshipStage.process_record-376"><span class="linenos">376</span></a>                <span class="n">include_nulls</span><span class="o">=</span><span class="n">sub_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;include_nulls&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
</span><span id="FieldSurvivorshipStage.process_record-377"><a href="#FieldSurvivorshipStage.process_record-377"><span class="linenos">377</span></a>            <span class="p">)</span>
</span><span id="FieldSurvivorshipStage.process_record-378"><a href="#FieldSurvivorshipStage.process_record-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="FieldSurvivorshipStage.unique_name" class="variable">unique_name</dd>
                <dd id="FieldSurvivorshipStage.pipeline" class="variable">pipeline</dd>
                <dd id="FieldSurvivorshipStage.add_downstream" class="function">add_downstream</dd>
                <dd id="FieldSurvivorshipStage.add_upstream" class="function">add_upstream</dd>
                <dd id="FieldSurvivorshipStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="FieldSurvivorshipStage.channels" class="variable">channels</dd>
                <dd id="FieldSurvivorshipStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="FieldSurvivorshipStage.log" class="variable">log</dd>
                <dd id="FieldSurvivorshipStage.reset_level" class="function">reset_level</dd>
                <dd id="FieldSurvivorshipStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="IdentityStage">
                            <input id="IdentityStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IdentityStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="IdentityStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IdentityStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IdentityStage-5"><a href="#IdentityStage-5"><span class="linenos"> 5</span></a><span class="k">class</span> <span class="nc">IdentityStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="IdentityStage-6"><a href="#IdentityStage-6"><span class="linenos"> 6</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass batch through unchanged.&quot;&quot;&quot;</span>
</span><span id="IdentityStage-7"><a href="#IdentityStage-7"><span class="linenos"> 7</span></a>
</span><span id="IdentityStage-8"><a href="#IdentityStage-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="IdentityStage-9"><a href="#IdentityStage-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IdentityStage-10"><a href="#IdentityStage-10"><span class="linenos">10</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="IdentityStage-11"><a href="#IdentityStage-11"><span class="linenos">11</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="IdentityStage-12"><a href="#IdentityStage-12"><span class="linenos">12</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="IdentityStage-13"><a href="#IdentityStage-13"><span class="linenos">13</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="IdentityStage-14"><a href="#IdentityStage-14"><span class="linenos">14</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="IdentityStage-15"><a href="#IdentityStage-15"><span class="linenos">15</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `IdentityStage`.</span>
</span><span id="IdentityStage-16"><a href="#IdentityStage-16"><span class="linenos">16</span></a>
</span><span id="IdentityStage-17"><a href="#IdentityStage-17"><span class="linenos">17</span></a><span class="sd">        Args:</span>
</span><span id="IdentityStage-18"><a href="#IdentityStage-18"><span class="linenos">18</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="IdentityStage-19"><a href="#IdentityStage-19"><span class="linenos">19</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="IdentityStage-20"><a href="#IdentityStage-20"><span class="linenos">20</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="IdentityStage-21"><a href="#IdentityStage-21"><span class="linenos">21</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="IdentityStage-22"><a href="#IdentityStage-22"><span class="linenos">22</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IdentityStage-23"><a href="#IdentityStage-23"><span class="linenos">23</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="IdentityStage-24"><a href="#IdentityStage-24"><span class="linenos">24</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="IdentityStage-25"><a href="#IdentityStage-25"><span class="linenos">25</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="IdentityStage-26"><a href="#IdentityStage-26"><span class="linenos">26</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="IdentityStage-27"><a href="#IdentityStage-27"><span class="linenos">27</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="IdentityStage-28"><a href="#IdentityStage-28"><span class="linenos">28</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="IdentityStage-29"><a href="#IdentityStage-29"><span class="linenos">29</span></a>        <span class="p">)</span>
</span><span id="IdentityStage-30"><a href="#IdentityStage-30"><span class="linenos">30</span></a>
</span><span id="IdentityStage-31"><a href="#IdentityStage-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="IdentityStage-32"><a href="#IdentityStage-32"><span class="linenos">32</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Pass batch through unchanged.</p>
</div>


                            <div id="IdentityStage.__init__" class="classattr">
                                        <input id="IdentityStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">IdentityStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="IdentityStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IdentityStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IdentityStage.__init__-8"><a href="#IdentityStage.__init__-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="IdentityStage.__init__-9"><a href="#IdentityStage.__init__-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-10"><a href="#IdentityStage.__init__-10"><span class="linenos">10</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-11"><a href="#IdentityStage.__init__-11"><span class="linenos">11</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-12"><a href="#IdentityStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-13"><a href="#IdentityStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-14"><a href="#IdentityStage.__init__-14"><span class="linenos">14</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="IdentityStage.__init__-15"><a href="#IdentityStage.__init__-15"><span class="linenos">15</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `IdentityStage`.</span>
</span><span id="IdentityStage.__init__-16"><a href="#IdentityStage.__init__-16"><span class="linenos">16</span></a>
</span><span id="IdentityStage.__init__-17"><a href="#IdentityStage.__init__-17"><span class="linenos">17</span></a><span class="sd">        Args:</span>
</span><span id="IdentityStage.__init__-18"><a href="#IdentityStage.__init__-18"><span class="linenos">18</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="IdentityStage.__init__-19"><a href="#IdentityStage.__init__-19"><span class="linenos">19</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="IdentityStage.__init__-20"><a href="#IdentityStage.__init__-20"><span class="linenos">20</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="IdentityStage.__init__-21"><a href="#IdentityStage.__init__-21"><span class="linenos">21</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="IdentityStage.__init__-22"><a href="#IdentityStage.__init__-22"><span class="linenos">22</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IdentityStage.__init__-23"><a href="#IdentityStage.__init__-23"><span class="linenos">23</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="IdentityStage.__init__-24"><a href="#IdentityStage.__init__-24"><span class="linenos">24</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-25"><a href="#IdentityStage.__init__-25"><span class="linenos">25</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-26"><a href="#IdentityStage.__init__-26"><span class="linenos">26</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-27"><a href="#IdentityStage.__init__-27"><span class="linenos">27</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-28"><a href="#IdentityStage.__init__-28"><span class="linenos">28</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="IdentityStage.__init__-29"><a href="#IdentityStage.__init__-29"><span class="linenos">29</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#IdentityStage">IdentityStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="IdentityStage.process_record" class="classattr">
                                        <input id="IdentityStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="IdentityStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IdentityStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IdentityStage.process_record-31"><a href="#IdentityStage.process_record-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="IdentityStage.process_record-32"><a href="#IdentityStage.process_record-32"><span class="linenos">32</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="IdentityStage.unique_name" class="variable">unique_name</dd>
                <dd id="IdentityStage.pipeline" class="variable">pipeline</dd>
                <dd id="IdentityStage.add_downstream" class="function">add_downstream</dd>
                <dd id="IdentityStage.add_upstream" class="function">add_upstream</dd>
                <dd id="IdentityStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="IdentityStage.channels" class="variable">channels</dd>
                <dd id="IdentityStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="IdentityStage.log" class="variable">log</dd>
                <dd id="IdentityStage.reset_level" class="function">reset_level</dd>
                <dd id="IdentityStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="KeepFieldsStage">
                            <input id="KeepFieldsStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KeepFieldsStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="KeepFieldsStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KeepFieldsStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KeepFieldsStage-5"><a href="#KeepFieldsStage-5"><span class="linenos"> 5</span></a><span class="k">class</span> <span class="nc">KeepFieldsStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="KeepFieldsStage-6"><a href="#KeepFieldsStage-6"><span class="linenos"> 6</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Keeps only provided fields from each record in batch.&quot;&quot;&quot;</span>
</span><span id="KeepFieldsStage-7"><a href="#KeepFieldsStage-7"><span class="linenos"> 7</span></a>
</span><span id="KeepFieldsStage-8"><a href="#KeepFieldsStage-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="KeepFieldsStage-9"><a href="#KeepFieldsStage-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KeepFieldsStage-10"><a href="#KeepFieldsStage-10"><span class="linenos">10</span></a>        <span class="n">keep_fields</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="KeepFieldsStage-11"><a href="#KeepFieldsStage-11"><span class="linenos">11</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KeepFieldsStage-12"><a href="#KeepFieldsStage-12"><span class="linenos">12</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="KeepFieldsStage-13"><a href="#KeepFieldsStage-13"><span class="linenos">13</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="KeepFieldsStage-14"><a href="#KeepFieldsStage-14"><span class="linenos">14</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="KeepFieldsStage-15"><a href="#KeepFieldsStage-15"><span class="linenos">15</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KeepFieldsStage-16"><a href="#KeepFieldsStage-16"><span class="linenos">16</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `KeepFieldsStage`.</span>
</span><span id="KeepFieldsStage-17"><a href="#KeepFieldsStage-17"><span class="linenos">17</span></a>
</span><span id="KeepFieldsStage-18"><a href="#KeepFieldsStage-18"><span class="linenos">18</span></a><span class="sd">        Args:</span>
</span><span id="KeepFieldsStage-19"><a href="#KeepFieldsStage-19"><span class="linenos">19</span></a><span class="sd">            keep_fields (set[str]): Fields to keep.</span>
</span><span id="KeepFieldsStage-20"><a href="#KeepFieldsStage-20"><span class="linenos">20</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="KeepFieldsStage-21"><a href="#KeepFieldsStage-21"><span class="linenos">21</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="KeepFieldsStage-22"><a href="#KeepFieldsStage-22"><span class="linenos">22</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="KeepFieldsStage-23"><a href="#KeepFieldsStage-23"><span class="linenos">23</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="KeepFieldsStage-24"><a href="#KeepFieldsStage-24"><span class="linenos">24</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KeepFieldsStage-25"><a href="#KeepFieldsStage-25"><span class="linenos">25</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KeepFieldsStage-26"><a href="#KeepFieldsStage-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="KeepFieldsStage-27"><a href="#KeepFieldsStage-27"><span class="linenos">27</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="KeepFieldsStage-28"><a href="#KeepFieldsStage-28"><span class="linenos">28</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="KeepFieldsStage-29"><a href="#KeepFieldsStage-29"><span class="linenos">29</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="KeepFieldsStage-30"><a href="#KeepFieldsStage-30"><span class="linenos">30</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="KeepFieldsStage-31"><a href="#KeepFieldsStage-31"><span class="linenos">31</span></a>        <span class="p">)</span>
</span><span id="KeepFieldsStage-32"><a href="#KeepFieldsStage-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">keep_fields</span> <span class="o">=</span> <span class="n">keep_fields</span>
</span><span id="KeepFieldsStage-33"><a href="#KeepFieldsStage-33"><span class="linenos">33</span></a>
</span><span id="KeepFieldsStage-34"><a href="#KeepFieldsStage-34"><span class="linenos">34</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="KeepFieldsStage-35"><a href="#KeepFieldsStage-35"><span class="linenos">35</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_fields</span><span class="p">}</span>
</span><span id="KeepFieldsStage-36"><a href="#KeepFieldsStage-36"><span class="linenos">36</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Keeps only provided fields from each record in batch.</p>
</div>


                            <div id="KeepFieldsStage.__init__" class="classattr">
                                        <input id="KeepFieldsStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">KeepFieldsStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">keep_fields</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="KeepFieldsStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KeepFieldsStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KeepFieldsStage.__init__-8"><a href="#KeepFieldsStage.__init__-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="KeepFieldsStage.__init__-9"><a href="#KeepFieldsStage.__init__-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-10"><a href="#KeepFieldsStage.__init__-10"><span class="linenos">10</span></a>        <span class="n">keep_fields</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="KeepFieldsStage.__init__-11"><a href="#KeepFieldsStage.__init__-11"><span class="linenos">11</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-12"><a href="#KeepFieldsStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-13"><a href="#KeepFieldsStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-14"><a href="#KeepFieldsStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-15"><a href="#KeepFieldsStage.__init__-15"><span class="linenos">15</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KeepFieldsStage.__init__-16"><a href="#KeepFieldsStage.__init__-16"><span class="linenos">16</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `KeepFieldsStage`.</span>
</span><span id="KeepFieldsStage.__init__-17"><a href="#KeepFieldsStage.__init__-17"><span class="linenos">17</span></a>
</span><span id="KeepFieldsStage.__init__-18"><a href="#KeepFieldsStage.__init__-18"><span class="linenos">18</span></a><span class="sd">        Args:</span>
</span><span id="KeepFieldsStage.__init__-19"><a href="#KeepFieldsStage.__init__-19"><span class="linenos">19</span></a><span class="sd">            keep_fields (set[str]): Fields to keep.</span>
</span><span id="KeepFieldsStage.__init__-20"><a href="#KeepFieldsStage.__init__-20"><span class="linenos">20</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="KeepFieldsStage.__init__-21"><a href="#KeepFieldsStage.__init__-21"><span class="linenos">21</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="KeepFieldsStage.__init__-22"><a href="#KeepFieldsStage.__init__-22"><span class="linenos">22</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="KeepFieldsStage.__init__-23"><a href="#KeepFieldsStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="KeepFieldsStage.__init__-24"><a href="#KeepFieldsStage.__init__-24"><span class="linenos">24</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KeepFieldsStage.__init__-25"><a href="#KeepFieldsStage.__init__-25"><span class="linenos">25</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KeepFieldsStage.__init__-26"><a href="#KeepFieldsStage.__init__-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-27"><a href="#KeepFieldsStage.__init__-27"><span class="linenos">27</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-28"><a href="#KeepFieldsStage.__init__-28"><span class="linenos">28</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-29"><a href="#KeepFieldsStage.__init__-29"><span class="linenos">29</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-30"><a href="#KeepFieldsStage.__init__-30"><span class="linenos">30</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="KeepFieldsStage.__init__-31"><a href="#KeepFieldsStage.__init__-31"><span class="linenos">31</span></a>        <span class="p">)</span>
</span><span id="KeepFieldsStage.__init__-32"><a href="#KeepFieldsStage.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">keep_fields</span> <span class="o">=</span> <span class="n">keep_fields</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#KeepFieldsStage">KeepFieldsStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>keep_fields (set[str]):</strong>  Fields to keep.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="KeepFieldsStage.process_record" class="classattr">
                                        <input id="KeepFieldsStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="KeepFieldsStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KeepFieldsStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KeepFieldsStage.process_record-34"><a href="#KeepFieldsStage.process_record-34"><span class="linenos">34</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="KeepFieldsStage.process_record-35"><a href="#KeepFieldsStage.process_record-35"><span class="linenos">35</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_fields</span><span class="p">}</span>
</span><span id="KeepFieldsStage.process_record-36"><a href="#KeepFieldsStage.process_record-36"><span class="linenos">36</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="KeepFieldsStage.unique_name" class="variable">unique_name</dd>
                <dd id="KeepFieldsStage.pipeline" class="variable">pipeline</dd>
                <dd id="KeepFieldsStage.add_downstream" class="function">add_downstream</dd>
                <dd id="KeepFieldsStage.add_upstream" class="function">add_upstream</dd>
                <dd id="KeepFieldsStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="KeepFieldsStage.channels" class="variable">channels</dd>
                <dd id="KeepFieldsStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="KeepFieldsStage.log" class="variable">log</dd>
                <dd id="KeepFieldsStage.reset_level" class="function">reset_level</dd>
                <dd id="KeepFieldsStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MasterMatchStage">
                            <input id="MasterMatchStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MasterMatchStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="MasterMatchStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MasterMatchStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MasterMatchStage-17"><a href="#MasterMatchStage-17"><span class="linenos"> 17</span></a><span class="k">class</span> <span class="nc">MasterMatchStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="MasterMatchStage-18"><a href="#MasterMatchStage-18"><span class="linenos"> 18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Looks up existing master table records for a given Record.&quot;&quot;&quot;</span>
</span><span id="MasterMatchStage-19"><a href="#MasterMatchStage-19"><span class="linenos"> 19</span></a>
</span><span id="MasterMatchStage-20"><a href="#MasterMatchStage-20"><span class="linenos"> 20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MasterMatchStage-21"><a href="#MasterMatchStage-21"><span class="linenos"> 21</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MasterMatchStage-22"><a href="#MasterMatchStage-22"><span class="linenos"> 22</span></a>        <span class="n">master_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MasterMatchStage-23"><a href="#MasterMatchStage-23"><span class="linenos"> 23</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="MasterMatchStage-24"><a href="#MasterMatchStage-24"><span class="linenos"> 24</span></a>        <span class="n">record_data_source_key_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data_source_key&quot;</span><span class="p">,</span>
</span><span id="MasterMatchStage-25"><a href="#MasterMatchStage-25"><span class="linenos"> 25</span></a>        <span class="n">match_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="MasterMatchStage-26"><a href="#MasterMatchStage-26"><span class="linenos"> 26</span></a>        <span class="n">timestamp_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span>
</span><span id="MasterMatchStage-27"><a href="#MasterMatchStage-27"><span class="linenos"> 27</span></a>        <span class="n">date_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MasterMatchStage-28"><a href="#MasterMatchStage-28"><span class="linenos"> 28</span></a>        <span class="n">sort_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span>
</span><span id="MasterMatchStage-29"><a href="#MasterMatchStage-29"><span class="linenos"> 29</span></a>        <span class="n">sort_reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MasterMatchStage-30"><a href="#MasterMatchStage-30"><span class="linenos"> 30</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MasterMatchStage-31"><a href="#MasterMatchStage-31"><span class="linenos"> 31</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MasterMatchStage-32"><a href="#MasterMatchStage-32"><span class="linenos"> 32</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="MasterMatchStage-33"><a href="#MasterMatchStage-33"><span class="linenos"> 33</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MasterMatchStage-34"><a href="#MasterMatchStage-34"><span class="linenos"> 34</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MasterMatchStage-35"><a href="#MasterMatchStage-35"><span class="linenos"> 35</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `MasterMatchStage`.</span>
</span><span id="MasterMatchStage-36"><a href="#MasterMatchStage-36"><span class="linenos"> 36</span></a>
</span><span id="MasterMatchStage-37"><a href="#MasterMatchStage-37"><span class="linenos"> 37</span></a><span class="sd">        Args:</span>
</span><span id="MasterMatchStage-38"><a href="#MasterMatchStage-38"><span class="linenos"> 38</span></a><span class="sd">            master_table (str): The name of the master table on which to perform match.</span>
</span><span id="MasterMatchStage-39"><a href="#MasterMatchStage-39"><span class="linenos"> 39</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Connection pool to use connections from for matching.</span>
</span><span id="MasterMatchStage-40"><a href="#MasterMatchStage-40"><span class="linenos"> 40</span></a><span class="sd">            record_data_source_key_field (str, optional): The name of the field in the record data that contains the data source key. Defaults to `&quot;data_source_key&quot;`.</span>
</span><span id="MasterMatchStage-41"><a href="#MasterMatchStage-41"><span class="linenos"> 41</span></a><span class="sd">            match_ratio (float): The ratio of hash matches required to consider a record a match. 1 is all hashes match, or record already in master, 0.5 would be half the hashes match, etc.</span>
</span><span id="MasterMatchStage-42"><a href="#MasterMatchStage-42"><span class="linenos"> 42</span></a><span class="sd">            timestamp_fields (List[str], optional): list of fields in timestamp format.  parsed from strings to python datetimes.  Defaults to `[&quot;ts_updated&quot;]`</span>
</span><span id="MasterMatchStage-43"><a href="#MasterMatchStage-43"><span class="linenos"> 43</span></a><span class="sd">            date_fields (List[str], optional): list of fields in date format.  parsed from strings to python dates.  Defaults to `None`</span>
</span><span id="MasterMatchStage-44"><a href="#MasterMatchStage-44"><span class="linenos"> 44</span></a><span class="sd">            sort_fields (List[str], optional): list of fields to use in sorting match results.  sorts the returned matches by values in these fields. Sorting is not applied when empty or None. Defaults to `[&quot;ts_updated&quot;]`</span>
</span><span id="MasterMatchStage-45"><a href="#MasterMatchStage-45"><span class="linenos"> 45</span></a><span class="sd">            sort_reverse (bool): sort matches in reverse order.  Applies to all sort keys. Only used when sort_fields also present. Defaults to `True`.</span>
</span><span id="MasterMatchStage-46"><a href="#MasterMatchStage-46"><span class="linenos"> 46</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="MasterMatchStage-47"><a href="#MasterMatchStage-47"><span class="linenos"> 47</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="MasterMatchStage-48"><a href="#MasterMatchStage-48"><span class="linenos"> 48</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="MasterMatchStage-49"><a href="#MasterMatchStage-49"><span class="linenos"> 49</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="MasterMatchStage-50"><a href="#MasterMatchStage-50"><span class="linenos"> 50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MasterMatchStage-51"><a href="#MasterMatchStage-51"><span class="linenos"> 51</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MasterMatchStage-52"><a href="#MasterMatchStage-52"><span class="linenos"> 52</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MasterMatchStage-53"><a href="#MasterMatchStage-53"><span class="linenos"> 53</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="MasterMatchStage-54"><a href="#MasterMatchStage-54"><span class="linenos"> 54</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="MasterMatchStage-55"><a href="#MasterMatchStage-55"><span class="linenos"> 55</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="MasterMatchStage-56"><a href="#MasterMatchStage-56"><span class="linenos"> 56</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="MasterMatchStage-57"><a href="#MasterMatchStage-57"><span class="linenos"> 57</span></a>        <span class="p">)</span>
</span><span id="MasterMatchStage-58"><a href="#MasterMatchStage-58"><span class="linenos"> 58</span></a>
</span><span id="MasterMatchStage-59"><a href="#MasterMatchStage-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">master_table</span> <span class="o">=</span> <span class="n">master_table</span>
</span><span id="MasterMatchStage-60"><a href="#MasterMatchStage-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span><span id="MasterMatchStage-61"><a href="#MasterMatchStage-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">match_ratio</span> <span class="o">=</span> <span class="n">match_ratio</span>
</span><span id="MasterMatchStage-62"><a href="#MasterMatchStage-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">record_data_source_key_field</span> <span class="o">=</span> <span class="n">record_data_source_key_field</span>
</span><span id="MasterMatchStage-63"><a href="#MasterMatchStage-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_fields</span> <span class="o">=</span> <span class="n">timestamp_fields</span>
</span><span id="MasterMatchStage-64"><a href="#MasterMatchStage-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_fields</span> <span class="o">=</span> <span class="n">date_fields</span>
</span><span id="MasterMatchStage-65"><a href="#MasterMatchStage-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span> <span class="o">=</span> <span class="n">sort_fields</span>
</span><span id="MasterMatchStage-66"><a href="#MasterMatchStage-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort_reverse</span> <span class="o">=</span> <span class="n">sort_reverse</span>
</span><span id="MasterMatchStage-67"><a href="#MasterMatchStage-67"><span class="linenos"> 67</span></a>
</span><span id="MasterMatchStage-68"><a href="#MasterMatchStage-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="nf">_validate_lookup_results</span><span class="p">(</span>
</span><span id="MasterMatchStage-69"><a href="#MasterMatchStage-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictRow</span><span class="p">]</span>
</span><span id="MasterMatchStage-70"><a href="#MasterMatchStage-70"><span class="linenos"> 70</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MasterMatchStage-71"><a href="#MasterMatchStage-71"><span class="linenos"> 71</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MasterMatchStage-72"><a href="#MasterMatchStage-72"><span class="linenos"> 72</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="MasterMatchStage-73"><a href="#MasterMatchStage-73"><span class="linenos"> 73</span></a>                <span class="sa">f</span><span class="s2">&quot;Lookup query must return exactly one row. Got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows.&quot;</span>
</span><span id="MasterMatchStage-74"><a href="#MasterMatchStage-74"><span class="linenos"> 74</span></a>            <span class="p">)</span>
</span><span id="MasterMatchStage-75"><a href="#MasterMatchStage-75"><span class="linenos"> 75</span></a>
</span><span id="MasterMatchStage-76"><a href="#MasterMatchStage-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">_date_from_postgres_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_str</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MasterMatchStage-77"><a href="#MasterMatchStage-77"><span class="linenos"> 77</span></a>        <span class="n">retval</span> <span class="o">=</span> <span class="n">ts_str</span>
</span><span id="MasterMatchStage-78"><a href="#MasterMatchStage-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MasterMatchStage-79"><a href="#MasterMatchStage-79"><span class="linenos"> 79</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">retval</span><span class="p">)</span>
</span><span id="MasterMatchStage-80"><a href="#MasterMatchStage-80"><span class="linenos"> 80</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="MasterMatchStage-81"><a href="#MasterMatchStage-81"><span class="linenos"> 81</span></a>                <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</span><span id="MasterMatchStage-82"><a href="#MasterMatchStage-82"><span class="linenos"> 82</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="MasterMatchStage-83"><a href="#MasterMatchStage-83"><span class="linenos"> 83</span></a>
</span><span id="MasterMatchStage-84"><a href="#MasterMatchStage-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="nf">_timestamp_from_postgres_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_str</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MasterMatchStage-85"><a href="#MasterMatchStage-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="n">ts_str</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">ts_str</span>
</span><span id="MasterMatchStage-86"><a href="#MasterMatchStage-86"><span class="linenos"> 86</span></a>
</span><span id="MasterMatchStage-87"><a href="#MasterMatchStage-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">_post_process_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="MasterMatchStage-88"><a href="#MasterMatchStage-88"><span class="linenos"> 88</span></a>        <span class="n">retval</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MasterMatchStage-89"><a href="#MasterMatchStage-89"><span class="linenos"> 89</span></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="MasterMatchStage-90"><a href="#MasterMatchStage-90"><span class="linenos"> 90</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MasterMatchStage-91"><a href="#MasterMatchStage-91"><span class="linenos"> 91</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_fields</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_fields</span><span class="p">:</span>
</span><span id="MasterMatchStage-92"><a href="#MasterMatchStage-92"><span class="linenos"> 92</span></a>                    <span class="k">match</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_date_from_postgres_str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="MasterMatchStage-93"><a href="#MasterMatchStage-93"><span class="linenos"> 93</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_fields</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_fields</span><span class="p">:</span>
</span><span id="MasterMatchStage-94"><a href="#MasterMatchStage-94"><span class="linenos"> 94</span></a>                    <span class="k">match</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp_from_postgres_str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="MasterMatchStage-95"><a href="#MasterMatchStage-95"><span class="linenos"> 95</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MasterMatchStage-96"><a href="#MasterMatchStage-96"><span class="linenos"> 96</span></a>                    <span class="k">match</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="MasterMatchStage-97"><a href="#MasterMatchStage-97"><span class="linenos"> 97</span></a>            <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
</span><span id="MasterMatchStage-98"><a href="#MasterMatchStage-98"><span class="linenos"> 98</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span><span class="p">:</span>
</span><span id="MasterMatchStage-99"><a href="#MasterMatchStage-99"><span class="linenos"> 99</span></a>            <span class="c1"># when sort_reverse = True, descending on all keys, nulls last - default config</span>
</span><span id="MasterMatchStage-100"><a href="#MasterMatchStage-100"><span class="linenos">100</span></a>            <span class="c1"># when sort_reverse = False, ascending on all keys, nulls last</span>
</span><span id="MasterMatchStage-101"><a href="#MasterMatchStage-101"><span class="linenos">101</span></a>            <span class="c1"># generalized null handling for sorting: https://stackoverflow.com/a/72138073</span>
</span><span id="MasterMatchStage-102"><a href="#MasterMatchStage-102"><span class="linenos">102</span></a>            <span class="k">def</span> <span class="nf">_sort_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="MasterMatchStage-103"><a href="#MasterMatchStage-103"><span class="linenos">103</span></a>                <span class="k">return</span> <span class="p">(</span>
</span><span id="MasterMatchStage-104"><a href="#MasterMatchStage-104"><span class="linenos">104</span></a>                    <span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span><span class="p">]</span>
</span><span id="MasterMatchStage-105"><a href="#MasterMatchStage-105"><span class="linenos">105</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_reverse</span>
</span><span id="MasterMatchStage-106"><a href="#MasterMatchStage-106"><span class="linenos">106</span></a>                    <span class="k">else</span> <span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span><span class="p">]</span>
</span><span id="MasterMatchStage-107"><a href="#MasterMatchStage-107"><span class="linenos">107</span></a>                <span class="p">)</span>
</span><span id="MasterMatchStage-108"><a href="#MasterMatchStage-108"><span class="linenos">108</span></a>
</span><span id="MasterMatchStage-109"><a href="#MasterMatchStage-109"><span class="linenos">109</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_sort_func</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sort_reverse</span><span class="p">)</span>
</span><span id="MasterMatchStage-110"><a href="#MasterMatchStage-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="MasterMatchStage-111"><a href="#MasterMatchStage-111"><span class="linenos">111</span></a>
</span><span id="MasterMatchStage-112"><a href="#MasterMatchStage-112"><span class="linenos">112</span></a>    <span class="k">def</span> <span class="nf">_process_lookup_results</span><span class="p">(</span>
</span><span id="MasterMatchStage-113"><a href="#MasterMatchStage-113"><span class="linenos">113</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictRow</span><span class="p">]</span>
</span><span id="MasterMatchStage-114"><a href="#MasterMatchStage-114"><span class="linenos">114</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MasterMatchStage-115"><a href="#MasterMatchStage-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_lookup_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="MasterMatchStage-116"><a href="#MasterMatchStage-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MasterMatchStage-117"><a href="#MasterMatchStage-117"><span class="linenos">117</span></a>
</span><span id="MasterMatchStage-118"><a href="#MasterMatchStage-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">_do_lookup</span><span class="p">(</span>
</span><span id="MasterMatchStage-119"><a href="#MasterMatchStage-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">:</span> <span class="n">connection</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_data</span><span class="p">:</span> <span class="n">RecordData</span>
</span><span id="MasterMatchStage-120"><a href="#MasterMatchStage-120"><span class="linenos">120</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MasterMatchStage-121"><a href="#MasterMatchStage-121"><span class="linenos">121</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_factory</span><span class="o">=</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictCursor</span><span class="p">)</span>
</span><span id="MasterMatchStage-122"><a href="#MasterMatchStage-122"><span class="linenos">122</span></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">record_data</span><span class="p">)</span>
</span><span id="MasterMatchStage-123"><a href="#MasterMatchStage-123"><span class="linenos">123</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="MasterMatchStage-124"><a href="#MasterMatchStage-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_lookup_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="MasterMatchStage-125"><a href="#MasterMatchStage-125"><span class="linenos">125</span></a>
</span><span id="MasterMatchStage-126"><a href="#MasterMatchStage-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="MasterMatchStage-127"><a href="#MasterMatchStage-127"><span class="linenos">127</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="MasterMatchStage-128"><a href="#MasterMatchStage-128"><span class="linenos">128</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MasterMatchStage-129"><a href="#MasterMatchStage-129"><span class="linenos">129</span></a>            <span class="n">lookup_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_lookup</span><span class="p">(</span>
</span><span id="MasterMatchStage-130"><a href="#MasterMatchStage-130"><span class="linenos">130</span></a>                <span class="n">conn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_query</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span>
</span><span id="MasterMatchStage-131"><a href="#MasterMatchStage-131"><span class="linenos">131</span></a>            <span class="p">)</span>
</span><span id="MasterMatchStage-132"><a href="#MasterMatchStage-132"><span class="linenos">132</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="MasterMatchStage-133"><a href="#MasterMatchStage-133"><span class="linenos">133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="MasterMatchStage-134"><a href="#MasterMatchStage-134"><span class="linenos">134</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">lookup_results</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span>
</span><span id="MasterMatchStage-135"><a href="#MasterMatchStage-135"><span class="linenos">135</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="MasterMatchStage-136"><a href="#MasterMatchStage-136"><span class="linenos">136</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_matches</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">])</span>
</span><span id="MasterMatchStage-137"><a href="#MasterMatchStage-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="n">record</span>
</span><span id="MasterMatchStage-138"><a href="#MasterMatchStage-138"><span class="linenos">138</span></a>
</span><span id="MasterMatchStage-139"><a href="#MasterMatchStage-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">_construct_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">:</span>
</span><span id="MasterMatchStage-140"><a href="#MasterMatchStage-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span>
</span><span id="MasterMatchStage-141"><a href="#MasterMatchStage-141"><span class="linenos">141</span></a>            <span class="n">dedent</span><span class="p">(</span>
</span><span id="MasterMatchStage-142"><a href="#MasterMatchStage-142"><span class="linenos">142</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MasterMatchStage-143"><a href="#MasterMatchStage-143"><span class="linenos">143</span></a><span class="sd">                WITH all_matches AS (</span>
</span><span id="MasterMatchStage-144"><a href="#MasterMatchStage-144"><span class="linenos">144</span></a><span class="sd">                    WITH master_matches AS (</span>
</span><span id="MasterMatchStage-145"><a href="#MasterMatchStage-145"><span class="linenos">145</span></a><span class="sd">                        WITH master_record AS (</span>
</span><span id="MasterMatchStage-146"><a href="#MasterMatchStage-146"><span class="linenos">146</span></a><span class="sd">                            SELECT</span>
</span><span id="MasterMatchStage-147"><a href="#MasterMatchStage-147"><span class="linenos">147</span></a><span class="sd">                                *</span>
</span><span id="MasterMatchStage-148"><a href="#MasterMatchStage-148"><span class="linenos">148</span></a><span class="sd">                            FROM</span>
</span><span id="MasterMatchStage-149"><a href="#MasterMatchStage-149"><span class="linenos">149</span></a><span class="sd">                                master.{master_table_name}</span>
</span><span id="MasterMatchStage-150"><a href="#MasterMatchStage-150"><span class="linenos">150</span></a><span class="sd">                            WHERE</span>
</span><span id="MasterMatchStage-151"><a href="#MasterMatchStage-151"><span class="linenos">151</span></a><span class="sd">                                array[{record_data_source_key}::text] &amp;&amp; data_source_keys</span>
</span><span id="MasterMatchStage-152"><a href="#MasterMatchStage-152"><span class="linenos">152</span></a><span class="sd">                        ) -- end master_record</span>
</span><span id="MasterMatchStage-153"><a href="#MasterMatchStage-153"><span class="linenos">153</span></a><span class="sd">                        SELECT</span>
</span><span id="MasterMatchStage-154"><a href="#MasterMatchStage-154"><span class="linenos">154</span></a><span class="sd">                            cl.*, 1 AS MATCH</span>
</span><span id="MasterMatchStage-155"><a href="#MasterMatchStage-155"><span class="linenos">155</span></a><span class="sd">                        FROM</span>
</span><span id="MasterMatchStage-156"><a href="#MasterMatchStage-156"><span class="linenos">156</span></a><span class="sd">                            master_record mr</span>
</span><span id="MasterMatchStage-157"><a href="#MasterMatchStage-157"><span class="linenos">157</span></a><span class="sd">                        JOIN clean.{master_table_name} cl ON</span>
</span><span id="MasterMatchStage-158"><a href="#MasterMatchStage-158"><span class="linenos">158</span></a><span class="sd">                            cl.data_source_key = ANY (data_source_keys)</span>
</span><span id="MasterMatchStage-159"><a href="#MasterMatchStage-159"><span class="linenos">159</span></a><span class="sd">                    ) -- end master_matches</span>
</span><span id="MasterMatchStage-160"><a href="#MasterMatchStage-160"><span class="linenos">160</span></a><span class="sd">                    ,hash_matches AS (</span>
</span><span id="MasterMatchStage-161"><a href="#MasterMatchStage-161"><span class="linenos">161</span></a><span class="sd">                        WITH incoming AS (</span>
</span><span id="MasterMatchStage-162"><a href="#MasterMatchStage-162"><span class="linenos">162</span></a><span class="sd">                            SELECT</span>
</span><span id="MasterMatchStage-163"><a href="#MasterMatchStage-163"><span class="linenos">163</span></a><span class="sd">                                array_hash</span>
</span><span id="MasterMatchStage-164"><a href="#MasterMatchStage-164"><span class="linenos">164</span></a><span class="sd">                            FROM</span>
</span><span id="MasterMatchStage-165"><a href="#MasterMatchStage-165"><span class="linenos">165</span></a><span class="sd">                                clean.{master_table_name}</span>
</span><span id="MasterMatchStage-166"><a href="#MasterMatchStage-166"><span class="linenos">166</span></a><span class="sd">                            WHERE</span>
</span><span id="MasterMatchStage-167"><a href="#MasterMatchStage-167"><span class="linenos">167</span></a><span class="sd">                                data_source_key = {record_data_source_key}</span>
</span><span id="MasterMatchStage-168"><a href="#MasterMatchStage-168"><span class="linenos">168</span></a><span class="sd">                        )</span>
</span><span id="MasterMatchStage-169"><a href="#MasterMatchStage-169"><span class="linenos">169</span></a><span class="sd">                        SELECT</span>
</span><span id="MasterMatchStage-170"><a href="#MasterMatchStage-170"><span class="linenos">170</span></a><span class="sd">                            id, CARDINALITY( ARRAY ( SELECT UNNEST(searching.array_hash) INTERSECT SELECT UNNEST(incoming.array_hash) ))::decimal / CARDINALITY(incoming.array_hash) AS MATCH</span>
</span><span id="MasterMatchStage-171"><a href="#MasterMatchStage-171"><span class="linenos">171</span></a><span class="sd">                        FROM</span>
</span><span id="MasterMatchStage-172"><a href="#MasterMatchStage-172"><span class="linenos">172</span></a><span class="sd">                            clean.{master_table_name} searching, incoming</span>
</span><span id="MasterMatchStage-173"><a href="#MasterMatchStage-173"><span class="linenos">173</span></a><span class="sd">                        WHERE</span>
</span><span id="MasterMatchStage-174"><a href="#MasterMatchStage-174"><span class="linenos">174</span></a><span class="sd">                            searching.array_hash &amp;&amp; incoming.array_hash</span>
</span><span id="MasterMatchStage-175"><a href="#MasterMatchStage-175"><span class="linenos">175</span></a><span class="sd">                    ) -- end hash_matches</span>
</span><span id="MasterMatchStage-176"><a href="#MasterMatchStage-176"><span class="linenos">176</span></a><span class="sd">                    SELECT</span>
</span><span id="MasterMatchStage-177"><a href="#MasterMatchStage-177"><span class="linenos">177</span></a><span class="sd">                        mm.id</span>
</span><span id="MasterMatchStage-178"><a href="#MasterMatchStage-178"><span class="linenos">178</span></a><span class="sd">                    FROM</span>
</span><span id="MasterMatchStage-179"><a href="#MasterMatchStage-179"><span class="linenos">179</span></a><span class="sd">                        master_matches mm</span>
</span><span id="MasterMatchStage-180"><a href="#MasterMatchStage-180"><span class="linenos">180</span></a><span class="sd">                    UNION ALL</span>
</span><span id="MasterMatchStage-181"><a href="#MasterMatchStage-181"><span class="linenos">181</span></a><span class="sd">                    SELECT</span>
</span><span id="MasterMatchStage-182"><a href="#MasterMatchStage-182"><span class="linenos">182</span></a><span class="sd">                        hm.id</span>
</span><span id="MasterMatchStage-183"><a href="#MasterMatchStage-183"><span class="linenos">183</span></a><span class="sd">                    FROM</span>
</span><span id="MasterMatchStage-184"><a href="#MasterMatchStage-184"><span class="linenos">184</span></a><span class="sd">                        hash_matches hm</span>
</span><span id="MasterMatchStage-185"><a href="#MasterMatchStage-185"><span class="linenos">185</span></a><span class="sd">                    WHERE</span>
</span><span id="MasterMatchStage-186"><a href="#MasterMatchStage-186"><span class="linenos">186</span></a><span class="sd">                        MATCH &gt;= {match_ratio}</span>
</span><span id="MasterMatchStage-187"><a href="#MasterMatchStage-187"><span class="linenos">187</span></a><span class="sd">                        -- MATCH RATIO (1 is already in master, or all hashes match, 0.5 would be half the hashes match, etc)</span>
</span><span id="MasterMatchStage-188"><a href="#MasterMatchStage-188"><span class="linenos">188</span></a><span class="sd">                    UNION ALL</span>
</span><span id="MasterMatchStage-189"><a href="#MasterMatchStage-189"><span class="linenos">189</span></a><span class="sd">                    SELECT</span>
</span><span id="MasterMatchStage-190"><a href="#MasterMatchStage-190"><span class="linenos">190</span></a><span class="sd">                        self_m.id</span>
</span><span id="MasterMatchStage-191"><a href="#MasterMatchStage-191"><span class="linenos">191</span></a><span class="sd">                    FROM</span>
</span><span id="MasterMatchStage-192"><a href="#MasterMatchStage-192"><span class="linenos">192</span></a><span class="sd">                        clean.{master_table_name} self_m</span>
</span><span id="MasterMatchStage-193"><a href="#MasterMatchStage-193"><span class="linenos">193</span></a><span class="sd">                    WHERE</span>
</span><span id="MasterMatchStage-194"><a href="#MasterMatchStage-194"><span class="linenos">194</span></a><span class="sd">                        data_source_key = {record_data_source_key}</span>
</span><span id="MasterMatchStage-195"><a href="#MasterMatchStage-195"><span class="linenos">195</span></a><span class="sd">                )  -- end all_matches</span>
</span><span id="MasterMatchStage-196"><a href="#MasterMatchStage-196"><span class="linenos">196</span></a><span class="sd">                SELECT</span>
</span><span id="MasterMatchStage-197"><a href="#MasterMatchStage-197"><span class="linenos">197</span></a><span class="sd">                    JSON_AGG(DISTINCT(cl.*))::TEXT AS matches</span>
</span><span id="MasterMatchStage-198"><a href="#MasterMatchStage-198"><span class="linenos">198</span></a><span class="sd">                FROM</span>
</span><span id="MasterMatchStage-199"><a href="#MasterMatchStage-199"><span class="linenos">199</span></a><span class="sd">                    all_matches am</span>
</span><span id="MasterMatchStage-200"><a href="#MasterMatchStage-200"><span class="linenos">200</span></a><span class="sd">                JOIN clean.{master_table_name} cl ON</span>
</span><span id="MasterMatchStage-201"><a href="#MasterMatchStage-201"><span class="linenos">201</span></a><span class="sd">                    am.id = cl.id</span>
</span><span id="MasterMatchStage-202"><a href="#MasterMatchStage-202"><span class="linenos">202</span></a><span class="sd">                WHERE cl.ts_status IS NULL OR cl.ts_status != &#39;DELETED&#39;</span>
</span><span id="MasterMatchStage-203"><a href="#MasterMatchStage-203"><span class="linenos">203</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MasterMatchStage-204"><a href="#MasterMatchStage-204"><span class="linenos">204</span></a>            <span class="p">)</span>
</span><span id="MasterMatchStage-205"><a href="#MasterMatchStage-205"><span class="linenos">205</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="MasterMatchStage-206"><a href="#MasterMatchStage-206"><span class="linenos">206</span></a>            <span class="n">record_data_source_key</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span>
</span><span id="MasterMatchStage-207"><a href="#MasterMatchStage-207"><span class="linenos">207</span></a>                <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">record_data_source_key_field</span><span class="p">]</span>
</span><span id="MasterMatchStage-208"><a href="#MasterMatchStage-208"><span class="linenos">208</span></a>            <span class="p">),</span>
</span><span id="MasterMatchStage-209"><a href="#MasterMatchStage-209"><span class="linenos">209</span></a>            <span class="n">master_table_name</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_table</span><span class="p">),</span>
</span><span id="MasterMatchStage-210"><a href="#MasterMatchStage-210"><span class="linenos">210</span></a>            <span class="n">match_ratio</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match_ratio</span><span class="p">),</span>
</span><span id="MasterMatchStage-211"><a href="#MasterMatchStage-211"><span class="linenos">211</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Looks up existing master table records for a given Record.</p>
</div>


                            <div id="MasterMatchStage.__init__" class="classattr">
                                        <input id="MasterMatchStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MasterMatchStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">master_table</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">connection_pool</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">postgres_connection_pool</span><span class="o">.</span><span class="n">PostgresConnectionPool</span>,</span><span class="param">	<span class="n">record_data_source_key_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;data_source_key&#39;</span>,</span><span class="param">	<span class="n">match_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>,</span><span class="param">	<span class="n">timestamp_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ts_updated&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">date_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sort_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ts_updated&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">sort_reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="MasterMatchStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MasterMatchStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MasterMatchStage.__init__-20"><a href="#MasterMatchStage.__init__-20"><span class="linenos">20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MasterMatchStage.__init__-21"><a href="#MasterMatchStage.__init__-21"><span class="linenos">21</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-22"><a href="#MasterMatchStage.__init__-22"><span class="linenos">22</span></a>        <span class="n">master_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-23"><a href="#MasterMatchStage.__init__-23"><span class="linenos">23</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-24"><a href="#MasterMatchStage.__init__-24"><span class="linenos">24</span></a>        <span class="n">record_data_source_key_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data_source_key&quot;</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-25"><a href="#MasterMatchStage.__init__-25"><span class="linenos">25</span></a>        <span class="n">match_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-26"><a href="#MasterMatchStage.__init__-26"><span class="linenos">26</span></a>        <span class="n">timestamp_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span>
</span><span id="MasterMatchStage.__init__-27"><a href="#MasterMatchStage.__init__-27"><span class="linenos">27</span></a>        <span class="n">date_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-28"><a href="#MasterMatchStage.__init__-28"><span class="linenos">28</span></a>        <span class="n">sort_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span>
</span><span id="MasterMatchStage.__init__-29"><a href="#MasterMatchStage.__init__-29"><span class="linenos">29</span></a>        <span class="n">sort_reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-30"><a href="#MasterMatchStage.__init__-30"><span class="linenos">30</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-31"><a href="#MasterMatchStage.__init__-31"><span class="linenos">31</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-32"><a href="#MasterMatchStage.__init__-32"><span class="linenos">32</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-33"><a href="#MasterMatchStage.__init__-33"><span class="linenos">33</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-34"><a href="#MasterMatchStage.__init__-34"><span class="linenos">34</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MasterMatchStage.__init__-35"><a href="#MasterMatchStage.__init__-35"><span class="linenos">35</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `MasterMatchStage`.</span>
</span><span id="MasterMatchStage.__init__-36"><a href="#MasterMatchStage.__init__-36"><span class="linenos">36</span></a>
</span><span id="MasterMatchStage.__init__-37"><a href="#MasterMatchStage.__init__-37"><span class="linenos">37</span></a><span class="sd">        Args:</span>
</span><span id="MasterMatchStage.__init__-38"><a href="#MasterMatchStage.__init__-38"><span class="linenos">38</span></a><span class="sd">            master_table (str): The name of the master table on which to perform match.</span>
</span><span id="MasterMatchStage.__init__-39"><a href="#MasterMatchStage.__init__-39"><span class="linenos">39</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Connection pool to use connections from for matching.</span>
</span><span id="MasterMatchStage.__init__-40"><a href="#MasterMatchStage.__init__-40"><span class="linenos">40</span></a><span class="sd">            record_data_source_key_field (str, optional): The name of the field in the record data that contains the data source key. Defaults to `&quot;data_source_key&quot;`.</span>
</span><span id="MasterMatchStage.__init__-41"><a href="#MasterMatchStage.__init__-41"><span class="linenos">41</span></a><span class="sd">            match_ratio (float): The ratio of hash matches required to consider a record a match. 1 is all hashes match, or record already in master, 0.5 would be half the hashes match, etc.</span>
</span><span id="MasterMatchStage.__init__-42"><a href="#MasterMatchStage.__init__-42"><span class="linenos">42</span></a><span class="sd">            timestamp_fields (List[str], optional): list of fields in timestamp format.  parsed from strings to python datetimes.  Defaults to `[&quot;ts_updated&quot;]`</span>
</span><span id="MasterMatchStage.__init__-43"><a href="#MasterMatchStage.__init__-43"><span class="linenos">43</span></a><span class="sd">            date_fields (List[str], optional): list of fields in date format.  parsed from strings to python dates.  Defaults to `None`</span>
</span><span id="MasterMatchStage.__init__-44"><a href="#MasterMatchStage.__init__-44"><span class="linenos">44</span></a><span class="sd">            sort_fields (List[str], optional): list of fields to use in sorting match results.  sorts the returned matches by values in these fields. Sorting is not applied when empty or None. Defaults to `[&quot;ts_updated&quot;]`</span>
</span><span id="MasterMatchStage.__init__-45"><a href="#MasterMatchStage.__init__-45"><span class="linenos">45</span></a><span class="sd">            sort_reverse (bool): sort matches in reverse order.  Applies to all sort keys. Only used when sort_fields also present. Defaults to `True`.</span>
</span><span id="MasterMatchStage.__init__-46"><a href="#MasterMatchStage.__init__-46"><span class="linenos">46</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="MasterMatchStage.__init__-47"><a href="#MasterMatchStage.__init__-47"><span class="linenos">47</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="MasterMatchStage.__init__-48"><a href="#MasterMatchStage.__init__-48"><span class="linenos">48</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="MasterMatchStage.__init__-49"><a href="#MasterMatchStage.__init__-49"><span class="linenos">49</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="MasterMatchStage.__init__-50"><a href="#MasterMatchStage.__init__-50"><span class="linenos">50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MasterMatchStage.__init__-51"><a href="#MasterMatchStage.__init__-51"><span class="linenos">51</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MasterMatchStage.__init__-52"><a href="#MasterMatchStage.__init__-52"><span class="linenos">52</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-53"><a href="#MasterMatchStage.__init__-53"><span class="linenos">53</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-54"><a href="#MasterMatchStage.__init__-54"><span class="linenos">54</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-55"><a href="#MasterMatchStage.__init__-55"><span class="linenos">55</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-56"><a href="#MasterMatchStage.__init__-56"><span class="linenos">56</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="MasterMatchStage.__init__-57"><a href="#MasterMatchStage.__init__-57"><span class="linenos">57</span></a>        <span class="p">)</span>
</span><span id="MasterMatchStage.__init__-58"><a href="#MasterMatchStage.__init__-58"><span class="linenos">58</span></a>
</span><span id="MasterMatchStage.__init__-59"><a href="#MasterMatchStage.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">master_table</span> <span class="o">=</span> <span class="n">master_table</span>
</span><span id="MasterMatchStage.__init__-60"><a href="#MasterMatchStage.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span><span id="MasterMatchStage.__init__-61"><a href="#MasterMatchStage.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">match_ratio</span> <span class="o">=</span> <span class="n">match_ratio</span>
</span><span id="MasterMatchStage.__init__-62"><a href="#MasterMatchStage.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">record_data_source_key_field</span> <span class="o">=</span> <span class="n">record_data_source_key_field</span>
</span><span id="MasterMatchStage.__init__-63"><a href="#MasterMatchStage.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_fields</span> <span class="o">=</span> <span class="n">timestamp_fields</span>
</span><span id="MasterMatchStage.__init__-64"><a href="#MasterMatchStage.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_fields</span> <span class="o">=</span> <span class="n">date_fields</span>
</span><span id="MasterMatchStage.__init__-65"><a href="#MasterMatchStage.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span> <span class="o">=</span> <span class="n">sort_fields</span>
</span><span id="MasterMatchStage.__init__-66"><a href="#MasterMatchStage.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort_reverse</span> <span class="o">=</span> <span class="n">sort_reverse</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#MasterMatchStage">MasterMatchStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>master_table (str):</strong>  The name of the master table on which to perform match.</li>
<li><strong>connection_pool (PostgresConnectionPool):</strong>  Connection pool to use connections from for matching.</li>
<li><strong>record_data_source_key_field (str, optional):</strong>  The name of the field in the record data that contains the data source key. Defaults to <code>"data_source_key"</code>.</li>
<li><strong>match_ratio (float):</strong>  The ratio of hash matches required to consider a record a match. 1 is all hashes match, or record already in master, 0.5 would be half the hashes match, etc.</li>
<li><strong>timestamp_fields (List[str], optional):</strong>  list of fields in timestamp format.  parsed from strings to python datetimes.  Defaults to <code>["ts_updated"]</code></li>
<li><strong>date_fields (List[str], optional):</strong>  list of fields in date format.  parsed from strings to python dates.  Defaults to <code>None</code></li>
<li><strong>sort_fields (List[str], optional):</strong>  list of fields to use in sorting match results.  sorts the returned matches by values in these fields. Sorting is not applied when empty or None. Defaults to <code>["ts_updated"]</code></li>
<li><strong>sort_reverse (bool):</strong>  sort matches in reverse order.  Applies to all sort keys. Only used when sort_fields also present. Defaults to <code>True</code>.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="MasterMatchStage.process_record" class="classattr">
                                        <input id="MasterMatchStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="MasterMatchStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MasterMatchStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MasterMatchStage.process_record-126"><a href="#MasterMatchStage.process_record-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="MasterMatchStage.process_record-127"><a href="#MasterMatchStage.process_record-127"><span class="linenos">127</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="MasterMatchStage.process_record-128"><a href="#MasterMatchStage.process_record-128"><span class="linenos">128</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MasterMatchStage.process_record-129"><a href="#MasterMatchStage.process_record-129"><span class="linenos">129</span></a>            <span class="n">lookup_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_lookup</span><span class="p">(</span>
</span><span id="MasterMatchStage.process_record-130"><a href="#MasterMatchStage.process_record-130"><span class="linenos">130</span></a>                <span class="n">conn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_query</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span>
</span><span id="MasterMatchStage.process_record-131"><a href="#MasterMatchStage.process_record-131"><span class="linenos">131</span></a>            <span class="p">)</span>
</span><span id="MasterMatchStage.process_record-132"><a href="#MasterMatchStage.process_record-132"><span class="linenos">132</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="MasterMatchStage.process_record-133"><a href="#MasterMatchStage.process_record-133"><span class="linenos">133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="MasterMatchStage.process_record-134"><a href="#MasterMatchStage.process_record-134"><span class="linenos">134</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">lookup_results</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span>
</span><span id="MasterMatchStage.process_record-135"><a href="#MasterMatchStage.process_record-135"><span class="linenos">135</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="MasterMatchStage.process_record-136"><a href="#MasterMatchStage.process_record-136"><span class="linenos">136</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_matches</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">])</span>
</span><span id="MasterMatchStage.process_record-137"><a href="#MasterMatchStage.process_record-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="MasterMatchStage.unique_name" class="variable">unique_name</dd>
                <dd id="MasterMatchStage.pipeline" class="variable">pipeline</dd>
                <dd id="MasterMatchStage.add_downstream" class="function">add_downstream</dd>
                <dd id="MasterMatchStage.add_upstream" class="function">add_upstream</dd>
                <dd id="MasterMatchStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="MasterMatchStage.channels" class="variable">channels</dd>
                <dd id="MasterMatchStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="MasterMatchStage.log" class="variable">log</dd>
                <dd id="MasterMatchStage.reset_level" class="function">reset_level</dd>
                <dd id="MasterMatchStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MasterMatchStageV3_4">
                            <input id="MasterMatchStageV3_4-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MasterMatchStageV3_4</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="MasterMatchStageV3_4-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MasterMatchStageV3_4"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MasterMatchStageV3_4-17"><a href="#MasterMatchStageV3_4-17"><span class="linenos"> 17</span></a><span class="k">class</span> <span class="nc">MasterMatchStageV3_4</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="MasterMatchStageV3_4-18"><a href="#MasterMatchStageV3_4-18"><span class="linenos"> 18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Looks up existing master table records for a given Record.&quot;&quot;&quot;</span>
</span><span id="MasterMatchStageV3_4-19"><a href="#MasterMatchStageV3_4-19"><span class="linenos"> 19</span></a>
</span><span id="MasterMatchStageV3_4-20"><a href="#MasterMatchStageV3_4-20"><span class="linenos"> 20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-21"><a href="#MasterMatchStageV3_4-21"><span class="linenos"> 21</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-22"><a href="#MasterMatchStageV3_4-22"><span class="linenos"> 22</span></a>        <span class="n">master_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-23"><a href="#MasterMatchStageV3_4-23"><span class="linenos"> 23</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-24"><a href="#MasterMatchStageV3_4-24"><span class="linenos"> 24</span></a>        <span class="n">record_data_source_key_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data_source_key&quot;</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-25"><a href="#MasterMatchStageV3_4-25"><span class="linenos"> 25</span></a>        <span class="n">record_array_hash_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;array_hash&quot;</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-26"><a href="#MasterMatchStageV3_4-26"><span class="linenos"> 26</span></a>        <span class="n">match_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-27"><a href="#MasterMatchStageV3_4-27"><span class="linenos"> 27</span></a>        <span class="n">timestamp_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span>
</span><span id="MasterMatchStageV3_4-28"><a href="#MasterMatchStageV3_4-28"><span class="linenos"> 28</span></a>        <span class="n">date_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-29"><a href="#MasterMatchStageV3_4-29"><span class="linenos"> 29</span></a>        <span class="n">sort_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span>
</span><span id="MasterMatchStageV3_4-30"><a href="#MasterMatchStageV3_4-30"><span class="linenos"> 30</span></a>        <span class="n">sort_reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-31"><a href="#MasterMatchStageV3_4-31"><span class="linenos"> 31</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-32"><a href="#MasterMatchStageV3_4-32"><span class="linenos"> 32</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-33"><a href="#MasterMatchStageV3_4-33"><span class="linenos"> 33</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-34"><a href="#MasterMatchStageV3_4-34"><span class="linenos"> 34</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-35"><a href="#MasterMatchStageV3_4-35"><span class="linenos"> 35</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-36"><a href="#MasterMatchStageV3_4-36"><span class="linenos"> 36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `MasterMatchStage`.</span>
</span><span id="MasterMatchStageV3_4-37"><a href="#MasterMatchStageV3_4-37"><span class="linenos"> 37</span></a>
</span><span id="MasterMatchStageV3_4-38"><a href="#MasterMatchStageV3_4-38"><span class="linenos"> 38</span></a><span class="sd">        Args:</span>
</span><span id="MasterMatchStageV3_4-39"><a href="#MasterMatchStageV3_4-39"><span class="linenos"> 39</span></a><span class="sd">            master_table (str): The name of the master table on which to perform match.</span>
</span><span id="MasterMatchStageV3_4-40"><a href="#MasterMatchStageV3_4-40"><span class="linenos"> 40</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Connection pool to use connections from for matching.</span>
</span><span id="MasterMatchStageV3_4-41"><a href="#MasterMatchStageV3_4-41"><span class="linenos"> 41</span></a><span class="sd">            record_data_source_key_field (str, optional): The name of the field in the record data that contains the data source key. Defaults to `&quot;data_source_key&quot;`.</span>
</span><span id="MasterMatchStageV3_4-42"><a href="#MasterMatchStageV3_4-42"><span class="linenos"> 42</span></a><span class="sd">            record_array_hash_field (str, optional): The name of the field in the record data that contains the array hash. Defaults to `&quot;array_hash&quot;`.</span>
</span><span id="MasterMatchStageV3_4-43"><a href="#MasterMatchStageV3_4-43"><span class="linenos"> 43</span></a><span class="sd">            match_ratio (float): The ratio of hash matches required to consider a record a match. 1 is all hashes match, or record already in master, 0.5 would be half the hashes match, etc.</span>
</span><span id="MasterMatchStageV3_4-44"><a href="#MasterMatchStageV3_4-44"><span class="linenos"> 44</span></a><span class="sd">            timestamp_fields (List[str], optional): list of fields in timestamp format.  parsed from strings to python datetimes.  Defaults to `[&quot;ts_updated&quot;]`</span>
</span><span id="MasterMatchStageV3_4-45"><a href="#MasterMatchStageV3_4-45"><span class="linenos"> 45</span></a><span class="sd">            date_fields (List[str], optional): list of fields in date format.  parsed from strings to python dates.  Defaults to `None`</span>
</span><span id="MasterMatchStageV3_4-46"><a href="#MasterMatchStageV3_4-46"><span class="linenos"> 46</span></a><span class="sd">            sort_fields (List[str], optional): list of fields to use in sorting match results.  sorts the returned matches by values in these fields. Sorting is not applied when empty or None. Defaults to `[&quot;ts_updated&quot;]`</span>
</span><span id="MasterMatchStageV3_4-47"><a href="#MasterMatchStageV3_4-47"><span class="linenos"> 47</span></a><span class="sd">            sort_reverse (bool): sort matches in reverse order.  Applies to all sort keys. Only used when sort_fields also present. Defaults to `True`.</span>
</span><span id="MasterMatchStageV3_4-48"><a href="#MasterMatchStageV3_4-48"><span class="linenos"> 48</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="MasterMatchStageV3_4-49"><a href="#MasterMatchStageV3_4-49"><span class="linenos"> 49</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="MasterMatchStageV3_4-50"><a href="#MasterMatchStageV3_4-50"><span class="linenos"> 50</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="MasterMatchStageV3_4-51"><a href="#MasterMatchStageV3_4-51"><span class="linenos"> 51</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="MasterMatchStageV3_4-52"><a href="#MasterMatchStageV3_4-52"><span class="linenos"> 52</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MasterMatchStageV3_4-53"><a href="#MasterMatchStageV3_4-53"><span class="linenos"> 53</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-54"><a href="#MasterMatchStageV3_4-54"><span class="linenos"> 54</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-55"><a href="#MasterMatchStageV3_4-55"><span class="linenos"> 55</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-56"><a href="#MasterMatchStageV3_4-56"><span class="linenos"> 56</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-57"><a href="#MasterMatchStageV3_4-57"><span class="linenos"> 57</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-58"><a href="#MasterMatchStageV3_4-58"><span class="linenos"> 58</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4-59"><a href="#MasterMatchStageV3_4-59"><span class="linenos"> 59</span></a>        <span class="p">)</span>
</span><span id="MasterMatchStageV3_4-60"><a href="#MasterMatchStageV3_4-60"><span class="linenos"> 60</span></a>
</span><span id="MasterMatchStageV3_4-61"><a href="#MasterMatchStageV3_4-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">master_table</span> <span class="o">=</span> <span class="n">master_table</span>
</span><span id="MasterMatchStageV3_4-62"><a href="#MasterMatchStageV3_4-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span><span id="MasterMatchStageV3_4-63"><a href="#MasterMatchStageV3_4-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">match_ratio</span> <span class="o">=</span> <span class="n">match_ratio</span>
</span><span id="MasterMatchStageV3_4-64"><a href="#MasterMatchStageV3_4-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">record_data_source_key_field</span> <span class="o">=</span> <span class="n">record_data_source_key_field</span>
</span><span id="MasterMatchStageV3_4-65"><a href="#MasterMatchStageV3_4-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">record_array_hash_field</span> <span class="o">=</span> <span class="n">record_array_hash_field</span>
</span><span id="MasterMatchStageV3_4-66"><a href="#MasterMatchStageV3_4-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_fields</span> <span class="o">=</span> <span class="n">timestamp_fields</span>
</span><span id="MasterMatchStageV3_4-67"><a href="#MasterMatchStageV3_4-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_fields</span> <span class="o">=</span> <span class="n">date_fields</span>
</span><span id="MasterMatchStageV3_4-68"><a href="#MasterMatchStageV3_4-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span> <span class="o">=</span> <span class="n">sort_fields</span>
</span><span id="MasterMatchStageV3_4-69"><a href="#MasterMatchStageV3_4-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort_reverse</span> <span class="o">=</span> <span class="n">sort_reverse</span>
</span><span id="MasterMatchStageV3_4-70"><a href="#MasterMatchStageV3_4-70"><span class="linenos"> 70</span></a>
</span><span id="MasterMatchStageV3_4-71"><a href="#MasterMatchStageV3_4-71"><span class="linenos"> 71</span></a>    <span class="k">def</span> <span class="nf">_validate_lookup_results</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-72"><a href="#MasterMatchStageV3_4-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictRow</span><span class="p">]</span>
</span><span id="MasterMatchStageV3_4-73"><a href="#MasterMatchStageV3_4-73"><span class="linenos"> 73</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-74"><a href="#MasterMatchStageV3_4-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-75"><a href="#MasterMatchStageV3_4-75"><span class="linenos"> 75</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-76"><a href="#MasterMatchStageV3_4-76"><span class="linenos"> 76</span></a>                <span class="sa">f</span><span class="s2">&quot;Lookup query must return exactly one row. Got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows.&quot;</span>
</span><span id="MasterMatchStageV3_4-77"><a href="#MasterMatchStageV3_4-77"><span class="linenos"> 77</span></a>            <span class="p">)</span>
</span><span id="MasterMatchStageV3_4-78"><a href="#MasterMatchStageV3_4-78"><span class="linenos"> 78</span></a>
</span><span id="MasterMatchStageV3_4-79"><a href="#MasterMatchStageV3_4-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">_date_from_postgres_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_str</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-80"><a href="#MasterMatchStageV3_4-80"><span class="linenos"> 80</span></a>        <span class="n">retval</span> <span class="o">=</span> <span class="n">ts_str</span>
</span><span id="MasterMatchStageV3_4-81"><a href="#MasterMatchStageV3_4-81"><span class="linenos"> 81</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MasterMatchStageV3_4-82"><a href="#MasterMatchStageV3_4-82"><span class="linenos"> 82</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">retval</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-83"><a href="#MasterMatchStageV3_4-83"><span class="linenos"> 83</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="MasterMatchStageV3_4-84"><a href="#MasterMatchStageV3_4-84"><span class="linenos"> 84</span></a>                <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</span><span id="MasterMatchStageV3_4-85"><a href="#MasterMatchStageV3_4-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="MasterMatchStageV3_4-86"><a href="#MasterMatchStageV3_4-86"><span class="linenos"> 86</span></a>
</span><span id="MasterMatchStageV3_4-87"><a href="#MasterMatchStageV3_4-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">_timestamp_from_postgres_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_str</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-88"><a href="#MasterMatchStageV3_4-88"><span class="linenos"> 88</span></a>        <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="n">ts_str</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">ts_str</span>
</span><span id="MasterMatchStageV3_4-89"><a href="#MasterMatchStageV3_4-89"><span class="linenos"> 89</span></a>
</span><span id="MasterMatchStageV3_4-90"><a href="#MasterMatchStageV3_4-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">_post_process_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="MasterMatchStageV3_4-91"><a href="#MasterMatchStageV3_4-91"><span class="linenos"> 91</span></a>        <span class="n">retval</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MasterMatchStageV3_4-92"><a href="#MasterMatchStageV3_4-92"><span class="linenos"> 92</span></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-93"><a href="#MasterMatchStageV3_4-93"><span class="linenos"> 93</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MasterMatchStageV3_4-94"><a href="#MasterMatchStageV3_4-94"><span class="linenos"> 94</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_fields</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_fields</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-95"><a href="#MasterMatchStageV3_4-95"><span class="linenos"> 95</span></a>                    <span class="k">match</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_date_from_postgres_str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-96"><a href="#MasterMatchStageV3_4-96"><span class="linenos"> 96</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_fields</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_fields</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-97"><a href="#MasterMatchStageV3_4-97"><span class="linenos"> 97</span></a>                    <span class="k">match</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp_from_postgres_str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-98"><a href="#MasterMatchStageV3_4-98"><span class="linenos"> 98</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-99"><a href="#MasterMatchStageV3_4-99"><span class="linenos"> 99</span></a>                    <span class="k">match</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="MasterMatchStageV3_4-100"><a href="#MasterMatchStageV3_4-100"><span class="linenos">100</span></a>            <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-101"><a href="#MasterMatchStageV3_4-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-102"><a href="#MasterMatchStageV3_4-102"><span class="linenos">102</span></a>            <span class="c1"># when sort_reverse = True, descending on all keys, nulls last - default config</span>
</span><span id="MasterMatchStageV3_4-103"><a href="#MasterMatchStageV3_4-103"><span class="linenos">103</span></a>            <span class="c1"># when sort_reverse = False, ascending on all keys, nulls last</span>
</span><span id="MasterMatchStageV3_4-104"><a href="#MasterMatchStageV3_4-104"><span class="linenos">104</span></a>            <span class="c1"># generalized null handling for sorting: https://stackoverflow.com/a/72138073</span>
</span><span id="MasterMatchStageV3_4-105"><a href="#MasterMatchStageV3_4-105"><span class="linenos">105</span></a>            <span class="k">def</span> <span class="nf">_sort_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="MasterMatchStageV3_4-106"><a href="#MasterMatchStageV3_4-106"><span class="linenos">106</span></a>                <span class="k">return</span> <span class="p">(</span>
</span><span id="MasterMatchStageV3_4-107"><a href="#MasterMatchStageV3_4-107"><span class="linenos">107</span></a>                    <span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span><span class="p">]</span>
</span><span id="MasterMatchStageV3_4-108"><a href="#MasterMatchStageV3_4-108"><span class="linenos">108</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_reverse</span>
</span><span id="MasterMatchStageV3_4-109"><a href="#MasterMatchStageV3_4-109"><span class="linenos">109</span></a>                    <span class="k">else</span> <span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span><span class="p">]</span>
</span><span id="MasterMatchStageV3_4-110"><a href="#MasterMatchStageV3_4-110"><span class="linenos">110</span></a>                <span class="p">)</span>
</span><span id="MasterMatchStageV3_4-111"><a href="#MasterMatchStageV3_4-111"><span class="linenos">111</span></a>
</span><span id="MasterMatchStageV3_4-112"><a href="#MasterMatchStageV3_4-112"><span class="linenos">112</span></a>            <span class="n">retval</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_sort_func</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sort_reverse</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-113"><a href="#MasterMatchStageV3_4-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="n">retval</span>
</span><span id="MasterMatchStageV3_4-114"><a href="#MasterMatchStageV3_4-114"><span class="linenos">114</span></a>
</span><span id="MasterMatchStageV3_4-115"><a href="#MasterMatchStageV3_4-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">_process_lookup_results</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-116"><a href="#MasterMatchStageV3_4-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictRow</span><span class="p">]</span>
</span><span id="MasterMatchStageV3_4-117"><a href="#MasterMatchStageV3_4-117"><span class="linenos">117</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MasterMatchStageV3_4-118"><a href="#MasterMatchStageV3_4-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_lookup_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-119"><a href="#MasterMatchStageV3_4-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MasterMatchStageV3_4-120"><a href="#MasterMatchStageV3_4-120"><span class="linenos">120</span></a>
</span><span id="MasterMatchStageV3_4-121"><a href="#MasterMatchStageV3_4-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="nf">_do_lookup</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-122"><a href="#MasterMatchStageV3_4-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">:</span> <span class="n">connection</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_data</span><span class="p">:</span> <span class="n">RecordData</span>
</span><span id="MasterMatchStageV3_4-123"><a href="#MasterMatchStageV3_4-123"><span class="linenos">123</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MasterMatchStageV3_4-124"><a href="#MasterMatchStageV3_4-124"><span class="linenos">124</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_factory</span><span class="o">=</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictCursor</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-125"><a href="#MasterMatchStageV3_4-125"><span class="linenos">125</span></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">record_data</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-126"><a href="#MasterMatchStageV3_4-126"><span class="linenos">126</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="MasterMatchStageV3_4-127"><a href="#MasterMatchStageV3_4-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_lookup_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-128"><a href="#MasterMatchStageV3_4-128"><span class="linenos">128</span></a>
</span><span id="MasterMatchStageV3_4-129"><a href="#MasterMatchStageV3_4-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-130"><a href="#MasterMatchStageV3_4-130"><span class="linenos">130</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="MasterMatchStageV3_4-131"><a href="#MasterMatchStageV3_4-131"><span class="linenos">131</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-132"><a href="#MasterMatchStageV3_4-132"><span class="linenos">132</span></a>            <span class="n">lookup_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_lookup</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-133"><a href="#MasterMatchStageV3_4-133"><span class="linenos">133</span></a>                <span class="n">conn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_query</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span>
</span><span id="MasterMatchStageV3_4-134"><a href="#MasterMatchStageV3_4-134"><span class="linenos">134</span></a>            <span class="p">)</span>
</span><span id="MasterMatchStageV3_4-135"><a href="#MasterMatchStageV3_4-135"><span class="linenos">135</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-136"><a href="#MasterMatchStageV3_4-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4-137"><a href="#MasterMatchStageV3_4-137"><span class="linenos">137</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">lookup_results</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span>
</span><span id="MasterMatchStageV3_4-138"><a href="#MasterMatchStageV3_4-138"><span class="linenos">138</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="MasterMatchStageV3_4-139"><a href="#MasterMatchStageV3_4-139"><span class="linenos">139</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_matches</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">])</span>
</span><span id="MasterMatchStageV3_4-140"><a href="#MasterMatchStageV3_4-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="n">record</span>
</span><span id="MasterMatchStageV3_4-141"><a href="#MasterMatchStageV3_4-141"><span class="linenos">141</span></a>
</span><span id="MasterMatchStageV3_4-142"><a href="#MasterMatchStageV3_4-142"><span class="linenos">142</span></a>    <span class="k">def</span> <span class="nf">_construct_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4-143"><a href="#MasterMatchStageV3_4-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-144"><a href="#MasterMatchStageV3_4-144"><span class="linenos">144</span></a>            <span class="n">dedent</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-145"><a href="#MasterMatchStageV3_4-145"><span class="linenos">145</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MasterMatchStageV3_4-146"><a href="#MasterMatchStageV3_4-146"><span class="linenos">146</span></a><span class="sd">                with matches as materialized (</span>
</span><span id="MasterMatchStageV3_4-147"><a href="#MasterMatchStageV3_4-147"><span class="linenos">147</span></a><span class="sd">                        select {record_data_source_key} as data_source_key -- incoming record key</span>
</span><span id="MasterMatchStageV3_4-148"><a href="#MasterMatchStageV3_4-148"><span class="linenos">148</span></a><span class="sd">                        union</span>
</span><span id="MasterMatchStageV3_4-149"><a href="#MasterMatchStageV3_4-149"><span class="linenos">149</span></a><span class="sd">                        select distinct unnest(data_source_keys) as data_source_key -- get hard matches from master</span>
</span><span id="MasterMatchStageV3_4-150"><a href="#MasterMatchStageV3_4-150"><span class="linenos">150</span></a><span class="sd">                        from master.{master_table_name}</span>
</span><span id="MasterMatchStageV3_4-151"><a href="#MasterMatchStageV3_4-151"><span class="linenos">151</span></a><span class="sd">                        where array[{record_data_source_key}::text] &amp;&amp; data_source_keys</span>
</span><span id="MasterMatchStageV3_4-152"><a href="#MasterMatchStageV3_4-152"><span class="linenos">152</span></a><span class="sd">                        union</span>
</span><span id="MasterMatchStageV3_4-153"><a href="#MasterMatchStageV3_4-153"><span class="linenos">153</span></a><span class="sd">                        select distinct unnest(mh.data_source_keys) as data_source_key -- get hash matches to master</span>
</span><span id="MasterMatchStageV3_4-154"><a href="#MasterMatchStageV3_4-154"><span class="linenos">154</span></a><span class="sd">                        from master.{master_table_name} mh</span>
</span><span id="MasterMatchStageV3_4-155"><a href="#MasterMatchStageV3_4-155"><span class="linenos">155</span></a><span class="sd">                        where mh.array_hash &amp;&amp; {array_hash}::_text</span>
</span><span id="MasterMatchStageV3_4-156"><a href="#MasterMatchStageV3_4-156"><span class="linenos">156</span></a><span class="sd">                        and cardinality(array(select unnest({array_hash}::_text) intersect select unnest(mh.array_hash)))::decimal/cardinality({array_hash}::_text) &gt;= {match_ratio})</span>
</span><span id="MasterMatchStageV3_4-157"><a href="#MasterMatchStageV3_4-157"><span class="linenos">157</span></a><span class="sd">                select json_agg(c.*)::text as matches -- return all clean records that matched to the incoming record</span>
</span><span id="MasterMatchStageV3_4-158"><a href="#MasterMatchStageV3_4-158"><span class="linenos">158</span></a><span class="sd">                from clean.{master_table_name} c</span>
</span><span id="MasterMatchStageV3_4-159"><a href="#MasterMatchStageV3_4-159"><span class="linenos">159</span></a><span class="sd">                where c.data_source_key in (select data_source_key from matches)</span>
</span><span id="MasterMatchStageV3_4-160"><a href="#MasterMatchStageV3_4-160"><span class="linenos">160</span></a><span class="sd">                    and (c.ts_status is null or c.ts_status != &#39;DELETED&#39;)</span>
</span><span id="MasterMatchStageV3_4-161"><a href="#MasterMatchStageV3_4-161"><span class="linenos">161</span></a><span class="sd">                ;</span>
</span><span id="MasterMatchStageV3_4-162"><a href="#MasterMatchStageV3_4-162"><span class="linenos">162</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="MasterMatchStageV3_4-163"><a href="#MasterMatchStageV3_4-163"><span class="linenos">163</span></a>            <span class="p">)</span>
</span><span id="MasterMatchStageV3_4-164"><a href="#MasterMatchStageV3_4-164"><span class="linenos">164</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-165"><a href="#MasterMatchStageV3_4-165"><span class="linenos">165</span></a>            <span class="n">record_data_source_key</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4-166"><a href="#MasterMatchStageV3_4-166"><span class="linenos">166</span></a>                <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">record_data_source_key_field</span><span class="p">]</span>
</span><span id="MasterMatchStageV3_4-167"><a href="#MasterMatchStageV3_4-167"><span class="linenos">167</span></a>            <span class="p">),</span>
</span><span id="MasterMatchStageV3_4-168"><a href="#MasterMatchStageV3_4-168"><span class="linenos">168</span></a>            <span class="n">master_table_name</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_table</span><span class="p">),</span>
</span><span id="MasterMatchStageV3_4-169"><a href="#MasterMatchStageV3_4-169"><span class="linenos">169</span></a>            <span class="n">match_ratio</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match_ratio</span><span class="p">),</span>
</span><span id="MasterMatchStageV3_4-170"><a href="#MasterMatchStageV3_4-170"><span class="linenos">170</span></a>            <span class="n">array_hash</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">record_array_hash_field</span><span class="p">]),</span>
</span><span id="MasterMatchStageV3_4-171"><a href="#MasterMatchStageV3_4-171"><span class="linenos">171</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Looks up existing master table records for a given Record.</p>
</div>


                            <div id="MasterMatchStageV3_4.__init__" class="classattr">
                                        <input id="MasterMatchStageV3_4.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MasterMatchStageV3_4</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">master_table</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">connection_pool</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">postgres_connection_pool</span><span class="o">.</span><span class="n">PostgresConnectionPool</span>,</span><span class="param">	<span class="n">record_data_source_key_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;data_source_key&#39;</span>,</span><span class="param">	<span class="n">record_array_hash_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;array_hash&#39;</span>,</span><span class="param">	<span class="n">match_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>,</span><span class="param">	<span class="n">timestamp_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ts_updated&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">date_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sort_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ts_updated&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">sort_reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="MasterMatchStageV3_4.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MasterMatchStageV3_4.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MasterMatchStageV3_4.__init__-20"><a href="#MasterMatchStageV3_4.__init__-20"><span class="linenos">20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4.__init__-21"><a href="#MasterMatchStageV3_4.__init__-21"><span class="linenos">21</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-22"><a href="#MasterMatchStageV3_4.__init__-22"><span class="linenos">22</span></a>        <span class="n">master_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-23"><a href="#MasterMatchStageV3_4.__init__-23"><span class="linenos">23</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-24"><a href="#MasterMatchStageV3_4.__init__-24"><span class="linenos">24</span></a>        <span class="n">record_data_source_key_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data_source_key&quot;</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-25"><a href="#MasterMatchStageV3_4.__init__-25"><span class="linenos">25</span></a>        <span class="n">record_array_hash_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;array_hash&quot;</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-26"><a href="#MasterMatchStageV3_4.__init__-26"><span class="linenos">26</span></a>        <span class="n">match_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-27"><a href="#MasterMatchStageV3_4.__init__-27"><span class="linenos">27</span></a>        <span class="n">timestamp_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span>
</span><span id="MasterMatchStageV3_4.__init__-28"><a href="#MasterMatchStageV3_4.__init__-28"><span class="linenos">28</span></a>        <span class="n">date_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-29"><a href="#MasterMatchStageV3_4.__init__-29"><span class="linenos">29</span></a>        <span class="n">sort_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ts_updated&quot;</span><span class="p">],</span>
</span><span id="MasterMatchStageV3_4.__init__-30"><a href="#MasterMatchStageV3_4.__init__-30"><span class="linenos">30</span></a>        <span class="n">sort_reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-31"><a href="#MasterMatchStageV3_4.__init__-31"><span class="linenos">31</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-32"><a href="#MasterMatchStageV3_4.__init__-32"><span class="linenos">32</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-33"><a href="#MasterMatchStageV3_4.__init__-33"><span class="linenos">33</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-34"><a href="#MasterMatchStageV3_4.__init__-34"><span class="linenos">34</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-35"><a href="#MasterMatchStageV3_4.__init__-35"><span class="linenos">35</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4.__init__-36"><a href="#MasterMatchStageV3_4.__init__-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `MasterMatchStage`.</span>
</span><span id="MasterMatchStageV3_4.__init__-37"><a href="#MasterMatchStageV3_4.__init__-37"><span class="linenos">37</span></a>
</span><span id="MasterMatchStageV3_4.__init__-38"><a href="#MasterMatchStageV3_4.__init__-38"><span class="linenos">38</span></a><span class="sd">        Args:</span>
</span><span id="MasterMatchStageV3_4.__init__-39"><a href="#MasterMatchStageV3_4.__init__-39"><span class="linenos">39</span></a><span class="sd">            master_table (str): The name of the master table on which to perform match.</span>
</span><span id="MasterMatchStageV3_4.__init__-40"><a href="#MasterMatchStageV3_4.__init__-40"><span class="linenos">40</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Connection pool to use connections from for matching.</span>
</span><span id="MasterMatchStageV3_4.__init__-41"><a href="#MasterMatchStageV3_4.__init__-41"><span class="linenos">41</span></a><span class="sd">            record_data_source_key_field (str, optional): The name of the field in the record data that contains the data source key. Defaults to `&quot;data_source_key&quot;`.</span>
</span><span id="MasterMatchStageV3_4.__init__-42"><a href="#MasterMatchStageV3_4.__init__-42"><span class="linenos">42</span></a><span class="sd">            record_array_hash_field (str, optional): The name of the field in the record data that contains the array hash. Defaults to `&quot;array_hash&quot;`.</span>
</span><span id="MasterMatchStageV3_4.__init__-43"><a href="#MasterMatchStageV3_4.__init__-43"><span class="linenos">43</span></a><span class="sd">            match_ratio (float): The ratio of hash matches required to consider a record a match. 1 is all hashes match, or record already in master, 0.5 would be half the hashes match, etc.</span>
</span><span id="MasterMatchStageV3_4.__init__-44"><a href="#MasterMatchStageV3_4.__init__-44"><span class="linenos">44</span></a><span class="sd">            timestamp_fields (List[str], optional): list of fields in timestamp format.  parsed from strings to python datetimes.  Defaults to `[&quot;ts_updated&quot;]`</span>
</span><span id="MasterMatchStageV3_4.__init__-45"><a href="#MasterMatchStageV3_4.__init__-45"><span class="linenos">45</span></a><span class="sd">            date_fields (List[str], optional): list of fields in date format.  parsed from strings to python dates.  Defaults to `None`</span>
</span><span id="MasterMatchStageV3_4.__init__-46"><a href="#MasterMatchStageV3_4.__init__-46"><span class="linenos">46</span></a><span class="sd">            sort_fields (List[str], optional): list of fields to use in sorting match results.  sorts the returned matches by values in these fields. Sorting is not applied when empty or None. Defaults to `[&quot;ts_updated&quot;]`</span>
</span><span id="MasterMatchStageV3_4.__init__-47"><a href="#MasterMatchStageV3_4.__init__-47"><span class="linenos">47</span></a><span class="sd">            sort_reverse (bool): sort matches in reverse order.  Applies to all sort keys. Only used when sort_fields also present. Defaults to `True`.</span>
</span><span id="MasterMatchStageV3_4.__init__-48"><a href="#MasterMatchStageV3_4.__init__-48"><span class="linenos">48</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="MasterMatchStageV3_4.__init__-49"><a href="#MasterMatchStageV3_4.__init__-49"><span class="linenos">49</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="MasterMatchStageV3_4.__init__-50"><a href="#MasterMatchStageV3_4.__init__-50"><span class="linenos">50</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="MasterMatchStageV3_4.__init__-51"><a href="#MasterMatchStageV3_4.__init__-51"><span class="linenos">51</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="MasterMatchStageV3_4.__init__-52"><a href="#MasterMatchStageV3_4.__init__-52"><span class="linenos">52</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MasterMatchStageV3_4.__init__-53"><a href="#MasterMatchStageV3_4.__init__-53"><span class="linenos">53</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4.__init__-54"><a href="#MasterMatchStageV3_4.__init__-54"><span class="linenos">54</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-55"><a href="#MasterMatchStageV3_4.__init__-55"><span class="linenos">55</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-56"><a href="#MasterMatchStageV3_4.__init__-56"><span class="linenos">56</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-57"><a href="#MasterMatchStageV3_4.__init__-57"><span class="linenos">57</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-58"><a href="#MasterMatchStageV3_4.__init__-58"><span class="linenos">58</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="MasterMatchStageV3_4.__init__-59"><a href="#MasterMatchStageV3_4.__init__-59"><span class="linenos">59</span></a>        <span class="p">)</span>
</span><span id="MasterMatchStageV3_4.__init__-60"><a href="#MasterMatchStageV3_4.__init__-60"><span class="linenos">60</span></a>
</span><span id="MasterMatchStageV3_4.__init__-61"><a href="#MasterMatchStageV3_4.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">master_table</span> <span class="o">=</span> <span class="n">master_table</span>
</span><span id="MasterMatchStageV3_4.__init__-62"><a href="#MasterMatchStageV3_4.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span><span id="MasterMatchStageV3_4.__init__-63"><a href="#MasterMatchStageV3_4.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">match_ratio</span> <span class="o">=</span> <span class="n">match_ratio</span>
</span><span id="MasterMatchStageV3_4.__init__-64"><a href="#MasterMatchStageV3_4.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">record_data_source_key_field</span> <span class="o">=</span> <span class="n">record_data_source_key_field</span>
</span><span id="MasterMatchStageV3_4.__init__-65"><a href="#MasterMatchStageV3_4.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">record_array_hash_field</span> <span class="o">=</span> <span class="n">record_array_hash_field</span>
</span><span id="MasterMatchStageV3_4.__init__-66"><a href="#MasterMatchStageV3_4.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_fields</span> <span class="o">=</span> <span class="n">timestamp_fields</span>
</span><span id="MasterMatchStageV3_4.__init__-67"><a href="#MasterMatchStageV3_4.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_fields</span> <span class="o">=</span> <span class="n">date_fields</span>
</span><span id="MasterMatchStageV3_4.__init__-68"><a href="#MasterMatchStageV3_4.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span> <span class="o">=</span> <span class="n">sort_fields</span>
</span><span id="MasterMatchStageV3_4.__init__-69"><a href="#MasterMatchStageV3_4.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort_reverse</span> <span class="o">=</span> <span class="n">sort_reverse</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#MasterMatchStage">MasterMatchStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>master_table (str):</strong>  The name of the master table on which to perform match.</li>
<li><strong>connection_pool (PostgresConnectionPool):</strong>  Connection pool to use connections from for matching.</li>
<li><strong>record_data_source_key_field (str, optional):</strong>  The name of the field in the record data that contains the data source key. Defaults to <code>"data_source_key"</code>.</li>
<li><strong>record_array_hash_field (str, optional):</strong>  The name of the field in the record data that contains the array hash. Defaults to <code>"array_hash"</code>.</li>
<li><strong>match_ratio (float):</strong>  The ratio of hash matches required to consider a record a match. 1 is all hashes match, or record already in master, 0.5 would be half the hashes match, etc.</li>
<li><strong>timestamp_fields (List[str], optional):</strong>  list of fields in timestamp format.  parsed from strings to python datetimes.  Defaults to <code>["ts_updated"]</code></li>
<li><strong>date_fields (List[str], optional):</strong>  list of fields in date format.  parsed from strings to python dates.  Defaults to <code>None</code></li>
<li><strong>sort_fields (List[str], optional):</strong>  list of fields to use in sorting match results.  sorts the returned matches by values in these fields. Sorting is not applied when empty or None. Defaults to <code>["ts_updated"]</code></li>
<li><strong>sort_reverse (bool):</strong>  sort matches in reverse order.  Applies to all sort keys. Only used when sort_fields also present. Defaults to <code>True</code>.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="MasterMatchStageV3_4.process_record" class="classattr">
                                        <input id="MasterMatchStageV3_4.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="MasterMatchStageV3_4.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MasterMatchStageV3_4.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MasterMatchStageV3_4.process_record-129"><a href="#MasterMatchStageV3_4.process_record-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4.process_record-130"><a href="#MasterMatchStageV3_4.process_record-130"><span class="linenos">130</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="MasterMatchStageV3_4.process_record-131"><a href="#MasterMatchStageV3_4.process_record-131"><span class="linenos">131</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4.process_record-132"><a href="#MasterMatchStageV3_4.process_record-132"><span class="linenos">132</span></a>            <span class="n">lookup_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_lookup</span><span class="p">(</span>
</span><span id="MasterMatchStageV3_4.process_record-133"><a href="#MasterMatchStageV3_4.process_record-133"><span class="linenos">133</span></a>                <span class="n">conn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_query</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span>
</span><span id="MasterMatchStageV3_4.process_record-134"><a href="#MasterMatchStageV3_4.process_record-134"><span class="linenos">134</span></a>            <span class="p">)</span>
</span><span id="MasterMatchStageV3_4.process_record-135"><a href="#MasterMatchStageV3_4.process_record-135"><span class="linenos">135</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="MasterMatchStageV3_4.process_record-136"><a href="#MasterMatchStageV3_4.process_record-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="MasterMatchStageV3_4.process_record-137"><a href="#MasterMatchStageV3_4.process_record-137"><span class="linenos">137</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">lookup_results</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span>
</span><span id="MasterMatchStageV3_4.process_record-138"><a href="#MasterMatchStageV3_4.process_record-138"><span class="linenos">138</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="MasterMatchStageV3_4.process_record-139"><a href="#MasterMatchStageV3_4.process_record-139"><span class="linenos">139</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_matches</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">])</span>
</span><span id="MasterMatchStageV3_4.process_record-140"><a href="#MasterMatchStageV3_4.process_record-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="MasterMatchStageV3_4.unique_name" class="variable">unique_name</dd>
                <dd id="MasterMatchStageV3_4.pipeline" class="variable">pipeline</dd>
                <dd id="MasterMatchStageV3_4.add_downstream" class="function">add_downstream</dd>
                <dd id="MasterMatchStageV3_4.add_upstream" class="function">add_upstream</dd>
                <dd id="MasterMatchStageV3_4.get_downstreams" class="function">get_downstreams</dd>
                <dd id="MasterMatchStageV3_4.channels" class="variable">channels</dd>
                <dd id="MasterMatchStageV3_4.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="MasterMatchStageV3_4.log" class="variable">log</dd>
                <dd id="MasterMatchStageV3_4.reset_level" class="function">reset_level</dd>
                <dd id="MasterMatchStageV3_4.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PhoneNumberParserStage">
                            <input id="PhoneNumberParserStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PhoneNumberParserStage</span><wbr>(<span class="base">cluo.extensions.field_processor_stage.FieldProcessorStage</span>):

                <label class="view-source-button" for="PhoneNumberParserStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PhoneNumberParserStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PhoneNumberParserStage-10"><a href="#PhoneNumberParserStage-10"><span class="linenos">10</span></a><span class="k">class</span> <span class="nc">PhoneNumberParserStage</span><span class="p">(</span><span class="n">FieldProcessorStage</span><span class="p">):</span>
</span><span id="PhoneNumberParserStage-11"><a href="#PhoneNumberParserStage-11"><span class="linenos">11</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse and format phone numbers if possible, else raise exception or provide default. Tries to parse with E.164 format, if not, tries to parse with default country code of US.&quot;&quot;&quot;</span>
</span><span id="PhoneNumberParserStage-12"><a href="#PhoneNumberParserStage-12"><span class="linenos">12</span></a>
</span><span id="PhoneNumberParserStage-13"><a href="#PhoneNumberParserStage-13"><span class="linenos">13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PhoneNumberParserStage-14"><a href="#PhoneNumberParserStage-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-15"><a href="#PhoneNumberParserStage-15"><span class="linenos">15</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-16"><a href="#PhoneNumberParserStage-16"><span class="linenos">16</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-17"><a href="#PhoneNumberParserStage-17"><span class="linenos">17</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-18"><a href="#PhoneNumberParserStage-18"><span class="linenos">18</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-19"><a href="#PhoneNumberParserStage-19"><span class="linenos">19</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-20"><a href="#PhoneNumberParserStage-20"><span class="linenos">20</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-21"><a href="#PhoneNumberParserStage-21"><span class="linenos">21</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-22"><a href="#PhoneNumberParserStage-22"><span class="linenos">22</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-23"><a href="#PhoneNumberParserStage-23"><span class="linenos">23</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `PhoneNumberParserStage`.</span>
</span><span id="PhoneNumberParserStage-24"><a href="#PhoneNumberParserStage-24"><span class="linenos">24</span></a>
</span><span id="PhoneNumberParserStage-25"><a href="#PhoneNumberParserStage-25"><span class="linenos">25</span></a><span class="sd">        Args:</span>
</span><span id="PhoneNumberParserStage-26"><a href="#PhoneNumberParserStage-26"><span class="linenos">26</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="PhoneNumberParserStage-27"><a href="#PhoneNumberParserStage-27"><span class="linenos">27</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="PhoneNumberParserStage-28"><a href="#PhoneNumberParserStage-28"><span class="linenos">28</span></a><span class="sd">            on_error (&quot;raise&quot; or &quot;default&quot;, optional): What to do if a phone number cannot be parsed. Defaults to &quot;raise&quot;.</span>
</span><span id="PhoneNumberParserStage-29"><a href="#PhoneNumberParserStage-29"><span class="linenos">29</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="PhoneNumberParserStage-30"><a href="#PhoneNumberParserStage-30"><span class="linenos">30</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="PhoneNumberParserStage-31"><a href="#PhoneNumberParserStage-31"><span class="linenos">31</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="PhoneNumberParserStage-32"><a href="#PhoneNumberParserStage-32"><span class="linenos">32</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="PhoneNumberParserStage-33"><a href="#PhoneNumberParserStage-33"><span class="linenos">33</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PhoneNumberParserStage-34"><a href="#PhoneNumberParserStage-34"><span class="linenos">34</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PhoneNumberParserStage-35"><a href="#PhoneNumberParserStage-35"><span class="linenos">35</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-36"><a href="#PhoneNumberParserStage-36"><span class="linenos">36</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-37"><a href="#PhoneNumberParserStage-37"><span class="linenos">37</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-38"><a href="#PhoneNumberParserStage-38"><span class="linenos">38</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-39"><a href="#PhoneNumberParserStage-39"><span class="linenos">39</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-40"><a href="#PhoneNumberParserStage-40"><span class="linenos">40</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-41"><a href="#PhoneNumberParserStage-41"><span class="linenos">41</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage-42"><a href="#PhoneNumberParserStage-42"><span class="linenos">42</span></a>        <span class="p">)</span>
</span><span id="PhoneNumberParserStage-43"><a href="#PhoneNumberParserStage-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span> <span class="o">=</span> <span class="n">on_error</span>
</span><span id="PhoneNumberParserStage-44"><a href="#PhoneNumberParserStage-44"><span class="linenos">44</span></a>
</span><span id="PhoneNumberParserStage-45"><a href="#PhoneNumberParserStage-45"><span class="linenos">45</span></a>    <span class="k">def</span> <span class="nf">_clean_phone_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phone_number</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-46"><a href="#PhoneNumberParserStage-46"><span class="linenos">46</span></a>        <span class="k">if</span> <span class="n">phone_number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-47"><a href="#PhoneNumberParserStage-47"><span class="linenos">47</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="PhoneNumberParserStage-48"><a href="#PhoneNumberParserStage-48"><span class="linenos">48</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phone_number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="PhoneNumberParserStage-49"><a href="#PhoneNumberParserStage-49"><span class="linenos">49</span></a>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">phone_number</span><span class="p">)</span>
</span><span id="PhoneNumberParserStage-50"><a href="#PhoneNumberParserStage-50"><span class="linenos">50</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phone_number</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="PhoneNumberParserStage-51"><a href="#PhoneNumberParserStage-51"><span class="linenos">51</span></a>            <span class="k">return</span> <span class="n">phone_number</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="PhoneNumberParserStage-52"><a href="#PhoneNumberParserStage-52"><span class="linenos">52</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-53"><a href="#PhoneNumberParserStage-53"><span class="linenos">53</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="PhoneNumberParserStage-54"><a href="#PhoneNumberParserStage-54"><span class="linenos">54</span></a>                <span class="s2">&quot;Phone number must be a string or integer. Unable to parse&quot;</span>
</span><span id="PhoneNumberParserStage-55"><a href="#PhoneNumberParserStage-55"><span class="linenos">55</span></a>            <span class="p">)</span>
</span><span id="PhoneNumberParserStage-56"><a href="#PhoneNumberParserStage-56"><span class="linenos">56</span></a>
</span><span id="PhoneNumberParserStage-57"><a href="#PhoneNumberParserStage-57"><span class="linenos">57</span></a>    <span class="k">def</span> <span class="nf">_parse_single_phone_number</span><span class="p">(</span>
</span><span id="PhoneNumberParserStage-58"><a href="#PhoneNumberParserStage-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">phone_number</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="PhoneNumberParserStage-59"><a href="#PhoneNumberParserStage-59"><span class="linenos">59</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="PhoneNumberParserStage-60"><a href="#PhoneNumberParserStage-60"><span class="linenos">60</span></a>        <span class="n">phone_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_phone_number</span><span class="p">(</span><span class="n">phone_number</span><span class="p">)</span>
</span><span id="PhoneNumberParserStage-61"><a href="#PhoneNumberParserStage-61"><span class="linenos">61</span></a>        <span class="k">if</span> <span class="n">phone_number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-62"><a href="#PhoneNumberParserStage-62"><span class="linenos">62</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="PhoneNumberParserStage-63"><a href="#PhoneNumberParserStage-63"><span class="linenos">63</span></a>        <span class="n">is_in_e164_format</span> <span class="o">=</span> <span class="n">phone_number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span>
</span><span id="PhoneNumberParserStage-64"><a href="#PhoneNumberParserStage-64"><span class="linenos">64</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-65"><a href="#PhoneNumberParserStage-65"><span class="linenos">65</span></a>            <span class="k">if</span> <span class="n">is_in_e164_format</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-66"><a href="#PhoneNumberParserStage-66"><span class="linenos">66</span></a>                <span class="n">parsed</span> <span class="o">=</span> <span class="n">phonenumbers</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">phone_number</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="PhoneNumberParserStage-67"><a href="#PhoneNumberParserStage-67"><span class="linenos">67</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-68"><a href="#PhoneNumberParserStage-68"><span class="linenos">68</span></a>                <span class="n">parsed</span> <span class="o">=</span> <span class="n">phonenumbers</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">phone_number</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">)</span>
</span><span id="PhoneNumberParserStage-69"><a href="#PhoneNumberParserStage-69"><span class="linenos">69</span></a>        <span class="k">except</span> <span class="n">phonenumbers</span><span class="o">.</span><span class="n">phonenumberutil</span><span class="o">.</span><span class="n">NumberParseException</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-70"><a href="#PhoneNumberParserStage-70"><span class="linenos">70</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="PhoneNumberParserStage-71"><a href="#PhoneNumberParserStage-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="PhoneNumberParserStage-72"><a href="#PhoneNumberParserStage-72"><span class="linenos">72</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_e164_format</span><span class="p">(</span><span class="n">parsed</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="PhoneNumberParserStage-73"><a href="#PhoneNumberParserStage-73"><span class="linenos">73</span></a>            <span class="k">if</span> <span class="n">phonenumbers</span><span class="o">.</span><span class="n">is_possible_number</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span>
</span><span id="PhoneNumberParserStage-74"><a href="#PhoneNumberParserStage-74"><span class="linenos">74</span></a>            <span class="k">else</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="PhoneNumberParserStage-75"><a href="#PhoneNumberParserStage-75"><span class="linenos">75</span></a>        <span class="p">)</span>
</span><span id="PhoneNumberParserStage-76"><a href="#PhoneNumberParserStage-76"><span class="linenos">76</span></a>
</span><span id="PhoneNumberParserStage-77"><a href="#PhoneNumberParserStage-77"><span class="linenos">77</span></a>    <span class="k">def</span> <span class="nf">_convert_to_e164_format</span><span class="p">(</span>
</span><span id="PhoneNumberParserStage-78"><a href="#PhoneNumberParserStage-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">parsed</span><span class="p">:</span> <span class="n">phonenumbers</span><span class="o">.</span><span class="n">phonenumber</span><span class="o">.</span><span class="n">PhoneNumber</span>
</span><span id="PhoneNumberParserStage-79"><a href="#PhoneNumberParserStage-79"><span class="linenos">79</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-80"><a href="#PhoneNumberParserStage-80"><span class="linenos">80</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;+</span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">country_code</span><span class="si">}{</span><span class="n">parsed</span><span class="o">.</span><span class="n">national_number</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="PhoneNumberParserStage-81"><a href="#PhoneNumberParserStage-81"><span class="linenos">81</span></a>
</span><span id="PhoneNumberParserStage-82"><a href="#PhoneNumberParserStage-82"><span class="linenos">82</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-83"><a href="#PhoneNumberParserStage-83"><span class="linenos">83</span></a>        <span class="n">parsed</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_phone_number</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span>
</span><span id="PhoneNumberParserStage-84"><a href="#PhoneNumberParserStage-84"><span class="linenos">84</span></a>        <span class="k">if</span> <span class="n">err</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage-85"><a href="#PhoneNumberParserStage-85"><span class="linenos">85</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="PhoneNumberParserStage-86"><a href="#PhoneNumberParserStage-86"><span class="linenos">86</span></a>                <span class="sa">f</span><span class="s2">&quot;Unable to parse phone number in field `</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">`:&quot;</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">field_value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="PhoneNumberParserStage-87"><a href="#PhoneNumberParserStage-87"><span class="linenos">87</span></a>            <span class="p">)</span>
</span><span id="PhoneNumberParserStage-88"><a href="#PhoneNumberParserStage-88"><span class="linenos">88</span></a>        <span class="k">return</span> <span class="n">parsed</span>
</span></pre></div>


            <div class="docstring"><p>Parse and format phone numbers if possible, else raise exception or provide default. Tries to parse with E.164 format, if not, tries to parse with default country code of US.</p>
</div>


                            <div id="PhoneNumberParserStage.__init__" class="classattr">
                                        <input id="PhoneNumberParserStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PhoneNumberParserStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="PhoneNumberParserStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PhoneNumberParserStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PhoneNumberParserStage.__init__-13"><a href="#PhoneNumberParserStage.__init__-13"><span class="linenos">13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PhoneNumberParserStage.__init__-14"><a href="#PhoneNumberParserStage.__init__-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-15"><a href="#PhoneNumberParserStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-16"><a href="#PhoneNumberParserStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-17"><a href="#PhoneNumberParserStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-18"><a href="#PhoneNumberParserStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-19"><a href="#PhoneNumberParserStage.__init__-19"><span class="linenos">19</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-20"><a href="#PhoneNumberParserStage.__init__-20"><span class="linenos">20</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-21"><a href="#PhoneNumberParserStage.__init__-21"><span class="linenos">21</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-22"><a href="#PhoneNumberParserStage.__init__-22"><span class="linenos">22</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage.__init__-23"><a href="#PhoneNumberParserStage.__init__-23"><span class="linenos">23</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `PhoneNumberParserStage`.</span>
</span><span id="PhoneNumberParserStage.__init__-24"><a href="#PhoneNumberParserStage.__init__-24"><span class="linenos">24</span></a>
</span><span id="PhoneNumberParserStage.__init__-25"><a href="#PhoneNumberParserStage.__init__-25"><span class="linenos">25</span></a><span class="sd">        Args:</span>
</span><span id="PhoneNumberParserStage.__init__-26"><a href="#PhoneNumberParserStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="PhoneNumberParserStage.__init__-27"><a href="#PhoneNumberParserStage.__init__-27"><span class="linenos">27</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="PhoneNumberParserStage.__init__-28"><a href="#PhoneNumberParserStage.__init__-28"><span class="linenos">28</span></a><span class="sd">            on_error (&quot;raise&quot; or &quot;default&quot;, optional): What to do if a phone number cannot be parsed. Defaults to &quot;raise&quot;.</span>
</span><span id="PhoneNumberParserStage.__init__-29"><a href="#PhoneNumberParserStage.__init__-29"><span class="linenos">29</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="PhoneNumberParserStage.__init__-30"><a href="#PhoneNumberParserStage.__init__-30"><span class="linenos">30</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="PhoneNumberParserStage.__init__-31"><a href="#PhoneNumberParserStage.__init__-31"><span class="linenos">31</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="PhoneNumberParserStage.__init__-32"><a href="#PhoneNumberParserStage.__init__-32"><span class="linenos">32</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="PhoneNumberParserStage.__init__-33"><a href="#PhoneNumberParserStage.__init__-33"><span class="linenos">33</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PhoneNumberParserStage.__init__-34"><a href="#PhoneNumberParserStage.__init__-34"><span class="linenos">34</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PhoneNumberParserStage.__init__-35"><a href="#PhoneNumberParserStage.__init__-35"><span class="linenos">35</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-36"><a href="#PhoneNumberParserStage.__init__-36"><span class="linenos">36</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-37"><a href="#PhoneNumberParserStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-38"><a href="#PhoneNumberParserStage.__init__-38"><span class="linenos">38</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-39"><a href="#PhoneNumberParserStage.__init__-39"><span class="linenos">39</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-40"><a href="#PhoneNumberParserStage.__init__-40"><span class="linenos">40</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-41"><a href="#PhoneNumberParserStage.__init__-41"><span class="linenos">41</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="PhoneNumberParserStage.__init__-42"><a href="#PhoneNumberParserStage.__init__-42"><span class="linenos">42</span></a>        <span class="p">)</span>
</span><span id="PhoneNumberParserStage.__init__-43"><a href="#PhoneNumberParserStage.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span> <span class="o">=</span> <span class="n">on_error</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#PhoneNumberParserStage">PhoneNumberParserStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (Iterable[str], optional):</strong>  Fields to operate on. Will operate on all fields if not set (None).</li>
<li><strong>allow_nulls (bool, optional):</strong>  Allow null values/fields if True, otherwise use error_handling_method</li>
<li><strong>on_error ("raise" or "default", optional):</strong>  What to do if a phone number cannot be parsed. Defaults to "raise".</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="PhoneNumberParserStage.process_field" class="classattr">
                                        <input id="PhoneNumberParserStage.process_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="PhoneNumberParserStage.process_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PhoneNumberParserStage.process_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PhoneNumberParserStage.process_field-82"><a href="#PhoneNumberParserStage.process_field-82"><span class="linenos">82</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage.process_field-83"><a href="#PhoneNumberParserStage.process_field-83"><span class="linenos">83</span></a>        <span class="n">parsed</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_phone_number</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span>
</span><span id="PhoneNumberParserStage.process_field-84"><a href="#PhoneNumberParserStage.process_field-84"><span class="linenos">84</span></a>        <span class="k">if</span> <span class="n">err</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
</span><span id="PhoneNumberParserStage.process_field-85"><a href="#PhoneNumberParserStage.process_field-85"><span class="linenos">85</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="PhoneNumberParserStage.process_field-86"><a href="#PhoneNumberParserStage.process_field-86"><span class="linenos">86</span></a>                <span class="sa">f</span><span class="s2">&quot;Unable to parse phone number in field `</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">`:&quot;</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">field_value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="PhoneNumberParserStage.process_field-87"><a href="#PhoneNumberParserStage.process_field-87"><span class="linenos">87</span></a>            <span class="p">)</span>
</span><span id="PhoneNumberParserStage.process_field-88"><a href="#PhoneNumberParserStage.process_field-88"><span class="linenos">88</span></a>        <span class="k">return</span> <span class="n">parsed</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.extensions.field_processor_stage.FieldProcessorStage</dt>
                                <dd id="PhoneNumberParserStage.process_record" class="function">process_record</dd>

            </div>
            <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="PhoneNumberParserStage.unique_name" class="variable">unique_name</dd>
                <dd id="PhoneNumberParserStage.pipeline" class="variable">pipeline</dd>
                <dd id="PhoneNumberParserStage.add_downstream" class="function">add_downstream</dd>
                <dd id="PhoneNumberParserStage.add_upstream" class="function">add_upstream</dd>
                <dd id="PhoneNumberParserStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="PhoneNumberParserStage.channels" class="variable">channels</dd>
                <dd id="PhoneNumberParserStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="PhoneNumberParserStage.log" class="variable">log</dd>
                <dd id="PhoneNumberParserStage.reset_level" class="function">reset_level</dd>
                <dd id="PhoneNumberParserStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PostgresLookupStage">
                            <input id="PostgresLookupStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PostgresLookupStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="PostgresLookupStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PostgresLookupStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PostgresLookupStage-12"><a href="#PostgresLookupStage-12"><span class="linenos">12</span></a><span class="k">class</span> <span class="nc">PostgresLookupStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="PostgresLookupStage-13"><a href="#PostgresLookupStage-13"><span class="linenos">13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Appends fields to each record in a batch based on a lookup query.&quot;&quot;&quot;</span>
</span><span id="PostgresLookupStage-14"><a href="#PostgresLookupStage-14"><span class="linenos">14</span></a>
</span><span id="PostgresLookupStage-15"><a href="#PostgresLookupStage-15"><span class="linenos">15</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PostgresLookupStage-16"><a href="#PostgresLookupStage-16"><span class="linenos">16</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresLookupStage-17"><a href="#PostgresLookupStage-17"><span class="linenos">17</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresLookupStage-18"><a href="#PostgresLookupStage-18"><span class="linenos">18</span></a>        <span class="n">mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="PostgresLookupStage-19"><a href="#PostgresLookupStage-19"><span class="linenos">19</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="PostgresLookupStage-20"><a href="#PostgresLookupStage-20"><span class="linenos">20</span></a>        <span class="n">on_zero_rows</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="s2">&quot;preserve&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="PostgresLookupStage-21"><a href="#PostgresLookupStage-21"><span class="linenos">21</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresLookupStage-22"><a href="#PostgresLookupStage-22"><span class="linenos">22</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PostgresLookupStage-23"><a href="#PostgresLookupStage-23"><span class="linenos">23</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="PostgresLookupStage-24"><a href="#PostgresLookupStage-24"><span class="linenos">24</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PostgresLookupStage-25"><a href="#PostgresLookupStage-25"><span class="linenos">25</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PostgresLookupStage-26"><a href="#PostgresLookupStage-26"><span class="linenos">26</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `PostgresLookupStage`.</span>
</span><span id="PostgresLookupStage-27"><a href="#PostgresLookupStage-27"><span class="linenos">27</span></a>
</span><span id="PostgresLookupStage-28"><a href="#PostgresLookupStage-28"><span class="linenos">28</span></a><span class="sd">        Args:</span>
</span><span id="PostgresLookupStage-29"><a href="#PostgresLookupStage-29"><span class="linenos">29</span></a><span class="sd">            query (str): SQL query to run. Applied for each batch. Must return exactly one row. Uses %s for placeholders, with placeholder names corresponding to record dictionary keys. Example: `&quot;SELECT * FROM master.companies WHERE city = %(city)s LIMIT 1;&quot;`</span>
</span><span id="PostgresLookupStage-30"><a href="#PostgresLookupStage-30"><span class="linenos">30</span></a><span class="sd">            mappings (dict[str, str]): Map of how fields keys (columns) returned by query should be mapped to a field in each record on the batch. Example: `{&#39;id&#39;: &#39;data_source_id&#39;, &#39;name&#39;: &#39;company_name&#39;}`.</span>
</span><span id="PostgresLookupStage-31"><a href="#PostgresLookupStage-31"><span class="linenos">31</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Connection pool to use connections from for lookup.</span>
</span><span id="PostgresLookupStage-32"><a href="#PostgresLookupStage-32"><span class="linenos">32</span></a><span class="sd">            on_zero_rows (Literal[&quot;ignore&quot;, &quot;raise&quot;, &quot;preserve&quot;], optional): What to do if zero rows are returned by lookup. Defaults to &quot;ignore&quot;, which will set the lookup field to None. &quot;raise&quot; will raise an exception.  &quot;preserve&quot; preserves original record data.</span>
</span><span id="PostgresLookupStage-33"><a href="#PostgresLookupStage-33"><span class="linenos">33</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="PostgresLookupStage-34"><a href="#PostgresLookupStage-34"><span class="linenos">34</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="PostgresLookupStage-35"><a href="#PostgresLookupStage-35"><span class="linenos">35</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="PostgresLookupStage-36"><a href="#PostgresLookupStage-36"><span class="linenos">36</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="PostgresLookupStage-37"><a href="#PostgresLookupStage-37"><span class="linenos">37</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PostgresLookupStage-38"><a href="#PostgresLookupStage-38"><span class="linenos">38</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PostgresLookupStage-39"><a href="#PostgresLookupStage-39"><span class="linenos">39</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresLookupStage-40"><a href="#PostgresLookupStage-40"><span class="linenos">40</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="PostgresLookupStage-41"><a href="#PostgresLookupStage-41"><span class="linenos">41</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="PostgresLookupStage-42"><a href="#PostgresLookupStage-42"><span class="linenos">42</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="PostgresLookupStage-43"><a href="#PostgresLookupStage-43"><span class="linenos">43</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="PostgresLookupStage-44"><a href="#PostgresLookupStage-44"><span class="linenos">44</span></a>        <span class="p">)</span>
</span><span id="PostgresLookupStage-45"><a href="#PostgresLookupStage-45"><span class="linenos">45</span></a>
</span><span id="PostgresLookupStage-46"><a href="#PostgresLookupStage-46"><span class="linenos">46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
</span><span id="PostgresLookupStage-47"><a href="#PostgresLookupStage-47"><span class="linenos">47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span> <span class="o">=</span> <span class="n">mappings</span>
</span><span id="PostgresLookupStage-48"><a href="#PostgresLookupStage-48"><span class="linenos">48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_rows</span> <span class="o">=</span> <span class="n">on_zero_rows</span>
</span><span id="PostgresLookupStage-49"><a href="#PostgresLookupStage-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span><span id="PostgresLookupStage-50"><a href="#PostgresLookupStage-50"><span class="linenos">50</span></a>
</span><span id="PostgresLookupStage-51"><a href="#PostgresLookupStage-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="nf">_validate_lookup_results</span><span class="p">(</span>
</span><span id="PostgresLookupStage-52"><a href="#PostgresLookupStage-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictRow</span><span class="p">]</span>
</span><span id="PostgresLookupStage-53"><a href="#PostgresLookupStage-53"><span class="linenos">53</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PostgresLookupStage-54"><a href="#PostgresLookupStage-54"><span class="linenos">54</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_rows</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
</span><span id="PostgresLookupStage-55"><a href="#PostgresLookupStage-55"><span class="linenos">55</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="PostgresLookupStage-56"><a href="#PostgresLookupStage-56"><span class="linenos">56</span></a>                <span class="sa">f</span><span class="s2">&quot;Lookup query must return exactly one row. Got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows.&quot;</span>
</span><span id="PostgresLookupStage-57"><a href="#PostgresLookupStage-57"><span class="linenos">57</span></a>            <span class="p">)</span>
</span><span id="PostgresLookupStage-58"><a href="#PostgresLookupStage-58"><span class="linenos">58</span></a>
</span><span id="PostgresLookupStage-59"><a href="#PostgresLookupStage-59"><span class="linenos">59</span></a>    <span class="k">def</span> <span class="nf">_process_lookup_results</span><span class="p">(</span>
</span><span id="PostgresLookupStage-60"><a href="#PostgresLookupStage-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresLookupStage-61"><a href="#PostgresLookupStage-61"><span class="linenos">61</span></a>        <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictRow</span><span class="p">],</span>
</span><span id="PostgresLookupStage-62"><a href="#PostgresLookupStage-62"><span class="linenos">62</span></a>        <span class="n">colnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="PostgresLookupStage-63"><a href="#PostgresLookupStage-63"><span class="linenos">63</span></a>        <span class="n">record_data</span><span class="p">:</span> <span class="n">RecordData</span><span class="p">,</span>
</span><span id="PostgresLookupStage-64"><a href="#PostgresLookupStage-64"><span class="linenos">64</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PostgresLookupStage-65"><a href="#PostgresLookupStage-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_lookup_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="PostgresLookupStage-66"><a href="#PostgresLookupStage-66"><span class="linenos">66</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="PostgresLookupStage-67"><a href="#PostgresLookupStage-67"><span class="linenos">67</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_rows</span> <span class="o">==</span> <span class="s2">&quot;ignore&quot;</span><span class="p">:</span>
</span><span id="PostgresLookupStage-68"><a href="#PostgresLookupStage-68"><span class="linenos">68</span></a>            <span class="k">return</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">colnames</span><span class="p">}</span>
</span><span id="PostgresLookupStage-69"><a href="#PostgresLookupStage-69"><span class="linenos">69</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">results</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_rows</span> <span class="o">==</span> <span class="s2">&quot;preserve&quot;</span><span class="p">:</span>
</span><span id="PostgresLookupStage-70"><a href="#PostgresLookupStage-70"><span class="linenos">70</span></a>            <span class="k">return</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span> <span class="n">record_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="PostgresLookupStage-71"><a href="#PostgresLookupStage-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="PostgresLookupStage-72"><a href="#PostgresLookupStage-72"><span class="linenos">72</span></a>
</span><span id="PostgresLookupStage-73"><a href="#PostgresLookupStage-73"><span class="linenos">73</span></a>    <span class="k">def</span> <span class="nf">_do_lookup</span><span class="p">(</span>
</span><span id="PostgresLookupStage-74"><a href="#PostgresLookupStage-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">:</span> <span class="n">connection</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_data</span><span class="p">:</span> <span class="n">RecordData</span>
</span><span id="PostgresLookupStage-75"><a href="#PostgresLookupStage-75"><span class="linenos">75</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PostgresLookupStage-76"><a href="#PostgresLookupStage-76"><span class="linenos">76</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_factory</span><span class="o">=</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictCursor</span><span class="p">)</span>
</span><span id="PostgresLookupStage-77"><a href="#PostgresLookupStage-77"><span class="linenos">77</span></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">record_data</span><span class="p">)</span>
</span><span id="PostgresLookupStage-78"><a href="#PostgresLookupStage-78"><span class="linenos">78</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="PostgresLookupStage-79"><a href="#PostgresLookupStage-79"><span class="linenos">79</span></a>        <span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
</span><span id="PostgresLookupStage-80"><a href="#PostgresLookupStage-80"><span class="linenos">80</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_lookup_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">record_data</span><span class="p">)</span>
</span><span id="PostgresLookupStage-81"><a href="#PostgresLookupStage-81"><span class="linenos">81</span></a>
</span><span id="PostgresLookupStage-82"><a href="#PostgresLookupStage-82"><span class="linenos">82</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="PostgresLookupStage-83"><a href="#PostgresLookupStage-83"><span class="linenos">83</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="PostgresLookupStage-84"><a href="#PostgresLookupStage-84"><span class="linenos">84</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PostgresLookupStage-85"><a href="#PostgresLookupStage-85"><span class="linenos">85</span></a>            <span class="n">lookup_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_lookup</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="PostgresLookupStage-86"><a href="#PostgresLookupStage-86"><span class="linenos">86</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="PostgresLookupStage-87"><a href="#PostgresLookupStage-87"><span class="linenos">87</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="PostgresLookupStage-88"><a href="#PostgresLookupStage-88"><span class="linenos">88</span></a>        <span class="n">filtered_results</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">lookup_results</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="PostgresLookupStage-89"><a href="#PostgresLookupStage-89"><span class="linenos">89</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filtered_results</span><span class="p">)</span>
</span><span id="PostgresLookupStage-90"><a href="#PostgresLookupStage-90"><span class="linenos">90</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Appends fields to each record in a batch based on a lookup query.</p>
</div>


                            <div id="PostgresLookupStage.__init__" class="classattr">
                                        <input id="PostgresLookupStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PostgresLookupStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">query</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">connection_pool</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">postgres_connection_pool</span><span class="o">.</span><span class="n">PostgresConnectionPool</span>,</span><span class="param">	<span class="n">on_zero_rows</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="s1">&#39;preserve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="PostgresLookupStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PostgresLookupStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PostgresLookupStage.__init__-15"><a href="#PostgresLookupStage.__init__-15"><span class="linenos">15</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PostgresLookupStage.__init__-16"><a href="#PostgresLookupStage.__init__-16"><span class="linenos">16</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-17"><a href="#PostgresLookupStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-18"><a href="#PostgresLookupStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="PostgresLookupStage.__init__-19"><a href="#PostgresLookupStage.__init__-19"><span class="linenos">19</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-20"><a href="#PostgresLookupStage.__init__-20"><span class="linenos">20</span></a>        <span class="n">on_zero_rows</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="s2">&quot;preserve&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-21"><a href="#PostgresLookupStage.__init__-21"><span class="linenos">21</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-22"><a href="#PostgresLookupStage.__init__-22"><span class="linenos">22</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-23"><a href="#PostgresLookupStage.__init__-23"><span class="linenos">23</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-24"><a href="#PostgresLookupStage.__init__-24"><span class="linenos">24</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-25"><a href="#PostgresLookupStage.__init__-25"><span class="linenos">25</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PostgresLookupStage.__init__-26"><a href="#PostgresLookupStage.__init__-26"><span class="linenos">26</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `PostgresLookupStage`.</span>
</span><span id="PostgresLookupStage.__init__-27"><a href="#PostgresLookupStage.__init__-27"><span class="linenos">27</span></a>
</span><span id="PostgresLookupStage.__init__-28"><a href="#PostgresLookupStage.__init__-28"><span class="linenos">28</span></a><span class="sd">        Args:</span>
</span><span id="PostgresLookupStage.__init__-29"><a href="#PostgresLookupStage.__init__-29"><span class="linenos">29</span></a><span class="sd">            query (str): SQL query to run. Applied for each batch. Must return exactly one row. Uses %s for placeholders, with placeholder names corresponding to record dictionary keys. Example: `&quot;SELECT * FROM master.companies WHERE city = %(city)s LIMIT 1;&quot;`</span>
</span><span id="PostgresLookupStage.__init__-30"><a href="#PostgresLookupStage.__init__-30"><span class="linenos">30</span></a><span class="sd">            mappings (dict[str, str]): Map of how fields keys (columns) returned by query should be mapped to a field in each record on the batch. Example: `{&#39;id&#39;: &#39;data_source_id&#39;, &#39;name&#39;: &#39;company_name&#39;}`.</span>
</span><span id="PostgresLookupStage.__init__-31"><a href="#PostgresLookupStage.__init__-31"><span class="linenos">31</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Connection pool to use connections from for lookup.</span>
</span><span id="PostgresLookupStage.__init__-32"><a href="#PostgresLookupStage.__init__-32"><span class="linenos">32</span></a><span class="sd">            on_zero_rows (Literal[&quot;ignore&quot;, &quot;raise&quot;, &quot;preserve&quot;], optional): What to do if zero rows are returned by lookup. Defaults to &quot;ignore&quot;, which will set the lookup field to None. &quot;raise&quot; will raise an exception.  &quot;preserve&quot; preserves original record data.</span>
</span><span id="PostgresLookupStage.__init__-33"><a href="#PostgresLookupStage.__init__-33"><span class="linenos">33</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="PostgresLookupStage.__init__-34"><a href="#PostgresLookupStage.__init__-34"><span class="linenos">34</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="PostgresLookupStage.__init__-35"><a href="#PostgresLookupStage.__init__-35"><span class="linenos">35</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="PostgresLookupStage.__init__-36"><a href="#PostgresLookupStage.__init__-36"><span class="linenos">36</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="PostgresLookupStage.__init__-37"><a href="#PostgresLookupStage.__init__-37"><span class="linenos">37</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PostgresLookupStage.__init__-38"><a href="#PostgresLookupStage.__init__-38"><span class="linenos">38</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PostgresLookupStage.__init__-39"><a href="#PostgresLookupStage.__init__-39"><span class="linenos">39</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-40"><a href="#PostgresLookupStage.__init__-40"><span class="linenos">40</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-41"><a href="#PostgresLookupStage.__init__-41"><span class="linenos">41</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-42"><a href="#PostgresLookupStage.__init__-42"><span class="linenos">42</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-43"><a href="#PostgresLookupStage.__init__-43"><span class="linenos">43</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="PostgresLookupStage.__init__-44"><a href="#PostgresLookupStage.__init__-44"><span class="linenos">44</span></a>        <span class="p">)</span>
</span><span id="PostgresLookupStage.__init__-45"><a href="#PostgresLookupStage.__init__-45"><span class="linenos">45</span></a>
</span><span id="PostgresLookupStage.__init__-46"><a href="#PostgresLookupStage.__init__-46"><span class="linenos">46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
</span><span id="PostgresLookupStage.__init__-47"><a href="#PostgresLookupStage.__init__-47"><span class="linenos">47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span> <span class="o">=</span> <span class="n">mappings</span>
</span><span id="PostgresLookupStage.__init__-48"><a href="#PostgresLookupStage.__init__-48"><span class="linenos">48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_rows</span> <span class="o">=</span> <span class="n">on_zero_rows</span>
</span><span id="PostgresLookupStage.__init__-49"><a href="#PostgresLookupStage.__init__-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#PostgresLookupStage">PostgresLookupStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>query (str):</strong>  SQL query to run. Applied for each batch. Must return exactly one row. Uses %s for placeholders, with placeholder names corresponding to record dictionary keys. Example: <code>"SELECT * FROM master.companies WHERE city = %(city)s LIMIT 1;"</code></li>
<li><strong>mappings (dict[str, str]):</strong>  Map of how fields keys (columns) returned by query should be mapped to a field in each record on the batch. Example: <code>{'id': 'data_source_id', 'name': 'company_name'}</code>.</li>
<li><strong>connection_pool (PostgresConnectionPool):</strong>  Connection pool to use connections from for lookup.</li>
<li><strong>on_zero_rows (Literal["ignore", "raise", "preserve"], optional):</strong>  What to do if zero rows are returned by lookup. Defaults to "ignore", which will set the lookup field to None. "raise" will raise an exception.  "preserve" preserves original record data.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="PostgresLookupStage.process_record" class="classattr">
                                        <input id="PostgresLookupStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="PostgresLookupStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PostgresLookupStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PostgresLookupStage.process_record-82"><a href="#PostgresLookupStage.process_record-82"><span class="linenos">82</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="PostgresLookupStage.process_record-83"><a href="#PostgresLookupStage.process_record-83"><span class="linenos">83</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="PostgresLookupStage.process_record-84"><a href="#PostgresLookupStage.process_record-84"><span class="linenos">84</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PostgresLookupStage.process_record-85"><a href="#PostgresLookupStage.process_record-85"><span class="linenos">85</span></a>            <span class="n">lookup_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_lookup</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="PostgresLookupStage.process_record-86"><a href="#PostgresLookupStage.process_record-86"><span class="linenos">86</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="PostgresLookupStage.process_record-87"><a href="#PostgresLookupStage.process_record-87"><span class="linenos">87</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="PostgresLookupStage.process_record-88"><a href="#PostgresLookupStage.process_record-88"><span class="linenos">88</span></a>        <span class="n">filtered_results</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">lookup_results</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="PostgresLookupStage.process_record-89"><a href="#PostgresLookupStage.process_record-89"><span class="linenos">89</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filtered_results</span><span class="p">)</span>
</span><span id="PostgresLookupStage.process_record-90"><a href="#PostgresLookupStage.process_record-90"><span class="linenos">90</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="PostgresLookupStage.unique_name" class="variable">unique_name</dd>
                <dd id="PostgresLookupStage.pipeline" class="variable">pipeline</dd>
                <dd id="PostgresLookupStage.add_downstream" class="function">add_downstream</dd>
                <dd id="PostgresLookupStage.add_upstream" class="function">add_upstream</dd>
                <dd id="PostgresLookupStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="PostgresLookupStage.channels" class="variable">channels</dd>
                <dd id="PostgresLookupStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="PostgresLookupStage.log" class="variable">log</dd>
                <dd id="PostgresLookupStage.reset_level" class="function">reset_level</dd>
                <dd id="PostgresLookupStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PostgresReferenceLookupStage">
                            <input id="PostgresReferenceLookupStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PostgresReferenceLookupStage</span><wbr>(<span class="base"><a href="#PostgresLookupStage">cluo.stages.PostgresLookupStage</a></span>):

                <label class="view-source-button" for="PostgresReferenceLookupStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PostgresReferenceLookupStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PostgresReferenceLookupStage-9"><a href="#PostgresReferenceLookupStage-9"><span class="linenos"> 9</span></a><span class="k">class</span> <span class="nc">PostgresReferenceLookupStage</span><span class="p">(</span><span class="n">PostgresLookupStage</span><span class="p">):</span>
</span><span id="PostgresReferenceLookupStage-10"><a href="#PostgresReferenceLookupStage-10"><span class="linenos">10</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convience constructor for `PostgresLookupBuilderStage` for doing reference table lookups.&quot;&quot;&quot;</span>
</span><span id="PostgresReferenceLookupStage-11"><a href="#PostgresReferenceLookupStage-11"><span class="linenos">11</span></a>
</span><span id="PostgresReferenceLookupStage-12"><a href="#PostgresReferenceLookupStage-12"><span class="linenos">12</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="PostgresReferenceLookupStage-13"><a href="#PostgresReferenceLookupStage-13"><span class="linenos">13</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-14"><a href="#PostgresReferenceLookupStage-14"><span class="linenos">14</span></a>        <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-15"><a href="#PostgresReferenceLookupStage-15"><span class="linenos">15</span></a>        <span class="n">table_match_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-16"><a href="#PostgresReferenceLookupStage-16"><span class="linenos">16</span></a>        <span class="n">record_match_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-17"><a href="#PostgresReferenceLookupStage-17"><span class="linenos">17</span></a>        <span class="n">table_get_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-18"><a href="#PostgresReferenceLookupStage-18"><span class="linenos">18</span></a>        <span class="n">record_set_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-19"><a href="#PostgresReferenceLookupStage-19"><span class="linenos">19</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-20"><a href="#PostgresReferenceLookupStage-20"><span class="linenos">20</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-21"><a href="#PostgresReferenceLookupStage-21"><span class="linenos">21</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-22"><a href="#PostgresReferenceLookupStage-22"><span class="linenos">22</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-23"><a href="#PostgresReferenceLookupStage-23"><span class="linenos">23</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PostgresLookupStage</span><span class="p">:</span>
</span><span id="PostgresReferenceLookupStage-24"><a href="#PostgresReferenceLookupStage-24"><span class="linenos">24</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span>
</span><span id="PostgresReferenceLookupStage-25"><a href="#PostgresReferenceLookupStage-25"><span class="linenos">25</span></a>            <span class="sa">f</span><span class="s2">&quot;SELECT </span><span class="si">{</span><span class="n">table_get_field</span><span class="si">}</span><span class="s2"> AS </span><span class="si">{</span><span class="n">record_set_field</span><span class="si">}</span><span class="s2"> FROM reference.</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> WHERE </span><span class="si">{</span><span class="n">table_match_field</span><span class="si">}</span><span class="s2"> = %(</span><span class="si">{</span><span class="n">record_match_field</span><span class="si">}</span><span class="s2">)s;&quot;</span>
</span><span id="PostgresReferenceLookupStage-26"><a href="#PostgresReferenceLookupStage-26"><span class="linenos">26</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PostgresReferenceLookupStage-27"><a href="#PostgresReferenceLookupStage-27"><span class="linenos">27</span></a>            <span class="n">table_get_field</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="n">table_get_field</span><span class="p">),</span>
</span><span id="PostgresReferenceLookupStage-28"><a href="#PostgresReferenceLookupStage-28"><span class="linenos">28</span></a>            <span class="n">record_set_field</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="n">record_set_field</span><span class="p">),</span>
</span><span id="PostgresReferenceLookupStage-29"><a href="#PostgresReferenceLookupStage-29"><span class="linenos">29</span></a>            <span class="n">table</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="n">table</span><span class="p">),</span>
</span><span id="PostgresReferenceLookupStage-30"><a href="#PostgresReferenceLookupStage-30"><span class="linenos">30</span></a>            <span class="n">table_match_field</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="n">table_match_field</span><span class="p">),</span>
</span><span id="PostgresReferenceLookupStage-31"><a href="#PostgresReferenceLookupStage-31"><span class="linenos">31</span></a>        <span class="p">)</span>
</span><span id="PostgresReferenceLookupStage-32"><a href="#PostgresReferenceLookupStage-32"><span class="linenos">32</span></a>        <span class="n">mappings</span> <span class="o">=</span> <span class="p">{</span><span class="n">record_set_field</span><span class="p">:</span> <span class="n">record_set_field</span><span class="p">}</span>
</span><span id="PostgresReferenceLookupStage-33"><a href="#PostgresReferenceLookupStage-33"><span class="linenos">33</span></a>        <span class="k">return</span> <span class="n">PostgresLookupStage</span><span class="p">(</span>
</span><span id="PostgresReferenceLookupStage-34"><a href="#PostgresReferenceLookupStage-34"><span class="linenos">34</span></a>            <span class="n">query</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-35"><a href="#PostgresReferenceLookupStage-35"><span class="linenos">35</span></a>            <span class="n">mappings</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-36"><a href="#PostgresReferenceLookupStage-36"><span class="linenos">36</span></a>            <span class="n">connection_pool</span><span class="o">=</span><span class="n">connection_pool</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-37"><a href="#PostgresReferenceLookupStage-37"><span class="linenos">37</span></a>            <span class="n">on_zero_rows</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-38"><a href="#PostgresReferenceLookupStage-38"><span class="linenos">38</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-39"><a href="#PostgresReferenceLookupStage-39"><span class="linenos">39</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-40"><a href="#PostgresReferenceLookupStage-40"><span class="linenos">40</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="PostgresReferenceLookupStage-41"><a href="#PostgresReferenceLookupStage-41"><span class="linenos">41</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convience constructor for <code>PostgresLookupBuilderStage</code> for doing reference table lookups.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#PostgresLookupStage">PostgresLookupStage</a></dt>
                                <dd id="PostgresReferenceLookupStage.__init__" class="function"><a href="#PostgresLookupStage.__init__">PostgresLookupStage</a></dd>
                <dd id="PostgresReferenceLookupStage.process_record" class="function"><a href="#PostgresLookupStage.process_record">process_record</a></dd>

            </div>
            <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="PostgresReferenceLookupStage.unique_name" class="variable">unique_name</dd>
                <dd id="PostgresReferenceLookupStage.pipeline" class="variable">pipeline</dd>
                <dd id="PostgresReferenceLookupStage.add_downstream" class="function">add_downstream</dd>
                <dd id="PostgresReferenceLookupStage.add_upstream" class="function">add_upstream</dd>
                <dd id="PostgresReferenceLookupStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="PostgresReferenceLookupStage.channels" class="variable">channels</dd>
                <dd id="PostgresReferenceLookupStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="PostgresReferenceLookupStage.log" class="variable">log</dd>
                <dd id="PostgresReferenceLookupStage.reset_level" class="function">reset_level</dd>
                <dd id="PostgresReferenceLookupStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PythonCallableStage">
                            <input id="PythonCallableStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PythonCallableStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="PythonCallableStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PythonCallableStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PythonCallableStage-7"><a href="#PythonCallableStage-7"><span class="linenos"> 7</span></a><span class="k">class</span> <span class="nc">PythonCallableStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="PythonCallableStage-8"><a href="#PythonCallableStage-8"><span class="linenos"> 8</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a pipeline stage from an arbitrary Python function.&quot;&quot;&quot;</span>
</span><span id="PythonCallableStage-9"><a href="#PythonCallableStage-9"><span class="linenos"> 9</span></a>
</span><span id="PythonCallableStage-10"><a href="#PythonCallableStage-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PythonCallableStage-11"><a href="#PythonCallableStage-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PythonCallableStage-12"><a href="#PythonCallableStage-12"><span class="linenos">12</span></a>        <span class="n">process_record</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Record</span><span class="p">],</span> <span class="n">Record</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PythonCallableStage-13"><a href="#PythonCallableStage-13"><span class="linenos">13</span></a>        <span class="n">process_batch</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Batch</span><span class="p">],</span> <span class="n">Batch</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PythonCallableStage-14"><a href="#PythonCallableStage-14"><span class="linenos">14</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PythonCallableStage-15"><a href="#PythonCallableStage-15"><span class="linenos">15</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PythonCallableStage-16"><a href="#PythonCallableStage-16"><span class="linenos">16</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">,</span>
</span><span id="PythonCallableStage-17"><a href="#PythonCallableStage-17"><span class="linenos">17</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PythonCallableStage-18"><a href="#PythonCallableStage-18"><span class="linenos">18</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PythonCallableStage-19"><a href="#PythonCallableStage-19"><span class="linenos">19</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `PythonCallableStage`. One of `process_record` or `process_batch` must be provided.</span>
</span><span id="PythonCallableStage-20"><a href="#PythonCallableStage-20"><span class="linenos">20</span></a>
</span><span id="PythonCallableStage-21"><a href="#PythonCallableStage-21"><span class="linenos">21</span></a><span class="sd">        Args:</span>
</span><span id="PythonCallableStage-22"><a href="#PythonCallableStage-22"><span class="linenos">22</span></a><span class="sd">            process_record (Callable[[Record], Record], optional): Function for processing a record. Defaults to None.</span>
</span><span id="PythonCallableStage-23"><a href="#PythonCallableStage-23"><span class="linenos">23</span></a><span class="sd">            process_batch (Callable[[Batch], Batch], optional): Function for processing a batch. Defaults to None.</span>
</span><span id="PythonCallableStage-24"><a href="#PythonCallableStage-24"><span class="linenos">24</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="PythonCallableStage-25"><a href="#PythonCallableStage-25"><span class="linenos">25</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="PythonCallableStage-26"><a href="#PythonCallableStage-26"><span class="linenos">26</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="PythonCallableStage-27"><a href="#PythonCallableStage-27"><span class="linenos">27</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="PythonCallableStage-28"><a href="#PythonCallableStage-28"><span class="linenos">28</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PythonCallableStage-29"><a href="#PythonCallableStage-29"><span class="linenos">29</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PythonCallableStage-30"><a href="#PythonCallableStage-30"><span class="linenos">30</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PythonCallableStage-31"><a href="#PythonCallableStage-31"><span class="linenos">31</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="PythonCallableStage-32"><a href="#PythonCallableStage-32"><span class="linenos">32</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="PythonCallableStage-33"><a href="#PythonCallableStage-33"><span class="linenos">33</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="PythonCallableStage-34"><a href="#PythonCallableStage-34"><span class="linenos">34</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="PythonCallableStage-35"><a href="#PythonCallableStage-35"><span class="linenos">35</span></a>        <span class="p">)</span>
</span><span id="PythonCallableStage-36"><a href="#PythonCallableStage-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_processor</span><span class="p">(</span><span class="n">process_record</span><span class="p">,</span> <span class="n">process_batch</span><span class="p">)</span>
</span><span id="PythonCallableStage-37"><a href="#PythonCallableStage-37"><span class="linenos">37</span></a>
</span><span id="PythonCallableStage-38"><a href="#PythonCallableStage-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="nf">_set_processor</span><span class="p">(</span>
</span><span id="PythonCallableStage-39"><a href="#PythonCallableStage-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PythonCallableStage-40"><a href="#PythonCallableStage-40"><span class="linenos">40</span></a>        <span class="n">process_record</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Record</span><span class="p">],</span> <span class="n">Record</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PythonCallableStage-41"><a href="#PythonCallableStage-41"><span class="linenos">41</span></a>        <span class="n">process_batch</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Batch</span><span class="p">],</span> <span class="n">Batch</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PythonCallableStage-42"><a href="#PythonCallableStage-42"><span class="linenos">42</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PythonCallableStage-43"><a href="#PythonCallableStage-43"><span class="linenos">43</span></a>        <span class="k">if</span> <span class="n">process_record</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">process_batch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PythonCallableStage-44"><a href="#PythonCallableStage-44"><span class="linenos">44</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either process_record or process_batch.&quot;</span><span class="p">)</span>
</span><span id="PythonCallableStage-45"><a href="#PythonCallableStage-45"><span class="linenos">45</span></a>        <span class="k">if</span> <span class="n">process_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">process_batch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PythonCallableStage-46"><a href="#PythonCallableStage-46"><span class="linenos">46</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot provide both process_record and process_batch.&quot;</span><span class="p">)</span>
</span><span id="PythonCallableStage-47"><a href="#PythonCallableStage-47"><span class="linenos">47</span></a>        <span class="k">if</span> <span class="n">process_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PythonCallableStage-48"><a href="#PythonCallableStage-48"><span class="linenos">48</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">process_record</span> <span class="o">=</span> <span class="n">process_record</span>
</span><span id="PythonCallableStage-49"><a href="#PythonCallableStage-49"><span class="linenos">49</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PythonCallableStage-50"><a href="#PythonCallableStage-50"><span class="linenos">50</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">process_batch</span> <span class="o">=</span> <span class="n">process_batch</span>
</span></pre></div>


            <div class="docstring"><p>Create a pipeline stage from an arbitrary Python function.</p>
</div>


                            <div id="PythonCallableStage.__init__" class="classattr">
                                        <input id="PythonCallableStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PythonCallableStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">process_record</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span><span class="p">],</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">process_batch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span><span class="p">],</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="PythonCallableStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PythonCallableStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PythonCallableStage.__init__-10"><a href="#PythonCallableStage.__init__-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PythonCallableStage.__init__-11"><a href="#PythonCallableStage.__init__-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-12"><a href="#PythonCallableStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">process_record</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Record</span><span class="p">],</span> <span class="n">Record</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-13"><a href="#PythonCallableStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">process_batch</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Batch</span><span class="p">],</span> <span class="n">Batch</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-14"><a href="#PythonCallableStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-15"><a href="#PythonCallableStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-16"><a href="#PythonCallableStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-17"><a href="#PythonCallableStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-18"><a href="#PythonCallableStage.__init__-18"><span class="linenos">18</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PythonCallableStage.__init__-19"><a href="#PythonCallableStage.__init__-19"><span class="linenos">19</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `PythonCallableStage`. One of `process_record` or `process_batch` must be provided.</span>
</span><span id="PythonCallableStage.__init__-20"><a href="#PythonCallableStage.__init__-20"><span class="linenos">20</span></a>
</span><span id="PythonCallableStage.__init__-21"><a href="#PythonCallableStage.__init__-21"><span class="linenos">21</span></a><span class="sd">        Args:</span>
</span><span id="PythonCallableStage.__init__-22"><a href="#PythonCallableStage.__init__-22"><span class="linenos">22</span></a><span class="sd">            process_record (Callable[[Record], Record], optional): Function for processing a record. Defaults to None.</span>
</span><span id="PythonCallableStage.__init__-23"><a href="#PythonCallableStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            process_batch (Callable[[Batch], Batch], optional): Function for processing a batch. Defaults to None.</span>
</span><span id="PythonCallableStage.__init__-24"><a href="#PythonCallableStage.__init__-24"><span class="linenos">24</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="PythonCallableStage.__init__-25"><a href="#PythonCallableStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="PythonCallableStage.__init__-26"><a href="#PythonCallableStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="PythonCallableStage.__init__-27"><a href="#PythonCallableStage.__init__-27"><span class="linenos">27</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="PythonCallableStage.__init__-28"><a href="#PythonCallableStage.__init__-28"><span class="linenos">28</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PythonCallableStage.__init__-29"><a href="#PythonCallableStage.__init__-29"><span class="linenos">29</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PythonCallableStage.__init__-30"><a href="#PythonCallableStage.__init__-30"><span class="linenos">30</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-31"><a href="#PythonCallableStage.__init__-31"><span class="linenos">31</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-32"><a href="#PythonCallableStage.__init__-32"><span class="linenos">32</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-33"><a href="#PythonCallableStage.__init__-33"><span class="linenos">33</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-34"><a href="#PythonCallableStage.__init__-34"><span class="linenos">34</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="PythonCallableStage.__init__-35"><a href="#PythonCallableStage.__init__-35"><span class="linenos">35</span></a>        <span class="p">)</span>
</span><span id="PythonCallableStage.__init__-36"><a href="#PythonCallableStage.__init__-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_processor</span><span class="p">(</span><span class="n">process_record</span><span class="p">,</span> <span class="n">process_batch</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#PythonCallableStage">PythonCallableStage</a></code>. One of <code>process_record</code> or <code>process_batch</code> must be provided.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>process_record (Callable[[Record], Record], optional):</strong>  Function for processing a record. Defaults to None.</li>
<li><strong>process_batch (Callable[[Batch], Batch], optional):</strong>  Function for processing a batch. Defaults to None.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="PythonCallableStage.unique_name" class="variable">unique_name</dd>
                <dd id="PythonCallableStage.pipeline" class="variable">pipeline</dd>
                <dd id="PythonCallableStage.add_downstream" class="function">add_downstream</dd>
                <dd id="PythonCallableStage.add_upstream" class="function">add_upstream</dd>
                <dd id="PythonCallableStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="PythonCallableStage.channels" class="variable">channels</dd>
                <dd id="PythonCallableStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="PythonCallableStage.log" class="variable">log</dd>
                <dd id="PythonCallableStage.reset_level" class="function">reset_level</dd>
                <dd id="PythonCallableStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="RedisLookupStage">
                            <input id="RedisLookupStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RedisLookupStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="RedisLookupStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RedisLookupStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RedisLookupStage-9"><a href="#RedisLookupStage-9"><span class="linenos">  9</span></a><span class="k">class</span> <span class="nc">RedisLookupStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="RedisLookupStage-10"><a href="#RedisLookupStage-10"><span class="linenos"> 10</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform a Redis lookup on a record.</span>
</span><span id="RedisLookupStage-11"><a href="#RedisLookupStage-11"><span class="linenos"> 11</span></a>
</span><span id="RedisLookupStage-12"><a href="#RedisLookupStage-12"><span class="linenos"> 12</span></a><span class="sd">    Attributes:</span>
</span><span id="RedisLookupStage-13"><a href="#RedisLookupStage-13"><span class="linenos"> 13</span></a><span class="sd">        key: The key to use for the lookup.</span>
</span><span id="RedisLookupStage-14"><a href="#RedisLookupStage-14"><span class="linenos"> 14</span></a><span class="sd">        redis_client: The Redis client to use for the lookup.</span>
</span><span id="RedisLookupStage-15"><a href="#RedisLookupStage-15"><span class="linenos"> 15</span></a><span class="sd">        on_zero_keys: What to do if the key is not found in Redis. Options are &quot;raise&quot;, &quot;ignore&quot;, and &quot;preserve&quot;.</span>
</span><span id="RedisLookupStage-16"><a href="#RedisLookupStage-16"><span class="linenos"> 16</span></a><span class="sd">        prefix: A prefix to add to the key before performing the lookup.</span>
</span><span id="RedisLookupStage-17"><a href="#RedisLookupStage-17"><span class="linenos"> 17</span></a><span class="sd">        suffix: A suffix to add to the key before performing the lookup.</span>
</span><span id="RedisLookupStage-18"><a href="#RedisLookupStage-18"><span class="linenos"> 18</span></a><span class="sd">        name: The name of the stage.</span>
</span><span id="RedisLookupStage-19"><a href="#RedisLookupStage-19"><span class="linenos"> 19</span></a><span class="sd">        processes: The number of processes to use for the stage.</span>
</span><span id="RedisLookupStage-20"><a href="#RedisLookupStage-20"><span class="linenos"> 20</span></a><span class="sd">        error_handling_method: The error handling method to use for the stage.</span>
</span><span id="RedisLookupStage-21"><a href="#RedisLookupStage-21"><span class="linenos"> 21</span></a><span class="sd">        expose_metrics: Whether or not to expose metrics for this stage.</span>
</span><span id="RedisLookupStage-22"><a href="#RedisLookupStage-22"><span class="linenos"> 22</span></a>
</span><span id="RedisLookupStage-23"><a href="#RedisLookupStage-23"><span class="linenos"> 23</span></a><span class="sd">    Methods:</span>
</span><span id="RedisLookupStage-24"><a href="#RedisLookupStage-24"><span class="linenos"> 24</span></a><span class="sd">        process_record: Perform the Redis lookup and update the record data with the result.</span>
</span><span id="RedisLookupStage-25"><a href="#RedisLookupStage-25"><span class="linenos"> 25</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RedisLookupStage-26"><a href="#RedisLookupStage-26"><span class="linenos"> 26</span></a>
</span><span id="RedisLookupStage-27"><a href="#RedisLookupStage-27"><span class="linenos"> 27</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="RedisLookupStage-28"><a href="#RedisLookupStage-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RedisLookupStage-29"><a href="#RedisLookupStage-29"><span class="linenos"> 29</span></a>        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="RedisLookupStage-30"><a href="#RedisLookupStage-30"><span class="linenos"> 30</span></a>        <span class="n">redis_client</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">redis</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Redis</span><span class="p">,</span> <span class="n">redis</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">RedisCluster</span><span class="p">],</span>
</span><span id="RedisLookupStage-31"><a href="#RedisLookupStage-31"><span class="linenos"> 31</span></a>        <span class="n">on_zero_keys</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="s2">&quot;preserve&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="RedisLookupStage-32"><a href="#RedisLookupStage-32"><span class="linenos"> 32</span></a>        <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="RedisLookupStage-33"><a href="#RedisLookupStage-33"><span class="linenos"> 33</span></a>        <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="RedisLookupStage-34"><a href="#RedisLookupStage-34"><span class="linenos"> 34</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RedisLookupStage-35"><a href="#RedisLookupStage-35"><span class="linenos"> 35</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="RedisLookupStage-36"><a href="#RedisLookupStage-36"><span class="linenos"> 36</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="RedisLookupStage-37"><a href="#RedisLookupStage-37"><span class="linenos"> 37</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="RedisLookupStage-38"><a href="#RedisLookupStage-38"><span class="linenos"> 38</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RedisLookupStage-39"><a href="#RedisLookupStage-39"><span class="linenos"> 39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the RedisLookupStage.</span>
</span><span id="RedisLookupStage-40"><a href="#RedisLookupStage-40"><span class="linenos"> 40</span></a>
</span><span id="RedisLookupStage-41"><a href="#RedisLookupStage-41"><span class="linenos"> 41</span></a><span class="sd">        Args:</span>
</span><span id="RedisLookupStage-42"><a href="#RedisLookupStage-42"><span class="linenos"> 42</span></a><span class="sd">            key (str): The key to use for the lookup.</span>
</span><span id="RedisLookupStage-43"><a href="#RedisLookupStage-43"><span class="linenos"> 43</span></a><span class="sd">            redis_client (Union[redis.client.Redis, redis.cluster.RedisCluster]): The Redis client to use for the lookup.</span>
</span><span id="RedisLookupStage-44"><a href="#RedisLookupStage-44"><span class="linenos"> 44</span></a><span class="sd">            on_zero_keys (Literal[&quot;raise&quot;, &quot;ignore&quot;, &quot;preserve&quot;], optional): What to do if the key is not found in Redis.</span>
</span><span id="RedisLookupStage-45"><a href="#RedisLookupStage-45"><span class="linenos"> 45</span></a><span class="sd">            prefix (str, optional): A prefix to add to the key before performing the lookup.</span>
</span><span id="RedisLookupStage-46"><a href="#RedisLookupStage-46"><span class="linenos"> 46</span></a><span class="sd">            suffix (str, optional): A suffix to add to the key before performing the lookup.</span>
</span><span id="RedisLookupStage-47"><a href="#RedisLookupStage-47"><span class="linenos"> 47</span></a><span class="sd">            name (str, optional): The name of the stage.</span>
</span><span id="RedisLookupStage-48"><a href="#RedisLookupStage-48"><span class="linenos"> 48</span></a><span class="sd">            processes (int, optional): The number of processes to use for the stage.</span>
</span><span id="RedisLookupStage-49"><a href="#RedisLookupStage-49"><span class="linenos"> 49</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): The error handling method to use for the stage.</span>
</span><span id="RedisLookupStage-50"><a href="#RedisLookupStage-50"><span class="linenos"> 50</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="RedisLookupStage-51"><a href="#RedisLookupStage-51"><span class="linenos"> 51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RedisLookupStage-52"><a href="#RedisLookupStage-52"><span class="linenos"> 52</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="RedisLookupStage-53"><a href="#RedisLookupStage-53"><span class="linenos"> 53</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="RedisLookupStage-54"><a href="#RedisLookupStage-54"><span class="linenos"> 54</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="RedisLookupStage-55"><a href="#RedisLookupStage-55"><span class="linenos"> 55</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="RedisLookupStage-56"><a href="#RedisLookupStage-56"><span class="linenos"> 56</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="RedisLookupStage-57"><a href="#RedisLookupStage-57"><span class="linenos"> 57</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="RedisLookupStage-58"><a href="#RedisLookupStage-58"><span class="linenos"> 58</span></a>        <span class="p">)</span>
</span><span id="RedisLookupStage-59"><a href="#RedisLookupStage-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
</span><span id="RedisLookupStage-60"><a href="#RedisLookupStage-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis_client</span>
</span><span id="RedisLookupStage-61"><a href="#RedisLookupStage-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_keys</span> <span class="o">=</span> <span class="n">on_zero_keys</span>
</span><span id="RedisLookupStage-62"><a href="#RedisLookupStage-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
</span><span id="RedisLookupStage-63"><a href="#RedisLookupStage-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span>
</span><span id="RedisLookupStage-64"><a href="#RedisLookupStage-64"><span class="linenos"> 64</span></a>
</span><span id="RedisLookupStage-65"><a href="#RedisLookupStage-65"><span class="linenos"> 65</span></a>    <span class="k">def</span> <span class="nf">_validate_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_data</span><span class="p">:</span> <span class="n">RecordData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RedisLookupStage-66"><a href="#RedisLookupStage-66"><span class="linenos"> 66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that the key exists in the record data.&quot;&quot;&quot;</span>
</span><span id="RedisLookupStage-67"><a href="#RedisLookupStage-67"><span class="linenos"> 67</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
</span><span id="RedisLookupStage-68"><a href="#RedisLookupStage-68"><span class="linenos"> 68</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Key must be provided for RedisLookupStage.&quot;</span><span class="p">)</span>
</span><span id="RedisLookupStage-69"><a href="#RedisLookupStage-69"><span class="linenos"> 69</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">record_data</span><span class="p">:</span>
</span><span id="RedisLookupStage-70"><a href="#RedisLookupStage-70"><span class="linenos"> 70</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> not found in record data.&quot;</span><span class="p">)</span>
</span><span id="RedisLookupStage-71"><a href="#RedisLookupStage-71"><span class="linenos"> 71</span></a>
</span><span id="RedisLookupStage-72"><a href="#RedisLookupStage-72"><span class="linenos"> 72</span></a>    <span class="k">def</span> <span class="nf">_create_redis_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_data</span><span class="p">:</span> <span class="n">RecordData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="RedisLookupStage-73"><a href="#RedisLookupStage-73"><span class="linenos"> 73</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the Redis key to use for lookup from the value of the key in the record data.&quot;&quot;&quot;</span>
</span><span id="RedisLookupStage-74"><a href="#RedisLookupStage-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_key</span><span class="p">(</span><span class="n">record_data</span><span class="p">)</span>
</span><span id="RedisLookupStage-75"><a href="#RedisLookupStage-75"><span class="linenos"> 75</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}{</span><span class="n">record_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RedisLookupStage-76"><a href="#RedisLookupStage-76"><span class="linenos"> 76</span></a>
</span><span id="RedisLookupStage-77"><a href="#RedisLookupStage-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="nf">_process_lookup_result</span><span class="p">(</span>
</span><span id="RedisLookupStage-78"><a href="#RedisLookupStage-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">redis_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_data</span><span class="p">:</span> <span class="n">RecordData</span>
</span><span id="RedisLookupStage-79"><a href="#RedisLookupStage-79"><span class="linenos"> 79</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RedisLookupStage-80"><a href="#RedisLookupStage-80"><span class="linenos"> 80</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the result of the redis lookup and decode it.&quot;&quot;&quot;</span>
</span><span id="RedisLookupStage-81"><a href="#RedisLookupStage-81"><span class="linenos"> 81</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="RedisLookupStage-82"><a href="#RedisLookupStage-82"><span class="linenos"> 82</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_keys</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
</span><span id="RedisLookupStage-83"><a href="#RedisLookupStage-83"><span class="linenos"> 83</span></a>                <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">redis_key</span><span class="si">}</span><span class="s2"> not found in Redis.&quot;</span><span class="p">)</span>
</span><span id="RedisLookupStage-84"><a href="#RedisLookupStage-84"><span class="linenos"> 84</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_keys</span> <span class="o">==</span> <span class="s2">&quot;ignore&quot;</span><span class="p">:</span>
</span><span id="RedisLookupStage-85"><a href="#RedisLookupStage-85"><span class="linenos"> 85</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="RedisLookupStage-86"><a href="#RedisLookupStage-86"><span class="linenos"> 86</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_keys</span> <span class="o">==</span> <span class="s2">&quot;preserve&quot;</span><span class="p">:</span>
</span><span id="RedisLookupStage-87"><a href="#RedisLookupStage-87"><span class="linenos"> 87</span></a>                <span class="k">return</span> <span class="n">record_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span id="RedisLookupStage-88"><a href="#RedisLookupStage-88"><span class="linenos"> 88</span></a>
</span><span id="RedisLookupStage-89"><a href="#RedisLookupStage-89"><span class="linenos"> 89</span></a>        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="RedisLookupStage-90"><a href="#RedisLookupStage-90"><span class="linenos"> 90</span></a>
</span><span id="RedisLookupStage-91"><a href="#RedisLookupStage-91"><span class="linenos"> 91</span></a>    <span class="k">def</span> <span class="nf">_do_lookup</span><span class="p">(</span>
</span><span id="RedisLookupStage-92"><a href="#RedisLookupStage-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RedisLookupStage-93"><a href="#RedisLookupStage-93"><span class="linenos"> 93</span></a>        <span class="n">connection</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">redis</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Redis</span><span class="p">,</span> <span class="n">redis</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">RedisCluster</span><span class="p">],</span>
</span><span id="RedisLookupStage-94"><a href="#RedisLookupStage-94"><span class="linenos"> 94</span></a>        <span class="n">redis_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="RedisLookupStage-95"><a href="#RedisLookupStage-95"><span class="linenos"> 95</span></a>        <span class="n">record_data</span><span class="p">:</span> <span class="n">RecordData</span><span class="p">,</span>
</span><span id="RedisLookupStage-96"><a href="#RedisLookupStage-96"><span class="linenos"> 96</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RedisLookupStage-97"><a href="#RedisLookupStage-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the redis lookup.&quot;&quot;&quot;</span>
</span><span id="RedisLookupStage-98"><a href="#RedisLookupStage-98"><span class="linenos"> 98</span></a>        <span class="n">lookup</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">redis_key</span><span class="p">)</span>
</span><span id="RedisLookupStage-99"><a href="#RedisLookupStage-99"><span class="linenos"> 99</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_lookup_result</span><span class="p">(</span><span class="n">lookup</span><span class="p">,</span> <span class="n">redis_key</span><span class="p">,</span> <span class="n">record_data</span><span class="p">)</span>
</span><span id="RedisLookupStage-100"><a href="#RedisLookupStage-100"><span class="linenos">100</span></a>
</span><span id="RedisLookupStage-101"><a href="#RedisLookupStage-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="RedisLookupStage-102"><a href="#RedisLookupStage-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the redis lookup and update the record data with the result.&quot;&quot;&quot;</span>
</span><span id="RedisLookupStage-103"><a href="#RedisLookupStage-103"><span class="linenos">103</span></a>        <span class="n">redis_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_redis_key</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="RedisLookupStage-104"><a href="#RedisLookupStage-104"><span class="linenos">104</span></a>        <span class="n">redis_lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="p">,</span> <span class="n">redis_key</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="RedisLookupStage-105"><a href="#RedisLookupStage-105"><span class="linenos">105</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">redis_lookup</span><span class="p">})</span>
</span><span id="RedisLookupStage-106"><a href="#RedisLookupStage-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Perform a Redis lookup on a record.</p>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>key:</strong>  The key to use for the lookup.</li>
<li><strong>redis_client:</strong>  The Redis client to use for the lookup.</li>
<li><strong>on_zero_keys:</strong>  What to do if the key is not found in Redis. Options are "raise", "ignore", and "preserve".</li>
<li><strong>prefix:</strong>  A prefix to add to the key before performing the lookup.</li>
<li><strong>suffix:</strong>  A suffix to add to the key before performing the lookup.</li>
<li><strong>name:</strong>  The name of the stage.</li>
<li><strong>processes:</strong>  The number of processes to use for the stage.</li>
<li><strong>error_handling_method:</strong>  The error handling method to use for the stage.</li>
<li><strong>expose_metrics:</strong>  Whether or not to expose metrics for this stage.</li>
</ul>

<h6 id="methods">Methods:</h6>

<blockquote>
  <p>process_record: Perform the Redis lookup and update the record data with the result.</p>
</blockquote>
</div>


                            <div id="RedisLookupStage.__init__" class="classattr">
                                        <input id="RedisLookupStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RedisLookupStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">key</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">redis_client</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">redis</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Redis</span><span class="p">,</span> <span class="n">redis</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">RedisCluster</span><span class="p">]</span>,</span><span class="param">	<span class="n">on_zero_keys</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="s1">&#39;preserve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span>,</span><span class="param">	<span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="RedisLookupStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RedisLookupStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RedisLookupStage.__init__-27"><a href="#RedisLookupStage.__init__-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="RedisLookupStage.__init__-28"><a href="#RedisLookupStage.__init__-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-29"><a href="#RedisLookupStage.__init__-29"><span class="linenos">29</span></a>        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-30"><a href="#RedisLookupStage.__init__-30"><span class="linenos">30</span></a>        <span class="n">redis_client</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">redis</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Redis</span><span class="p">,</span> <span class="n">redis</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">RedisCluster</span><span class="p">],</span>
</span><span id="RedisLookupStage.__init__-31"><a href="#RedisLookupStage.__init__-31"><span class="linenos">31</span></a>        <span class="n">on_zero_keys</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="s2">&quot;preserve&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-32"><a href="#RedisLookupStage.__init__-32"><span class="linenos">32</span></a>        <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-33"><a href="#RedisLookupStage.__init__-33"><span class="linenos">33</span></a>        <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-34"><a href="#RedisLookupStage.__init__-34"><span class="linenos">34</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-35"><a href="#RedisLookupStage.__init__-35"><span class="linenos">35</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-36"><a href="#RedisLookupStage.__init__-36"><span class="linenos">36</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-37"><a href="#RedisLookupStage.__init__-37"><span class="linenos">37</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-38"><a href="#RedisLookupStage.__init__-38"><span class="linenos">38</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RedisLookupStage.__init__-39"><a href="#RedisLookupStage.__init__-39"><span class="linenos">39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the RedisLookupStage.</span>
</span><span id="RedisLookupStage.__init__-40"><a href="#RedisLookupStage.__init__-40"><span class="linenos">40</span></a>
</span><span id="RedisLookupStage.__init__-41"><a href="#RedisLookupStage.__init__-41"><span class="linenos">41</span></a><span class="sd">        Args:</span>
</span><span id="RedisLookupStage.__init__-42"><a href="#RedisLookupStage.__init__-42"><span class="linenos">42</span></a><span class="sd">            key (str): The key to use for the lookup.</span>
</span><span id="RedisLookupStage.__init__-43"><a href="#RedisLookupStage.__init__-43"><span class="linenos">43</span></a><span class="sd">            redis_client (Union[redis.client.Redis, redis.cluster.RedisCluster]): The Redis client to use for the lookup.</span>
</span><span id="RedisLookupStage.__init__-44"><a href="#RedisLookupStage.__init__-44"><span class="linenos">44</span></a><span class="sd">            on_zero_keys (Literal[&quot;raise&quot;, &quot;ignore&quot;, &quot;preserve&quot;], optional): What to do if the key is not found in Redis.</span>
</span><span id="RedisLookupStage.__init__-45"><a href="#RedisLookupStage.__init__-45"><span class="linenos">45</span></a><span class="sd">            prefix (str, optional): A prefix to add to the key before performing the lookup.</span>
</span><span id="RedisLookupStage.__init__-46"><a href="#RedisLookupStage.__init__-46"><span class="linenos">46</span></a><span class="sd">            suffix (str, optional): A suffix to add to the key before performing the lookup.</span>
</span><span id="RedisLookupStage.__init__-47"><a href="#RedisLookupStage.__init__-47"><span class="linenos">47</span></a><span class="sd">            name (str, optional): The name of the stage.</span>
</span><span id="RedisLookupStage.__init__-48"><a href="#RedisLookupStage.__init__-48"><span class="linenos">48</span></a><span class="sd">            processes (int, optional): The number of processes to use for the stage.</span>
</span><span id="RedisLookupStage.__init__-49"><a href="#RedisLookupStage.__init__-49"><span class="linenos">49</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): The error handling method to use for the stage.</span>
</span><span id="RedisLookupStage.__init__-50"><a href="#RedisLookupStage.__init__-50"><span class="linenos">50</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="RedisLookupStage.__init__-51"><a href="#RedisLookupStage.__init__-51"><span class="linenos">51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RedisLookupStage.__init__-52"><a href="#RedisLookupStage.__init__-52"><span class="linenos">52</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="RedisLookupStage.__init__-53"><a href="#RedisLookupStage.__init__-53"><span class="linenos">53</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-54"><a href="#RedisLookupStage.__init__-54"><span class="linenos">54</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-55"><a href="#RedisLookupStage.__init__-55"><span class="linenos">55</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-56"><a href="#RedisLookupStage.__init__-56"><span class="linenos">56</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-57"><a href="#RedisLookupStage.__init__-57"><span class="linenos">57</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="RedisLookupStage.__init__-58"><a href="#RedisLookupStage.__init__-58"><span class="linenos">58</span></a>        <span class="p">)</span>
</span><span id="RedisLookupStage.__init__-59"><a href="#RedisLookupStage.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
</span><span id="RedisLookupStage.__init__-60"><a href="#RedisLookupStage.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis_client</span>
</span><span id="RedisLookupStage.__init__-61"><a href="#RedisLookupStage.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_zero_keys</span> <span class="o">=</span> <span class="n">on_zero_keys</span>
</span><span id="RedisLookupStage.__init__-62"><a href="#RedisLookupStage.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
</span><span id="RedisLookupStage.__init__-63"><a href="#RedisLookupStage.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the RedisLookupStage.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>key (str):</strong>  The key to use for the lookup.</li>
<li><strong>redis_client (Union[redis.client.Redis, redis.cluster.RedisCluster]):</strong>  The Redis client to use for the lookup.</li>
<li><strong>on_zero_keys (Literal["raise", "ignore", "preserve"], optional):</strong>  What to do if the key is not found in Redis.</li>
<li><strong>prefix (str, optional):</strong>  A prefix to add to the key before performing the lookup.</li>
<li><strong>suffix (str, optional):</strong>  A suffix to add to the key before performing the lookup.</li>
<li><strong>name (str, optional):</strong>  The name of the stage.</li>
<li><strong>processes (int, optional):</strong>  The number of processes to use for the stage.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  The error handling method to use for the stage.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="RedisLookupStage.process_record" class="classattr">
                                        <input id="RedisLookupStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="RedisLookupStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RedisLookupStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RedisLookupStage.process_record-101"><a href="#RedisLookupStage.process_record-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="RedisLookupStage.process_record-102"><a href="#RedisLookupStage.process_record-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the redis lookup and update the record data with the result.&quot;&quot;&quot;</span>
</span><span id="RedisLookupStage.process_record-103"><a href="#RedisLookupStage.process_record-103"><span class="linenos">103</span></a>        <span class="n">redis_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_redis_key</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="RedisLookupStage.process_record-104"><a href="#RedisLookupStage.process_record-104"><span class="linenos">104</span></a>        <span class="n">redis_lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_client</span><span class="p">,</span> <span class="n">redis_key</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="RedisLookupStage.process_record-105"><a href="#RedisLookupStage.process_record-105"><span class="linenos">105</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">redis_lookup</span><span class="p">})</span>
</span><span id="RedisLookupStage.process_record-106"><a href="#RedisLookupStage.process_record-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Perform the redis lookup and update the record data with the result.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="RedisLookupStage.unique_name" class="variable">unique_name</dd>
                <dd id="RedisLookupStage.pipeline" class="variable">pipeline</dd>
                <dd id="RedisLookupStage.add_downstream" class="function">add_downstream</dd>
                <dd id="RedisLookupStage.add_upstream" class="function">add_upstream</dd>
                <dd id="RedisLookupStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="RedisLookupStage.channels" class="variable">channels</dd>
                <dd id="RedisLookupStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="RedisLookupStage.log" class="variable">log</dd>
                <dd id="RedisLookupStage.reset_level" class="function">reset_level</dd>
                <dd id="RedisLookupStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="RenameFieldsStage">
                            <input id="RenameFieldsStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RenameFieldsStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="RenameFieldsStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RenameFieldsStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RenameFieldsStage-5"><a href="#RenameFieldsStage-5"><span class="linenos"> 5</span></a><span class="k">class</span> <span class="nc">RenameFieldsStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="RenameFieldsStage-6"><a href="#RenameFieldsStage-6"><span class="linenos"> 6</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Renames fields in each record in batch.&quot;&quot;&quot;</span>
</span><span id="RenameFieldsStage-7"><a href="#RenameFieldsStage-7"><span class="linenos"> 7</span></a>
</span><span id="RenameFieldsStage-8"><a href="#RenameFieldsStage-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="RenameFieldsStage-9"><a href="#RenameFieldsStage-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RenameFieldsStage-10"><a href="#RenameFieldsStage-10"><span class="linenos">10</span></a>        <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="RenameFieldsStage-11"><a href="#RenameFieldsStage-11"><span class="linenos">11</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RenameFieldsStage-12"><a href="#RenameFieldsStage-12"><span class="linenos">12</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="RenameFieldsStage-13"><a href="#RenameFieldsStage-13"><span class="linenos">13</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="RenameFieldsStage-14"><a href="#RenameFieldsStage-14"><span class="linenos">14</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="RenameFieldsStage-15"><a href="#RenameFieldsStage-15"><span class="linenos">15</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RenameFieldsStage-16"><a href="#RenameFieldsStage-16"><span class="linenos">16</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `RenameFieldsStage`.</span>
</span><span id="RenameFieldsStage-17"><a href="#RenameFieldsStage-17"><span class="linenos">17</span></a>
</span><span id="RenameFieldsStage-18"><a href="#RenameFieldsStage-18"><span class="linenos">18</span></a><span class="sd">        Args:</span>
</span><span id="RenameFieldsStage-19"><a href="#RenameFieldsStage-19"><span class="linenos">19</span></a><span class="sd">            mapping (dict[str, str]): Mapping from old field names to new field names.</span>
</span><span id="RenameFieldsStage-20"><a href="#RenameFieldsStage-20"><span class="linenos">20</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="RenameFieldsStage-21"><a href="#RenameFieldsStage-21"><span class="linenos">21</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="RenameFieldsStage-22"><a href="#RenameFieldsStage-22"><span class="linenos">22</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="RenameFieldsStage-23"><a href="#RenameFieldsStage-23"><span class="linenos">23</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="RenameFieldsStage-24"><a href="#RenameFieldsStage-24"><span class="linenos">24</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RenameFieldsStage-25"><a href="#RenameFieldsStage-25"><span class="linenos">25</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="RenameFieldsStage-26"><a href="#RenameFieldsStage-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="RenameFieldsStage-27"><a href="#RenameFieldsStage-27"><span class="linenos">27</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="RenameFieldsStage-28"><a href="#RenameFieldsStage-28"><span class="linenos">28</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="RenameFieldsStage-29"><a href="#RenameFieldsStage-29"><span class="linenos">29</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="RenameFieldsStage-30"><a href="#RenameFieldsStage-30"><span class="linenos">30</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="RenameFieldsStage-31"><a href="#RenameFieldsStage-31"><span class="linenos">31</span></a>        <span class="p">)</span>
</span><span id="RenameFieldsStage-32"><a href="#RenameFieldsStage-32"><span class="linenos">32</span></a>
</span><span id="RenameFieldsStage-33"><a href="#RenameFieldsStage-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span>
</span><span id="RenameFieldsStage-34"><a href="#RenameFieldsStage-34"><span class="linenos">34</span></a>
</span><span id="RenameFieldsStage-35"><a href="#RenameFieldsStage-35"><span class="linenos">35</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="RenameFieldsStage-36"><a href="#RenameFieldsStage-36"><span class="linenos">36</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="RenameFieldsStage-37"><a href="#RenameFieldsStage-37"><span class="linenos">37</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Renames fields in each record in batch.</p>
</div>


                            <div id="RenameFieldsStage.__init__" class="classattr">
                                        <input id="RenameFieldsStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RenameFieldsStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="RenameFieldsStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RenameFieldsStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RenameFieldsStage.__init__-8"><a href="#RenameFieldsStage.__init__-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="RenameFieldsStage.__init__-9"><a href="#RenameFieldsStage.__init__-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-10"><a href="#RenameFieldsStage.__init__-10"><span class="linenos">10</span></a>        <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="RenameFieldsStage.__init__-11"><a href="#RenameFieldsStage.__init__-11"><span class="linenos">11</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-12"><a href="#RenameFieldsStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-13"><a href="#RenameFieldsStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-14"><a href="#RenameFieldsStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-15"><a href="#RenameFieldsStage.__init__-15"><span class="linenos">15</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RenameFieldsStage.__init__-16"><a href="#RenameFieldsStage.__init__-16"><span class="linenos">16</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `RenameFieldsStage`.</span>
</span><span id="RenameFieldsStage.__init__-17"><a href="#RenameFieldsStage.__init__-17"><span class="linenos">17</span></a>
</span><span id="RenameFieldsStage.__init__-18"><a href="#RenameFieldsStage.__init__-18"><span class="linenos">18</span></a><span class="sd">        Args:</span>
</span><span id="RenameFieldsStage.__init__-19"><a href="#RenameFieldsStage.__init__-19"><span class="linenos">19</span></a><span class="sd">            mapping (dict[str, str]): Mapping from old field names to new field names.</span>
</span><span id="RenameFieldsStage.__init__-20"><a href="#RenameFieldsStage.__init__-20"><span class="linenos">20</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="RenameFieldsStage.__init__-21"><a href="#RenameFieldsStage.__init__-21"><span class="linenos">21</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="RenameFieldsStage.__init__-22"><a href="#RenameFieldsStage.__init__-22"><span class="linenos">22</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="RenameFieldsStage.__init__-23"><a href="#RenameFieldsStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="RenameFieldsStage.__init__-24"><a href="#RenameFieldsStage.__init__-24"><span class="linenos">24</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RenameFieldsStage.__init__-25"><a href="#RenameFieldsStage.__init__-25"><span class="linenos">25</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="RenameFieldsStage.__init__-26"><a href="#RenameFieldsStage.__init__-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-27"><a href="#RenameFieldsStage.__init__-27"><span class="linenos">27</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-28"><a href="#RenameFieldsStage.__init__-28"><span class="linenos">28</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-29"><a href="#RenameFieldsStage.__init__-29"><span class="linenos">29</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-30"><a href="#RenameFieldsStage.__init__-30"><span class="linenos">30</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="RenameFieldsStage.__init__-31"><a href="#RenameFieldsStage.__init__-31"><span class="linenos">31</span></a>        <span class="p">)</span>
</span><span id="RenameFieldsStage.__init__-32"><a href="#RenameFieldsStage.__init__-32"><span class="linenos">32</span></a>
</span><span id="RenameFieldsStage.__init__-33"><a href="#RenameFieldsStage.__init__-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#RenameFieldsStage">RenameFieldsStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>mapping (dict[str, str]):</strong>  Mapping from old field names to new field names.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="RenameFieldsStage.process_record" class="classattr">
                                        <input id="RenameFieldsStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="RenameFieldsStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RenameFieldsStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RenameFieldsStage.process_record-35"><a href="#RenameFieldsStage.process_record-35"><span class="linenos">35</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="RenameFieldsStage.process_record-36"><a href="#RenameFieldsStage.process_record-36"><span class="linenos">36</span></a>        <span class="n">record</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="RenameFieldsStage.process_record-37"><a href="#RenameFieldsStage.process_record-37"><span class="linenos">37</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="RenameFieldsStage.unique_name" class="variable">unique_name</dd>
                <dd id="RenameFieldsStage.pipeline" class="variable">pipeline</dd>
                <dd id="RenameFieldsStage.add_downstream" class="function">add_downstream</dd>
                <dd id="RenameFieldsStage.add_upstream" class="function">add_upstream</dd>
                <dd id="RenameFieldsStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="RenameFieldsStage.channels" class="variable">channels</dd>
                <dd id="RenameFieldsStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="RenameFieldsStage.log" class="variable">log</dd>
                <dd id="RenameFieldsStage.reset_level" class="function">reset_level</dd>
                <dd id="RenameFieldsStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SetToCurrentTimestampStage">
                            <input id="SetToCurrentTimestampStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SetToCurrentTimestampStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="SetToCurrentTimestampStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SetToCurrentTimestampStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SetToCurrentTimestampStage-8"><a href="#SetToCurrentTimestampStage-8"><span class="linenos"> 8</span></a><span class="k">class</span> <span class="nc">SetToCurrentTimestampStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="SetToCurrentTimestampStage-9"><a href="#SetToCurrentTimestampStage-9"><span class="linenos"> 9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set fields to the current timestamp.&quot;&quot;&quot;</span>
</span><span id="SetToCurrentTimestampStage-10"><a href="#SetToCurrentTimestampStage-10"><span class="linenos">10</span></a>
</span><span id="SetToCurrentTimestampStage-11"><a href="#SetToCurrentTimestampStage-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SetToCurrentTimestampStage-12"><a href="#SetToCurrentTimestampStage-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-13"><a href="#SetToCurrentTimestampStage-13"><span class="linenos">13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SetToCurrentTimestampStage-14"><a href="#SetToCurrentTimestampStage-14"><span class="linenos">14</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-15"><a href="#SetToCurrentTimestampStage-15"><span class="linenos">15</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-16"><a href="#SetToCurrentTimestampStage-16"><span class="linenos">16</span></a>        <span class="n">error_handling_method</span><span class="o">=</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-17"><a href="#SetToCurrentTimestampStage-17"><span class="linenos">17</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-18"><a href="#SetToCurrentTimestampStage-18"><span class="linenos">18</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SetToCurrentTimestampStage-19"><a href="#SetToCurrentTimestampStage-19"><span class="linenos">19</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `SetToCurrentTimestampStage`.</span>
</span><span id="SetToCurrentTimestampStage-20"><a href="#SetToCurrentTimestampStage-20"><span class="linenos">20</span></a>
</span><span id="SetToCurrentTimestampStage-21"><a href="#SetToCurrentTimestampStage-21"><span class="linenos">21</span></a><span class="sd">        Args:</span>
</span><span id="SetToCurrentTimestampStage-22"><a href="#SetToCurrentTimestampStage-22"><span class="linenos">22</span></a><span class="sd">            fields (list[str]): The fields to set to the current timestamp.</span>
</span><span id="SetToCurrentTimestampStage-23"><a href="#SetToCurrentTimestampStage-23"><span class="linenos">23</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SetToCurrentTimestampStage-24"><a href="#SetToCurrentTimestampStage-24"><span class="linenos">24</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="SetToCurrentTimestampStage-25"><a href="#SetToCurrentTimestampStage-25"><span class="linenos">25</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SetToCurrentTimestampStage-26"><a href="#SetToCurrentTimestampStage-26"><span class="linenos">26</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="SetToCurrentTimestampStage-27"><a href="#SetToCurrentTimestampStage-27"><span class="linenos">27</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SetToCurrentTimestampStage-28"><a href="#SetToCurrentTimestampStage-28"><span class="linenos">28</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SetToCurrentTimestampStage-29"><a href="#SetToCurrentTimestampStage-29"><span class="linenos">29</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-30"><a href="#SetToCurrentTimestampStage-30"><span class="linenos">30</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-31"><a href="#SetToCurrentTimestampStage-31"><span class="linenos">31</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-32"><a href="#SetToCurrentTimestampStage-32"><span class="linenos">32</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-33"><a href="#SetToCurrentTimestampStage-33"><span class="linenos">33</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage-34"><a href="#SetToCurrentTimestampStage-34"><span class="linenos">34</span></a>        <span class="p">)</span>
</span><span id="SetToCurrentTimestampStage-35"><a href="#SetToCurrentTimestampStage-35"><span class="linenos">35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="SetToCurrentTimestampStage-36"><a href="#SetToCurrentTimestampStage-36"><span class="linenos">36</span></a>
</span><span id="SetToCurrentTimestampStage-37"><a href="#SetToCurrentTimestampStage-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="SetToCurrentTimestampStage-38"><a href="#SetToCurrentTimestampStage-38"><span class="linenos">38</span></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="SetToCurrentTimestampStage-39"><a href="#SetToCurrentTimestampStage-39"><span class="linenos">39</span></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
</span><span id="SetToCurrentTimestampStage-40"><a href="#SetToCurrentTimestampStage-40"><span class="linenos">40</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
</span><span id="SetToCurrentTimestampStage-41"><a href="#SetToCurrentTimestampStage-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Set fields to the current timestamp.</p>
</div>


                            <div id="SetToCurrentTimestampStage.__init__" class="classattr">
                                        <input id="SetToCurrentTimestampStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SetToCurrentTimestampStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="o">=&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="SetToCurrentTimestampStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SetToCurrentTimestampStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SetToCurrentTimestampStage.__init__-11"><a href="#SetToCurrentTimestampStage.__init__-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SetToCurrentTimestampStage.__init__-12"><a href="#SetToCurrentTimestampStage.__init__-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-13"><a href="#SetToCurrentTimestampStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SetToCurrentTimestampStage.__init__-14"><a href="#SetToCurrentTimestampStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-15"><a href="#SetToCurrentTimestampStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-16"><a href="#SetToCurrentTimestampStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">error_handling_method</span><span class="o">=</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-17"><a href="#SetToCurrentTimestampStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-18"><a href="#SetToCurrentTimestampStage.__init__-18"><span class="linenos">18</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SetToCurrentTimestampStage.__init__-19"><a href="#SetToCurrentTimestampStage.__init__-19"><span class="linenos">19</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `SetToCurrentTimestampStage`.</span>
</span><span id="SetToCurrentTimestampStage.__init__-20"><a href="#SetToCurrentTimestampStage.__init__-20"><span class="linenos">20</span></a>
</span><span id="SetToCurrentTimestampStage.__init__-21"><a href="#SetToCurrentTimestampStage.__init__-21"><span class="linenos">21</span></a><span class="sd">        Args:</span>
</span><span id="SetToCurrentTimestampStage.__init__-22"><a href="#SetToCurrentTimestampStage.__init__-22"><span class="linenos">22</span></a><span class="sd">            fields (list[str]): The fields to set to the current timestamp.</span>
</span><span id="SetToCurrentTimestampStage.__init__-23"><a href="#SetToCurrentTimestampStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SetToCurrentTimestampStage.__init__-24"><a href="#SetToCurrentTimestampStage.__init__-24"><span class="linenos">24</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="SetToCurrentTimestampStage.__init__-25"><a href="#SetToCurrentTimestampStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SetToCurrentTimestampStage.__init__-26"><a href="#SetToCurrentTimestampStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="SetToCurrentTimestampStage.__init__-27"><a href="#SetToCurrentTimestampStage.__init__-27"><span class="linenos">27</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SetToCurrentTimestampStage.__init__-28"><a href="#SetToCurrentTimestampStage.__init__-28"><span class="linenos">28</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SetToCurrentTimestampStage.__init__-29"><a href="#SetToCurrentTimestampStage.__init__-29"><span class="linenos">29</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-30"><a href="#SetToCurrentTimestampStage.__init__-30"><span class="linenos">30</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-31"><a href="#SetToCurrentTimestampStage.__init__-31"><span class="linenos">31</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-32"><a href="#SetToCurrentTimestampStage.__init__-32"><span class="linenos">32</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-33"><a href="#SetToCurrentTimestampStage.__init__-33"><span class="linenos">33</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="SetToCurrentTimestampStage.__init__-34"><a href="#SetToCurrentTimestampStage.__init__-34"><span class="linenos">34</span></a>        <span class="p">)</span>
</span><span id="SetToCurrentTimestampStage.__init__-35"><a href="#SetToCurrentTimestampStage.__init__-35"><span class="linenos">35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#SetToCurrentTimestampStage">SetToCurrentTimestampStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (list[str]):</strong>  The fields to set to the current timestamp.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="SetToCurrentTimestampStage.process_record" class="classattr">
                                        <input id="SetToCurrentTimestampStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="SetToCurrentTimestampStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SetToCurrentTimestampStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SetToCurrentTimestampStage.process_record-37"><a href="#SetToCurrentTimestampStage.process_record-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="SetToCurrentTimestampStage.process_record-38"><a href="#SetToCurrentTimestampStage.process_record-38"><span class="linenos">38</span></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="SetToCurrentTimestampStage.process_record-39"><a href="#SetToCurrentTimestampStage.process_record-39"><span class="linenos">39</span></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
</span><span id="SetToCurrentTimestampStage.process_record-40"><a href="#SetToCurrentTimestampStage.process_record-40"><span class="linenos">40</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
</span><span id="SetToCurrentTimestampStage.process_record-41"><a href="#SetToCurrentTimestampStage.process_record-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="SetToCurrentTimestampStage.unique_name" class="variable">unique_name</dd>
                <dd id="SetToCurrentTimestampStage.pipeline" class="variable">pipeline</dd>
                <dd id="SetToCurrentTimestampStage.add_downstream" class="function">add_downstream</dd>
                <dd id="SetToCurrentTimestampStage.add_upstream" class="function">add_upstream</dd>
                <dd id="SetToCurrentTimestampStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="SetToCurrentTimestampStage.channels" class="variable">channels</dd>
                <dd id="SetToCurrentTimestampStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="SetToCurrentTimestampStage.log" class="variable">log</dd>
                <dd id="SetToCurrentTimestampStage.reset_level" class="function">reset_level</dd>
                <dd id="SetToCurrentTimestampStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SocialMediaUrlCleanerStage">
                            <input id="SocialMediaUrlCleanerStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SocialMediaUrlCleanerStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="SocialMediaUrlCleanerStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SocialMediaUrlCleanerStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SocialMediaUrlCleanerStage-8"><a href="#SocialMediaUrlCleanerStage-8"><span class="linenos">  8</span></a><span class="k">class</span> <span class="nc">SocialMediaUrlCleanerStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="SocialMediaUrlCleanerStage-9"><a href="#SocialMediaUrlCleanerStage-9"><span class="linenos">  9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cleans Social media urls to the desired format&quot;&quot;&quot;</span>
</span><span id="SocialMediaUrlCleanerStage-10"><a href="#SocialMediaUrlCleanerStage-10"><span class="linenos"> 10</span></a>
</span><span id="SocialMediaUrlCleanerStage-11"><a href="#SocialMediaUrlCleanerStage-11"><span class="linenos"> 11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-12"><a href="#SocialMediaUrlCleanerStage-12"><span class="linenos"> 12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-13"><a href="#SocialMediaUrlCleanerStage-13"><span class="linenos"> 13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
</span><span id="SocialMediaUrlCleanerStage-14"><a href="#SocialMediaUrlCleanerStage-14"><span class="linenos"> 14</span></a>            <span class="nb">str</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-15"><a href="#SocialMediaUrlCleanerStage-15"><span class="linenos"> 15</span></a>            <span class="n">Literal</span><span class="p">[</span>
</span><span id="SocialMediaUrlCleanerStage-16"><a href="#SocialMediaUrlCleanerStage-16"><span class="linenos"> 16</span></a>                <span class="s2">&quot;angel&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-17"><a href="#SocialMediaUrlCleanerStage-17"><span class="linenos"> 17</span></a>                <span class="s2">&quot;facebook&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-18"><a href="#SocialMediaUrlCleanerStage-18"><span class="linenos"> 18</span></a>                <span class="s2">&quot;linkedin&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-19"><a href="#SocialMediaUrlCleanerStage-19"><span class="linenos"> 19</span></a>                <span class="s2">&quot;twitter&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-20"><a href="#SocialMediaUrlCleanerStage-20"><span class="linenos"> 20</span></a>                <span class="s2">&quot;pitchbook&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-21"><a href="#SocialMediaUrlCleanerStage-21"><span class="linenos"> 21</span></a>                <span class="s2">&quot;crunchbase&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-22"><a href="#SocialMediaUrlCleanerStage-22"><span class="linenos"> 22</span></a>                <span class="s2">&quot;paperstreet&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-23"><a href="#SocialMediaUrlCleanerStage-23"><span class="linenos"> 23</span></a>            <span class="p">],</span>
</span><span id="SocialMediaUrlCleanerStage-24"><a href="#SocialMediaUrlCleanerStage-24"><span class="linenos"> 24</span></a>        <span class="p">],</span>
</span><span id="SocialMediaUrlCleanerStage-25"><a href="#SocialMediaUrlCleanerStage-25"><span class="linenos"> 25</span></a>        <span class="n">null_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-26"><a href="#SocialMediaUrlCleanerStage-26"><span class="linenos"> 26</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-27"><a href="#SocialMediaUrlCleanerStage-27"><span class="linenos"> 27</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-28"><a href="#SocialMediaUrlCleanerStage-28"><span class="linenos"> 28</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-29"><a href="#SocialMediaUrlCleanerStage-29"><span class="linenos"> 29</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-30"><a href="#SocialMediaUrlCleanerStage-30"><span class="linenos"> 30</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SocialMediaUrlCleanerStage-31"><a href="#SocialMediaUrlCleanerStage-31"><span class="linenos"> 31</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `SocialMediaUrlCleanerStage`.</span>
</span><span id="SocialMediaUrlCleanerStage-32"><a href="#SocialMediaUrlCleanerStage-32"><span class="linenos"> 32</span></a><span class="sd">        Args:</span>
</span><span id="SocialMediaUrlCleanerStage-33"><a href="#SocialMediaUrlCleanerStage-33"><span class="linenos"> 33</span></a><span class="sd">            fields (dict[str,Literal[&quot;angel&quot;, &quot;facebook&quot;, &quot;linkedin&quot;, &quot;twitter&quot;, &quot;pitchbook&quot;, &quot;crunchbase&quot;, &quot;paperstreet&quot;]]): Social Media URL fields to clean and their corresponding cleaning method.</span>
</span><span id="SocialMediaUrlCleanerStage-34"><a href="#SocialMediaUrlCleanerStage-34"><span class="linenos"> 34</span></a><span class="sd">            null_on_error bool: DEFAULTs to False. Raise error</span>
</span><span id="SocialMediaUrlCleanerStage-35"><a href="#SocialMediaUrlCleanerStage-35"><span class="linenos"> 35</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SocialMediaUrlCleanerStage-36"><a href="#SocialMediaUrlCleanerStage-36"><span class="linenos"> 36</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if process_record method is implemented. Defaults to 1.</span>
</span><span id="SocialMediaUrlCleanerStage-37"><a href="#SocialMediaUrlCleanerStage-37"><span class="linenos"> 37</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SocialMediaUrlCleanerStage-38"><a href="#SocialMediaUrlCleanerStage-38"><span class="linenos"> 38</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="SocialMediaUrlCleanerStage-39"><a href="#SocialMediaUrlCleanerStage-39"><span class="linenos"> 39</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SocialMediaUrlCleanerStage-40"><a href="#SocialMediaUrlCleanerStage-40"><span class="linenos"> 40</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-41"><a href="#SocialMediaUrlCleanerStage-41"><span class="linenos"> 41</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-42"><a href="#SocialMediaUrlCleanerStage-42"><span class="linenos"> 42</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-43"><a href="#SocialMediaUrlCleanerStage-43"><span class="linenos"> 43</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-44"><a href="#SocialMediaUrlCleanerStage-44"><span class="linenos"> 44</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-45"><a href="#SocialMediaUrlCleanerStage-45"><span class="linenos"> 45</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-46"><a href="#SocialMediaUrlCleanerStage-46"><span class="linenos"> 46</span></a>        <span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage-47"><a href="#SocialMediaUrlCleanerStage-47"><span class="linenos"> 47</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="SocialMediaUrlCleanerStage-48"><a href="#SocialMediaUrlCleanerStage-48"><span class="linenos"> 48</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-49"><a href="#SocialMediaUrlCleanerStage-49"><span class="linenos"> 49</span></a>                <span class="s2">&quot;Cleaning method values must be in the following list: [&#39;linkedin&#39;,&#39;angel&#39;,&#39;facebook&#39;,&#39;twitter&#39;,&#39;pitchbook&#39;,&#39;crunchbase&#39;,&#39;paperstreet&#39;]&quot;</span>
</span><span id="SocialMediaUrlCleanerStage-50"><a href="#SocialMediaUrlCleanerStage-50"><span class="linenos"> 50</span></a>            <span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage-51"><a href="#SocialMediaUrlCleanerStage-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="SocialMediaUrlCleanerStage-52"><a href="#SocialMediaUrlCleanerStage-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">null_on_error</span> <span class="o">=</span> <span class="n">null_on_error</span>
</span><span id="SocialMediaUrlCleanerStage-53"><a href="#SocialMediaUrlCleanerStage-53"><span class="linenos"> 53</span></a>
</span><span id="SocialMediaUrlCleanerStage-54"><a href="#SocialMediaUrlCleanerStage-54"><span class="linenos"> 54</span></a>    <span class="n">mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SocialMediaUrlCleanerStage-55"><a href="#SocialMediaUrlCleanerStage-55"><span class="linenos"> 55</span></a>        <span class="s2">&quot;angel&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SocialMediaUrlCleanerStage-56"><a href="#SocialMediaUrlCleanerStage-56"><span class="linenos"> 56</span></a>            <span class="s2">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;(?i)(?:https?:</span><span class="se">\\</span><span class="s2">/</span><span class="se">\\</span><span class="s2">/)?(?:(?:www|</span><span class="se">\\</span><span class="s2">w</span><span class="se">\\</span><span class="s2">w)</span><span class="se">\\</span><span class="s2">.)?angel</span><span class="se">\\</span><span class="s2">.co</span><span class="se">\\</span><span class="s2">/([^?^#]*)&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-57"><a href="#SocialMediaUrlCleanerStage-57"><span class="linenos"> 57</span></a>            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;angel.co/</span><span class="si">{</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-58"><a href="#SocialMediaUrlCleanerStage-58"><span class="linenos"> 58</span></a>        <span class="p">},</span>
</span><span id="SocialMediaUrlCleanerStage-59"><a href="#SocialMediaUrlCleanerStage-59"><span class="linenos"> 59</span></a>        <span class="s2">&quot;facebook&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SocialMediaUrlCleanerStage-60"><a href="#SocialMediaUrlCleanerStage-60"><span class="linenos"> 60</span></a>            <span class="s2">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;(?:https?:</span><span class="se">\\</span><span class="s2">/</span><span class="se">\\</span><span class="s2">/)?(?:(?:www|</span><span class="se">\\</span><span class="s2">w</span><span class="se">\\</span><span class="s2">w)</span><span class="se">\\</span><span class="s2">.)?(?:facebook</span><span class="se">\\</span><span class="s2">.com|fb</span><span class="se">\\</span><span class="s2">.me)</span><span class="se">\\</span><span class="s2">/([^?^#]*)&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-61"><a href="#SocialMediaUrlCleanerStage-61"><span class="linenos"> 61</span></a>            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;facebook.com/</span><span class="si">{</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-62"><a href="#SocialMediaUrlCleanerStage-62"><span class="linenos"> 62</span></a>        <span class="p">},</span>
</span><span id="SocialMediaUrlCleanerStage-63"><a href="#SocialMediaUrlCleanerStage-63"><span class="linenos"> 63</span></a>        <span class="s2">&quot;linkedin&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SocialMediaUrlCleanerStage-64"><a href="#SocialMediaUrlCleanerStage-64"><span class="linenos"> 64</span></a>            <span class="s2">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;(?:https?:</span><span class="se">\\</span><span class="s2">/</span><span class="se">\\</span><span class="s2">/)?(?:(?:www|</span><span class="se">\\</span><span class="s2">w</span><span class="se">\\</span><span class="s2">w)</span><span class="se">\\</span><span class="s2">.)?linkedin</span><span class="se">\\</span><span class="s2">.(?:com|cn)</span><span class="se">\\</span><span class="s2">/(?:(?:organization-guest|mwlite)</span><span class="se">\\</span><span class="s2">/)?(company|companies|in|showcase|pub|groups|organization|school|edu|company-beta)</span><span class="se">\\</span><span class="s2">/(?:([^?]*?)(?:</span><span class="se">\\</span><span class="s2">/)|(.*))&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-65"><a href="#SocialMediaUrlCleanerStage-65"><span class="linenos"> 65</span></a>            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s2">&quot;linkedin.com/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-66"><a href="#SocialMediaUrlCleanerStage-66"><span class="linenos"> 66</span></a>                <span class="s2">&quot;company&quot;</span> <span class="k">if</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;company-beta&quot;</span> <span class="k">else</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="SocialMediaUrlCleanerStage-67"><a href="#SocialMediaUrlCleanerStage-67"><span class="linenos"> 67</span></a>                <span class="k">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">match</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="SocialMediaUrlCleanerStage-68"><a href="#SocialMediaUrlCleanerStage-68"><span class="linenos"> 68</span></a>            <span class="p">),</span>
</span><span id="SocialMediaUrlCleanerStage-69"><a href="#SocialMediaUrlCleanerStage-69"><span class="linenos"> 69</span></a>        <span class="p">},</span>
</span><span id="SocialMediaUrlCleanerStage-70"><a href="#SocialMediaUrlCleanerStage-70"><span class="linenos"> 70</span></a>        <span class="s2">&quot;twitter&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SocialMediaUrlCleanerStage-71"><a href="#SocialMediaUrlCleanerStage-71"><span class="linenos"> 71</span></a>            <span class="s2">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;(?:https?:</span><span class="se">\\</span><span class="s2">/</span><span class="se">\\</span><span class="s2">/)?(?:(?:www|</span><span class="se">\\</span><span class="s2">w</span><span class="se">\\</span><span class="s2">w)</span><span class="se">\\</span><span class="s2">.)?twitter</span><span class="se">\\</span><span class="s2">.com</span><span class="se">\\</span><span class="s2">/([^?^#]*)&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-72"><a href="#SocialMediaUrlCleanerStage-72"><span class="linenos"> 72</span></a>            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;twitter.com/</span><span class="si">{</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-73"><a href="#SocialMediaUrlCleanerStage-73"><span class="linenos"> 73</span></a>        <span class="p">},</span>
</span><span id="SocialMediaUrlCleanerStage-74"><a href="#SocialMediaUrlCleanerStage-74"><span class="linenos"> 74</span></a>        <span class="s2">&quot;pitchbook&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SocialMediaUrlCleanerStage-75"><a href="#SocialMediaUrlCleanerStage-75"><span class="linenos"> 75</span></a>            <span class="s2">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;(?:https?:</span><span class="se">\\</span><span class="s2">/</span><span class="se">\\</span><span class="s2">/)?(?:(?:www|</span><span class="se">\\</span><span class="s2">w</span><span class="se">\\</span><span class="s2">w)</span><span class="se">\\</span><span class="s2">.)?my</span><span class="se">\\</span><span class="s2">.pitchbook</span><span class="se">\\</span><span class="s2">.com</span><span class="se">\\</span><span class="s2">/profile</span><span class="se">\\</span><span class="s2">/([^?^#]*)&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-76"><a href="#SocialMediaUrlCleanerStage-76"><span class="linenos"> 76</span></a>            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;my.pitchbook.com/profile/</span><span class="si">{</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-77"><a href="#SocialMediaUrlCleanerStage-77"><span class="linenos"> 77</span></a>        <span class="p">},</span>
</span><span id="SocialMediaUrlCleanerStage-78"><a href="#SocialMediaUrlCleanerStage-78"><span class="linenos"> 78</span></a>        <span class="s2">&quot;crunchbase&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SocialMediaUrlCleanerStage-79"><a href="#SocialMediaUrlCleanerStage-79"><span class="linenos"> 79</span></a>            <span class="s2">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;(?:https?:</span><span class="se">\\</span><span class="s2">/</span><span class="se">\\</span><span class="s2">/)?(?:(?:www|</span><span class="se">\\</span><span class="s2">w</span><span class="se">\\</span><span class="s2">w)</span><span class="se">\\</span><span class="s2">.)?crunchbase</span><span class="se">\\</span><span class="s2">.com</span><span class="se">\\</span><span class="s2">/(company|organization|financial-organization)</span><span class="se">\\</span><span class="s2">/(?:([^?^#]*?)(?:</span><span class="se">\\</span><span class="s2">/)|([^?]*))&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-80"><a href="#SocialMediaUrlCleanerStage-80"><span class="linenos"> 80</span></a>            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s2">&quot;crunchbase.com/organization/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-81"><a href="#SocialMediaUrlCleanerStage-81"><span class="linenos"> 81</span></a>                <span class="k">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">match</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="SocialMediaUrlCleanerStage-82"><a href="#SocialMediaUrlCleanerStage-82"><span class="linenos"> 82</span></a>            <span class="p">),</span>
</span><span id="SocialMediaUrlCleanerStage-83"><a href="#SocialMediaUrlCleanerStage-83"><span class="linenos"> 83</span></a>        <span class="p">},</span>
</span><span id="SocialMediaUrlCleanerStage-84"><a href="#SocialMediaUrlCleanerStage-84"><span class="linenos"> 84</span></a>        <span class="s2">&quot;paperstreet&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SocialMediaUrlCleanerStage-85"><a href="#SocialMediaUrlCleanerStage-85"><span class="linenos"> 85</span></a>            <span class="s2">&quot;regex&quot;</span><span class="p">:</span> <span class="s2">&quot;(?:https?:</span><span class="se">\\</span><span class="s2">/</span><span class="se">\\</span><span class="s2">/)?(?:(?:www|</span><span class="se">\\</span><span class="s2">w</span><span class="se">\\</span><span class="s2">w)</span><span class="se">\\</span><span class="s2">.)?paperstreet</span><span class="se">\\</span><span class="s2">.vc</span><span class="se">\\</span><span class="s2">/([^?^#]*)&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-86"><a href="#SocialMediaUrlCleanerStage-86"><span class="linenos"> 86</span></a>            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;paperstreet.vc/</span><span class="si">{</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-87"><a href="#SocialMediaUrlCleanerStage-87"><span class="linenos"> 87</span></a>        <span class="p">},</span>
</span><span id="SocialMediaUrlCleanerStage-88"><a href="#SocialMediaUrlCleanerStage-88"><span class="linenos"> 88</span></a>    <span class="p">}</span>
</span><span id="SocialMediaUrlCleanerStage-89"><a href="#SocialMediaUrlCleanerStage-89"><span class="linenos"> 89</span></a>
</span><span id="SocialMediaUrlCleanerStage-90"><a href="#SocialMediaUrlCleanerStage-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">_get_social_media_url</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-91"><a href="#SocialMediaUrlCleanerStage-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-92"><a href="#SocialMediaUrlCleanerStage-92"><span class="linenos"> 92</span></a>        <span class="n">og_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-93"><a href="#SocialMediaUrlCleanerStage-93"><span class="linenos"> 93</span></a>        <span class="n">search_val</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-94"><a href="#SocialMediaUrlCleanerStage-94"><span class="linenos"> 94</span></a>        <span class="n">match_regex</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-95"><a href="#SocialMediaUrlCleanerStage-95"><span class="linenos"> 95</span></a>        <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-96"><a href="#SocialMediaUrlCleanerStage-96"><span class="linenos"> 96</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SocialMediaUrlCleanerStage-97"><a href="#SocialMediaUrlCleanerStage-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-98"><a href="#SocialMediaUrlCleanerStage-98"><span class="linenos"> 98</span></a>            <span class="n">og_url</span>
</span><span id="SocialMediaUrlCleanerStage-99"><a href="#SocialMediaUrlCleanerStage-99"><span class="linenos"> 99</span></a>            <span class="ow">and</span> <span class="n">search_val</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">og_url</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="SocialMediaUrlCleanerStage-100"><a href="#SocialMediaUrlCleanerStage-100"><span class="linenos">100</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">null_on_error</span>
</span><span id="SocialMediaUrlCleanerStage-101"><a href="#SocialMediaUrlCleanerStage-101"><span class="linenos">101</span></a>            <span class="ow">or</span> <span class="ow">not</span> <span class="n">og_url</span>
</span><span id="SocialMediaUrlCleanerStage-102"><a href="#SocialMediaUrlCleanerStage-102"><span class="linenos">102</span></a>        <span class="p">):</span>
</span><span id="SocialMediaUrlCleanerStage-103"><a href="#SocialMediaUrlCleanerStage-103"><span class="linenos">103</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SocialMediaUrlCleanerStage-104"><a href="#SocialMediaUrlCleanerStage-104"><span class="linenos">104</span></a>        <span class="k">elif</span> <span class="n">search_val</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">og_url</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
</span><span id="SocialMediaUrlCleanerStage-105"><a href="#SocialMediaUrlCleanerStage-105"><span class="linenos">105</span></a>            <span class="k">raise</span> <span class="n">SocialMediaUrlError</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-106"><a href="#SocialMediaUrlCleanerStage-106"><span class="linenos">106</span></a>                <span class="n">stage_name</span><span class="o">=</span><span class="s2">&quot;SocialMediaUrlCleanerStage&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-107"><a href="#SocialMediaUrlCleanerStage-107"><span class="linenos">107</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">og_url</span><span class="si">}</span><span class="s2"> is not a </span><span class="si">{</span><span class="n">search_val</span><span class="si">}</span><span class="s2"> URL, string:</span><span class="si">{</span><span class="n">search_val</span><span class="si">}</span><span class="s2"> not found in URL&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-108"><a href="#SocialMediaUrlCleanerStage-108"><span class="linenos">108</span></a>                <span class="n">handling_method</span><span class="o">=</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-109"><a href="#SocialMediaUrlCleanerStage-109"><span class="linenos">109</span></a>            <span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage-110"><a href="#SocialMediaUrlCleanerStage-110"><span class="linenos">110</span></a>        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">match_regex</span><span class="p">,</span> <span class="n">og_url</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage-111"><a href="#SocialMediaUrlCleanerStage-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SocialMediaUrlCleanerStage-112"><a href="#SocialMediaUrlCleanerStage-112"><span class="linenos">112</span></a>            <span class="k">return</span> <span class="n">callback</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage-113"><a href="#SocialMediaUrlCleanerStage-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">null_on_error</span><span class="p">:</span>
</span><span id="SocialMediaUrlCleanerStage-114"><a href="#SocialMediaUrlCleanerStage-114"><span class="linenos">114</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SocialMediaUrlCleanerStage-115"><a href="#SocialMediaUrlCleanerStage-115"><span class="linenos">115</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SocialMediaUrlCleanerStage-116"><a href="#SocialMediaUrlCleanerStage-116"><span class="linenos">116</span></a>            <span class="k">raise</span> <span class="n">SocialMediaUrlError</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-117"><a href="#SocialMediaUrlCleanerStage-117"><span class="linenos">117</span></a>                <span class="n">stage_name</span><span class="o">=</span><span class="s2">&quot;SocialMediaUrlCleanerStage&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-118"><a href="#SocialMediaUrlCleanerStage-118"><span class="linenos">118</span></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No regex matches found in the provided URL:</span><span class="si">{</span><span class="n">og_url</span><span class="si">}</span><span class="s2">, Check if valid </span><span class="si">{</span><span class="n">search_val</span><span class="si">}</span><span class="s2"> URL is passed&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-119"><a href="#SocialMediaUrlCleanerStage-119"><span class="linenos">119</span></a>                <span class="n">handling_method</span><span class="o">=</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage-120"><a href="#SocialMediaUrlCleanerStage-120"><span class="linenos">120</span></a>            <span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage-121"><a href="#SocialMediaUrlCleanerStage-121"><span class="linenos">121</span></a>
</span><span id="SocialMediaUrlCleanerStage-122"><a href="#SocialMediaUrlCleanerStage-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="SocialMediaUrlCleanerStage-123"><a href="#SocialMediaUrlCleanerStage-123"><span class="linenos">123</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SocialMediaUrlCleanerStage-124"><a href="#SocialMediaUrlCleanerStage-124"><span class="linenos">124</span></a>            <span class="n">regex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span><span class="p">[</span><span class="n">val</span><span class="p">][</span><span class="s2">&quot;regex&quot;</span><span class="p">]</span>
</span><span id="SocialMediaUrlCleanerStage-125"><a href="#SocialMediaUrlCleanerStage-125"><span class="linenos">125</span></a>            <span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span><span class="p">[</span><span class="n">val</span><span class="p">][</span><span class="s2">&quot;callback&quot;</span><span class="p">]</span>
</span><span id="SocialMediaUrlCleanerStage-126"><a href="#SocialMediaUrlCleanerStage-126"><span class="linenos">126</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_social_media_url</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage-127"><a href="#SocialMediaUrlCleanerStage-127"><span class="linenos">127</span></a>                <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">val</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">callback</span>
</span><span id="SocialMediaUrlCleanerStage-128"><a href="#SocialMediaUrlCleanerStage-128"><span class="linenos">128</span></a>            <span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage-129"><a href="#SocialMediaUrlCleanerStage-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Cleans Social media urls to the desired format</p>
</div>


                            <div id="SocialMediaUrlCleanerStage.__init__" class="classattr">
                                        <input id="SocialMediaUrlCleanerStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SocialMediaUrlCleanerStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;angel&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook&#39;</span><span class="p">,</span> <span class="s1">&#39;linkedin&#39;</span><span class="p">,</span> <span class="s1">&#39;twitter&#39;</span><span class="p">,</span> <span class="s1">&#39;pitchbook&#39;</span><span class="p">,</span> <span class="s1">&#39;crunchbase&#39;</span><span class="p">,</span> <span class="s1">&#39;paperstreet&#39;</span><span class="p">]]</span>,</span><span class="param">	<span class="n">null_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="SocialMediaUrlCleanerStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SocialMediaUrlCleanerStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SocialMediaUrlCleanerStage.__init__-11"><a href="#SocialMediaUrlCleanerStage.__init__-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-12"><a href="#SocialMediaUrlCleanerStage.__init__-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-13"><a href="#SocialMediaUrlCleanerStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-14"><a href="#SocialMediaUrlCleanerStage.__init__-14"><span class="linenos">14</span></a>            <span class="nb">str</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-15"><a href="#SocialMediaUrlCleanerStage.__init__-15"><span class="linenos">15</span></a>            <span class="n">Literal</span><span class="p">[</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-16"><a href="#SocialMediaUrlCleanerStage.__init__-16"><span class="linenos">16</span></a>                <span class="s2">&quot;angel&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-17"><a href="#SocialMediaUrlCleanerStage.__init__-17"><span class="linenos">17</span></a>                <span class="s2">&quot;facebook&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-18"><a href="#SocialMediaUrlCleanerStage.__init__-18"><span class="linenos">18</span></a>                <span class="s2">&quot;linkedin&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-19"><a href="#SocialMediaUrlCleanerStage.__init__-19"><span class="linenos">19</span></a>                <span class="s2">&quot;twitter&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-20"><a href="#SocialMediaUrlCleanerStage.__init__-20"><span class="linenos">20</span></a>                <span class="s2">&quot;pitchbook&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-21"><a href="#SocialMediaUrlCleanerStage.__init__-21"><span class="linenos">21</span></a>                <span class="s2">&quot;crunchbase&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-22"><a href="#SocialMediaUrlCleanerStage.__init__-22"><span class="linenos">22</span></a>                <span class="s2">&quot;paperstreet&quot;</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-23"><a href="#SocialMediaUrlCleanerStage.__init__-23"><span class="linenos">23</span></a>            <span class="p">],</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-24"><a href="#SocialMediaUrlCleanerStage.__init__-24"><span class="linenos">24</span></a>        <span class="p">],</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-25"><a href="#SocialMediaUrlCleanerStage.__init__-25"><span class="linenos">25</span></a>        <span class="n">null_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-26"><a href="#SocialMediaUrlCleanerStage.__init__-26"><span class="linenos">26</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-27"><a href="#SocialMediaUrlCleanerStage.__init__-27"><span class="linenos">27</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-28"><a href="#SocialMediaUrlCleanerStage.__init__-28"><span class="linenos">28</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-29"><a href="#SocialMediaUrlCleanerStage.__init__-29"><span class="linenos">29</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-30"><a href="#SocialMediaUrlCleanerStage.__init__-30"><span class="linenos">30</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-31"><a href="#SocialMediaUrlCleanerStage.__init__-31"><span class="linenos">31</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `SocialMediaUrlCleanerStage`.</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-32"><a href="#SocialMediaUrlCleanerStage.__init__-32"><span class="linenos">32</span></a><span class="sd">        Args:</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-33"><a href="#SocialMediaUrlCleanerStage.__init__-33"><span class="linenos">33</span></a><span class="sd">            fields (dict[str,Literal[&quot;angel&quot;, &quot;facebook&quot;, &quot;linkedin&quot;, &quot;twitter&quot;, &quot;pitchbook&quot;, &quot;crunchbase&quot;, &quot;paperstreet&quot;]]): Social Media URL fields to clean and their corresponding cleaning method.</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-34"><a href="#SocialMediaUrlCleanerStage.__init__-34"><span class="linenos">34</span></a><span class="sd">            null_on_error bool: DEFAULTs to False. Raise error</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-35"><a href="#SocialMediaUrlCleanerStage.__init__-35"><span class="linenos">35</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-36"><a href="#SocialMediaUrlCleanerStage.__init__-36"><span class="linenos">36</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if process_record method is implemented. Defaults to 1.</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-37"><a href="#SocialMediaUrlCleanerStage.__init__-37"><span class="linenos">37</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-38"><a href="#SocialMediaUrlCleanerStage.__init__-38"><span class="linenos">38</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-39"><a href="#SocialMediaUrlCleanerStage.__init__-39"><span class="linenos">39</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-40"><a href="#SocialMediaUrlCleanerStage.__init__-40"><span class="linenos">40</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-41"><a href="#SocialMediaUrlCleanerStage.__init__-41"><span class="linenos">41</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-42"><a href="#SocialMediaUrlCleanerStage.__init__-42"><span class="linenos">42</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-43"><a href="#SocialMediaUrlCleanerStage.__init__-43"><span class="linenos">43</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-44"><a href="#SocialMediaUrlCleanerStage.__init__-44"><span class="linenos">44</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-45"><a href="#SocialMediaUrlCleanerStage.__init__-45"><span class="linenos">45</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-46"><a href="#SocialMediaUrlCleanerStage.__init__-46"><span class="linenos">46</span></a>        <span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-47"><a href="#SocialMediaUrlCleanerStage.__init__-47"><span class="linenos">47</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-48"><a href="#SocialMediaUrlCleanerStage.__init__-48"><span class="linenos">48</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-49"><a href="#SocialMediaUrlCleanerStage.__init__-49"><span class="linenos">49</span></a>                <span class="s2">&quot;Cleaning method values must be in the following list: [&#39;linkedin&#39;,&#39;angel&#39;,&#39;facebook&#39;,&#39;twitter&#39;,&#39;pitchbook&#39;,&#39;crunchbase&#39;,&#39;paperstreet&#39;]&quot;</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-50"><a href="#SocialMediaUrlCleanerStage.__init__-50"><span class="linenos">50</span></a>            <span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-51"><a href="#SocialMediaUrlCleanerStage.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="SocialMediaUrlCleanerStage.__init__-52"><a href="#SocialMediaUrlCleanerStage.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">null_on_error</span> <span class="o">=</span> <span class="n">null_on_error</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#SocialMediaUrlCleanerStage">SocialMediaUrlCleanerStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (dict[str,Literal["angel", "facebook", "linkedin", "twitter", "pitchbook", "crunchbase", "paperstreet"]]):</strong>  Social Media URL fields to clean and their corresponding cleaning method.</li>
<li><strong>null_on_error bool:</strong>  DEFAULTs to False. Raise error</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="SocialMediaUrlCleanerStage.process_record" class="classattr">
                                        <input id="SocialMediaUrlCleanerStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="SocialMediaUrlCleanerStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SocialMediaUrlCleanerStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SocialMediaUrlCleanerStage.process_record-122"><a href="#SocialMediaUrlCleanerStage.process_record-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="SocialMediaUrlCleanerStage.process_record-123"><a href="#SocialMediaUrlCleanerStage.process_record-123"><span class="linenos">123</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SocialMediaUrlCleanerStage.process_record-124"><a href="#SocialMediaUrlCleanerStage.process_record-124"><span class="linenos">124</span></a>            <span class="n">regex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span><span class="p">[</span><span class="n">val</span><span class="p">][</span><span class="s2">&quot;regex&quot;</span><span class="p">]</span>
</span><span id="SocialMediaUrlCleanerStage.process_record-125"><a href="#SocialMediaUrlCleanerStage.process_record-125"><span class="linenos">125</span></a>            <span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mappings</span><span class="p">[</span><span class="n">val</span><span class="p">][</span><span class="s2">&quot;callback&quot;</span><span class="p">]</span>
</span><span id="SocialMediaUrlCleanerStage.process_record-126"><a href="#SocialMediaUrlCleanerStage.process_record-126"><span class="linenos">126</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_social_media_url</span><span class="p">(</span>
</span><span id="SocialMediaUrlCleanerStage.process_record-127"><a href="#SocialMediaUrlCleanerStage.process_record-127"><span class="linenos">127</span></a>                <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">val</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">callback</span>
</span><span id="SocialMediaUrlCleanerStage.process_record-128"><a href="#SocialMediaUrlCleanerStage.process_record-128"><span class="linenos">128</span></a>            <span class="p">)</span>
</span><span id="SocialMediaUrlCleanerStage.process_record-129"><a href="#SocialMediaUrlCleanerStage.process_record-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="SocialMediaUrlCleanerStage.unique_name" class="variable">unique_name</dd>
                <dd id="SocialMediaUrlCleanerStage.pipeline" class="variable">pipeline</dd>
                <dd id="SocialMediaUrlCleanerStage.add_downstream" class="function">add_downstream</dd>
                <dd id="SocialMediaUrlCleanerStage.add_upstream" class="function">add_upstream</dd>
                <dd id="SocialMediaUrlCleanerStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="SocialMediaUrlCleanerStage.channels" class="variable">channels</dd>
                <dd id="SocialMediaUrlCleanerStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="SocialMediaUrlCleanerStage.log" class="variable">log</dd>
                <dd id="SocialMediaUrlCleanerStage.reset_level" class="function">reset_level</dd>
                <dd id="SocialMediaUrlCleanerStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SpecialCharacterCleanerStage">
                            <input id="SpecialCharacterCleanerStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SpecialCharacterCleanerStage</span><wbr>(<span class="base">cluo.extensions.field_processor_stage.FieldProcessorStage</span>):

                <label class="view-source-button" for="SpecialCharacterCleanerStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SpecialCharacterCleanerStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SpecialCharacterCleanerStage-10"><a href="#SpecialCharacterCleanerStage-10"><span class="linenos">10</span></a><span class="k">class</span> <span class="nc">SpecialCharacterCleanerStage</span><span class="p">(</span><span class="n">FieldProcessorStage</span><span class="p">):</span>
</span><span id="SpecialCharacterCleanerStage-11"><a href="#SpecialCharacterCleanerStage-11"><span class="linenos">11</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove special characters from specified strings.&quot;&quot;&quot;</span>
</span><span id="SpecialCharacterCleanerStage-12"><a href="#SpecialCharacterCleanerStage-12"><span class="linenos">12</span></a>
</span><span id="SpecialCharacterCleanerStage-13"><a href="#SpecialCharacterCleanerStage-13"><span class="linenos">13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SpecialCharacterCleanerStage-14"><a href="#SpecialCharacterCleanerStage-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-15"><a href="#SpecialCharacterCleanerStage-15"><span class="linenos">15</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-16"><a href="#SpecialCharacterCleanerStage-16"><span class="linenos">16</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-17"><a href="#SpecialCharacterCleanerStage-17"><span class="linenos">17</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-18"><a href="#SpecialCharacterCleanerStage-18"><span class="linenos">18</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-19"><a href="#SpecialCharacterCleanerStage-19"><span class="linenos">19</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-20"><a href="#SpecialCharacterCleanerStage-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-21"><a href="#SpecialCharacterCleanerStage-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SpecialCharacterCleanerStage-22"><a href="#SpecialCharacterCleanerStage-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize `SpecialCharacterCleanerStage`.</span>
</span><span id="SpecialCharacterCleanerStage-23"><a href="#SpecialCharacterCleanerStage-23"><span class="linenos">23</span></a>
</span><span id="SpecialCharacterCleanerStage-24"><a href="#SpecialCharacterCleanerStage-24"><span class="linenos">24</span></a><span class="sd">        Args:</span>
</span><span id="SpecialCharacterCleanerStage-25"><a href="#SpecialCharacterCleanerStage-25"><span class="linenos">25</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="SpecialCharacterCleanerStage-26"><a href="#SpecialCharacterCleanerStage-26"><span class="linenos">26</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="SpecialCharacterCleanerStage-27"><a href="#SpecialCharacterCleanerStage-27"><span class="linenos">27</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SpecialCharacterCleanerStage-28"><a href="#SpecialCharacterCleanerStage-28"><span class="linenos">28</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="SpecialCharacterCleanerStage-29"><a href="#SpecialCharacterCleanerStage-29"><span class="linenos">29</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SpecialCharacterCleanerStage-30"><a href="#SpecialCharacterCleanerStage-30"><span class="linenos">30</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="SpecialCharacterCleanerStage-31"><a href="#SpecialCharacterCleanerStage-31"><span class="linenos">31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SpecialCharacterCleanerStage-32"><a href="#SpecialCharacterCleanerStage-32"><span class="linenos">32</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SpecialCharacterCleanerStage-33"><a href="#SpecialCharacterCleanerStage-33"><span class="linenos">33</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-34"><a href="#SpecialCharacterCleanerStage-34"><span class="linenos">34</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-35"><a href="#SpecialCharacterCleanerStage-35"><span class="linenos">35</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-36"><a href="#SpecialCharacterCleanerStage-36"><span class="linenos">36</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-37"><a href="#SpecialCharacterCleanerStage-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-38"><a href="#SpecialCharacterCleanerStage-38"><span class="linenos">38</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-39"><a href="#SpecialCharacterCleanerStage-39"><span class="linenos">39</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage-40"><a href="#SpecialCharacterCleanerStage-40"><span class="linenos">40</span></a>        <span class="p">)</span>
</span><span id="SpecialCharacterCleanerStage-41"><a href="#SpecialCharacterCleanerStage-41"><span class="linenos">41</span></a>
</span><span id="SpecialCharacterCleanerStage-42"><a href="#SpecialCharacterCleanerStage-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SpecialCharacterCleanerStage-43"><a href="#SpecialCharacterCleanerStage-43"><span class="linenos">43</span></a>        <span class="k">return</span> <span class="n">unidecode</span><span class="o">.</span><span class="n">unidecode</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove special characters from specified strings.</p>
</div>


                            <div id="SpecialCharacterCleanerStage.__init__" class="classattr">
                                        <input id="SpecialCharacterCleanerStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SpecialCharacterCleanerStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="SpecialCharacterCleanerStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SpecialCharacterCleanerStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SpecialCharacterCleanerStage.__init__-13"><a href="#SpecialCharacterCleanerStage.__init__-13"><span class="linenos">13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SpecialCharacterCleanerStage.__init__-14"><a href="#SpecialCharacterCleanerStage.__init__-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-15"><a href="#SpecialCharacterCleanerStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-16"><a href="#SpecialCharacterCleanerStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-17"><a href="#SpecialCharacterCleanerStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-18"><a href="#SpecialCharacterCleanerStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-19"><a href="#SpecialCharacterCleanerStage.__init__-19"><span class="linenos">19</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-20"><a href="#SpecialCharacterCleanerStage.__init__-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-21"><a href="#SpecialCharacterCleanerStage.__init__-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SpecialCharacterCleanerStage.__init__-22"><a href="#SpecialCharacterCleanerStage.__init__-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize `SpecialCharacterCleanerStage`.</span>
</span><span id="SpecialCharacterCleanerStage.__init__-23"><a href="#SpecialCharacterCleanerStage.__init__-23"><span class="linenos">23</span></a>
</span><span id="SpecialCharacterCleanerStage.__init__-24"><a href="#SpecialCharacterCleanerStage.__init__-24"><span class="linenos">24</span></a><span class="sd">        Args:</span>
</span><span id="SpecialCharacterCleanerStage.__init__-25"><a href="#SpecialCharacterCleanerStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="SpecialCharacterCleanerStage.__init__-26"><a href="#SpecialCharacterCleanerStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="SpecialCharacterCleanerStage.__init__-27"><a href="#SpecialCharacterCleanerStage.__init__-27"><span class="linenos">27</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SpecialCharacterCleanerStage.__init__-28"><a href="#SpecialCharacterCleanerStage.__init__-28"><span class="linenos">28</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="SpecialCharacterCleanerStage.__init__-29"><a href="#SpecialCharacterCleanerStage.__init__-29"><span class="linenos">29</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SpecialCharacterCleanerStage.__init__-30"><a href="#SpecialCharacterCleanerStage.__init__-30"><span class="linenos">30</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="SpecialCharacterCleanerStage.__init__-31"><a href="#SpecialCharacterCleanerStage.__init__-31"><span class="linenos">31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SpecialCharacterCleanerStage.__init__-32"><a href="#SpecialCharacterCleanerStage.__init__-32"><span class="linenos">32</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SpecialCharacterCleanerStage.__init__-33"><a href="#SpecialCharacterCleanerStage.__init__-33"><span class="linenos">33</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-34"><a href="#SpecialCharacterCleanerStage.__init__-34"><span class="linenos">34</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-35"><a href="#SpecialCharacterCleanerStage.__init__-35"><span class="linenos">35</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-36"><a href="#SpecialCharacterCleanerStage.__init__-36"><span class="linenos">36</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-37"><a href="#SpecialCharacterCleanerStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-38"><a href="#SpecialCharacterCleanerStage.__init__-38"><span class="linenos">38</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-39"><a href="#SpecialCharacterCleanerStage.__init__-39"><span class="linenos">39</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="SpecialCharacterCleanerStage.__init__-40"><a href="#SpecialCharacterCleanerStage.__init__-40"><span class="linenos">40</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize <code><a href="#SpecialCharacterCleanerStage">SpecialCharacterCleanerStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (Iterable[str], optional):</strong>  Fields to operate on. Will operate on all fields if not set (None).</li>
<li><strong>allow_nulls (bool, optional):</strong>  Allow null values/fields if True, otherwise use error_handling_method</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="SpecialCharacterCleanerStage.process_field" class="classattr">
                                        <input id="SpecialCharacterCleanerStage.process_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="SpecialCharacterCleanerStage.process_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SpecialCharacterCleanerStage.process_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SpecialCharacterCleanerStage.process_field-42"><a href="#SpecialCharacterCleanerStage.process_field-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SpecialCharacterCleanerStage.process_field-43"><a href="#SpecialCharacterCleanerStage.process_field-43"><span class="linenos">43</span></a>        <span class="k">return</span> <span class="n">unidecode</span><span class="o">.</span><span class="n">unidecode</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.extensions.field_processor_stage.FieldProcessorStage</dt>
                                <dd id="SpecialCharacterCleanerStage.process_record" class="function">process_record</dd>

            </div>
            <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="SpecialCharacterCleanerStage.unique_name" class="variable">unique_name</dd>
                <dd id="SpecialCharacterCleanerStage.pipeline" class="variable">pipeline</dd>
                <dd id="SpecialCharacterCleanerStage.add_downstream" class="function">add_downstream</dd>
                <dd id="SpecialCharacterCleanerStage.add_upstream" class="function">add_upstream</dd>
                <dd id="SpecialCharacterCleanerStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="SpecialCharacterCleanerStage.channels" class="variable">channels</dd>
                <dd id="SpecialCharacterCleanerStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="SpecialCharacterCleanerStage.log" class="variable">log</dd>
                <dd id="SpecialCharacterCleanerStage.reset_level" class="function">reset_level</dd>
                <dd id="SpecialCharacterCleanerStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TypecastStage">
                            <input id="TypecastStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TypecastStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="TypecastStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TypecastStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TypecastStage-7"><a href="#TypecastStage-7"><span class="linenos"> 7</span></a><span class="k">class</span> <span class="nc">TypecastStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="TypecastStage-8"><a href="#TypecastStage-8"><span class="linenos"> 8</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cast the data types of values for each record in batch.&quot;&quot;&quot;</span>
</span><span id="TypecastStage-9"><a href="#TypecastStage-9"><span class="linenos"> 9</span></a>
</span><span id="TypecastStage-10"><a href="#TypecastStage-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="TypecastStage-11"><a href="#TypecastStage-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TypecastStage-12"><a href="#TypecastStage-12"><span class="linenos">12</span></a>        <span class="n">type_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
</span><span id="TypecastStage-13"><a href="#TypecastStage-13"><span class="linenos">13</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TypecastStage-14"><a href="#TypecastStage-14"><span class="linenos">14</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="TypecastStage-15"><a href="#TypecastStage-15"><span class="linenos">15</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">,</span>
</span><span id="TypecastStage-16"><a href="#TypecastStage-16"><span class="linenos">16</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TypecastStage-17"><a href="#TypecastStage-17"><span class="linenos">17</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TypecastStage-18"><a href="#TypecastStage-18"><span class="linenos">18</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `TypecastStage`.</span>
</span><span id="TypecastStage-19"><a href="#TypecastStage-19"><span class="linenos">19</span></a>
</span><span id="TypecastStage-20"><a href="#TypecastStage-20"><span class="linenos">20</span></a><span class="sd">        Args:</span>
</span><span id="TypecastStage-21"><a href="#TypecastStage-21"><span class="linenos">21</span></a><span class="sd">            type_mapping (dict[str, Type[object]]): Mapping from record keys to cast function or object constructor values (e.g. str, int, float, etc.).</span>
</span><span id="TypecastStage-22"><a href="#TypecastStage-22"><span class="linenos">22</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="TypecastStage-23"><a href="#TypecastStage-23"><span class="linenos">23</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="TypecastStage-24"><a href="#TypecastStage-24"><span class="linenos">24</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="TypecastStage-25"><a href="#TypecastStage-25"><span class="linenos">25</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="TypecastStage-26"><a href="#TypecastStage-26"><span class="linenos">26</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TypecastStage-27"><a href="#TypecastStage-27"><span class="linenos">27</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TypecastStage-28"><a href="#TypecastStage-28"><span class="linenos">28</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="TypecastStage-29"><a href="#TypecastStage-29"><span class="linenos">29</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="TypecastStage-30"><a href="#TypecastStage-30"><span class="linenos">30</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="TypecastStage-31"><a href="#TypecastStage-31"><span class="linenos">31</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="TypecastStage-32"><a href="#TypecastStage-32"><span class="linenos">32</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="TypecastStage-33"><a href="#TypecastStage-33"><span class="linenos">33</span></a>        <span class="p">)</span>
</span><span id="TypecastStage-34"><a href="#TypecastStage-34"><span class="linenos">34</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="TypecastStage-35"><a href="#TypecastStage-35"><span class="linenos">35</span></a>            <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_constructor</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TypecastStage-36"><a href="#TypecastStage-36"><span class="linenos">36</span></a>            <span class="k">for</span> <span class="n">type_constructor</span> <span class="ow">in</span> <span class="n">type_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="TypecastStage-37"><a href="#TypecastStage-37"><span class="linenos">37</span></a>        <span class="p">):</span>
</span><span id="TypecastStage-38"><a href="#TypecastStage-38"><span class="linenos">38</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type_mapping values must be types.&quot;</span><span class="p">)</span>
</span><span id="TypecastStage-39"><a href="#TypecastStage-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">type_mapping</span> <span class="o">=</span> <span class="n">type_mapping</span>
</span><span id="TypecastStage-40"><a href="#TypecastStage-40"><span class="linenos">40</span></a>
</span><span id="TypecastStage-41"><a href="#TypecastStage-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="TypecastStage-42"><a href="#TypecastStage-42"><span class="linenos">42</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">type_constructor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TypecastStage-43"><a href="#TypecastStage-43"><span class="linenos">43</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_constructor</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="TypecastStage-44"><a href="#TypecastStage-44"><span class="linenos">44</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Cast the data types of values for each record in batch.</p>
</div>


                            <div id="TypecastStage.__init__" class="classattr">
                                        <input id="TypecastStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TypecastStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">type_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]]</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="TypecastStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TypecastStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TypecastStage.__init__-10"><a href="#TypecastStage.__init__-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="TypecastStage.__init__-11"><a href="#TypecastStage.__init__-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-12"><a href="#TypecastStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">type_mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
</span><span id="TypecastStage.__init__-13"><a href="#TypecastStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-14"><a href="#TypecastStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-15"><a href="#TypecastStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">RAISE</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-16"><a href="#TypecastStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-17"><a href="#TypecastStage.__init__-17"><span class="linenos">17</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TypecastStage.__init__-18"><a href="#TypecastStage.__init__-18"><span class="linenos">18</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `TypecastStage`.</span>
</span><span id="TypecastStage.__init__-19"><a href="#TypecastStage.__init__-19"><span class="linenos">19</span></a>
</span><span id="TypecastStage.__init__-20"><a href="#TypecastStage.__init__-20"><span class="linenos">20</span></a><span class="sd">        Args:</span>
</span><span id="TypecastStage.__init__-21"><a href="#TypecastStage.__init__-21"><span class="linenos">21</span></a><span class="sd">            type_mapping (dict[str, Type[object]]): Mapping from record keys to cast function or object constructor values (e.g. str, int, float, etc.).</span>
</span><span id="TypecastStage.__init__-22"><a href="#TypecastStage.__init__-22"><span class="linenos">22</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="TypecastStage.__init__-23"><a href="#TypecastStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="TypecastStage.__init__-24"><a href="#TypecastStage.__init__-24"><span class="linenos">24</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="TypecastStage.__init__-25"><a href="#TypecastStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="TypecastStage.__init__-26"><a href="#TypecastStage.__init__-26"><span class="linenos">26</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TypecastStage.__init__-27"><a href="#TypecastStage.__init__-27"><span class="linenos">27</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TypecastStage.__init__-28"><a href="#TypecastStage.__init__-28"><span class="linenos">28</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-29"><a href="#TypecastStage.__init__-29"><span class="linenos">29</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-30"><a href="#TypecastStage.__init__-30"><span class="linenos">30</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-31"><a href="#TypecastStage.__init__-31"><span class="linenos">31</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-32"><a href="#TypecastStage.__init__-32"><span class="linenos">32</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="TypecastStage.__init__-33"><a href="#TypecastStage.__init__-33"><span class="linenos">33</span></a>        <span class="p">)</span>
</span><span id="TypecastStage.__init__-34"><a href="#TypecastStage.__init__-34"><span class="linenos">34</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="TypecastStage.__init__-35"><a href="#TypecastStage.__init__-35"><span class="linenos">35</span></a>            <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_constructor</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TypecastStage.__init__-36"><a href="#TypecastStage.__init__-36"><span class="linenos">36</span></a>            <span class="k">for</span> <span class="n">type_constructor</span> <span class="ow">in</span> <span class="n">type_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="TypecastStage.__init__-37"><a href="#TypecastStage.__init__-37"><span class="linenos">37</span></a>        <span class="p">):</span>
</span><span id="TypecastStage.__init__-38"><a href="#TypecastStage.__init__-38"><span class="linenos">38</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type_mapping values must be types.&quot;</span><span class="p">)</span>
</span><span id="TypecastStage.__init__-39"><a href="#TypecastStage.__init__-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">type_mapping</span> <span class="o">=</span> <span class="n">type_mapping</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#TypecastStage">TypecastStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>type_mapping (dict[str, Type[object]]):</strong>  Mapping from record keys to cast function or object constructor values (e.g. str, int, float, etc.).</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="TypecastStage.process_record" class="classattr">
                                        <input id="TypecastStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="TypecastStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TypecastStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TypecastStage.process_record-41"><a href="#TypecastStage.process_record-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="TypecastStage.process_record-42"><a href="#TypecastStage.process_record-42"><span class="linenos">42</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">type_constructor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TypecastStage.process_record-43"><a href="#TypecastStage.process_record-43"><span class="linenos">43</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_constructor</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="TypecastStage.process_record-44"><a href="#TypecastStage.process_record-44"><span class="linenos">44</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="TypecastStage.unique_name" class="variable">unique_name</dd>
                <dd id="TypecastStage.pipeline" class="variable">pipeline</dd>
                <dd id="TypecastStage.add_downstream" class="function">add_downstream</dd>
                <dd id="TypecastStage.add_upstream" class="function">add_upstream</dd>
                <dd id="TypecastStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="TypecastStage.channels" class="variable">channels</dd>
                <dd id="TypecastStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="TypecastStage.log" class="variable">log</dd>
                <dd id="TypecastStage.reset_level" class="function">reset_level</dd>
                <dd id="TypecastStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="UpdateFieldsStage">
                            <input id="UpdateFieldsStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">UpdateFieldsStage</span><wbr>(<span class="base">cluo.core.stage.Stage</span>):

                <label class="view-source-button" for="UpdateFieldsStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UpdateFieldsStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UpdateFieldsStage-7"><a href="#UpdateFieldsStage-7"><span class="linenos"> 7</span></a><span class="k">class</span> <span class="nc">UpdateFieldsStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
</span><span id="UpdateFieldsStage-8"><a href="#UpdateFieldsStage-8"><span class="linenos"> 8</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Update values of fields for each record in batch.&quot;&quot;&quot;</span>
</span><span id="UpdateFieldsStage-9"><a href="#UpdateFieldsStage-9"><span class="linenos"> 9</span></a>
</span><span id="UpdateFieldsStage-10"><a href="#UpdateFieldsStage-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="UpdateFieldsStage-11"><a href="#UpdateFieldsStage-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-12"><a href="#UpdateFieldsStage-12"><span class="linenos">12</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="UpdateFieldsStage-13"><a href="#UpdateFieldsStage-13"><span class="linenos">13</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-14"><a href="#UpdateFieldsStage-14"><span class="linenos">14</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-15"><a href="#UpdateFieldsStage-15"><span class="linenos">15</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-16"><a href="#UpdateFieldsStage-16"><span class="linenos">16</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-17"><a href="#UpdateFieldsStage-17"><span class="linenos">17</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UpdateFieldsStage-18"><a href="#UpdateFieldsStage-18"><span class="linenos">18</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `UpdateFieldsStage`.</span>
</span><span id="UpdateFieldsStage-19"><a href="#UpdateFieldsStage-19"><span class="linenos">19</span></a>
</span><span id="UpdateFieldsStage-20"><a href="#UpdateFieldsStage-20"><span class="linenos">20</span></a><span class="sd">        Args:</span>
</span><span id="UpdateFieldsStage-21"><a href="#UpdateFieldsStage-21"><span class="linenos">21</span></a><span class="sd">            fields (dict[str, Union[Callable[[Any], Any], Any]]): Mapping from keys to new value or callable that takes old value as an argument and returns new value. Key must be found in original record if using callable.</span>
</span><span id="UpdateFieldsStage-22"><a href="#UpdateFieldsStage-22"><span class="linenos">22</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="UpdateFieldsStage-23"><a href="#UpdateFieldsStage-23"><span class="linenos">23</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="UpdateFieldsStage-24"><a href="#UpdateFieldsStage-24"><span class="linenos">24</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="UpdateFieldsStage-25"><a href="#UpdateFieldsStage-25"><span class="linenos">25</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="UpdateFieldsStage-26"><a href="#UpdateFieldsStage-26"><span class="linenos">26</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UpdateFieldsStage-27"><a href="#UpdateFieldsStage-27"><span class="linenos">27</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="UpdateFieldsStage-28"><a href="#UpdateFieldsStage-28"><span class="linenos">28</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-29"><a href="#UpdateFieldsStage-29"><span class="linenos">29</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-30"><a href="#UpdateFieldsStage-30"><span class="linenos">30</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-31"><a href="#UpdateFieldsStage-31"><span class="linenos">31</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-32"><a href="#UpdateFieldsStage-32"><span class="linenos">32</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="UpdateFieldsStage-33"><a href="#UpdateFieldsStage-33"><span class="linenos">33</span></a>        <span class="p">)</span>
</span><span id="UpdateFieldsStage-34"><a href="#UpdateFieldsStage-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="UpdateFieldsStage-35"><a href="#UpdateFieldsStage-35"><span class="linenos">35</span></a>
</span><span id="UpdateFieldsStage-36"><a href="#UpdateFieldsStage-36"><span class="linenos">36</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="UpdateFieldsStage-37"><a href="#UpdateFieldsStage-37"><span class="linenos">37</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="UpdateFieldsStage-38"><a href="#UpdateFieldsStage-38"><span class="linenos">38</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
</span><span id="UpdateFieldsStage-39"><a href="#UpdateFieldsStage-39"><span class="linenos">39</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


            <div class="docstring"><p>Update values of fields for each record in batch.</p>
</div>


                            <div id="UpdateFieldsStage.__init__" class="classattr">
                                        <input id="UpdateFieldsStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">UpdateFieldsStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="UpdateFieldsStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UpdateFieldsStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UpdateFieldsStage.__init__-10"><a href="#UpdateFieldsStage.__init__-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="UpdateFieldsStage.__init__-11"><a href="#UpdateFieldsStage.__init__-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-12"><a href="#UpdateFieldsStage.__init__-12"><span class="linenos">12</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="UpdateFieldsStage.__init__-13"><a href="#UpdateFieldsStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-14"><a href="#UpdateFieldsStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-15"><a href="#UpdateFieldsStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-16"><a href="#UpdateFieldsStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-17"><a href="#UpdateFieldsStage.__init__-17"><span class="linenos">17</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UpdateFieldsStage.__init__-18"><a href="#UpdateFieldsStage.__init__-18"><span class="linenos">18</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `UpdateFieldsStage`.</span>
</span><span id="UpdateFieldsStage.__init__-19"><a href="#UpdateFieldsStage.__init__-19"><span class="linenos">19</span></a>
</span><span id="UpdateFieldsStage.__init__-20"><a href="#UpdateFieldsStage.__init__-20"><span class="linenos">20</span></a><span class="sd">        Args:</span>
</span><span id="UpdateFieldsStage.__init__-21"><a href="#UpdateFieldsStage.__init__-21"><span class="linenos">21</span></a><span class="sd">            fields (dict[str, Union[Callable[[Any], Any], Any]]): Mapping from keys to new value or callable that takes old value as an argument and returns new value. Key must be found in original record if using callable.</span>
</span><span id="UpdateFieldsStage.__init__-22"><a href="#UpdateFieldsStage.__init__-22"><span class="linenos">22</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="UpdateFieldsStage.__init__-23"><a href="#UpdateFieldsStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="UpdateFieldsStage.__init__-24"><a href="#UpdateFieldsStage.__init__-24"><span class="linenos">24</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="UpdateFieldsStage.__init__-25"><a href="#UpdateFieldsStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="UpdateFieldsStage.__init__-26"><a href="#UpdateFieldsStage.__init__-26"><span class="linenos">26</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UpdateFieldsStage.__init__-27"><a href="#UpdateFieldsStage.__init__-27"><span class="linenos">27</span></a>        <span class="n">Stage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="UpdateFieldsStage.__init__-28"><a href="#UpdateFieldsStage.__init__-28"><span class="linenos">28</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-29"><a href="#UpdateFieldsStage.__init__-29"><span class="linenos">29</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-30"><a href="#UpdateFieldsStage.__init__-30"><span class="linenos">30</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-31"><a href="#UpdateFieldsStage.__init__-31"><span class="linenos">31</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-32"><a href="#UpdateFieldsStage.__init__-32"><span class="linenos">32</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="UpdateFieldsStage.__init__-33"><a href="#UpdateFieldsStage.__init__-33"><span class="linenos">33</span></a>        <span class="p">)</span>
</span><span id="UpdateFieldsStage.__init__-34"><a href="#UpdateFieldsStage.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#UpdateFieldsStage">UpdateFieldsStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (dict[str, Union[Callable[[Any], Any], Any]]):</strong>  Mapping from keys to new value or callable that takes old value as an argument and returns new value. Key must be found in original record if using callable.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="UpdateFieldsStage.process_record" class="classattr">
                                        <input id="UpdateFieldsStage.process_record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>:</span></span>

                <label class="view-source-button" for="UpdateFieldsStage.process_record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UpdateFieldsStage.process_record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UpdateFieldsStage.process_record-36"><a href="#UpdateFieldsStage.process_record-36"><span class="linenos">36</span></a>    <span class="k">def</span> <span class="nf">process_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Record</span><span class="p">:</span>
</span><span id="UpdateFieldsStage.process_record-37"><a href="#UpdateFieldsStage.process_record-37"><span class="linenos">37</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="UpdateFieldsStage.process_record-38"><a href="#UpdateFieldsStage.process_record-38"><span class="linenos">38</span></a>            <span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
</span><span id="UpdateFieldsStage.process_record-39"><a href="#UpdateFieldsStage.process_record-39"><span class="linenos">39</span></a>        <span class="k">return</span> <span class="n">record</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="UpdateFieldsStage.unique_name" class="variable">unique_name</dd>
                <dd id="UpdateFieldsStage.pipeline" class="variable">pipeline</dd>
                <dd id="UpdateFieldsStage.add_downstream" class="function">add_downstream</dd>
                <dd id="UpdateFieldsStage.add_upstream" class="function">add_upstream</dd>
                <dd id="UpdateFieldsStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="UpdateFieldsStage.channels" class="variable">channels</dd>
                <dd id="UpdateFieldsStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="UpdateFieldsStage.log" class="variable">log</dd>
                <dd id="UpdateFieldsStage.reset_level" class="function">reset_level</dd>
                <dd id="UpdateFieldsStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ValidateUrlStage">
                            <input id="ValidateUrlStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ValidateUrlStage</span><wbr>(<span class="base">cluo.extensions.field_processor_stage.FieldProcessorStage</span>):

                <label class="view-source-button" for="ValidateUrlStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValidateUrlStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValidateUrlStage-10"><a href="#ValidateUrlStage-10"><span class="linenos">10</span></a><span class="k">class</span> <span class="nc">ValidateUrlStage</span><span class="p">(</span><span class="n">FieldProcessorStage</span><span class="p">):</span>
</span><span id="ValidateUrlStage-11"><a href="#ValidateUrlStage-11"><span class="linenos">11</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set field(s) to None if URL does not exist, else do nothing.&quot;&quot;&quot;</span>
</span><span id="ValidateUrlStage-12"><a href="#ValidateUrlStage-12"><span class="linenos">12</span></a>
</span><span id="ValidateUrlStage-13"><a href="#ValidateUrlStage-13"><span class="linenos">13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ValidateUrlStage-14"><a href="#ValidateUrlStage-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ValidateUrlStage-15"><a href="#ValidateUrlStage-15"><span class="linenos">15</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ValidateUrlStage-16"><a href="#ValidateUrlStage-16"><span class="linenos">16</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ValidateUrlStage-17"><a href="#ValidateUrlStage-17"><span class="linenos">17</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ValidateUrlStage-18"><a href="#ValidateUrlStage-18"><span class="linenos">18</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ValidateUrlStage-19"><a href="#ValidateUrlStage-19"><span class="linenos">19</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="ValidateUrlStage-20"><a href="#ValidateUrlStage-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ValidateUrlStage-21"><a href="#ValidateUrlStage-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValidateUrlStage-22"><a href="#ValidateUrlStage-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `ValidateUrlStage`.</span>
</span><span id="ValidateUrlStage-23"><a href="#ValidateUrlStage-23"><span class="linenos">23</span></a>
</span><span id="ValidateUrlStage-24"><a href="#ValidateUrlStage-24"><span class="linenos">24</span></a><span class="sd">        Args:</span>
</span><span id="ValidateUrlStage-25"><a href="#ValidateUrlStage-25"><span class="linenos">25</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="ValidateUrlStage-26"><a href="#ValidateUrlStage-26"><span class="linenos">26</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="ValidateUrlStage-27"><a href="#ValidateUrlStage-27"><span class="linenos">27</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="ValidateUrlStage-28"><a href="#ValidateUrlStage-28"><span class="linenos">28</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="ValidateUrlStage-29"><a href="#ValidateUrlStage-29"><span class="linenos">29</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="ValidateUrlStage-30"><a href="#ValidateUrlStage-30"><span class="linenos">30</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="ValidateUrlStage-31"><a href="#ValidateUrlStage-31"><span class="linenos">31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValidateUrlStage-32"><a href="#ValidateUrlStage-32"><span class="linenos">32</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ValidateUrlStage-33"><a href="#ValidateUrlStage-33"><span class="linenos">33</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="ValidateUrlStage-34"><a href="#ValidateUrlStage-34"><span class="linenos">34</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="ValidateUrlStage-35"><a href="#ValidateUrlStage-35"><span class="linenos">35</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="ValidateUrlStage-36"><a href="#ValidateUrlStage-36"><span class="linenos">36</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="ValidateUrlStage-37"><a href="#ValidateUrlStage-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="ValidateUrlStage-38"><a href="#ValidateUrlStage-38"><span class="linenos">38</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="ValidateUrlStage-39"><a href="#ValidateUrlStage-39"><span class="linenos">39</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="ValidateUrlStage-40"><a href="#ValidateUrlStage-40"><span class="linenos">40</span></a>        <span class="p">)</span>
</span><span id="ValidateUrlStage-41"><a href="#ValidateUrlStage-41"><span class="linenos">41</span></a>
</span><span id="ValidateUrlStage-42"><a href="#ValidateUrlStage-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="nf">_page_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ValidateUrlStage-43"><a href="#ValidateUrlStage-43"><span class="linenos">43</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ValidateUrlStage-44"><a href="#ValidateUrlStage-44"><span class="linenos">44</span></a>            <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</span><span id="ValidateUrlStage-45"><a href="#ValidateUrlStage-45"><span class="linenos">45</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">:</span>
</span><span id="ValidateUrlStage-46"><a href="#ValidateUrlStage-46"><span class="linenos">46</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ValidateUrlStage-47"><a href="#ValidateUrlStage-47"><span class="linenos">47</span></a>
</span><span id="ValidateUrlStage-48"><a href="#ValidateUrlStage-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="ValidateUrlStage-49"><a href="#ValidateUrlStage-49"><span class="linenos">49</span></a>        <span class="k">return</span> <span class="n">field_value</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_page_exists</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Set field(s) to None if URL does not exist, else do nothing.</p>
</div>


                            <div id="ValidateUrlStage.__init__" class="classattr">
                                        <input id="ValidateUrlStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ValidateUrlStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="ValidateUrlStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValidateUrlStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValidateUrlStage.__init__-13"><a href="#ValidateUrlStage.__init__-13"><span class="linenos">13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ValidateUrlStage.__init__-14"><a href="#ValidateUrlStage.__init__-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-15"><a href="#ValidateUrlStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-16"><a href="#ValidateUrlStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-17"><a href="#ValidateUrlStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-18"><a href="#ValidateUrlStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-19"><a href="#ValidateUrlStage.__init__-19"><span class="linenos">19</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-20"><a href="#ValidateUrlStage.__init__-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-21"><a href="#ValidateUrlStage.__init__-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValidateUrlStage.__init__-22"><a href="#ValidateUrlStage.__init__-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `ValidateUrlStage`.</span>
</span><span id="ValidateUrlStage.__init__-23"><a href="#ValidateUrlStage.__init__-23"><span class="linenos">23</span></a>
</span><span id="ValidateUrlStage.__init__-24"><a href="#ValidateUrlStage.__init__-24"><span class="linenos">24</span></a><span class="sd">        Args:</span>
</span><span id="ValidateUrlStage.__init__-25"><a href="#ValidateUrlStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="ValidateUrlStage.__init__-26"><a href="#ValidateUrlStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="ValidateUrlStage.__init__-27"><a href="#ValidateUrlStage.__init__-27"><span class="linenos">27</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="ValidateUrlStage.__init__-28"><a href="#ValidateUrlStage.__init__-28"><span class="linenos">28</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="ValidateUrlStage.__init__-29"><a href="#ValidateUrlStage.__init__-29"><span class="linenos">29</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="ValidateUrlStage.__init__-30"><a href="#ValidateUrlStage.__init__-30"><span class="linenos">30</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="ValidateUrlStage.__init__-31"><a href="#ValidateUrlStage.__init__-31"><span class="linenos">31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValidateUrlStage.__init__-32"><a href="#ValidateUrlStage.__init__-32"><span class="linenos">32</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ValidateUrlStage.__init__-33"><a href="#ValidateUrlStage.__init__-33"><span class="linenos">33</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-34"><a href="#ValidateUrlStage.__init__-34"><span class="linenos">34</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-35"><a href="#ValidateUrlStage.__init__-35"><span class="linenos">35</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-36"><a href="#ValidateUrlStage.__init__-36"><span class="linenos">36</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-37"><a href="#ValidateUrlStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-38"><a href="#ValidateUrlStage.__init__-38"><span class="linenos">38</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-39"><a href="#ValidateUrlStage.__init__-39"><span class="linenos">39</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="ValidateUrlStage.__init__-40"><a href="#ValidateUrlStage.__init__-40"><span class="linenos">40</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#ValidateUrlStage">ValidateUrlStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (Iterable[str], optional):</strong>  Fields to operate on. Will operate on all fields if not set (None).</li>
<li><strong>allow_nulls (bool, optional):</strong>  Allow null values/fields if True, otherwise use error_handling_method</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="ValidateUrlStage.process_field" class="classattr">
                                        <input id="ValidateUrlStage.process_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="ValidateUrlStage.process_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValidateUrlStage.process_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValidateUrlStage.process_field-48"><a href="#ValidateUrlStage.process_field-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="ValidateUrlStage.process_field-49"><a href="#ValidateUrlStage.process_field-49"><span class="linenos">49</span></a>        <span class="k">return</span> <span class="n">field_value</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_page_exists</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.extensions.field_processor_stage.FieldProcessorStage</dt>
                                <dd id="ValidateUrlStage.process_record" class="function">process_record</dd>

            </div>
            <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="ValidateUrlStage.unique_name" class="variable">unique_name</dd>
                <dd id="ValidateUrlStage.pipeline" class="variable">pipeline</dd>
                <dd id="ValidateUrlStage.add_downstream" class="function">add_downstream</dd>
                <dd id="ValidateUrlStage.add_upstream" class="function">add_upstream</dd>
                <dd id="ValidateUrlStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="ValidateUrlStage.channels" class="variable">channels</dd>
                <dd id="ValidateUrlStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="ValidateUrlStage.log" class="variable">log</dd>
                <dd id="ValidateUrlStage.reset_level" class="function">reset_level</dd>
                <dd id="ValidateUrlStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="WhitespaceTrimmerStage">
                            <input id="WhitespaceTrimmerStage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WhitespaceTrimmerStage</span><wbr>(<span class="base">cluo.extensions.field_processor_stage.FieldProcessorStage</span>):

                <label class="view-source-button" for="WhitespaceTrimmerStage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WhitespaceTrimmerStage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WhitespaceTrimmerStage-8"><a href="#WhitespaceTrimmerStage-8"><span class="linenos"> 8</span></a><span class="k">class</span> <span class="nc">WhitespaceTrimmerStage</span><span class="p">(</span><span class="n">FieldProcessorStage</span><span class="p">):</span>
</span><span id="WhitespaceTrimmerStage-9"><a href="#WhitespaceTrimmerStage-9"><span class="linenos"> 9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove whitespace from start and end of string fields.&quot;&quot;&quot;</span>
</span><span id="WhitespaceTrimmerStage-10"><a href="#WhitespaceTrimmerStage-10"><span class="linenos">10</span></a>
</span><span id="WhitespaceTrimmerStage-11"><a href="#WhitespaceTrimmerStage-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="WhitespaceTrimmerStage-12"><a href="#WhitespaceTrimmerStage-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-13"><a href="#WhitespaceTrimmerStage-13"><span class="linenos">13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-14"><a href="#WhitespaceTrimmerStage-14"><span class="linenos">14</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-15"><a href="#WhitespaceTrimmerStage-15"><span class="linenos">15</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-16"><a href="#WhitespaceTrimmerStage-16"><span class="linenos">16</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-17"><a href="#WhitespaceTrimmerStage-17"><span class="linenos">17</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-18"><a href="#WhitespaceTrimmerStage-18"><span class="linenos">18</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-19"><a href="#WhitespaceTrimmerStage-19"><span class="linenos">19</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WhitespaceTrimmerStage-20"><a href="#WhitespaceTrimmerStage-20"><span class="linenos">20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize `WhitespaceTrimmerStage`.</span>
</span><span id="WhitespaceTrimmerStage-21"><a href="#WhitespaceTrimmerStage-21"><span class="linenos">21</span></a>
</span><span id="WhitespaceTrimmerStage-22"><a href="#WhitespaceTrimmerStage-22"><span class="linenos">22</span></a><span class="sd">        Args:</span>
</span><span id="WhitespaceTrimmerStage-23"><a href="#WhitespaceTrimmerStage-23"><span class="linenos">23</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="WhitespaceTrimmerStage-24"><a href="#WhitespaceTrimmerStage-24"><span class="linenos">24</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="WhitespaceTrimmerStage-25"><a href="#WhitespaceTrimmerStage-25"><span class="linenos">25</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="WhitespaceTrimmerStage-26"><a href="#WhitespaceTrimmerStage-26"><span class="linenos">26</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="WhitespaceTrimmerStage-27"><a href="#WhitespaceTrimmerStage-27"><span class="linenos">27</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="WhitespaceTrimmerStage-28"><a href="#WhitespaceTrimmerStage-28"><span class="linenos">28</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="WhitespaceTrimmerStage-29"><a href="#WhitespaceTrimmerStage-29"><span class="linenos">29</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WhitespaceTrimmerStage-30"><a href="#WhitespaceTrimmerStage-30"><span class="linenos">30</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="WhitespaceTrimmerStage-31"><a href="#WhitespaceTrimmerStage-31"><span class="linenos">31</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-32"><a href="#WhitespaceTrimmerStage-32"><span class="linenos">32</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-33"><a href="#WhitespaceTrimmerStage-33"><span class="linenos">33</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-34"><a href="#WhitespaceTrimmerStage-34"><span class="linenos">34</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-35"><a href="#WhitespaceTrimmerStage-35"><span class="linenos">35</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-36"><a href="#WhitespaceTrimmerStage-36"><span class="linenos">36</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-37"><a href="#WhitespaceTrimmerStage-37"><span class="linenos">37</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage-38"><a href="#WhitespaceTrimmerStage-38"><span class="linenos">38</span></a>        <span class="p">)</span>
</span><span id="WhitespaceTrimmerStage-39"><a href="#WhitespaceTrimmerStage-39"><span class="linenos">39</span></a>
</span><span id="WhitespaceTrimmerStage-40"><a href="#WhitespaceTrimmerStage-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="WhitespaceTrimmerStage-41"><a href="#WhitespaceTrimmerStage-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="n">field_value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Remove whitespace from start and end of string fields.</p>
</div>


                            <div id="WhitespaceTrimmerStage.__init__" class="classattr">
                                        <input id="WhitespaceTrimmerStage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">WhitespaceTrimmerStage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="WhitespaceTrimmerStage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WhitespaceTrimmerStage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WhitespaceTrimmerStage.__init__-11"><a href="#WhitespaceTrimmerStage.__init__-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="WhitespaceTrimmerStage.__init__-12"><a href="#WhitespaceTrimmerStage.__init__-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-13"><a href="#WhitespaceTrimmerStage.__init__-13"><span class="linenos">13</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-14"><a href="#WhitespaceTrimmerStage.__init__-14"><span class="linenos">14</span></a>        <span class="n">allow_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-15"><a href="#WhitespaceTrimmerStage.__init__-15"><span class="linenos">15</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-16"><a href="#WhitespaceTrimmerStage.__init__-16"><span class="linenos">16</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-17"><a href="#WhitespaceTrimmerStage.__init__-17"><span class="linenos">17</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-18"><a href="#WhitespaceTrimmerStage.__init__-18"><span class="linenos">18</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-19"><a href="#WhitespaceTrimmerStage.__init__-19"><span class="linenos">19</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WhitespaceTrimmerStage.__init__-20"><a href="#WhitespaceTrimmerStage.__init__-20"><span class="linenos">20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize `WhitespaceTrimmerStage`.</span>
</span><span id="WhitespaceTrimmerStage.__init__-21"><a href="#WhitespaceTrimmerStage.__init__-21"><span class="linenos">21</span></a>
</span><span id="WhitespaceTrimmerStage.__init__-22"><a href="#WhitespaceTrimmerStage.__init__-22"><span class="linenos">22</span></a><span class="sd">        Args:</span>
</span><span id="WhitespaceTrimmerStage.__init__-23"><a href="#WhitespaceTrimmerStage.__init__-23"><span class="linenos">23</span></a><span class="sd">            fields (Iterable[str], optional): Fields to operate on. Will operate on all fields if not set (None).</span>
</span><span id="WhitespaceTrimmerStage.__init__-24"><a href="#WhitespaceTrimmerStage.__init__-24"><span class="linenos">24</span></a><span class="sd">            allow_nulls (bool, optional): Allow null values/fields if True, otherwise use error_handling_method</span>
</span><span id="WhitespaceTrimmerStage.__init__-25"><a href="#WhitespaceTrimmerStage.__init__-25"><span class="linenos">25</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="WhitespaceTrimmerStage.__init__-26"><a href="#WhitespaceTrimmerStage.__init__-26"><span class="linenos">26</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="WhitespaceTrimmerStage.__init__-27"><a href="#WhitespaceTrimmerStage.__init__-27"><span class="linenos">27</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="WhitespaceTrimmerStage.__init__-28"><a href="#WhitespaceTrimmerStage.__init__-28"><span class="linenos">28</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this stage. Defaults to False.</span>
</span><span id="WhitespaceTrimmerStage.__init__-29"><a href="#WhitespaceTrimmerStage.__init__-29"><span class="linenos">29</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WhitespaceTrimmerStage.__init__-30"><a href="#WhitespaceTrimmerStage.__init__-30"><span class="linenos">30</span></a>        <span class="n">FieldProcessorStage</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="WhitespaceTrimmerStage.__init__-31"><a href="#WhitespaceTrimmerStage.__init__-31"><span class="linenos">31</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-32"><a href="#WhitespaceTrimmerStage.__init__-32"><span class="linenos">32</span></a>            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-33"><a href="#WhitespaceTrimmerStage.__init__-33"><span class="linenos">33</span></a>            <span class="n">allow_nulls</span><span class="o">=</span><span class="n">allow_nulls</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-34"><a href="#WhitespaceTrimmerStage.__init__-34"><span class="linenos">34</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-35"><a href="#WhitespaceTrimmerStage.__init__-35"><span class="linenos">35</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-36"><a href="#WhitespaceTrimmerStage.__init__-36"><span class="linenos">36</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-37"><a href="#WhitespaceTrimmerStage.__init__-37"><span class="linenos">37</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="WhitespaceTrimmerStage.__init__-38"><a href="#WhitespaceTrimmerStage.__init__-38"><span class="linenos">38</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize <code><a href="#WhitespaceTrimmerStage">WhitespaceTrimmerStage</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fields (Iterable[str], optional):</strong>  Fields to operate on. Will operate on all fields if not set (None).</li>
<li><strong>allow_nulls (bool, optional):</strong>  Allow null values/fields if True, otherwise use error_handling_method</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this stage. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="WhitespaceTrimmerStage.process_field" class="classattr">
                                        <input id="WhitespaceTrimmerStage.process_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="WhitespaceTrimmerStage.process_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WhitespaceTrimmerStage.process_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WhitespaceTrimmerStage.process_field-40"><a href="#WhitespaceTrimmerStage.process_field-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="nf">process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="WhitespaceTrimmerStage.process_field-41"><a href="#WhitespaceTrimmerStage.process_field-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="n">field_value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.extensions.field_processor_stage.FieldProcessorStage</dt>
                                <dd id="WhitespaceTrimmerStage.process_record" class="function">process_record</dd>

            </div>
            <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="WhitespaceTrimmerStage.unique_name" class="variable">unique_name</dd>
                <dd id="WhitespaceTrimmerStage.pipeline" class="variable">pipeline</dd>
                <dd id="WhitespaceTrimmerStage.add_downstream" class="function">add_downstream</dd>
                <dd id="WhitespaceTrimmerStage.add_upstream" class="function">add_upstream</dd>
                <dd id="WhitespaceTrimmerStage.get_downstreams" class="function">get_downstreams</dd>
                <dd id="WhitespaceTrimmerStage.channels" class="variable">channels</dd>
                <dd id="WhitespaceTrimmerStage.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="WhitespaceTrimmerStage.log" class="variable">log</dd>
                <dd id="WhitespaceTrimmerStage.reset_level" class="function">reset_level</dd>
                <dd id="WhitespaceTrimmerStage.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>