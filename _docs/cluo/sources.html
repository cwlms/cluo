<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.1"/>
    <title>cluo.sources API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../cluo.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;cluo</a>

            <img src="https://static.wikia.nocookie.net/newersupermariobroswii/images/b/bf/Warp_pipe.png/revision/latest/scale-to-width-down/200?cb=20181227070915" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#DummySource">DummySource</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DummySource.__init__">DummySource</a>
                        </li>
                        <li>
                                <a class="function" href="#DummySource.process_batch">process_batch</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#KafkaSource">KafkaSource</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#KafkaSource.__init__">KafkaSource</a>
                        </li>
                        <li>
                                <a class="function" href="#KafkaSource.process_batch">process_batch</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#KafkaAvroSource">KafkaAvroSource</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#KafkaAvroSource.__init__">KafkaAvroSource</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PostgresSelectSource">PostgresSelectSource</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PostgresSelectSource.__init__">PostgresSelectSource</a>
                        </li>
                        <li>
                                <a class="function" href="#PostgresSelectSource.process_batch">process_batch</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SalesforceReflowSource">SalesforceReflowSource</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SalesforceReflowSource.__init__">SalesforceReflowSource</a>
                        </li>
                        <li>
                                <a class="function" href="#SalesforceReflowSource.process_batch">process_batch</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SalesforceSelectSource">SalesforceSelectSource</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SalesforceSelectSource.__init__">SalesforceSelectSource</a>
                        </li>
                        <li>
                                <a class="function" href="#SalesforceSelectSource.process_batch">process_batch</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../cluo.html">cluo</a><wbr>.sources    </h1>

                
                        <input id="mod-sources-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-sources-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">from</span> <span class="nn">.dummy</span> <span class="kn">import</span> <span class="n">DummySource</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="kn">from</span> <span class="nn">.kafka</span> <span class="kn">import</span> <span class="n">KafkaAvroSource</span><span class="p">,</span> <span class="n">KafkaSource</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span> <span class="nn">.postgres_select</span> <span class="kn">import</span> <span class="n">PostgresSelectSource</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span> <span class="nn">.salesforce_reflow</span> <span class="kn">import</span> <span class="n">SalesforceReflowSource</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span> <span class="nn">.salesforce_select</span> <span class="kn">import</span> <span class="n">SalesforceSelectSource</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>    <span class="s2">&quot;DummySource&quot;</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>    <span class="s2">&quot;KafkaSource&quot;</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>    <span class="s2">&quot;KafkaAvroSource&quot;</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>    <span class="s2">&quot;PostgresSelectSource&quot;</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>    <span class="s2">&quot;SalesforceReflowSource&quot;</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>    <span class="s2">&quot;SalesforceSelectSource&quot;</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="DummySource">
                            <input id="DummySource-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DummySource</span><wbr>(<span class="base">cluo.core.source.Source</span>):

                <label class="view-source-button" for="DummySource-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DummySource"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DummySource-9"><a href="#DummySource-9"><span class="linenos"> 9</span></a><span class="k">class</span> <span class="nc">DummySource</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
</span><span id="DummySource-10"><a href="#DummySource-10"><span class="linenos">10</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Allows user to create arbitrary records in a batch for processing. Typically used for development and testing.&quot;&quot;&quot;</span>
</span><span id="DummySource-11"><a href="#DummySource-11"><span class="linenos">11</span></a>
</span><span id="DummySource-12"><a href="#DummySource-12"><span class="linenos">12</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DummySource-13"><a href="#DummySource-13"><span class="linenos">13</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DummySource-14"><a href="#DummySource-14"><span class="linenos">14</span></a>        <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">,</span>
</span><span id="DummySource-15"><a href="#DummySource-15"><span class="linenos">15</span></a>        <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="DummySource-16"><a href="#DummySource-16"><span class="linenos">16</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DummySource-17"><a href="#DummySource-17"><span class="linenos">17</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DummySource-18"><a href="#DummySource-18"><span class="linenos">18</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DummySource-19"><a href="#DummySource-19"><span class="linenos">19</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="DummySource-20"><a href="#DummySource-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DummySource-21"><a href="#DummySource-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DummySource-22"><a href="#DummySource-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `DummySource`.</span>
</span><span id="DummySource-23"><a href="#DummySource-23"><span class="linenos">23</span></a>
</span><span id="DummySource-24"><a href="#DummySource-24"><span class="linenos">24</span></a><span class="sd">        Args:</span>
</span><span id="DummySource-25"><a href="#DummySource-25"><span class="linenos">25</span></a><span class="sd">            record (Record): The record to use for each batch. This record will appear `batch_size` times in each batch returned by `DummySource.process_batch`.</span>
</span><span id="DummySource-26"><a href="#DummySource-26"><span class="linenos">26</span></a><span class="sd">            batch_size (int, optional): Number of records to include in batch. Defaults to 10.</span>
</span><span id="DummySource-27"><a href="#DummySource-27"><span class="linenos">27</span></a><span class="sd">            delay (int, optional): Seconds to wait before returning a new batch for processing in the pipeline. Simulates I/O lag. Defaults to 1.</span>
</span><span id="DummySource-28"><a href="#DummySource-28"><span class="linenos">28</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="DummySource-29"><a href="#DummySource-29"><span class="linenos">29</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="DummySource-30"><a href="#DummySource-30"><span class="linenos">30</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="DummySource-31"><a href="#DummySource-31"><span class="linenos">31</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="DummySource-32"><a href="#DummySource-32"><span class="linenos">32</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DummySource-33"><a href="#DummySource-33"><span class="linenos">33</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DummySource-34"><a href="#DummySource-34"><span class="linenos">34</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DummySource-35"><a href="#DummySource-35"><span class="linenos">35</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="DummySource-36"><a href="#DummySource-36"><span class="linenos">36</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="DummySource-37"><a href="#DummySource-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="DummySource-38"><a href="#DummySource-38"><span class="linenos">38</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="DummySource-39"><a href="#DummySource-39"><span class="linenos">39</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="DummySource-40"><a href="#DummySource-40"><span class="linenos">40</span></a>        <span class="p">)</span>
</span><span id="DummySource-41"><a href="#DummySource-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="n">record</span>
</span><span id="DummySource-42"><a href="#DummySource-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span>
</span><span id="DummySource-43"><a href="#DummySource-43"><span class="linenos">43</span></a>
</span><span id="DummySource-44"><a href="#DummySource-44"><span class="linenos">44</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="DummySource-45"><a href="#DummySource-45"><span class="linenos">45</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span>
</span><span id="DummySource-46"><a href="#DummySource-46"><span class="linenos">46</span></a>        <span class="k">return</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="DummySource-47"><a href="#DummySource-47"><span class="linenos">47</span></a>            <span class="n">records</span><span class="o">=</span><span class="p">[</span>
</span><span id="DummySource-48"><a href="#DummySource-48"><span class="linenos">48</span></a>                <span class="n">Record</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="DummySource-49"><a href="#DummySource-49"><span class="linenos">49</span></a>            <span class="p">]</span>
</span><span id="DummySource-50"><a href="#DummySource-50"><span class="linenos">50</span></a>        <span class="p">)</span>
</span><span id="DummySource-51"><a href="#DummySource-51"><span class="linenos">51</span></a>
</span><span id="DummySource-52"><a href="#DummySource-52"><span class="linenos">52</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DummySource-53"><a href="#DummySource-53"><span class="linenos">53</span></a>        <span class="k">pass</span>
</span><span id="DummySource-54"><a href="#DummySource-54"><span class="linenos">54</span></a>
</span><span id="DummySource-55"><a href="#DummySource-55"><span class="linenos">55</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
</span><span id="DummySource-56"><a href="#DummySource-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DummySource-57"><a href="#DummySource-57"><span class="linenos">57</span></a>        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DummySource-58"><a href="#DummySource-58"><span class="linenos">58</span></a>        <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DummySource-59"><a href="#DummySource-59"><span class="linenos">59</span></a>        <span class="n">exc_tb</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DummySource-60"><a href="#DummySource-60"><span class="linenos">60</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DummySource-61"><a href="#DummySource-61"><span class="linenos">61</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Allows user to create arbitrary records in a batch for processing. Typically used for development and testing.</p>
</div>


                            <div id="DummySource.__init__" class="classattr">
                                        <input id="DummySource.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DummySource</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">record</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">Record</span>,</span><span class="param">	<span class="n">delay</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="DummySource.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DummySource.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DummySource.__init__-12"><a href="#DummySource.__init__-12"><span class="linenos">12</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DummySource.__init__-13"><a href="#DummySource.__init__-13"><span class="linenos">13</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DummySource.__init__-14"><a href="#DummySource.__init__-14"><span class="linenos">14</span></a>        <span class="n">record</span><span class="p">:</span> <span class="n">Record</span><span class="p">,</span>
</span><span id="DummySource.__init__-15"><a href="#DummySource.__init__-15"><span class="linenos">15</span></a>        <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="DummySource.__init__-16"><a href="#DummySource.__init__-16"><span class="linenos">16</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DummySource.__init__-17"><a href="#DummySource.__init__-17"><span class="linenos">17</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DummySource.__init__-18"><a href="#DummySource.__init__-18"><span class="linenos">18</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DummySource.__init__-19"><a href="#DummySource.__init__-19"><span class="linenos">19</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="DummySource.__init__-20"><a href="#DummySource.__init__-20"><span class="linenos">20</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DummySource.__init__-21"><a href="#DummySource.__init__-21"><span class="linenos">21</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DummySource.__init__-22"><a href="#DummySource.__init__-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `DummySource`.</span>
</span><span id="DummySource.__init__-23"><a href="#DummySource.__init__-23"><span class="linenos">23</span></a>
</span><span id="DummySource.__init__-24"><a href="#DummySource.__init__-24"><span class="linenos">24</span></a><span class="sd">        Args:</span>
</span><span id="DummySource.__init__-25"><a href="#DummySource.__init__-25"><span class="linenos">25</span></a><span class="sd">            record (Record): The record to use for each batch. This record will appear `batch_size` times in each batch returned by `DummySource.process_batch`.</span>
</span><span id="DummySource.__init__-26"><a href="#DummySource.__init__-26"><span class="linenos">26</span></a><span class="sd">            batch_size (int, optional): Number of records to include in batch. Defaults to 10.</span>
</span><span id="DummySource.__init__-27"><a href="#DummySource.__init__-27"><span class="linenos">27</span></a><span class="sd">            delay (int, optional): Seconds to wait before returning a new batch for processing in the pipeline. Simulates I/O lag. Defaults to 1.</span>
</span><span id="DummySource.__init__-28"><a href="#DummySource.__init__-28"><span class="linenos">28</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="DummySource.__init__-29"><a href="#DummySource.__init__-29"><span class="linenos">29</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="DummySource.__init__-30"><a href="#DummySource.__init__-30"><span class="linenos">30</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="DummySource.__init__-31"><a href="#DummySource.__init__-31"><span class="linenos">31</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="DummySource.__init__-32"><a href="#DummySource.__init__-32"><span class="linenos">32</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DummySource.__init__-33"><a href="#DummySource.__init__-33"><span class="linenos">33</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DummySource.__init__-34"><a href="#DummySource.__init__-34"><span class="linenos">34</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DummySource.__init__-35"><a href="#DummySource.__init__-35"><span class="linenos">35</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="DummySource.__init__-36"><a href="#DummySource.__init__-36"><span class="linenos">36</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="DummySource.__init__-37"><a href="#DummySource.__init__-37"><span class="linenos">37</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="DummySource.__init__-38"><a href="#DummySource.__init__-38"><span class="linenos">38</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="DummySource.__init__-39"><a href="#DummySource.__init__-39"><span class="linenos">39</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="DummySource.__init__-40"><a href="#DummySource.__init__-40"><span class="linenos">40</span></a>        <span class="p">)</span>
</span><span id="DummySource.__init__-41"><a href="#DummySource.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="n">record</span>
</span><span id="DummySource.__init__-42"><a href="#DummySource.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#DummySource">DummySource</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>record (Record):</strong>  The record to use for each batch. This record will appear <code>batch_size</code> times in each batch returned by <code><a href="#DummySource.process_batch">DummySource.process_batch</a></code>.</li>
<li><strong>batch_size (int, optional):</strong>  Number of records to include in batch. Defaults to 10.</li>
<li><strong>delay (int, optional):</strong>  Seconds to wait before returning a new batch for processing in the pipeline. Simulates I/O lag. Defaults to 1.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this source. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="DummySource.process_batch" class="classattr">
                                        <input id="DummySource.process_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_batch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span>:</span></span>

                <label class="view-source-button" for="DummySource.process_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DummySource.process_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DummySource.process_batch-44"><a href="#DummySource.process_batch-44"><span class="linenos">44</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="DummySource.process_batch-45"><a href="#DummySource.process_batch-45"><span class="linenos">45</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span>
</span><span id="DummySource.process_batch-46"><a href="#DummySource.process_batch-46"><span class="linenos">46</span></a>        <span class="k">return</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="DummySource.process_batch-47"><a href="#DummySource.process_batch-47"><span class="linenos">47</span></a>            <span class="n">records</span><span class="o">=</span><span class="p">[</span>
</span><span id="DummySource.process_batch-48"><a href="#DummySource.process_batch-48"><span class="linenos">48</span></a>                <span class="n">Record</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="DummySource.process_batch-49"><a href="#DummySource.process_batch-49"><span class="linenos">49</span></a>            <span class="p">]</span>
</span><span id="DummySource.process_batch-50"><a href="#DummySource.process_batch-50"><span class="linenos">50</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="DummySource.unique_name" class="variable">unique_name</dd>
                <dd id="DummySource.pipeline" class="variable">pipeline</dd>
                <dd id="DummySource.add_downstream" class="function">add_downstream</dd>
                <dd id="DummySource.add_upstream" class="function">add_upstream</dd>
                <dd id="DummySource.get_downstreams" class="function">get_downstreams</dd>
                <dd id="DummySource.channels" class="variable">channels</dd>
                <dd id="DummySource.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="DummySource.log" class="variable">log</dd>
                <dd id="DummySource.reset_level" class="function">reset_level</dd>
                <dd id="DummySource.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="KafkaSource">
                            <input id="KafkaSource-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KafkaSource</span><wbr>(<span class="base">cluo.core.source.Source</span>):

                <label class="view-source-button" for="KafkaSource-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KafkaSource"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KafkaSource-51"><a href="#KafkaSource-51"><span class="linenos"> 51</span></a><span class="k">class</span> <span class="nc">KafkaSource</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
</span><span id="KafkaSource-52"><a href="#KafkaSource-52"><span class="linenos"> 52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtains data from a Kafka topic.&quot;&quot;&quot;</span>
</span><span id="KafkaSource-53"><a href="#KafkaSource-53"><span class="linenos"> 53</span></a>
</span><span id="KafkaSource-54"><a href="#KafkaSource-54"><span class="linenos"> 54</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="KafkaSource-55"><a href="#KafkaSource-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KafkaSource-56"><a href="#KafkaSource-56"><span class="linenos"> 56</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="KafkaSource-57"><a href="#KafkaSource-57"><span class="linenos"> 57</span></a>        <span class="n">bootstrap_servers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_KAFKA_SERVER</span><span class="p">,</span>
</span><span id="KafkaSource-58"><a href="#KafkaSource-58"><span class="linenos"> 58</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaSource-59"><a href="#KafkaSource-59"><span class="linenos"> 59</span></a>        <span class="n">poll_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">,</span>
</span><span id="KafkaSource-60"><a href="#KafkaSource-60"><span class="linenos"> 60</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaSource-61"><a href="#KafkaSource-61"><span class="linenos"> 61</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="KafkaSource-62"><a href="#KafkaSource-62"><span class="linenos"> 62</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="KafkaSource-63"><a href="#KafkaSource-63"><span class="linenos"> 63</span></a>        <span class="n">group_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;KafkaSource&quot;</span><span class="p">,</span>
</span><span id="KafkaSource-64"><a href="#KafkaSource-64"><span class="linenos"> 64</span></a>        <span class="n">registry_server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_CONFLUENT_REGISTRY</span><span class="p">,</span>  <span class="c1"># kafka avro v1 parameter: DEPRECATED</span>
</span><span id="KafkaSource-65"><a href="#KafkaSource-65"><span class="linenos"> 65</span></a>        <span class="n">avro_schema_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># kafka avro v1 parameter: DEPRECATED</span>
</span><span id="KafkaSource-66"><a href="#KafkaSource-66"><span class="linenos"> 66</span></a>        <span class="n">avro_schema_version</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="KafkaSource-67"><a href="#KafkaSource-67"><span class="linenos"> 67</span></a>        <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;latest&quot;</span><span class="p">,</span>  <span class="c1"># kafka avro v1 parameter: DEPRECATED</span>
</span><span id="KafkaSource-68"><a href="#KafkaSource-68"><span class="linenos"> 68</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="KafkaSource-69"><a href="#KafkaSource-69"><span class="linenos"> 69</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KafkaSource-70"><a href="#KafkaSource-70"><span class="linenos"> 70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `KafkaSource`.</span>
</span><span id="KafkaSource-71"><a href="#KafkaSource-71"><span class="linenos"> 71</span></a>
</span><span id="KafkaSource-72"><a href="#KafkaSource-72"><span class="linenos"> 72</span></a><span class="sd">        Args:</span>
</span><span id="KafkaSource-73"><a href="#KafkaSource-73"><span class="linenos"> 73</span></a><span class="sd">            topics (list[str]): Topics from which to consume.</span>
</span><span id="KafkaSource-74"><a href="#KafkaSource-74"><span class="linenos"> 74</span></a><span class="sd">            bootstrap_servers (str): The Kafka server to connect to. Defaults to `&quot;localhost:9092&quot;`.</span>
</span><span id="KafkaSource-75"><a href="#KafkaSource-75"><span class="linenos"> 75</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch. Defaults to 10.</span>
</span><span id="KafkaSource-76"><a href="#KafkaSource-76"><span class="linenos"> 76</span></a><span class="sd">            poll_timeout (float): The number of seconds to continue polling kafka before timing out.</span>
</span><span id="KafkaSource-77"><a href="#KafkaSource-77"><span class="linenos"> 77</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="KafkaSource-78"><a href="#KafkaSource-78"><span class="linenos"> 78</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="KafkaSource-79"><a href="#KafkaSource-79"><span class="linenos"> 79</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="KafkaSource-80"><a href="#KafkaSource-80"><span class="linenos"> 80</span></a><span class="sd">            group_id (str, optional): Kafka consumer group id.  Defaults to `&quot;KafaSource&quot;`.</span>
</span><span id="KafkaSource-81"><a href="#KafkaSource-81"><span class="linenos"> 81</span></a><span class="sd">            registry_server (str, optional): DEPRECATED String used to get the avro schema from a url.  Used to decode messages in avro format.</span>
</span><span id="KafkaSource-82"><a href="#KafkaSource-82"><span class="linenos"> 82</span></a><span class="sd">            avro_schema_name(str, optional): DEPRECATED The Avro Schema name.  When this parameter is supplied the source expects all consumed messages to be in avro binary format.  Also known as the &quot;subject&quot; in the confluent registry server.  All consumed messages must use the same schema.</span>
</span><span id="KafkaSource-83"><a href="#KafkaSource-83"><span class="linenos"> 83</span></a><span class="sd">            avro_schema_version(str, optional): DEPRECATED The Avro Schema version.  All messages consumed must use the same version.  Defaults to &quot;latest&quot;  Only used when avro_schema_name is supplied.</span>
</span><span id="KafkaSource-84"><a href="#KafkaSource-84"><span class="linenos"> 84</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="KafkaSource-85"><a href="#KafkaSource-85"><span class="linenos"> 85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KafkaSource-86"><a href="#KafkaSource-86"><span class="linenos"> 86</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KafkaSource-87"><a href="#KafkaSource-87"><span class="linenos"> 87</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="KafkaSource-88"><a href="#KafkaSource-88"><span class="linenos"> 88</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="KafkaSource-89"><a href="#KafkaSource-89"><span class="linenos"> 89</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="KafkaSource-90"><a href="#KafkaSource-90"><span class="linenos"> 90</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="KafkaSource-91"><a href="#KafkaSource-91"><span class="linenos"> 91</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="KafkaSource-92"><a href="#KafkaSource-92"><span class="linenos"> 92</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="KafkaSource-93"><a href="#KafkaSource-93"><span class="linenos"> 93</span></a>        <span class="p">)</span>
</span><span id="KafkaSource-94"><a href="#KafkaSource-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conf</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KafkaSource-95"><a href="#KafkaSource-95"><span class="linenos"> 95</span></a>            <span class="s2">&quot;bootstrap.servers&quot;</span><span class="p">:</span> <span class="n">bootstrap_servers</span><span class="p">,</span>
</span><span id="KafkaSource-96"><a href="#KafkaSource-96"><span class="linenos"> 96</span></a>            <span class="s2">&quot;group.id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span>  <span class="c1"># TODO: self.unique_name()</span>
</span><span id="KafkaSource-97"><a href="#KafkaSource-97"><span class="linenos"> 97</span></a>            <span class="s2">&quot;enable.auto.commit&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="KafkaSource-98"><a href="#KafkaSource-98"><span class="linenos"> 98</span></a>            <span class="s2">&quot;auto.offset.reset&quot;</span><span class="p">:</span> <span class="s2">&quot;earliest&quot;</span><span class="p">,</span>
</span><span id="KafkaSource-99"><a href="#KafkaSource-99"><span class="linenos"> 99</span></a>        <span class="p">}</span>
</span><span id="KafkaSource-100"><a href="#KafkaSource-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span> <span class="o">=</span> <span class="n">topics</span>
</span><span id="KafkaSource-101"><a href="#KafkaSource-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="p">:</span> <span class="n">Consumer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KafkaSource-102"><a href="#KafkaSource-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">poll_timeout</span> <span class="o">=</span> <span class="n">poll_timeout</span>
</span><span id="KafkaSource-103"><a href="#KafkaSource-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_received_messages_since_last_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="KafkaSource-104"><a href="#KafkaSource-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avro_schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KafkaSource-105"><a href="#KafkaSource-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registry_server</span> <span class="o">=</span> <span class="n">registry_server</span>
</span><span id="KafkaSource-106"><a href="#KafkaSource-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avro_schema_name</span> <span class="o">=</span> <span class="n">avro_schema_name</span>
</span><span id="KafkaSource-107"><a href="#KafkaSource-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avro_schema_version</span> <span class="o">=</span> <span class="n">avro_schema_version</span>
</span><span id="KafkaSource-108"><a href="#KafkaSource-108"><span class="linenos">108</span></a>
</span><span id="KafkaSource-109"><a href="#KafkaSource-109"><span class="linenos">109</span></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KafkaSource-110"><a href="#KafkaSource-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="p">:</span>
</span><span id="KafkaSource-111"><a href="#KafkaSource-111"><span class="linenos">111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="KafkaSource-112"><a href="#KafkaSource-112"><span class="linenos">112</span></a>
</span><span id="KafkaSource-113"><a href="#KafkaSource-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KafkaSource-114"><a href="#KafkaSource-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="p">:</span>
</span><span id="KafkaSource-115"><a href="#KafkaSource-115"><span class="linenos">115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span> <span class="o">=</span> <span class="n">Consumer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span>
</span><span id="KafkaSource-116"><a href="#KafkaSource-116"><span class="linenos">116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span>
</span><span id="KafkaSource-117"><a href="#KafkaSource-117"><span class="linenos">117</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">avro_schema_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">avro_schema_version</span><span class="p">:</span>
</span><span id="KafkaSource-118"><a href="#KafkaSource-118"><span class="linenos">118</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">avro_schema</span> <span class="o">=</span> <span class="n">_get_avro_schema</span><span class="p">(</span>
</span><span id="KafkaSource-119"><a href="#KafkaSource-119"><span class="linenos">119</span></a>                    <span class="n">registry_server</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">registry_server</span><span class="p">,</span>
</span><span id="KafkaSource-120"><a href="#KafkaSource-120"><span class="linenos">120</span></a>                    <span class="n">subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">avro_schema_name</span><span class="p">,</span>
</span><span id="KafkaSource-121"><a href="#KafkaSource-121"><span class="linenos">121</span></a>                    <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">avro_schema_version</span><span class="p">,</span>
</span><span id="KafkaSource-122"><a href="#KafkaSource-122"><span class="linenos">122</span></a>                <span class="p">)</span>
</span><span id="KafkaSource-123"><a href="#KafkaSource-123"><span class="linenos">123</span></a>
</span><span id="KafkaSource-124"><a href="#KafkaSource-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
</span><span id="KafkaSource-125"><a href="#KafkaSource-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KafkaSource-126"><a href="#KafkaSource-126"><span class="linenos">126</span></a>        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaSource-127"><a href="#KafkaSource-127"><span class="linenos">127</span></a>        <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaSource-128"><a href="#KafkaSource-128"><span class="linenos">128</span></a>        <span class="n">exc_tb</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaSource-129"><a href="#KafkaSource-129"><span class="linenos">129</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="KafkaSource-130"><a href="#KafkaSource-130"><span class="linenos">130</span></a>        <span class="n">has_exception</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="KafkaSource-131"><a href="#KafkaSource-131"><span class="linenos">131</span></a>            <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">exc_tb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KafkaSource-132"><a href="#KafkaSource-132"><span class="linenos">132</span></a>        <span class="p">)</span>
</span><span id="KafkaSource-133"><a href="#KafkaSource-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="KafkaSource-134"><a href="#KafkaSource-134"><span class="linenos">134</span></a>            <span class="ow">not</span> <span class="n">has_exception</span>
</span><span id="KafkaSource-135"><a href="#KafkaSource-135"><span class="linenos">135</span></a>            <span class="ow">and</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">WRITE</span>
</span><span id="KafkaSource-136"><a href="#KafkaSource-136"><span class="linenos">136</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span>
</span><span id="KafkaSource-137"><a href="#KafkaSource-137"><span class="linenos">137</span></a>        <span class="p">):</span>
</span><span id="KafkaSource-138"><a href="#KafkaSource-138"><span class="linenos">138</span></a>            <span class="c1"># we can get an error if we try to commit after reading no messages.</span>
</span><span id="KafkaSource-139"><a href="#KafkaSource-139"><span class="linenos">139</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_received_messages_since_last_commit</span><span class="p">:</span>
</span><span id="KafkaSource-140"><a href="#KafkaSource-140"><span class="linenos">140</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">asynchronous</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="KafkaSource-141"><a href="#KafkaSource-141"><span class="linenos">141</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_received_messages_since_last_commit</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="KafkaSource-142"><a href="#KafkaSource-142"><span class="linenos">142</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="KafkaSource-143"><a href="#KafkaSource-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="KafkaSource-144"><a href="#KafkaSource-144"><span class="linenos">144</span></a>
</span><span id="KafkaSource-145"><a href="#KafkaSource-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="KafkaSource-146"><a href="#KafkaSource-146"><span class="linenos">146</span></a>        <span class="n">new_batch</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="KafkaSource-147"><a href="#KafkaSource-147"><span class="linenos">147</span></a>            <span class="n">records</span><span class="o">=</span><span class="n">_basic_consume_loop</span><span class="p">(</span>
</span><span id="KafkaSource-148"><a href="#KafkaSource-148"><span class="linenos">148</span></a>                <span class="n">consumer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="p">,</span>
</span><span id="KafkaSource-149"><a href="#KafkaSource-149"><span class="linenos">149</span></a>                <span class="n">num_messages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="KafkaSource-150"><a href="#KafkaSource-150"><span class="linenos">150</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">poll_timeout</span><span class="p">,</span>
</span><span id="KafkaSource-151"><a href="#KafkaSource-151"><span class="linenos">151</span></a>                <span class="n">avro_schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">avro_schema</span><span class="p">,</span>
</span><span id="KafkaSource-152"><a href="#KafkaSource-152"><span class="linenos">152</span></a>            <span class="p">)</span>
</span><span id="KafkaSource-153"><a href="#KafkaSource-153"><span class="linenos">153</span></a>        <span class="p">)</span>
</span><span id="KafkaSource-154"><a href="#KafkaSource-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_batch</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="KafkaSource-155"><a href="#KafkaSource-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_received_messages_since_last_commit</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="KafkaSource-156"><a href="#KafkaSource-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="n">new_batch</span>
</span></pre></div>


            <div class="docstring"><p>Obtains data from a Kafka topic.</p>
</div>


                            <div id="KafkaSource.__init__" class="classattr">
                                        <input id="KafkaSource.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">KafkaSource</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">bootstrap_servers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;localhost:9092&#39;</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">poll_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">group_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;KafkaSource&#39;</span>,</span><span class="param">	<span class="n">registry_server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;localhost:8081&#39;</span>,</span><span class="param">	<span class="n">avro_schema_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">avro_schema_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s1">&#39;latest&#39;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="KafkaSource.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KafkaSource.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KafkaSource.__init__-54"><a href="#KafkaSource.__init__-54"><span class="linenos"> 54</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="KafkaSource.__init__-55"><a href="#KafkaSource.__init__-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-56"><a href="#KafkaSource.__init__-56"><span class="linenos"> 56</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="KafkaSource.__init__-57"><a href="#KafkaSource.__init__-57"><span class="linenos"> 57</span></a>        <span class="n">bootstrap_servers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_KAFKA_SERVER</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-58"><a href="#KafkaSource.__init__-58"><span class="linenos"> 58</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-59"><a href="#KafkaSource.__init__-59"><span class="linenos"> 59</span></a>        <span class="n">poll_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-60"><a href="#KafkaSource.__init__-60"><span class="linenos"> 60</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-61"><a href="#KafkaSource.__init__-61"><span class="linenos"> 61</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-62"><a href="#KafkaSource.__init__-62"><span class="linenos"> 62</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-63"><a href="#KafkaSource.__init__-63"><span class="linenos"> 63</span></a>        <span class="n">group_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;KafkaSource&quot;</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-64"><a href="#KafkaSource.__init__-64"><span class="linenos"> 64</span></a>        <span class="n">registry_server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_CONFLUENT_REGISTRY</span><span class="p">,</span>  <span class="c1"># kafka avro v1 parameter: DEPRECATED</span>
</span><span id="KafkaSource.__init__-65"><a href="#KafkaSource.__init__-65"><span class="linenos"> 65</span></a>        <span class="n">avro_schema_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># kafka avro v1 parameter: DEPRECATED</span>
</span><span id="KafkaSource.__init__-66"><a href="#KafkaSource.__init__-66"><span class="linenos"> 66</span></a>        <span class="n">avro_schema_version</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="KafkaSource.__init__-67"><a href="#KafkaSource.__init__-67"><span class="linenos"> 67</span></a>        <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;latest&quot;</span><span class="p">,</span>  <span class="c1"># kafka avro v1 parameter: DEPRECATED</span>
</span><span id="KafkaSource.__init__-68"><a href="#KafkaSource.__init__-68"><span class="linenos"> 68</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-69"><a href="#KafkaSource.__init__-69"><span class="linenos"> 69</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KafkaSource.__init__-70"><a href="#KafkaSource.__init__-70"><span class="linenos"> 70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `KafkaSource`.</span>
</span><span id="KafkaSource.__init__-71"><a href="#KafkaSource.__init__-71"><span class="linenos"> 71</span></a>
</span><span id="KafkaSource.__init__-72"><a href="#KafkaSource.__init__-72"><span class="linenos"> 72</span></a><span class="sd">        Args:</span>
</span><span id="KafkaSource.__init__-73"><a href="#KafkaSource.__init__-73"><span class="linenos"> 73</span></a><span class="sd">            topics (list[str]): Topics from which to consume.</span>
</span><span id="KafkaSource.__init__-74"><a href="#KafkaSource.__init__-74"><span class="linenos"> 74</span></a><span class="sd">            bootstrap_servers (str): The Kafka server to connect to. Defaults to `&quot;localhost:9092&quot;`.</span>
</span><span id="KafkaSource.__init__-75"><a href="#KafkaSource.__init__-75"><span class="linenos"> 75</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch. Defaults to 10.</span>
</span><span id="KafkaSource.__init__-76"><a href="#KafkaSource.__init__-76"><span class="linenos"> 76</span></a><span class="sd">            poll_timeout (float): The number of seconds to continue polling kafka before timing out.</span>
</span><span id="KafkaSource.__init__-77"><a href="#KafkaSource.__init__-77"><span class="linenos"> 77</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="KafkaSource.__init__-78"><a href="#KafkaSource.__init__-78"><span class="linenos"> 78</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="KafkaSource.__init__-79"><a href="#KafkaSource.__init__-79"><span class="linenos"> 79</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="KafkaSource.__init__-80"><a href="#KafkaSource.__init__-80"><span class="linenos"> 80</span></a><span class="sd">            group_id (str, optional): Kafka consumer group id.  Defaults to `&quot;KafaSource&quot;`.</span>
</span><span id="KafkaSource.__init__-81"><a href="#KafkaSource.__init__-81"><span class="linenos"> 81</span></a><span class="sd">            registry_server (str, optional): DEPRECATED String used to get the avro schema from a url.  Used to decode messages in avro format.</span>
</span><span id="KafkaSource.__init__-82"><a href="#KafkaSource.__init__-82"><span class="linenos"> 82</span></a><span class="sd">            avro_schema_name(str, optional): DEPRECATED The Avro Schema name.  When this parameter is supplied the source expects all consumed messages to be in avro binary format.  Also known as the &quot;subject&quot; in the confluent registry server.  All consumed messages must use the same schema.</span>
</span><span id="KafkaSource.__init__-83"><a href="#KafkaSource.__init__-83"><span class="linenos"> 83</span></a><span class="sd">            avro_schema_version(str, optional): DEPRECATED The Avro Schema version.  All messages consumed must use the same version.  Defaults to &quot;latest&quot;  Only used when avro_schema_name is supplied.</span>
</span><span id="KafkaSource.__init__-84"><a href="#KafkaSource.__init__-84"><span class="linenos"> 84</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="KafkaSource.__init__-85"><a href="#KafkaSource.__init__-85"><span class="linenos"> 85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KafkaSource.__init__-86"><a href="#KafkaSource.__init__-86"><span class="linenos"> 86</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KafkaSource.__init__-87"><a href="#KafkaSource.__init__-87"><span class="linenos"> 87</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-88"><a href="#KafkaSource.__init__-88"><span class="linenos"> 88</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-89"><a href="#KafkaSource.__init__-89"><span class="linenos"> 89</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-90"><a href="#KafkaSource.__init__-90"><span class="linenos"> 90</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-91"><a href="#KafkaSource.__init__-91"><span class="linenos"> 91</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-92"><a href="#KafkaSource.__init__-92"><span class="linenos"> 92</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-93"><a href="#KafkaSource.__init__-93"><span class="linenos"> 93</span></a>        <span class="p">)</span>
</span><span id="KafkaSource.__init__-94"><a href="#KafkaSource.__init__-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conf</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="KafkaSource.__init__-95"><a href="#KafkaSource.__init__-95"><span class="linenos"> 95</span></a>            <span class="s2">&quot;bootstrap.servers&quot;</span><span class="p">:</span> <span class="n">bootstrap_servers</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-96"><a href="#KafkaSource.__init__-96"><span class="linenos"> 96</span></a>            <span class="s2">&quot;group.id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span>  <span class="c1"># TODO: self.unique_name()</span>
</span><span id="KafkaSource.__init__-97"><a href="#KafkaSource.__init__-97"><span class="linenos"> 97</span></a>            <span class="s2">&quot;enable.auto.commit&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-98"><a href="#KafkaSource.__init__-98"><span class="linenos"> 98</span></a>            <span class="s2">&quot;auto.offset.reset&quot;</span><span class="p">:</span> <span class="s2">&quot;earliest&quot;</span><span class="p">,</span>
</span><span id="KafkaSource.__init__-99"><a href="#KafkaSource.__init__-99"><span class="linenos"> 99</span></a>        <span class="p">}</span>
</span><span id="KafkaSource.__init__-100"><a href="#KafkaSource.__init__-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span> <span class="o">=</span> <span class="n">topics</span>
</span><span id="KafkaSource.__init__-101"><a href="#KafkaSource.__init__-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="p">:</span> <span class="n">Consumer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KafkaSource.__init__-102"><a href="#KafkaSource.__init__-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">poll_timeout</span> <span class="o">=</span> <span class="n">poll_timeout</span>
</span><span id="KafkaSource.__init__-103"><a href="#KafkaSource.__init__-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_received_messages_since_last_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="KafkaSource.__init__-104"><a href="#KafkaSource.__init__-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avro_schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KafkaSource.__init__-105"><a href="#KafkaSource.__init__-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registry_server</span> <span class="o">=</span> <span class="n">registry_server</span>
</span><span id="KafkaSource.__init__-106"><a href="#KafkaSource.__init__-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avro_schema_name</span> <span class="o">=</span> <span class="n">avro_schema_name</span>
</span><span id="KafkaSource.__init__-107"><a href="#KafkaSource.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avro_schema_version</span> <span class="o">=</span> <span class="n">avro_schema_version</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#KafkaSource">KafkaSource</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>topics (list[str]):</strong>  Topics from which to consume.</li>
<li><strong>bootstrap_servers (str):</strong>  The Kafka server to connect to. Defaults to <code>"localhost:9092"</code>.</li>
<li><strong>batch_size (int, optional):</strong>  Number of records to include in each batch. Defaults to 10.</li>
<li><strong>poll_timeout (float):</strong>  The number of seconds to continue polling kafka before timing out.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>group_id (str, optional):</strong>  Kafka consumer group id.  Defaults to <code>"KafaSource"</code>.</li>
<li><strong>registry_server (str, optional):</strong>  DEPRECATED String used to get the avro schema from a url.  Used to decode messages in avro format.</li>
<li><strong>avro_schema_name(str, optional):</strong>  DEPRECATED The Avro Schema name.  When this parameter is supplied the source expects all consumed messages to be in avro binary format.  Also known as the "subject" in the confluent registry server.  All consumed messages must use the same schema.</li>
<li><strong>avro_schema_version(str, optional):</strong>  DEPRECATED The Avro Schema version.  All messages consumed must use the same version.  Defaults to "latest"  Only used when avro_schema_name is supplied.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this source. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="KafkaSource.process_batch" class="classattr">
                                        <input id="KafkaSource.process_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_batch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span>:</span></span>

                <label class="view-source-button" for="KafkaSource.process_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KafkaSource.process_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KafkaSource.process_batch-145"><a href="#KafkaSource.process_batch-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="KafkaSource.process_batch-146"><a href="#KafkaSource.process_batch-146"><span class="linenos">146</span></a>        <span class="n">new_batch</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="KafkaSource.process_batch-147"><a href="#KafkaSource.process_batch-147"><span class="linenos">147</span></a>            <span class="n">records</span><span class="o">=</span><span class="n">_basic_consume_loop</span><span class="p">(</span>
</span><span id="KafkaSource.process_batch-148"><a href="#KafkaSource.process_batch-148"><span class="linenos">148</span></a>                <span class="n">consumer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="p">,</span>
</span><span id="KafkaSource.process_batch-149"><a href="#KafkaSource.process_batch-149"><span class="linenos">149</span></a>                <span class="n">num_messages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="KafkaSource.process_batch-150"><a href="#KafkaSource.process_batch-150"><span class="linenos">150</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">poll_timeout</span><span class="p">,</span>
</span><span id="KafkaSource.process_batch-151"><a href="#KafkaSource.process_batch-151"><span class="linenos">151</span></a>                <span class="n">avro_schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">avro_schema</span><span class="p">,</span>
</span><span id="KafkaSource.process_batch-152"><a href="#KafkaSource.process_batch-152"><span class="linenos">152</span></a>            <span class="p">)</span>
</span><span id="KafkaSource.process_batch-153"><a href="#KafkaSource.process_batch-153"><span class="linenos">153</span></a>        <span class="p">)</span>
</span><span id="KafkaSource.process_batch-154"><a href="#KafkaSource.process_batch-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_batch</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="KafkaSource.process_batch-155"><a href="#KafkaSource.process_batch-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_received_messages_since_last_commit</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="KafkaSource.process_batch-156"><a href="#KafkaSource.process_batch-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="n">new_batch</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="KafkaSource.unique_name" class="variable">unique_name</dd>
                <dd id="KafkaSource.pipeline" class="variable">pipeline</dd>
                <dd id="KafkaSource.add_downstream" class="function">add_downstream</dd>
                <dd id="KafkaSource.add_upstream" class="function">add_upstream</dd>
                <dd id="KafkaSource.get_downstreams" class="function">get_downstreams</dd>
                <dd id="KafkaSource.channels" class="variable">channels</dd>
                <dd id="KafkaSource.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="KafkaSource.log" class="variable">log</dd>
                <dd id="KafkaSource.reset_level" class="function">reset_level</dd>
                <dd id="KafkaSource.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="KafkaAvroSource">
                            <input id="KafkaAvroSource-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KafkaAvroSource</span><wbr>(<span class="base"><a href="#KafkaSource">cluo.sources.KafkaSource</a></span>):

                <label class="view-source-button" for="KafkaAvroSource-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KafkaAvroSource"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KafkaAvroSource-159"><a href="#KafkaAvroSource-159"><span class="linenos">159</span></a><span class="k">class</span> <span class="nc">KafkaAvroSource</span><span class="p">(</span><span class="n">KafkaSource</span><span class="p">):</span>
</span><span id="KafkaAvroSource-160"><a href="#KafkaAvroSource-160"><span class="linenos">160</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtains data from a Kafka topic with an avro schema.&quot;&quot;&quot;</span>
</span><span id="KafkaAvroSource-161"><a href="#KafkaAvroSource-161"><span class="linenos">161</span></a>
</span><span id="KafkaAvroSource-162"><a href="#KafkaAvroSource-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="KafkaAvroSource-163"><a href="#KafkaAvroSource-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KafkaAvroSource-164"><a href="#KafkaAvroSource-164"><span class="linenos">164</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="KafkaAvroSource-165"><a href="#KafkaAvroSource-165"><span class="linenos">165</span></a>        <span class="n">bootstrap_servers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_KAFKA_SERVER</span><span class="p">,</span>
</span><span id="KafkaAvroSource-166"><a href="#KafkaAvroSource-166"><span class="linenos">166</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaAvroSource-167"><a href="#KafkaAvroSource-167"><span class="linenos">167</span></a>        <span class="n">poll_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">,</span>
</span><span id="KafkaAvroSource-168"><a href="#KafkaAvroSource-168"><span class="linenos">168</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaAvroSource-169"><a href="#KafkaAvroSource-169"><span class="linenos">169</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="KafkaAvroSource-170"><a href="#KafkaAvroSource-170"><span class="linenos">170</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="KafkaAvroSource-171"><a href="#KafkaAvroSource-171"><span class="linenos">171</span></a>        <span class="n">group_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;KafkaSource&quot;</span><span class="p">,</span>
</span><span id="KafkaAvroSource-172"><a href="#KafkaAvroSource-172"><span class="linenos">172</span></a>        <span class="n">registry_server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_CONFLUENT_REGISTRY</span><span class="p">,</span>
</span><span id="KafkaAvroSource-173"><a href="#KafkaAvroSource-173"><span class="linenos">173</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="KafkaAvroSource-174"><a href="#KafkaAvroSource-174"><span class="linenos">174</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KafkaAvroSource-175"><a href="#KafkaAvroSource-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `KafkaAvroSource`.</span>
</span><span id="KafkaAvroSource-176"><a href="#KafkaAvroSource-176"><span class="linenos">176</span></a>
</span><span id="KafkaAvroSource-177"><a href="#KafkaAvroSource-177"><span class="linenos">177</span></a><span class="sd">        Args:</span>
</span><span id="KafkaAvroSource-178"><a href="#KafkaAvroSource-178"><span class="linenos">178</span></a><span class="sd">            topics (list[str]): Topics from which to consume.</span>
</span><span id="KafkaAvroSource-179"><a href="#KafkaAvroSource-179"><span class="linenos">179</span></a><span class="sd">            bootstrap_servers (str): The Kafka server to connect to. Defaults to `&quot;localhost:9092&quot;`.</span>
</span><span id="KafkaAvroSource-180"><a href="#KafkaAvroSource-180"><span class="linenos">180</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch. Defaults to 10.</span>
</span><span id="KafkaAvroSource-181"><a href="#KafkaAvroSource-181"><span class="linenos">181</span></a><span class="sd">            poll_timeout (float): The number of seconds to continue polling kafka before timing out.</span>
</span><span id="KafkaAvroSource-182"><a href="#KafkaAvroSource-182"><span class="linenos">182</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="KafkaAvroSource-183"><a href="#KafkaAvroSource-183"><span class="linenos">183</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="KafkaAvroSource-184"><a href="#KafkaAvroSource-184"><span class="linenos">184</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="KafkaAvroSource-185"><a href="#KafkaAvroSource-185"><span class="linenos">185</span></a><span class="sd">            group_id (str, optional): Kafka consumer group id.  Defaults to `&quot;KafaSource&quot;`.</span>
</span><span id="KafkaAvroSource-186"><a href="#KafkaAvroSource-186"><span class="linenos">186</span></a><span class="sd">            registry_server (str, optional): String used to get the avro schema from a url.  Used to decode messages in avro format.</span>
</span><span id="KafkaAvroSource-187"><a href="#KafkaAvroSource-187"><span class="linenos">187</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="KafkaAvroSource-188"><a href="#KafkaAvroSource-188"><span class="linenos">188</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KafkaAvroSource-189"><a href="#KafkaAvroSource-189"><span class="linenos">189</span></a>        <span class="n">KafkaSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KafkaAvroSource-190"><a href="#KafkaAvroSource-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="KafkaAvroSource-191"><a href="#KafkaAvroSource-191"><span class="linenos">191</span></a>            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="KafkaAvroSource-192"><a href="#KafkaAvroSource-192"><span class="linenos">192</span></a>            <span class="n">bootstrap_servers</span><span class="o">=</span><span class="n">bootstrap_servers</span><span class="p">,</span>
</span><span id="KafkaAvroSource-193"><a href="#KafkaAvroSource-193"><span class="linenos">193</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="KafkaAvroSource-194"><a href="#KafkaAvroSource-194"><span class="linenos">194</span></a>            <span class="n">poll_timeout</span><span class="o">=</span><span class="n">poll_timeout</span><span class="p">,</span>
</span><span id="KafkaAvroSource-195"><a href="#KafkaAvroSource-195"><span class="linenos">195</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="KafkaAvroSource-196"><a href="#KafkaAvroSource-196"><span class="linenos">196</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="KafkaAvroSource-197"><a href="#KafkaAvroSource-197"><span class="linenos">197</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="KafkaAvroSource-198"><a href="#KafkaAvroSource-198"><span class="linenos">198</span></a>            <span class="n">group_id</span><span class="o">=</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="KafkaAvroSource-199"><a href="#KafkaAvroSource-199"><span class="linenos">199</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="KafkaAvroSource-200"><a href="#KafkaAvroSource-200"><span class="linenos">200</span></a>        <span class="p">)</span>
</span><span id="KafkaAvroSource-201"><a href="#KafkaAvroSource-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registry_server</span> <span class="o">=</span> <span class="n">registry_server</span>
</span><span id="KafkaAvroSource-202"><a href="#KafkaAvroSource-202"><span class="linenos">202</span></a>
</span><span id="KafkaAvroSource-203"><a href="#KafkaAvroSource-203"><span class="linenos">203</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KafkaAvroSource-204"><a href="#KafkaAvroSource-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="p">:</span>
</span><span id="KafkaAvroSource-205"><a href="#KafkaAvroSource-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schema_registry_client</span> <span class="o">=</span> <span class="n">SchemaRegistryClient</span><span class="p">(</span>
</span><span id="KafkaAvroSource-206"><a href="#KafkaAvroSource-206"><span class="linenos">206</span></a>                <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry_server</span><span class="p">}</span>
</span><span id="KafkaAvroSource-207"><a href="#KafkaAvroSource-207"><span class="linenos">207</span></a>            <span class="p">)</span>
</span><span id="KafkaAvroSource-208"><a href="#KafkaAvroSource-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">avro_deserializer</span> <span class="o">=</span> <span class="n">AvroDeserializer</span><span class="p">(</span>
</span><span id="KafkaAvroSource-209"><a href="#KafkaAvroSource-209"><span class="linenos">209</span></a>                <span class="n">schema_registry_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schema_registry_client</span>
</span><span id="KafkaAvroSource-210"><a href="#KafkaAvroSource-210"><span class="linenos">210</span></a>            <span class="p">)</span>
</span><span id="KafkaAvroSource-211"><a href="#KafkaAvroSource-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="p">[</span><span class="s2">&quot;value.deserializer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avro_deserializer</span>
</span><span id="KafkaAvroSource-212"><a href="#KafkaAvroSource-212"><span class="linenos">212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span> <span class="o">=</span> <span class="n">DeserializingConsumer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span>
</span><span id="KafkaAvroSource-213"><a href="#KafkaAvroSource-213"><span class="linenos">213</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Obtains data from a Kafka topic with an avro schema.</p>
</div>


                            <div id="KafkaAvroSource.__init__" class="classattr">
                                        <input id="KafkaAvroSource.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">KafkaAvroSource</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">topics</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">bootstrap_servers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;localhost:9092&#39;</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">poll_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">group_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;KafkaSource&#39;</span>,</span><span class="param">	<span class="n">registry_server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;localhost:8081&#39;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="KafkaAvroSource.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KafkaAvroSource.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KafkaAvroSource.__init__-162"><a href="#KafkaAvroSource.__init__-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="KafkaAvroSource.__init__-163"><a href="#KafkaAvroSource.__init__-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-164"><a href="#KafkaAvroSource.__init__-164"><span class="linenos">164</span></a>        <span class="n">topics</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="KafkaAvroSource.__init__-165"><a href="#KafkaAvroSource.__init__-165"><span class="linenos">165</span></a>        <span class="n">bootstrap_servers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_KAFKA_SERVER</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-166"><a href="#KafkaAvroSource.__init__-166"><span class="linenos">166</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-167"><a href="#KafkaAvroSource.__init__-167"><span class="linenos">167</span></a>        <span class="n">poll_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-168"><a href="#KafkaAvroSource.__init__-168"><span class="linenos">168</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-169"><a href="#KafkaAvroSource.__init__-169"><span class="linenos">169</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-170"><a href="#KafkaAvroSource.__init__-170"><span class="linenos">170</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-171"><a href="#KafkaAvroSource.__init__-171"><span class="linenos">171</span></a>        <span class="n">group_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;KafkaSource&quot;</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-172"><a href="#KafkaAvroSource.__init__-172"><span class="linenos">172</span></a>        <span class="n">registry_server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_CONFLUENT_REGISTRY</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-173"><a href="#KafkaAvroSource.__init__-173"><span class="linenos">173</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-174"><a href="#KafkaAvroSource.__init__-174"><span class="linenos">174</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KafkaAvroSource.__init__-175"><a href="#KafkaAvroSource.__init__-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `KafkaAvroSource`.</span>
</span><span id="KafkaAvroSource.__init__-176"><a href="#KafkaAvroSource.__init__-176"><span class="linenos">176</span></a>
</span><span id="KafkaAvroSource.__init__-177"><a href="#KafkaAvroSource.__init__-177"><span class="linenos">177</span></a><span class="sd">        Args:</span>
</span><span id="KafkaAvroSource.__init__-178"><a href="#KafkaAvroSource.__init__-178"><span class="linenos">178</span></a><span class="sd">            topics (list[str]): Topics from which to consume.</span>
</span><span id="KafkaAvroSource.__init__-179"><a href="#KafkaAvroSource.__init__-179"><span class="linenos">179</span></a><span class="sd">            bootstrap_servers (str): The Kafka server to connect to. Defaults to `&quot;localhost:9092&quot;`.</span>
</span><span id="KafkaAvroSource.__init__-180"><a href="#KafkaAvroSource.__init__-180"><span class="linenos">180</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch. Defaults to 10.</span>
</span><span id="KafkaAvroSource.__init__-181"><a href="#KafkaAvroSource.__init__-181"><span class="linenos">181</span></a><span class="sd">            poll_timeout (float): The number of seconds to continue polling kafka before timing out.</span>
</span><span id="KafkaAvroSource.__init__-182"><a href="#KafkaAvroSource.__init__-182"><span class="linenos">182</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="KafkaAvroSource.__init__-183"><a href="#KafkaAvroSource.__init__-183"><span class="linenos">183</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="KafkaAvroSource.__init__-184"><a href="#KafkaAvroSource.__init__-184"><span class="linenos">184</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="KafkaAvroSource.__init__-185"><a href="#KafkaAvroSource.__init__-185"><span class="linenos">185</span></a><span class="sd">            group_id (str, optional): Kafka consumer group id.  Defaults to `&quot;KafaSource&quot;`.</span>
</span><span id="KafkaAvroSource.__init__-186"><a href="#KafkaAvroSource.__init__-186"><span class="linenos">186</span></a><span class="sd">            registry_server (str, optional): String used to get the avro schema from a url.  Used to decode messages in avro format.</span>
</span><span id="KafkaAvroSource.__init__-187"><a href="#KafkaAvroSource.__init__-187"><span class="linenos">187</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="KafkaAvroSource.__init__-188"><a href="#KafkaAvroSource.__init__-188"><span class="linenos">188</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KafkaAvroSource.__init__-189"><a href="#KafkaAvroSource.__init__-189"><span class="linenos">189</span></a>        <span class="n">KafkaSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KafkaAvroSource.__init__-190"><a href="#KafkaAvroSource.__init__-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-191"><a href="#KafkaAvroSource.__init__-191"><span class="linenos">191</span></a>            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-192"><a href="#KafkaAvroSource.__init__-192"><span class="linenos">192</span></a>            <span class="n">bootstrap_servers</span><span class="o">=</span><span class="n">bootstrap_servers</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-193"><a href="#KafkaAvroSource.__init__-193"><span class="linenos">193</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-194"><a href="#KafkaAvroSource.__init__-194"><span class="linenos">194</span></a>            <span class="n">poll_timeout</span><span class="o">=</span><span class="n">poll_timeout</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-195"><a href="#KafkaAvroSource.__init__-195"><span class="linenos">195</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-196"><a href="#KafkaAvroSource.__init__-196"><span class="linenos">196</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-197"><a href="#KafkaAvroSource.__init__-197"><span class="linenos">197</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-198"><a href="#KafkaAvroSource.__init__-198"><span class="linenos">198</span></a>            <span class="n">group_id</span><span class="o">=</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-199"><a href="#KafkaAvroSource.__init__-199"><span class="linenos">199</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="KafkaAvroSource.__init__-200"><a href="#KafkaAvroSource.__init__-200"><span class="linenos">200</span></a>        <span class="p">)</span>
</span><span id="KafkaAvroSource.__init__-201"><a href="#KafkaAvroSource.__init__-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registry_server</span> <span class="o">=</span> <span class="n">registry_server</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#KafkaAvroSource">KafkaAvroSource</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>topics (list[str]):</strong>  Topics from which to consume.</li>
<li><strong>bootstrap_servers (str):</strong>  The Kafka server to connect to. Defaults to <code>"localhost:9092"</code>.</li>
<li><strong>batch_size (int, optional):</strong>  Number of records to include in each batch. Defaults to 10.</li>
<li><strong>poll_timeout (float):</strong>  The number of seconds to continue polling kafka before timing out.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>group_id (str, optional):</strong>  Kafka consumer group id.  Defaults to <code>"KafaSource"</code>.</li>
<li><strong>registry_server (str, optional):</strong>  String used to get the avro schema from a url.  Used to decode messages in avro format.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this source. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#KafkaSource">KafkaSource</a></dt>
                                <dd id="KafkaAvroSource.process_batch" class="function"><a href="#KafkaSource.process_batch">process_batch</a></dd>

            </div>
            <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="KafkaAvroSource.unique_name" class="variable">unique_name</dd>
                <dd id="KafkaAvroSource.pipeline" class="variable">pipeline</dd>
                <dd id="KafkaAvroSource.add_downstream" class="function">add_downstream</dd>
                <dd id="KafkaAvroSource.add_upstream" class="function">add_upstream</dd>
                <dd id="KafkaAvroSource.get_downstreams" class="function">get_downstreams</dd>
                <dd id="KafkaAvroSource.channels" class="variable">channels</dd>
                <dd id="KafkaAvroSource.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="KafkaAvroSource.log" class="variable">log</dd>
                <dd id="KafkaAvroSource.reset_level" class="function">reset_level</dd>
                <dd id="KafkaAvroSource.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PostgresSelectSource">
                            <input id="PostgresSelectSource-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PostgresSelectSource</span><wbr>(<span class="base">cluo.core.source.Source</span>):

                <label class="view-source-button" for="PostgresSelectSource-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PostgresSelectSource"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PostgresSelectSource-22"><a href="#PostgresSelectSource-22"><span class="linenos"> 22</span></a><span class="k">class</span> <span class="nc">PostgresSelectSource</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
</span><span id="PostgresSelectSource-23"><a href="#PostgresSelectSource-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a batch of data from a Postgres database. Records return are from index [offset, offset + batch_size).&quot;&quot;&quot;</span>
</span><span id="PostgresSelectSource-24"><a href="#PostgresSelectSource-24"><span class="linenos"> 24</span></a>
</span><span id="PostgresSelectSource-25"><a href="#PostgresSelectSource-25"><span class="linenos"> 25</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PostgresSelectSource-26"><a href="#PostgresSelectSource-26"><span class="linenos"> 26</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresSelectSource-27"><a href="#PostgresSelectSource-27"><span class="linenos"> 27</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresSelectSource-28"><a href="#PostgresSelectSource-28"><span class="linenos"> 28</span></a>        <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresSelectSource-29"><a href="#PostgresSelectSource-29"><span class="linenos"> 29</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="PostgresSelectSource-30"><a href="#PostgresSelectSource-30"><span class="linenos"> 30</span></a>        <span class="n">offset_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresSelectSource-31"><a href="#PostgresSelectSource-31"><span class="linenos"> 31</span></a>        <span class="n">offset_manager</span><span class="p">:</span> <span class="n">OffsetManager</span><span class="p">,</span>
</span><span id="PostgresSelectSource-32"><a href="#PostgresSelectSource-32"><span class="linenos"> 32</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="PostgresSelectSource-33"><a href="#PostgresSelectSource-33"><span class="linenos"> 33</span></a>        <span class="n">where_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource-34"><a href="#PostgresSelectSource-34"><span class="linenos"> 34</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource-35"><a href="#PostgresSelectSource-35"><span class="linenos"> 35</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource-36"><a href="#PostgresSelectSource-36"><span class="linenos"> 36</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PostgresSelectSource-37"><a href="#PostgresSelectSource-37"><span class="linenos"> 37</span></a>        <span class="n">use_timestamp_offset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PostgresSelectSource-38"><a href="#PostgresSelectSource-38"><span class="linenos"> 38</span></a>        <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource-39"><a href="#PostgresSelectSource-39"><span class="linenos"> 39</span></a>        <span class="n">offset_nonunique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PostgresSelectSource-40"><a href="#PostgresSelectSource-40"><span class="linenos"> 40</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="PostgresSelectSource-41"><a href="#PostgresSelectSource-41"><span class="linenos"> 41</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PostgresSelectSource-42"><a href="#PostgresSelectSource-42"><span class="linenos"> 42</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PostgresSelectSource-43"><a href="#PostgresSelectSource-43"><span class="linenos"> 43</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `PostgresSelectSource`.</span>
</span><span id="PostgresSelectSource-44"><a href="#PostgresSelectSource-44"><span class="linenos"> 44</span></a>
</span><span id="PostgresSelectSource-45"><a href="#PostgresSelectSource-45"><span class="linenos"> 45</span></a><span class="sd">        Args:</span>
</span><span id="PostgresSelectSource-46"><a href="#PostgresSelectSource-46"><span class="linenos"> 46</span></a><span class="sd">            schema (str): Schema containing the table.</span>
</span><span id="PostgresSelectSource-47"><a href="#PostgresSelectSource-47"><span class="linenos"> 47</span></a><span class="sd">            table (str): The table to which to append.</span>
</span><span id="PostgresSelectSource-48"><a href="#PostgresSelectSource-48"><span class="linenos"> 48</span></a><span class="sd">            fields (list[str]): The fields to select.</span>
</span><span id="PostgresSelectSource-49"><a href="#PostgresSelectSource-49"><span class="linenos"> 49</span></a><span class="sd">            offset_field (str): The field to use as the offset.</span>
</span><span id="PostgresSelectSource-50"><a href="#PostgresSelectSource-50"><span class="linenos"> 50</span></a><span class="sd">            offset_manager (OffsetManager): Offset manager for managing the current offset.</span>
</span><span id="PostgresSelectSource-51"><a href="#PostgresSelectSource-51"><span class="linenos"> 51</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Connection pool to use connections from for lookup.</span>
</span><span id="PostgresSelectSource-52"><a href="#PostgresSelectSource-52"><span class="linenos"> 52</span></a><span class="sd">            where_string (str, optional): A SQL WHERE clause to use for select. Defaults to no WHERE clause.</span>
</span><span id="PostgresSelectSource-53"><a href="#PostgresSelectSource-53"><span class="linenos"> 53</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch. Defaults to 10.</span>
</span><span id="PostgresSelectSource-54"><a href="#PostgresSelectSource-54"><span class="linenos"> 54</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="PostgresSelectSource-55"><a href="#PostgresSelectSource-55"><span class="linenos"> 55</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="PostgresSelectSource-56"><a href="#PostgresSelectSource-56"><span class="linenos"> 56</span></a><span class="sd">            order_by (list[str], optional): Order by fields.  Defaults to [offset_field].</span>
</span><span id="PostgresSelectSource-57"><a href="#PostgresSelectSource-57"><span class="linenos"> 57</span></a><span class="sd">            offset_nonunique (bool): Your offset field is non-unique.  Defaults to False.</span>
</span><span id="PostgresSelectSource-58"><a href="#PostgresSelectSource-58"><span class="linenos"> 58</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="PostgresSelectSource-59"><a href="#PostgresSelectSource-59"><span class="linenos"> 59</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="PostgresSelectSource-60"><a href="#PostgresSelectSource-60"><span class="linenos"> 60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PostgresSelectSource-61"><a href="#PostgresSelectSource-61"><span class="linenos"> 61</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PostgresSelectSource-62"><a href="#PostgresSelectSource-62"><span class="linenos"> 62</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresSelectSource-63"><a href="#PostgresSelectSource-63"><span class="linenos"> 63</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="PostgresSelectSource-64"><a href="#PostgresSelectSource-64"><span class="linenos"> 64</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="PostgresSelectSource-65"><a href="#PostgresSelectSource-65"><span class="linenos"> 65</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="PostgresSelectSource-66"><a href="#PostgresSelectSource-66"><span class="linenos"> 66</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="PostgresSelectSource-67"><a href="#PostgresSelectSource-67"><span class="linenos"> 67</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="PostgresSelectSource-68"><a href="#PostgresSelectSource-68"><span class="linenos"> 68</span></a>        <span class="p">)</span>
</span><span id="PostgresSelectSource-69"><a href="#PostgresSelectSource-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span> <span class="o">=</span> <span class="n">offset_manager</span>
</span><span id="PostgresSelectSource-70"><a href="#PostgresSelectSource-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span><span id="PostgresSelectSource-71"><a href="#PostgresSelectSource-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span>
</span><span id="PostgresSelectSource-72"><a href="#PostgresSelectSource-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
</span><span id="PostgresSelectSource-73"><a href="#PostgresSelectSource-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="PostgresSelectSource-74"><a href="#PostgresSelectSource-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span> <span class="o">=</span> <span class="n">offset_field</span>
</span><span id="PostgresSelectSource-75"><a href="#PostgresSelectSource-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">where_string</span> <span class="o">=</span> <span class="n">where_string</span>
</span><span id="PostgresSelectSource-76"><a href="#PostgresSelectSource-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">:</span> <span class="n">PossibleOffsetType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PostgresSelectSource-77"><a href="#PostgresSelectSource-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">order_by</span> <span class="ow">or</span> <span class="p">[</span><span class="n">offset_field</span><span class="p">]</span>
</span><span id="PostgresSelectSource-78"><a href="#PostgresSelectSource-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset_nonunique</span> <span class="o">=</span> <span class="n">offset_nonunique</span>
</span><span id="PostgresSelectSource-79"><a href="#PostgresSelectSource-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PostgresSelectSource-80"><a href="#PostgresSelectSource-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="n">offset_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_by</span><span class="p">:</span>
</span><span id="PostgresSelectSource-81"><a href="#PostgresSelectSource-81"><span class="linenos"> 81</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;offset field must be in order_by list&quot;</span><span class="p">)</span>
</span><span id="PostgresSelectSource-82"><a href="#PostgresSelectSource-82"><span class="linenos"> 82</span></a>        <span class="k">if</span> <span class="n">offset_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
</span><span id="PostgresSelectSource-83"><a href="#PostgresSelectSource-83"><span class="linenos"> 83</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;offset field must be in fields list&quot;</span><span class="p">)</span>
</span><span id="PostgresSelectSource-84"><a href="#PostgresSelectSource-84"><span class="linenos"> 84</span></a>
</span><span id="PostgresSelectSource-85"><a href="#PostgresSelectSource-85"><span class="linenos"> 85</span></a>    <span class="k">def</span> <span class="nf">_construct_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">:</span>
</span><span id="PostgresSelectSource-86"><a href="#PostgresSelectSource-86"><span class="linenos"> 86</span></a>        <span class="n">complete_where_clause</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;WHERE &quot;</span><span class="p">)</span>
</span><span id="PostgresSelectSource-87"><a href="#PostgresSelectSource-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">where_string</span><span class="p">:</span>
</span><span id="PostgresSelectSource-88"><a href="#PostgresSelectSource-88"><span class="linenos"> 88</span></a>            <span class="n">complete_where_clause</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="PostgresSelectSource-89"><a href="#PostgresSelectSource-89"><span class="linenos"> 89</span></a>                <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
</span><span id="PostgresSelectSource-90"><a href="#PostgresSelectSource-90"><span class="linenos"> 90</span></a>                <span class="o">+</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">where_string</span><span class="p">)</span>
</span><span id="PostgresSelectSource-91"><a href="#PostgresSelectSource-91"><span class="linenos"> 91</span></a>                <span class="o">+</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="PostgresSelectSource-92"><a href="#PostgresSelectSource-92"><span class="linenos"> 92</span></a>                <span class="o">+</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot; AND &quot;</span><span class="p">)</span>
</span><span id="PostgresSelectSource-93"><a href="#PostgresSelectSource-93"><span class="linenos"> 93</span></a>            <span class="p">)</span>
</span><span id="PostgresSelectSource-94"><a href="#PostgresSelectSource-94"><span class="linenos"> 94</span></a>
</span><span id="PostgresSelectSource-95"><a href="#PostgresSelectSource-95"><span class="linenos"> 95</span></a>        <span class="n">offset_string</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> &gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PostgresSelectSource-96"><a href="#PostgresSelectSource-96"><span class="linenos"> 96</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">),</span>
</span><span id="PostgresSelectSource-97"><a href="#PostgresSelectSource-97"><span class="linenos"> 97</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">),</span>
</span><span id="PostgresSelectSource-98"><a href="#PostgresSelectSource-98"><span class="linenos"> 98</span></a>        <span class="p">)</span>
</span><span id="PostgresSelectSource-99"><a href="#PostgresSelectSource-99"><span class="linenos"> 99</span></a>        <span class="n">complete_where_clause</span> <span class="o">+=</span> <span class="n">offset_string</span>
</span><span id="PostgresSelectSource-100"><a href="#PostgresSelectSource-100"><span class="linenos">100</span></a>
</span><span id="PostgresSelectSource-101"><a href="#PostgresSelectSource-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span>
</span><span id="PostgresSelectSource-102"><a href="#PostgresSelectSource-102"><span class="linenos">102</span></a>            <span class="s2">&quot;SELECT </span><span class="si">{}</span><span class="s2"> FROM </span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> ORDER BY </span><span class="si">{}</span><span class="s2"> LIMIT </span><span class="si">{}</span><span class="s2"> OFFSET </span><span class="si">{}</span><span class="s2">;&quot;</span>
</span><span id="PostgresSelectSource-103"><a href="#PostgresSelectSource-103"><span class="linenos">103</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PostgresSelectSource-104"><a href="#PostgresSelectSource-104"><span class="linenos">104</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)),</span>
</span><span id="PostgresSelectSource-105"><a href="#PostgresSelectSource-105"><span class="linenos">105</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">),</span>
</span><span id="PostgresSelectSource-106"><a href="#PostgresSelectSource-106"><span class="linenos">106</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">),</span>
</span><span id="PostgresSelectSource-107"><a href="#PostgresSelectSource-107"><span class="linenos">107</span></a>            <span class="n">complete_where_clause</span><span class="p">,</span>
</span><span id="PostgresSelectSource-108"><a href="#PostgresSelectSource-108"><span class="linenos">108</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_by</span><span class="p">)),</span>
</span><span id="PostgresSelectSource-109"><a href="#PostgresSelectSource-109"><span class="linenos">109</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>
</span><span id="PostgresSelectSource-110"><a href="#PostgresSelectSource-110"><span class="linenos">110</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>
</span><span id="PostgresSelectSource-111"><a href="#PostgresSelectSource-111"><span class="linenos">111</span></a>        <span class="p">)</span>
</span><span id="PostgresSelectSource-112"><a href="#PostgresSelectSource-112"><span class="linenos">112</span></a>
</span><span id="PostgresSelectSource-113"><a href="#PostgresSelectSource-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">_execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">:</span> <span class="n">connection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="PostgresSelectSource-114"><a href="#PostgresSelectSource-114"><span class="linenos">114</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_factory</span><span class="o">=</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictCursor</span><span class="p">)</span>
</span><span id="PostgresSelectSource-115"><a href="#PostgresSelectSource-115"><span class="linenos">115</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_query</span><span class="p">()</span>
</span><span id="PostgresSelectSource-116"><a href="#PostgresSelectSource-116"><span class="linenos">116</span></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="PostgresSelectSource-117"><a href="#PostgresSelectSource-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">real_dict_row</span><span class="p">)</span> <span class="k">for</span> <span class="n">real_dict_row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="PostgresSelectSource-118"><a href="#PostgresSelectSource-118"><span class="linenos">118</span></a>
</span><span id="PostgresSelectSource-119"><a href="#PostgresSelectSource-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="PostgresSelectSource-120"><a href="#PostgresSelectSource-120"><span class="linenos">120</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="PostgresSelectSource-121"><a href="#PostgresSelectSource-121"><span class="linenos">121</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PostgresSelectSource-122"><a href="#PostgresSelectSource-122"><span class="linenos">122</span></a>            <span class="n">batch</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="PostgresSelectSource-123"><a href="#PostgresSelectSource-123"><span class="linenos">123</span></a>                <span class="p">[</span><span class="n">Record</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span> <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">conn</span><span class="p">)]</span>
</span><span id="PostgresSelectSource-124"><a href="#PostgresSelectSource-124"><span class="linenos">124</span></a>            <span class="p">)</span>
</span><span id="PostgresSelectSource-125"><a href="#PostgresSelectSource-125"><span class="linenos">125</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="PostgresSelectSource-126"><a href="#PostgresSelectSource-126"><span class="linenos">126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="PostgresSelectSource-127"><a href="#PostgresSelectSource-127"><span class="linenos">127</span></a>        <span class="c1"># If we have a full batch and offset is non-unique, increment the page</span>
</span><span id="PostgresSelectSource-128"><a href="#PostgresSelectSource-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_nonunique</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
</span><span id="PostgresSelectSource-129"><a href="#PostgresSelectSource-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PostgresSelectSource-130"><a href="#PostgresSelectSource-130"><span class="linenos">130</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PostgresSelectSource-131"><a href="#PostgresSelectSource-131"><span class="linenos">131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">max_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">)</span>
</span><span id="PostgresSelectSource-132"><a href="#PostgresSelectSource-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PostgresSelectSource-133"><a href="#PostgresSelectSource-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">batch</span>
</span><span id="PostgresSelectSource-134"><a href="#PostgresSelectSource-134"><span class="linenos">134</span></a>
</span><span id="PostgresSelectSource-135"><a href="#PostgresSelectSource-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">_set_offset_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PostgresSelectSource-136"><a href="#PostgresSelectSource-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">set_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_name</span><span class="p">)</span>
</span><span id="PostgresSelectSource-137"><a href="#PostgresSelectSource-137"><span class="linenos">137</span></a>
</span><span id="PostgresSelectSource-138"><a href="#PostgresSelectSource-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PostgresSelectSource-139"><a href="#PostgresSelectSource-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">WRITE</span><span class="p">:</span>
</span><span id="PostgresSelectSource-140"><a href="#PostgresSelectSource-140"><span class="linenos">140</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_offset_key</span><span class="p">()</span>
</span><span id="PostgresSelectSource-141"><a href="#PostgresSelectSource-141"><span class="linenos">141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="PostgresSelectSource-142"><a href="#PostgresSelectSource-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PostgresSelectSource-143"><a href="#PostgresSelectSource-143"><span class="linenos">143</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">initial_offset</span>
</span><span id="PostgresSelectSource-144"><a href="#PostgresSelectSource-144"><span class="linenos">144</span></a>        <span class="k">elif</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">PREVIEW</span><span class="p">:</span>
</span><span id="PostgresSelectSource-145"><a href="#PostgresSelectSource-145"><span class="linenos">145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="PostgresSelectSource-146"><a href="#PostgresSelectSource-146"><span class="linenos">146</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PostgresSelectSource-147"><a href="#PostgresSelectSource-147"><span class="linenos">147</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown run mode.&quot;</span><span class="p">)</span>
</span><span id="PostgresSelectSource-148"><a href="#PostgresSelectSource-148"><span class="linenos">148</span></a>
</span><span id="PostgresSelectSource-149"><a href="#PostgresSelectSource-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
</span><span id="PostgresSelectSource-150"><a href="#PostgresSelectSource-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresSelectSource-151"><a href="#PostgresSelectSource-151"><span class="linenos">151</span></a>        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource-152"><a href="#PostgresSelectSource-152"><span class="linenos">152</span></a>        <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource-153"><a href="#PostgresSelectSource-153"><span class="linenos">153</span></a>        <span class="n">exc_tb</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource-154"><a href="#PostgresSelectSource-154"><span class="linenos">154</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="PostgresSelectSource-155"><a href="#PostgresSelectSource-155"><span class="linenos">155</span></a>        <span class="n">has_exception</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="PostgresSelectSource-156"><a href="#PostgresSelectSource-156"><span class="linenos">156</span></a>            <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">exc_tb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="PostgresSelectSource-157"><a href="#PostgresSelectSource-157"><span class="linenos">157</span></a>        <span class="p">)</span>
</span><span id="PostgresSelectSource-158"><a href="#PostgresSelectSource-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_exception</span> <span class="ow">and</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">WRITE</span><span class="p">:</span>
</span><span id="PostgresSelectSource-159"><a href="#PostgresSelectSource-159"><span class="linenos">159</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">:</span>
</span><span id="PostgresSelectSource-160"><a href="#PostgresSelectSource-160"><span class="linenos">160</span></a>                <span class="c1"># batch is not empty</span>
</span><span id="PostgresSelectSource-161"><a href="#PostgresSelectSource-161"><span class="linenos">161</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">)</span>
</span><span id="PostgresSelectSource-162"><a href="#PostgresSelectSource-162"><span class="linenos">162</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PostgresSelectSource-163"><a href="#PostgresSelectSource-163"><span class="linenos">163</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="PostgresSelectSource-164"><a href="#PostgresSelectSource-164"><span class="linenos">164</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Returns a batch of data from a Postgres database. Records return are from index [offset, offset + batch_size).</p>
</div>


                            <div id="PostgresSelectSource.__init__" class="classattr">
                                        <input id="PostgresSelectSource.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PostgresSelectSource</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">schema</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">table</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">offset_field</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">offset_manager</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">offset_manager</span><span class="o">.</span><span class="n">OffsetManager</span>,</span><span class="param">	<span class="n">connection_pool</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">postgres_connection_pool</span><span class="o">.</span><span class="n">PostgresConnectionPool</span>,</span><span class="param">	<span class="n">where_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">use_timestamp_offset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">offset_nonunique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="PostgresSelectSource.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PostgresSelectSource.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PostgresSelectSource.__init__-25"><a href="#PostgresSelectSource.__init__-25"><span class="linenos">25</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PostgresSelectSource.__init__-26"><a href="#PostgresSelectSource.__init__-26"><span class="linenos">26</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-27"><a href="#PostgresSelectSource.__init__-27"><span class="linenos">27</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-28"><a href="#PostgresSelectSource.__init__-28"><span class="linenos">28</span></a>        <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-29"><a href="#PostgresSelectSource.__init__-29"><span class="linenos">29</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="PostgresSelectSource.__init__-30"><a href="#PostgresSelectSource.__init__-30"><span class="linenos">30</span></a>        <span class="n">offset_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-31"><a href="#PostgresSelectSource.__init__-31"><span class="linenos">31</span></a>        <span class="n">offset_manager</span><span class="p">:</span> <span class="n">OffsetManager</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-32"><a href="#PostgresSelectSource.__init__-32"><span class="linenos">32</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-33"><a href="#PostgresSelectSource.__init__-33"><span class="linenos">33</span></a>        <span class="n">where_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-34"><a href="#PostgresSelectSource.__init__-34"><span class="linenos">34</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-35"><a href="#PostgresSelectSource.__init__-35"><span class="linenos">35</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-36"><a href="#PostgresSelectSource.__init__-36"><span class="linenos">36</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-37"><a href="#PostgresSelectSource.__init__-37"><span class="linenos">37</span></a>        <span class="n">use_timestamp_offset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-38"><a href="#PostgresSelectSource.__init__-38"><span class="linenos">38</span></a>        <span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-39"><a href="#PostgresSelectSource.__init__-39"><span class="linenos">39</span></a>        <span class="n">offset_nonunique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-40"><a href="#PostgresSelectSource.__init__-40"><span class="linenos">40</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-41"><a href="#PostgresSelectSource.__init__-41"><span class="linenos">41</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-42"><a href="#PostgresSelectSource.__init__-42"><span class="linenos">42</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PostgresSelectSource.__init__-43"><a href="#PostgresSelectSource.__init__-43"><span class="linenos">43</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `PostgresSelectSource`.</span>
</span><span id="PostgresSelectSource.__init__-44"><a href="#PostgresSelectSource.__init__-44"><span class="linenos">44</span></a>
</span><span id="PostgresSelectSource.__init__-45"><a href="#PostgresSelectSource.__init__-45"><span class="linenos">45</span></a><span class="sd">        Args:</span>
</span><span id="PostgresSelectSource.__init__-46"><a href="#PostgresSelectSource.__init__-46"><span class="linenos">46</span></a><span class="sd">            schema (str): Schema containing the table.</span>
</span><span id="PostgresSelectSource.__init__-47"><a href="#PostgresSelectSource.__init__-47"><span class="linenos">47</span></a><span class="sd">            table (str): The table to which to append.</span>
</span><span id="PostgresSelectSource.__init__-48"><a href="#PostgresSelectSource.__init__-48"><span class="linenos">48</span></a><span class="sd">            fields (list[str]): The fields to select.</span>
</span><span id="PostgresSelectSource.__init__-49"><a href="#PostgresSelectSource.__init__-49"><span class="linenos">49</span></a><span class="sd">            offset_field (str): The field to use as the offset.</span>
</span><span id="PostgresSelectSource.__init__-50"><a href="#PostgresSelectSource.__init__-50"><span class="linenos">50</span></a><span class="sd">            offset_manager (OffsetManager): Offset manager for managing the current offset.</span>
</span><span id="PostgresSelectSource.__init__-51"><a href="#PostgresSelectSource.__init__-51"><span class="linenos">51</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Connection pool to use connections from for lookup.</span>
</span><span id="PostgresSelectSource.__init__-52"><a href="#PostgresSelectSource.__init__-52"><span class="linenos">52</span></a><span class="sd">            where_string (str, optional): A SQL WHERE clause to use for select. Defaults to no WHERE clause.</span>
</span><span id="PostgresSelectSource.__init__-53"><a href="#PostgresSelectSource.__init__-53"><span class="linenos">53</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch. Defaults to 10.</span>
</span><span id="PostgresSelectSource.__init__-54"><a href="#PostgresSelectSource.__init__-54"><span class="linenos">54</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="PostgresSelectSource.__init__-55"><a href="#PostgresSelectSource.__init__-55"><span class="linenos">55</span></a><span class="sd">            processes (int, optional): Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</span>
</span><span id="PostgresSelectSource.__init__-56"><a href="#PostgresSelectSource.__init__-56"><span class="linenos">56</span></a><span class="sd">            order_by (list[str], optional): Order by fields.  Defaults to [offset_field].</span>
</span><span id="PostgresSelectSource.__init__-57"><a href="#PostgresSelectSource.__init__-57"><span class="linenos">57</span></a><span class="sd">            offset_nonunique (bool): Your offset field is non-unique.  Defaults to False.</span>
</span><span id="PostgresSelectSource.__init__-58"><a href="#PostgresSelectSource.__init__-58"><span class="linenos">58</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="PostgresSelectSource.__init__-59"><a href="#PostgresSelectSource.__init__-59"><span class="linenos">59</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="PostgresSelectSource.__init__-60"><a href="#PostgresSelectSource.__init__-60"><span class="linenos">60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PostgresSelectSource.__init__-61"><a href="#PostgresSelectSource.__init__-61"><span class="linenos">61</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PostgresSelectSource.__init__-62"><a href="#PostgresSelectSource.__init__-62"><span class="linenos">62</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-63"><a href="#PostgresSelectSource.__init__-63"><span class="linenos">63</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-64"><a href="#PostgresSelectSource.__init__-64"><span class="linenos">64</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-65"><a href="#PostgresSelectSource.__init__-65"><span class="linenos">65</span></a>            <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-66"><a href="#PostgresSelectSource.__init__-66"><span class="linenos">66</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-67"><a href="#PostgresSelectSource.__init__-67"><span class="linenos">67</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="PostgresSelectSource.__init__-68"><a href="#PostgresSelectSource.__init__-68"><span class="linenos">68</span></a>        <span class="p">)</span>
</span><span id="PostgresSelectSource.__init__-69"><a href="#PostgresSelectSource.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span> <span class="o">=</span> <span class="n">offset_manager</span>
</span><span id="PostgresSelectSource.__init__-70"><a href="#PostgresSelectSource.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span><span id="PostgresSelectSource.__init__-71"><a href="#PostgresSelectSource.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span>
</span><span id="PostgresSelectSource.__init__-72"><a href="#PostgresSelectSource.__init__-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
</span><span id="PostgresSelectSource.__init__-73"><a href="#PostgresSelectSource.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="PostgresSelectSource.__init__-74"><a href="#PostgresSelectSource.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span> <span class="o">=</span> <span class="n">offset_field</span>
</span><span id="PostgresSelectSource.__init__-75"><a href="#PostgresSelectSource.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">where_string</span> <span class="o">=</span> <span class="n">where_string</span>
</span><span id="PostgresSelectSource.__init__-76"><a href="#PostgresSelectSource.__init__-76"><span class="linenos">76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">:</span> <span class="n">PossibleOffsetType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PostgresSelectSource.__init__-77"><a href="#PostgresSelectSource.__init__-77"><span class="linenos">77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order_by</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">order_by</span> <span class="ow">or</span> <span class="p">[</span><span class="n">offset_field</span><span class="p">]</span>
</span><span id="PostgresSelectSource.__init__-78"><a href="#PostgresSelectSource.__init__-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset_nonunique</span> <span class="o">=</span> <span class="n">offset_nonunique</span>
</span><span id="PostgresSelectSource.__init__-79"><a href="#PostgresSelectSource.__init__-79"><span class="linenos">79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PostgresSelectSource.__init__-80"><a href="#PostgresSelectSource.__init__-80"><span class="linenos">80</span></a>        <span class="k">if</span> <span class="n">offset_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_by</span><span class="p">:</span>
</span><span id="PostgresSelectSource.__init__-81"><a href="#PostgresSelectSource.__init__-81"><span class="linenos">81</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;offset field must be in order_by list&quot;</span><span class="p">)</span>
</span><span id="PostgresSelectSource.__init__-82"><a href="#PostgresSelectSource.__init__-82"><span class="linenos">82</span></a>        <span class="k">if</span> <span class="n">offset_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
</span><span id="PostgresSelectSource.__init__-83"><a href="#PostgresSelectSource.__init__-83"><span class="linenos">83</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;offset field must be in fields list&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#PostgresSelectSource">PostgresSelectSource</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>schema (str):</strong>  Schema containing the table.</li>
<li><strong>table (str):</strong>  The table to which to append.</li>
<li><strong>fields (list[str]):</strong>  The fields to select.</li>
<li><strong>offset_field (str):</strong>  The field to use as the offset.</li>
<li><strong>offset_manager (OffsetManager):</strong>  Offset manager for managing the current offset.</li>
<li><strong>connection_pool (PostgresConnectionPool):</strong>  Connection pool to use connections from for lookup.</li>
<li><strong>where_string (str, optional):</strong>  A SQL WHERE clause to use for select. Defaults to no WHERE clause.</li>
<li><strong>batch_size (int, optional):</strong>  Number of records to include in each batch. Defaults to 10.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>processes (int, optional):</strong>  Number of CPUs to use. Can only be used if .process_record method is implemented. Defaults to 1.</li>
<li><strong>order_by (list[str], optional):</strong>  Order by fields.  Defaults to [offset_field].</li>
<li><strong>offset_nonunique (bool):</strong>  Your offset field is non-unique.  Defaults to False.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this source. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="PostgresSelectSource.process_batch" class="classattr">
                                        <input id="PostgresSelectSource.process_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_batch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span>:</span></span>

                <label class="view-source-button" for="PostgresSelectSource.process_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PostgresSelectSource.process_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PostgresSelectSource.process_batch-119"><a href="#PostgresSelectSource.process_batch-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="PostgresSelectSource.process_batch-120"><a href="#PostgresSelectSource.process_batch-120"><span class="linenos">120</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="PostgresSelectSource.process_batch-121"><a href="#PostgresSelectSource.process_batch-121"><span class="linenos">121</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PostgresSelectSource.process_batch-122"><a href="#PostgresSelectSource.process_batch-122"><span class="linenos">122</span></a>            <span class="n">batch</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="PostgresSelectSource.process_batch-123"><a href="#PostgresSelectSource.process_batch-123"><span class="linenos">123</span></a>                <span class="p">[</span><span class="n">Record</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span> <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">conn</span><span class="p">)]</span>
</span><span id="PostgresSelectSource.process_batch-124"><a href="#PostgresSelectSource.process_batch-124"><span class="linenos">124</span></a>            <span class="p">)</span>
</span><span id="PostgresSelectSource.process_batch-125"><a href="#PostgresSelectSource.process_batch-125"><span class="linenos">125</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="PostgresSelectSource.process_batch-126"><a href="#PostgresSelectSource.process_batch-126"><span class="linenos">126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="PostgresSelectSource.process_batch-127"><a href="#PostgresSelectSource.process_batch-127"><span class="linenos">127</span></a>        <span class="c1"># If we have a full batch and offset is non-unique, increment the page</span>
</span><span id="PostgresSelectSource.process_batch-128"><a href="#PostgresSelectSource.process_batch-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_nonunique</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
</span><span id="PostgresSelectSource.process_batch-129"><a href="#PostgresSelectSource.process_batch-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PostgresSelectSource.process_batch-130"><a href="#PostgresSelectSource.process_batch-130"><span class="linenos">130</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PostgresSelectSource.process_batch-131"><a href="#PostgresSelectSource.process_batch-131"><span class="linenos">131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">max_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">)</span>
</span><span id="PostgresSelectSource.process_batch-132"><a href="#PostgresSelectSource.process_batch-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PostgresSelectSource.process_batch-133"><a href="#PostgresSelectSource.process_batch-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">batch</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="PostgresSelectSource.unique_name" class="variable">unique_name</dd>
                <dd id="PostgresSelectSource.pipeline" class="variable">pipeline</dd>
                <dd id="PostgresSelectSource.add_downstream" class="function">add_downstream</dd>
                <dd id="PostgresSelectSource.add_upstream" class="function">add_upstream</dd>
                <dd id="PostgresSelectSource.get_downstreams" class="function">get_downstreams</dd>
                <dd id="PostgresSelectSource.channels" class="variable">channels</dd>
                <dd id="PostgresSelectSource.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="PostgresSelectSource.log" class="variable">log</dd>
                <dd id="PostgresSelectSource.reset_level" class="function">reset_level</dd>
                <dd id="PostgresSelectSource.serialize" class="function">serialize</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SalesforceReflowSource">
                            <input id="SalesforceReflowSource-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SalesforceReflowSource</span><wbr>(<span class="base">cluo.core.source.Source</span>, <span class="base">cluo.connections.salesforce_connection_mixin.SalesforceConnectionMixin</span>):

                <label class="view-source-button" for="SalesforceReflowSource-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SalesforceReflowSource"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SalesforceReflowSource-26"><a href="#SalesforceReflowSource-26"><span class="linenos"> 26</span></a><span class="k">class</span> <span class="nc">SalesforceReflowSource</span><span class="p">(</span><span class="n">Source</span><span class="p">,</span> <span class="n">SalesforceConnectionMixin</span><span class="p">):</span>
</span><span id="SalesforceReflowSource-27"><a href="#SalesforceReflowSource-27"><span class="linenos"> 27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SalesforceReflowSource-28"><a href="#SalesforceReflowSource-28"><span class="linenos"> 28</span></a><span class="sd">    Returns a batch of data from a Salesforce instance.</span>
</span><span id="SalesforceReflowSource-29"><a href="#SalesforceReflowSource-29"><span class="linenos"> 29</span></a><span class="sd">    Records are from a list of ids pulled from a postgres reflow table</span>
</span><span id="SalesforceReflowSource-30"><a href="#SalesforceReflowSource-30"><span class="linenos"> 30</span></a><span class="sd">    postgres reflow table records are from index [offset, offset + batch_size).</span>
</span><span id="SalesforceReflowSource-31"><a href="#SalesforceReflowSource-31"><span class="linenos"> 31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SalesforceReflowSource-32"><a href="#SalesforceReflowSource-32"><span class="linenos"> 32</span></a>
</span><span id="SalesforceReflowSource-33"><a href="#SalesforceReflowSource-33"><span class="linenos"> 33</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-34"><a href="#SalesforceReflowSource-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-35"><a href="#SalesforceReflowSource-35"><span class="linenos"> 35</span></a>        <span class="n">entity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-36"><a href="#SalesforceReflowSource-36"><span class="linenos"> 36</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SalesforceReflowSource-37"><a href="#SalesforceReflowSource-37"><span class="linenos"> 37</span></a>        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-38"><a href="#SalesforceReflowSource-38"><span class="linenos"> 38</span></a>        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-39"><a href="#SalesforceReflowSource-39"><span class="linenos"> 39</span></a>        <span class="n">security_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-40"><a href="#SalesforceReflowSource-40"><span class="linenos"> 40</span></a>        <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-41"><a href="#SalesforceReflowSource-41"><span class="linenos"> 41</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-42"><a href="#SalesforceReflowSource-42"><span class="linenos"> 42</span></a>        <span class="n">offset_manager</span><span class="p">:</span> <span class="n">OffsetManager</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-43"><a href="#SalesforceReflowSource-43"><span class="linenos"> 43</span></a>        <span class="n">reflow_schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-44"><a href="#SalesforceReflowSource-44"><span class="linenos"> 44</span></a>        <span class="n">reflow_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-45"><a href="#SalesforceReflowSource-45"><span class="linenos"> 45</span></a>        <span class="n">reflow_id_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-46"><a href="#SalesforceReflowSource-46"><span class="linenos"> 46</span></a>        <span class="n">reflow_offset_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-47"><a href="#SalesforceReflowSource-47"><span class="linenos"> 47</span></a>        <span class="n">id_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Id&quot;</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-48"><a href="#SalesforceReflowSource-48"><span class="linenos"> 48</span></a>        <span class="n">reflow_where_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-49"><a href="#SalesforceReflowSource-49"><span class="linenos"> 49</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-50"><a href="#SalesforceReflowSource-50"><span class="linenos"> 50</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-51"><a href="#SalesforceReflowSource-51"><span class="linenos"> 51</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-52"><a href="#SalesforceReflowSource-52"><span class="linenos"> 52</span></a>        <span class="n">include_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-53"><a href="#SalesforceReflowSource-53"><span class="linenos"> 53</span></a>        <span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-54"><a href="#SalesforceReflowSource-54"><span class="linenos"> 54</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-55"><a href="#SalesforceReflowSource-55"><span class="linenos"> 55</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `SalesforceReflowSource`.</span>
</span><span id="SalesforceReflowSource-56"><a href="#SalesforceReflowSource-56"><span class="linenos"> 56</span></a>
</span><span id="SalesforceReflowSource-57"><a href="#SalesforceReflowSource-57"><span class="linenos"> 57</span></a><span class="sd">        Args:</span>
</span><span id="SalesforceReflowSource-58"><a href="#SalesforceReflowSource-58"><span class="linenos"> 58</span></a><span class="sd">            entity (str): The salesforce entity to query.</span>
</span><span id="SalesforceReflowSource-59"><a href="#SalesforceReflowSource-59"><span class="linenos"> 59</span></a><span class="sd">            fields (list[str]): The fields to select.</span>
</span><span id="SalesforceReflowSource-60"><a href="#SalesforceReflowSource-60"><span class="linenos"> 60</span></a><span class="sd">            username (str): Username.</span>
</span><span id="SalesforceReflowSource-61"><a href="#SalesforceReflowSource-61"><span class="linenos"> 61</span></a><span class="sd">            password (str): Password.</span>
</span><span id="SalesforceReflowSource-62"><a href="#SalesforceReflowSource-62"><span class="linenos"> 62</span></a><span class="sd">            security_token (str): Security token.</span>
</span><span id="SalesforceReflowSource-63"><a href="#SalesforceReflowSource-63"><span class="linenos"> 63</span></a><span class="sd">            domain (str): Domain.</span>
</span><span id="SalesforceReflowSource-64"><a href="#SalesforceReflowSource-64"><span class="linenos"> 64</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Postgres Connection pool for accessing the reflow table.</span>
</span><span id="SalesforceReflowSource-65"><a href="#SalesforceReflowSource-65"><span class="linenos"> 65</span></a><span class="sd">            offset_manager (OffsetManager): Offset manager for managing the current offset.</span>
</span><span id="SalesforceReflowSource-66"><a href="#SalesforceReflowSource-66"><span class="linenos"> 66</span></a><span class="sd">            reflow_schema (str): Schema containing the reflow table.</span>
</span><span id="SalesforceReflowSource-67"><a href="#SalesforceReflowSource-67"><span class="linenos"> 67</span></a><span class="sd">            reflow_table (str): Reflow table name.</span>
</span><span id="SalesforceReflowSource-68"><a href="#SalesforceReflowSource-68"><span class="linenos"> 68</span></a><span class="sd">            reflow_id_field (str): The reflow table field that contains the entity id value.</span>
</span><span id="SalesforceReflowSource-69"><a href="#SalesforceReflowSource-69"><span class="linenos"> 69</span></a><span class="sd">            reflow_offset_field (str): The reflow table field to use as the offset.</span>
</span><span id="SalesforceReflowSource-70"><a href="#SalesforceReflowSource-70"><span class="linenos"> 70</span></a><span class="sd">            id_field: (str, optional): the salesforce id field.  Defaults to Id.</span>
</span><span id="SalesforceReflowSource-71"><a href="#SalesforceReflowSource-71"><span class="linenos"> 71</span></a><span class="sd">            reflow_where_string (str, optional): A SQL WHERE clause to use for select on the reflow table. Defaults to no WHERE clause.</span>
</span><span id="SalesforceReflowSource-72"><a href="#SalesforceReflowSource-72"><span class="linenos"> 72</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch from the reflow table. Defaults to 10.</span>
</span><span id="SalesforceReflowSource-73"><a href="#SalesforceReflowSource-73"><span class="linenos"> 73</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SalesforceReflowSource-74"><a href="#SalesforceReflowSource-74"><span class="linenos"> 74</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SalesforceReflowSource-75"><a href="#SalesforceReflowSource-75"><span class="linenos"> 75</span></a><span class="sd">            include_deleted (bool): include soft-deleted records in results.  Defaults to True.</span>
</span><span id="SalesforceReflowSource-76"><a href="#SalesforceReflowSource-76"><span class="linenos"> 76</span></a><span class="sd">            api_version (str, optional): Salesforce API version.</span>
</span><span id="SalesforceReflowSource-77"><a href="#SalesforceReflowSource-77"><span class="linenos"> 77</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SalesforceReflowSource-78"><a href="#SalesforceReflowSource-78"><span class="linenos"> 78</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-79"><a href="#SalesforceReflowSource-79"><span class="linenos"> 79</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-80"><a href="#SalesforceReflowSource-80"><span class="linenos"> 80</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-81"><a href="#SalesforceReflowSource-81"><span class="linenos"> 81</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-82"><a href="#SalesforceReflowSource-82"><span class="linenos"> 82</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-83"><a href="#SalesforceReflowSource-83"><span class="linenos"> 83</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-84"><a href="#SalesforceReflowSource-84"><span class="linenos"> 84</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-85"><a href="#SalesforceReflowSource-85"><span class="linenos"> 85</span></a>        <span class="n">SalesforceConnectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-86"><a href="#SalesforceReflowSource-86"><span class="linenos"> 86</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-87"><a href="#SalesforceReflowSource-87"><span class="linenos"> 87</span></a>            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-88"><a href="#SalesforceReflowSource-88"><span class="linenos"> 88</span></a>            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-89"><a href="#SalesforceReflowSource-89"><span class="linenos"> 89</span></a>            <span class="n">security_token</span><span class="o">=</span><span class="n">security_token</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-90"><a href="#SalesforceReflowSource-90"><span class="linenos"> 90</span></a>            <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-91"><a href="#SalesforceReflowSource-91"><span class="linenos"> 91</span></a>            <span class="n">version</span><span class="o">=</span><span class="n">api_version</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-92"><a href="#SalesforceReflowSource-92"><span class="linenos"> 92</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-93"><a href="#SalesforceReflowSource-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span> <span class="o">=</span> <span class="n">offset_manager</span>
</span><span id="SalesforceReflowSource-94"><a href="#SalesforceReflowSource-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span>
</span><span id="SalesforceReflowSource-95"><a href="#SalesforceReflowSource-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="SalesforceReflowSource-96"><a href="#SalesforceReflowSource-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span><span id="SalesforceReflowSource-97"><a href="#SalesforceReflowSource-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_schema</span> <span class="o">=</span> <span class="n">reflow_schema</span>
</span><span id="SalesforceReflowSource-98"><a href="#SalesforceReflowSource-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_table</span> <span class="o">=</span> <span class="n">reflow_table</span>
</span><span id="SalesforceReflowSource-99"><a href="#SalesforceReflowSource-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_id_field</span> <span class="o">=</span> <span class="n">reflow_id_field</span>
</span><span id="SalesforceReflowSource-100"><a href="#SalesforceReflowSource-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_offset_field</span> <span class="o">=</span> <span class="n">reflow_offset_field</span>
</span><span id="SalesforceReflowSource-101"><a href="#SalesforceReflowSource-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id_field</span> <span class="o">=</span> <span class="n">id_field</span>
</span><span id="SalesforceReflowSource-102"><a href="#SalesforceReflowSource-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_where_string</span> <span class="o">=</span> <span class="n">reflow_where_string</span>
</span><span id="SalesforceReflowSource-103"><a href="#SalesforceReflowSource-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">:</span> <span class="n">PossibleOffsetType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SalesforceReflowSource-104"><a href="#SalesforceReflowSource-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">salesforce_query</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SalesforceReflowSource-105"><a href="#SalesforceReflowSource-105"><span class="linenos">105</span></a>            <span class="s2">&quot;SELECT {:literal} FROM {:literal} WHERE {:literal} in ({:literal})&quot;</span>
</span><span id="SalesforceReflowSource-106"><a href="#SalesforceReflowSource-106"><span class="linenos">106</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-107"><a href="#SalesforceReflowSource-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_deleted</span> <span class="o">=</span> <span class="n">include_deleted</span>
</span><span id="SalesforceReflowSource-108"><a href="#SalesforceReflowSource-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SalesforceReflowSource-109"><a href="#SalesforceReflowSource-109"><span class="linenos">109</span></a>        <span class="c1"># calculate maximum batch size based on soql query URL length</span>
</span><span id="SalesforceReflowSource-110"><a href="#SalesforceReflowSource-110"><span class="linenos">110</span></a>        <span class="n">effective_batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_effective_batch_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-111"><a href="#SalesforceReflowSource-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SalesforceReflowSource-112"><a href="#SalesforceReflowSource-112"><span class="linenos">112</span></a>            <span class="n">batch_size</span>
</span><span id="SalesforceReflowSource-113"><a href="#SalesforceReflowSource-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">effective_batch_size</span>
</span><span id="SalesforceReflowSource-114"><a href="#SalesforceReflowSource-114"><span class="linenos">114</span></a>            <span class="k">else</span> <span class="n">effective_batch_size</span>
</span><span id="SalesforceReflowSource-115"><a href="#SalesforceReflowSource-115"><span class="linenos">115</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-116"><a href="#SalesforceReflowSource-116"><span class="linenos">116</span></a>
</span><span id="SalesforceReflowSource-117"><a href="#SalesforceReflowSource-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">_get_effective_batch_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-118"><a href="#SalesforceReflowSource-118"><span class="linenos">118</span></a>        <span class="c1"># rest api uri limit</span>
</span><span id="SalesforceReflowSource-119"><a href="#SalesforceReflowSource-119"><span class="linenos">119</span></a>        <span class="n">max_query_length</span> <span class="o">=</span> <span class="mi">16_384</span>
</span><span id="SalesforceReflowSource-120"><a href="#SalesforceReflowSource-120"><span class="linenos">120</span></a>        <span class="n">field_list_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-121"><a href="#SalesforceReflowSource-121"><span class="linenos">121</span></a>        <span class="n">remaining_chars</span> <span class="o">=</span> <span class="n">max_query_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-122"><a href="#SalesforceReflowSource-122"><span class="linenos">122</span></a>            <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT </span><span class="si">{</span><span class="n">field_list_str</span><span class="si">}</span><span class="s2"> FROM </span><span class="si">{</span><span class="n">entity</span><span class="si">}</span><span class="s2"> WHERE Id in ()&quot;</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-123"><a href="#SalesforceReflowSource-123"><span class="linenos">123</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-124"><a href="#SalesforceReflowSource-124"><span class="linenos">124</span></a>        <span class="c1"># salesforce 18 character id + 3 characters for delimiters (url encoded) = 27 but 24 proves to be the correct size in practice</span>
</span><span id="SalesforceReflowSource-125"><a href="#SalesforceReflowSource-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="n">remaining_chars</span> <span class="o">//</span> <span class="mi">24</span>
</span><span id="SalesforceReflowSource-126"><a href="#SalesforceReflowSource-126"><span class="linenos">126</span></a>
</span><span id="SalesforceReflowSource-127"><a href="#SalesforceReflowSource-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">_construct_reflow_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-128"><a href="#SalesforceReflowSource-128"><span class="linenos">128</span></a>        <span class="n">complete_where_clause</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;WHERE &quot;</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-129"><a href="#SalesforceReflowSource-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflow_where_string</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-130"><a href="#SalesforceReflowSource-130"><span class="linenos">130</span></a>            <span class="n">complete_where_clause</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="SalesforceReflowSource-131"><a href="#SalesforceReflowSource-131"><span class="linenos">131</span></a>                <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-132"><a href="#SalesforceReflowSource-132"><span class="linenos">132</span></a>                <span class="o">+</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_where_string</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-133"><a href="#SalesforceReflowSource-133"><span class="linenos">133</span></a>                <span class="o">+</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-134"><a href="#SalesforceReflowSource-134"><span class="linenos">134</span></a>                <span class="o">+</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot; AND &quot;</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-135"><a href="#SalesforceReflowSource-135"><span class="linenos">135</span></a>            <span class="p">)</span>
</span><span id="SalesforceReflowSource-136"><a href="#SalesforceReflowSource-136"><span class="linenos">136</span></a>
</span><span id="SalesforceReflowSource-137"><a href="#SalesforceReflowSource-137"><span class="linenos">137</span></a>        <span class="n">offset_string</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> &gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-138"><a href="#SalesforceReflowSource-138"><span class="linenos">138</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_offset_field</span><span class="p">),</span>
</span><span id="SalesforceReflowSource-139"><a href="#SalesforceReflowSource-139"><span class="linenos">139</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">),</span>
</span><span id="SalesforceReflowSource-140"><a href="#SalesforceReflowSource-140"><span class="linenos">140</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-141"><a href="#SalesforceReflowSource-141"><span class="linenos">141</span></a>        <span class="n">complete_where_clause</span> <span class="o">+=</span> <span class="n">offset_string</span>
</span><span id="SalesforceReflowSource-142"><a href="#SalesforceReflowSource-142"><span class="linenos">142</span></a>
</span><span id="SalesforceReflowSource-143"><a href="#SalesforceReflowSource-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">{}</span><span class="s2"> FROM </span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> ORDER BY </span><span class="si">{}</span><span class="s2"> LIMIT </span><span class="si">{}</span><span class="s2">;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-144"><a href="#SalesforceReflowSource-144"><span class="linenos">144</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-145"><a href="#SalesforceReflowSource-145"><span class="linenos">145</span></a>                <span class="nb">map</span><span class="p">(</span><span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_id_field</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflow_offset_field</span><span class="p">])</span>
</span><span id="SalesforceReflowSource-146"><a href="#SalesforceReflowSource-146"><span class="linenos">146</span></a>            <span class="p">),</span>
</span><span id="SalesforceReflowSource-147"><a href="#SalesforceReflowSource-147"><span class="linenos">147</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_schema</span><span class="p">),</span>
</span><span id="SalesforceReflowSource-148"><a href="#SalesforceReflowSource-148"><span class="linenos">148</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_table</span><span class="p">),</span>
</span><span id="SalesforceReflowSource-149"><a href="#SalesforceReflowSource-149"><span class="linenos">149</span></a>            <span class="n">complete_where_clause</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-150"><a href="#SalesforceReflowSource-150"><span class="linenos">150</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_offset_field</span><span class="p">),</span>
</span><span id="SalesforceReflowSource-151"><a href="#SalesforceReflowSource-151"><span class="linenos">151</span></a>            <span class="n">sql</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>
</span><span id="SalesforceReflowSource-152"><a href="#SalesforceReflowSource-152"><span class="linenos">152</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-153"><a href="#SalesforceReflowSource-153"><span class="linenos">153</span></a>
</span><span id="SalesforceReflowSource-154"><a href="#SalesforceReflowSource-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">_execute_reflow_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">:</span> <span class="n">connection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="SalesforceReflowSource-155"><a href="#SalesforceReflowSource-155"><span class="linenos">155</span></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_factory</span><span class="o">=</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">RealDictCursor</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-156"><a href="#SalesforceReflowSource-156"><span class="linenos">156</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_reflow_query</span><span class="p">()</span>
</span><span id="SalesforceReflowSource-157"><a href="#SalesforceReflowSource-157"><span class="linenos">157</span></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-158"><a href="#SalesforceReflowSource-158"><span class="linenos">158</span></a>        <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">real_dict_row</span><span class="p">)</span> <span class="k">for</span> <span class="n">real_dict_row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="SalesforceReflowSource-159"><a href="#SalesforceReflowSource-159"><span class="linenos">159</span></a>
</span><span id="SalesforceReflowSource-160"><a href="#SalesforceReflowSource-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">_process_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="SalesforceReflowSource-161"><a href="#SalesforceReflowSource-161"><span class="linenos">161</span></a>        <span class="n">records</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="SalesforceReflowSource-162"><a href="#SalesforceReflowSource-162"><span class="linenos">162</span></a>
</span><span id="SalesforceReflowSource-163"><a href="#SalesforceReflowSource-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">records</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-164"><a href="#SalesforceReflowSource-164"><span class="linenos">164</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="SalesforceReflowSource-165"><a href="#SalesforceReflowSource-165"><span class="linenos">165</span></a>
</span><span id="SalesforceReflowSource-166"><a href="#SalesforceReflowSource-166"><span class="linenos">166</span></a>        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-167"><a href="#SalesforceReflowSource-167"><span class="linenos">167</span></a>            <span class="k">if</span> <span class="s2">&quot;attributes&quot;</span> <span class="ow">in</span> <span class="n">record</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-168"><a href="#SalesforceReflowSource-168"><span class="linenos">168</span></a>                <span class="k">del</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>
</span><span id="SalesforceReflowSource-169"><a href="#SalesforceReflowSource-169"><span class="linenos">169</span></a>        <span class="k">return</span> <span class="n">records</span>
</span><span id="SalesforceReflowSource-170"><a href="#SalesforceReflowSource-170"><span class="linenos">170</span></a>
</span><span id="SalesforceReflowSource-171"><a href="#SalesforceReflowSource-171"><span class="linenos">171</span></a>    <span class="k">def</span> <span class="nf">_execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-172"><a href="#SalesforceReflowSource-172"><span class="linenos">172</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="SalesforceReflowSource-173"><a href="#SalesforceReflowSource-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sf</span><span class="o">.</span><span class="n">query_all</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-174"><a href="#SalesforceReflowSource-174"><span class="linenos">174</span></a>                <span class="n">format_soql</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-175"><a href="#SalesforceReflowSource-175"><span class="linenos">175</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salesforce_query</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-176"><a href="#SalesforceReflowSource-176"><span class="linenos">176</span></a>                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">),</span>
</span><span id="SalesforceReflowSource-177"><a href="#SalesforceReflowSource-177"><span class="linenos">177</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-178"><a href="#SalesforceReflowSource-178"><span class="linenos">178</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">id_field</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-179"><a href="#SalesforceReflowSource-179"><span class="linenos">179</span></a>                    <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">]),</span>
</span><span id="SalesforceReflowSource-180"><a href="#SalesforceReflowSource-180"><span class="linenos">180</span></a>                <span class="p">),</span>
</span><span id="SalesforceReflowSource-181"><a href="#SalesforceReflowSource-181"><span class="linenos">181</span></a>                <span class="n">include_deleted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">include_deleted</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-182"><a href="#SalesforceReflowSource-182"><span class="linenos">182</span></a>            <span class="p">)</span>
</span><span id="SalesforceReflowSource-183"><a href="#SalesforceReflowSource-183"><span class="linenos">183</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span>
</span><span id="SalesforceReflowSource-184"><a href="#SalesforceReflowSource-184"><span class="linenos">184</span></a>            <span class="k">else</span> <span class="p">{}</span>
</span><span id="SalesforceReflowSource-185"><a href="#SalesforceReflowSource-185"><span class="linenos">185</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-186"><a href="#SalesforceReflowSource-186"><span class="linenos">186</span></a>
</span><span id="SalesforceReflowSource-187"><a href="#SalesforceReflowSource-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-188"><a href="#SalesforceReflowSource-188"><span class="linenos">188</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="SalesforceReflowSource-189"><a href="#SalesforceReflowSource-189"><span class="linenos">189</span></a>        <span class="n">reflow_records</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SalesforceReflowSource-190"><a href="#SalesforceReflowSource-190"><span class="linenos">190</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-191"><a href="#SalesforceReflowSource-191"><span class="linenos">191</span></a>            <span class="c1"># get id list from postgres offset table</span>
</span><span id="SalesforceReflowSource-192"><a href="#SalesforceReflowSource-192"><span class="linenos">192</span></a>            <span class="n">reflow_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_reflow_query</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-193"><a href="#SalesforceReflowSource-193"><span class="linenos">193</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SalesforceReflowSource-194"><a href="#SalesforceReflowSource-194"><span class="linenos">194</span></a>                <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_id_field</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-195"><a href="#SalesforceReflowSource-195"><span class="linenos">195</span></a>                <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="n">reflow_records</span>
</span><span id="SalesforceReflowSource-196"><a href="#SalesforceReflowSource-196"><span class="linenos">196</span></a>                <span class="k">if</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_id_field</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-197"><a href="#SalesforceReflowSource-197"><span class="linenos">197</span></a>            <span class="p">]</span>
</span><span id="SalesforceReflowSource-198"><a href="#SalesforceReflowSource-198"><span class="linenos">198</span></a>            <span class="n">records</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-199"><a href="#SalesforceReflowSource-199"><span class="linenos">199</span></a>                <span class="n">records</span><span class="o">=</span><span class="p">[</span>
</span><span id="SalesforceReflowSource-200"><a href="#SalesforceReflowSource-200"><span class="linenos">200</span></a>                    <span class="n">Record</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-201"><a href="#SalesforceReflowSource-201"><span class="linenos">201</span></a>                    <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_query_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">())</span>
</span><span id="SalesforceReflowSource-202"><a href="#SalesforceReflowSource-202"><span class="linenos">202</span></a>                <span class="p">]</span>
</span><span id="SalesforceReflowSource-203"><a href="#SalesforceReflowSource-203"><span class="linenos">203</span></a>            <span class="p">)</span>
</span><span id="SalesforceReflowSource-204"><a href="#SalesforceReflowSource-204"><span class="linenos">204</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-205"><a href="#SalesforceReflowSource-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-206"><a href="#SalesforceReflowSource-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SalesforceReflowSource-207"><a href="#SalesforceReflowSource-207"><span class="linenos">207</span></a>            <span class="nb">max</span><span class="p">(</span><span class="n">reflow_records</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_offset_field</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-208"><a href="#SalesforceReflowSource-208"><span class="linenos">208</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">reflow_offset_field</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="SalesforceReflowSource-209"><a href="#SalesforceReflowSource-209"><span class="linenos">209</span></a>            <span class="p">)</span>
</span><span id="SalesforceReflowSource-210"><a href="#SalesforceReflowSource-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="n">reflow_records</span>
</span><span id="SalesforceReflowSource-211"><a href="#SalesforceReflowSource-211"><span class="linenos">211</span></a>            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span>
</span><span id="SalesforceReflowSource-212"><a href="#SalesforceReflowSource-212"><span class="linenos">212</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-213"><a href="#SalesforceReflowSource-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="n">records</span>
</span><span id="SalesforceReflowSource-214"><a href="#SalesforceReflowSource-214"><span class="linenos">214</span></a>
</span><span id="SalesforceReflowSource-215"><a href="#SalesforceReflowSource-215"><span class="linenos">215</span></a>    <span class="k">def</span> <span class="nf">_set_offset_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-216"><a href="#SalesforceReflowSource-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">set_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_name</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-217"><a href="#SalesforceReflowSource-217"><span class="linenos">217</span></a>
</span><span id="SalesforceReflowSource-218"><a href="#SalesforceReflowSource-218"><span class="linenos">218</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-219"><a href="#SalesforceReflowSource-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">WRITE</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-220"><a href="#SalesforceReflowSource-220"><span class="linenos">220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_offset_key</span><span class="p">()</span>
</span><span id="SalesforceReflowSource-221"><a href="#SalesforceReflowSource-221"><span class="linenos">221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="SalesforceReflowSource-222"><a href="#SalesforceReflowSource-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-223"><a href="#SalesforceReflowSource-223"><span class="linenos">223</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">initial_offset</span>
</span><span id="SalesforceReflowSource-224"><a href="#SalesforceReflowSource-224"><span class="linenos">224</span></a>        <span class="k">elif</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">PREVIEW</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-225"><a href="#SalesforceReflowSource-225"><span class="linenos">225</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">initial_offset</span>
</span><span id="SalesforceReflowSource-226"><a href="#SalesforceReflowSource-226"><span class="linenos">226</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-227"><a href="#SalesforceReflowSource-227"><span class="linenos">227</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown run mode.&quot;</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-228"><a href="#SalesforceReflowSource-228"><span class="linenos">228</span></a>
</span><span id="SalesforceReflowSource-229"><a href="#SalesforceReflowSource-229"><span class="linenos">229</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
</span><span id="SalesforceReflowSource-230"><a href="#SalesforceReflowSource-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-231"><a href="#SalesforceReflowSource-231"><span class="linenos">231</span></a>        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-232"><a href="#SalesforceReflowSource-232"><span class="linenos">232</span></a>        <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-233"><a href="#SalesforceReflowSource-233"><span class="linenos">233</span></a>        <span class="n">exc_tb</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource-234"><a href="#SalesforceReflowSource-234"><span class="linenos">234</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-235"><a href="#SalesforceReflowSource-235"><span class="linenos">235</span></a>        <span class="n">has_exception</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SalesforceReflowSource-236"><a href="#SalesforceReflowSource-236"><span class="linenos">236</span></a>            <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">exc_tb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SalesforceReflowSource-237"><a href="#SalesforceReflowSource-237"><span class="linenos">237</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource-238"><a href="#SalesforceReflowSource-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_exception</span> <span class="ow">and</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">WRITE</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-239"><a href="#SalesforceReflowSource-239"><span class="linenos">239</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">:</span>
</span><span id="SalesforceReflowSource-240"><a href="#SalesforceReflowSource-240"><span class="linenos">240</span></a>                <span class="c1"># batch is not empty</span>
</span><span id="SalesforceReflowSource-241"><a href="#SalesforceReflowSource-241"><span class="linenos">241</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">)</span>
</span><span id="SalesforceReflowSource-242"><a href="#SalesforceReflowSource-242"><span class="linenos">242</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SalesforceReflowSource-243"><a href="#SalesforceReflowSource-243"><span class="linenos">243</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="SalesforceReflowSource-244"><a href="#SalesforceReflowSource-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Returns a batch of data from a Salesforce instance.
Records are from a list of ids pulled from a postgres reflow table
postgres reflow table records are from index [offset, offset + batch_size).</p>
</div>


                            <div id="SalesforceReflowSource.__init__" class="classattr">
                                        <input id="SalesforceReflowSource.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SalesforceReflowSource</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">entity</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">username</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">password</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">security_token</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">domain</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">connection_pool</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">postgres_connection_pool</span><span class="o">.</span><span class="n">PostgresConnectionPool</span>,</span><span class="param">	<span class="n">offset_manager</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">offset_manager</span><span class="o">.</span><span class="n">OffsetManager</span>,</span><span class="param">	<span class="n">reflow_schema</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">reflow_table</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">reflow_id_field</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">reflow_offset_field</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">id_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Id&#39;</span>,</span><span class="param">	<span class="n">reflow_where_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">include_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="SalesforceReflowSource.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SalesforceReflowSource.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SalesforceReflowSource.__init__-33"><a href="#SalesforceReflowSource.__init__-33"><span class="linenos"> 33</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceReflowSource.__init__-34"><a href="#SalesforceReflowSource.__init__-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-35"><a href="#SalesforceReflowSource.__init__-35"><span class="linenos"> 35</span></a>        <span class="n">entity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-36"><a href="#SalesforceReflowSource.__init__-36"><span class="linenos"> 36</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SalesforceReflowSource.__init__-37"><a href="#SalesforceReflowSource.__init__-37"><span class="linenos"> 37</span></a>        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-38"><a href="#SalesforceReflowSource.__init__-38"><span class="linenos"> 38</span></a>        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-39"><a href="#SalesforceReflowSource.__init__-39"><span class="linenos"> 39</span></a>        <span class="n">security_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-40"><a href="#SalesforceReflowSource.__init__-40"><span class="linenos"> 40</span></a>        <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-41"><a href="#SalesforceReflowSource.__init__-41"><span class="linenos"> 41</span></a>        <span class="n">connection_pool</span><span class="p">:</span> <span class="n">PostgresConnectionPool</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-42"><a href="#SalesforceReflowSource.__init__-42"><span class="linenos"> 42</span></a>        <span class="n">offset_manager</span><span class="p">:</span> <span class="n">OffsetManager</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-43"><a href="#SalesforceReflowSource.__init__-43"><span class="linenos"> 43</span></a>        <span class="n">reflow_schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-44"><a href="#SalesforceReflowSource.__init__-44"><span class="linenos"> 44</span></a>        <span class="n">reflow_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-45"><a href="#SalesforceReflowSource.__init__-45"><span class="linenos"> 45</span></a>        <span class="n">reflow_id_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-46"><a href="#SalesforceReflowSource.__init__-46"><span class="linenos"> 46</span></a>        <span class="n">reflow_offset_field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-47"><a href="#SalesforceReflowSource.__init__-47"><span class="linenos"> 47</span></a>        <span class="n">id_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Id&quot;</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-48"><a href="#SalesforceReflowSource.__init__-48"><span class="linenos"> 48</span></a>        <span class="n">reflow_where_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-49"><a href="#SalesforceReflowSource.__init__-49"><span class="linenos"> 49</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-50"><a href="#SalesforceReflowSource.__init__-50"><span class="linenos"> 50</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-51"><a href="#SalesforceReflowSource.__init__-51"><span class="linenos"> 51</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-52"><a href="#SalesforceReflowSource.__init__-52"><span class="linenos"> 52</span></a>        <span class="n">include_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-53"><a href="#SalesforceReflowSource.__init__-53"><span class="linenos"> 53</span></a>        <span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-54"><a href="#SalesforceReflowSource.__init__-54"><span class="linenos"> 54</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceReflowSource.__init__-55"><a href="#SalesforceReflowSource.__init__-55"><span class="linenos"> 55</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `SalesforceReflowSource`.</span>
</span><span id="SalesforceReflowSource.__init__-56"><a href="#SalesforceReflowSource.__init__-56"><span class="linenos"> 56</span></a>
</span><span id="SalesforceReflowSource.__init__-57"><a href="#SalesforceReflowSource.__init__-57"><span class="linenos"> 57</span></a><span class="sd">        Args:</span>
</span><span id="SalesforceReflowSource.__init__-58"><a href="#SalesforceReflowSource.__init__-58"><span class="linenos"> 58</span></a><span class="sd">            entity (str): The salesforce entity to query.</span>
</span><span id="SalesforceReflowSource.__init__-59"><a href="#SalesforceReflowSource.__init__-59"><span class="linenos"> 59</span></a><span class="sd">            fields (list[str]): The fields to select.</span>
</span><span id="SalesforceReflowSource.__init__-60"><a href="#SalesforceReflowSource.__init__-60"><span class="linenos"> 60</span></a><span class="sd">            username (str): Username.</span>
</span><span id="SalesforceReflowSource.__init__-61"><a href="#SalesforceReflowSource.__init__-61"><span class="linenos"> 61</span></a><span class="sd">            password (str): Password.</span>
</span><span id="SalesforceReflowSource.__init__-62"><a href="#SalesforceReflowSource.__init__-62"><span class="linenos"> 62</span></a><span class="sd">            security_token (str): Security token.</span>
</span><span id="SalesforceReflowSource.__init__-63"><a href="#SalesforceReflowSource.__init__-63"><span class="linenos"> 63</span></a><span class="sd">            domain (str): Domain.</span>
</span><span id="SalesforceReflowSource.__init__-64"><a href="#SalesforceReflowSource.__init__-64"><span class="linenos"> 64</span></a><span class="sd">            connection_pool (PostgresConnectionPool): Postgres Connection pool for accessing the reflow table.</span>
</span><span id="SalesforceReflowSource.__init__-65"><a href="#SalesforceReflowSource.__init__-65"><span class="linenos"> 65</span></a><span class="sd">            offset_manager (OffsetManager): Offset manager for managing the current offset.</span>
</span><span id="SalesforceReflowSource.__init__-66"><a href="#SalesforceReflowSource.__init__-66"><span class="linenos"> 66</span></a><span class="sd">            reflow_schema (str): Schema containing the reflow table.</span>
</span><span id="SalesforceReflowSource.__init__-67"><a href="#SalesforceReflowSource.__init__-67"><span class="linenos"> 67</span></a><span class="sd">            reflow_table (str): Reflow table name.</span>
</span><span id="SalesforceReflowSource.__init__-68"><a href="#SalesforceReflowSource.__init__-68"><span class="linenos"> 68</span></a><span class="sd">            reflow_id_field (str): The reflow table field that contains the entity id value.</span>
</span><span id="SalesforceReflowSource.__init__-69"><a href="#SalesforceReflowSource.__init__-69"><span class="linenos"> 69</span></a><span class="sd">            reflow_offset_field (str): The reflow table field to use as the offset.</span>
</span><span id="SalesforceReflowSource.__init__-70"><a href="#SalesforceReflowSource.__init__-70"><span class="linenos"> 70</span></a><span class="sd">            id_field: (str, optional): the salesforce id field.  Defaults to Id.</span>
</span><span id="SalesforceReflowSource.__init__-71"><a href="#SalesforceReflowSource.__init__-71"><span class="linenos"> 71</span></a><span class="sd">            reflow_where_string (str, optional): A SQL WHERE clause to use for select on the reflow table. Defaults to no WHERE clause.</span>
</span><span id="SalesforceReflowSource.__init__-72"><a href="#SalesforceReflowSource.__init__-72"><span class="linenos"> 72</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch from the reflow table. Defaults to 10.</span>
</span><span id="SalesforceReflowSource.__init__-73"><a href="#SalesforceReflowSource.__init__-73"><span class="linenos"> 73</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SalesforceReflowSource.__init__-74"><a href="#SalesforceReflowSource.__init__-74"><span class="linenos"> 74</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SalesforceReflowSource.__init__-75"><a href="#SalesforceReflowSource.__init__-75"><span class="linenos"> 75</span></a><span class="sd">            include_deleted (bool): include soft-deleted records in results.  Defaults to True.</span>
</span><span id="SalesforceReflowSource.__init__-76"><a href="#SalesforceReflowSource.__init__-76"><span class="linenos"> 76</span></a><span class="sd">            api_version (str, optional): Salesforce API version.</span>
</span><span id="SalesforceReflowSource.__init__-77"><a href="#SalesforceReflowSource.__init__-77"><span class="linenos"> 77</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SalesforceReflowSource.__init__-78"><a href="#SalesforceReflowSource.__init__-78"><span class="linenos"> 78</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceReflowSource.__init__-79"><a href="#SalesforceReflowSource.__init__-79"><span class="linenos"> 79</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-80"><a href="#SalesforceReflowSource.__init__-80"><span class="linenos"> 80</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-81"><a href="#SalesforceReflowSource.__init__-81"><span class="linenos"> 81</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-82"><a href="#SalesforceReflowSource.__init__-82"><span class="linenos"> 82</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-83"><a href="#SalesforceReflowSource.__init__-83"><span class="linenos"> 83</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-84"><a href="#SalesforceReflowSource.__init__-84"><span class="linenos"> 84</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource.__init__-85"><a href="#SalesforceReflowSource.__init__-85"><span class="linenos"> 85</span></a>        <span class="n">SalesforceConnectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceReflowSource.__init__-86"><a href="#SalesforceReflowSource.__init__-86"><span class="linenos"> 86</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-87"><a href="#SalesforceReflowSource.__init__-87"><span class="linenos"> 87</span></a>            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-88"><a href="#SalesforceReflowSource.__init__-88"><span class="linenos"> 88</span></a>            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-89"><a href="#SalesforceReflowSource.__init__-89"><span class="linenos"> 89</span></a>            <span class="n">security_token</span><span class="o">=</span><span class="n">security_token</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-90"><a href="#SalesforceReflowSource.__init__-90"><span class="linenos"> 90</span></a>            <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-91"><a href="#SalesforceReflowSource.__init__-91"><span class="linenos"> 91</span></a>            <span class="n">version</span><span class="o">=</span><span class="n">api_version</span><span class="p">,</span>
</span><span id="SalesforceReflowSource.__init__-92"><a href="#SalesforceReflowSource.__init__-92"><span class="linenos"> 92</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource.__init__-93"><a href="#SalesforceReflowSource.__init__-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span> <span class="o">=</span> <span class="n">offset_manager</span>
</span><span id="SalesforceReflowSource.__init__-94"><a href="#SalesforceReflowSource.__init__-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span>
</span><span id="SalesforceReflowSource.__init__-95"><a href="#SalesforceReflowSource.__init__-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="SalesforceReflowSource.__init__-96"><a href="#SalesforceReflowSource.__init__-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span><span id="SalesforceReflowSource.__init__-97"><a href="#SalesforceReflowSource.__init__-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_schema</span> <span class="o">=</span> <span class="n">reflow_schema</span>
</span><span id="SalesforceReflowSource.__init__-98"><a href="#SalesforceReflowSource.__init__-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_table</span> <span class="o">=</span> <span class="n">reflow_table</span>
</span><span id="SalesforceReflowSource.__init__-99"><a href="#SalesforceReflowSource.__init__-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_id_field</span> <span class="o">=</span> <span class="n">reflow_id_field</span>
</span><span id="SalesforceReflowSource.__init__-100"><a href="#SalesforceReflowSource.__init__-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_offset_field</span> <span class="o">=</span> <span class="n">reflow_offset_field</span>
</span><span id="SalesforceReflowSource.__init__-101"><a href="#SalesforceReflowSource.__init__-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id_field</span> <span class="o">=</span> <span class="n">id_field</span>
</span><span id="SalesforceReflowSource.__init__-102"><a href="#SalesforceReflowSource.__init__-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reflow_where_string</span> <span class="o">=</span> <span class="n">reflow_where_string</span>
</span><span id="SalesforceReflowSource.__init__-103"><a href="#SalesforceReflowSource.__init__-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">:</span> <span class="n">PossibleOffsetType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SalesforceReflowSource.__init__-104"><a href="#SalesforceReflowSource.__init__-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">salesforce_query</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SalesforceReflowSource.__init__-105"><a href="#SalesforceReflowSource.__init__-105"><span class="linenos">105</span></a>            <span class="s2">&quot;SELECT {:literal} FROM {:literal} WHERE {:literal} in ({:literal})&quot;</span>
</span><span id="SalesforceReflowSource.__init__-106"><a href="#SalesforceReflowSource.__init__-106"><span class="linenos">106</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource.__init__-107"><a href="#SalesforceReflowSource.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_deleted</span> <span class="o">=</span> <span class="n">include_deleted</span>
</span><span id="SalesforceReflowSource.__init__-108"><a href="#SalesforceReflowSource.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SalesforceReflowSource.__init__-109"><a href="#SalesforceReflowSource.__init__-109"><span class="linenos">109</span></a>        <span class="c1"># calculate maximum batch size based on soql query URL length</span>
</span><span id="SalesforceReflowSource.__init__-110"><a href="#SalesforceReflowSource.__init__-110"><span class="linenos">110</span></a>        <span class="n">effective_batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_effective_batch_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
</span><span id="SalesforceReflowSource.__init__-111"><a href="#SalesforceReflowSource.__init__-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SalesforceReflowSource.__init__-112"><a href="#SalesforceReflowSource.__init__-112"><span class="linenos">112</span></a>            <span class="n">batch_size</span>
</span><span id="SalesforceReflowSource.__init__-113"><a href="#SalesforceReflowSource.__init__-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">effective_batch_size</span>
</span><span id="SalesforceReflowSource.__init__-114"><a href="#SalesforceReflowSource.__init__-114"><span class="linenos">114</span></a>            <span class="k">else</span> <span class="n">effective_batch_size</span>
</span><span id="SalesforceReflowSource.__init__-115"><a href="#SalesforceReflowSource.__init__-115"><span class="linenos">115</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#SalesforceReflowSource">SalesforceReflowSource</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>entity (str):</strong>  The salesforce entity to query.</li>
<li><strong>fields (list[str]):</strong>  The fields to select.</li>
<li><strong>username (str):</strong>  Username.</li>
<li><strong>password (str):</strong>  Password.</li>
<li><strong>security_token (str):</strong>  Security token.</li>
<li><strong>domain (str):</strong>  Domain.</li>
<li><strong>connection_pool (PostgresConnectionPool):</strong>  Postgres Connection pool for accessing the reflow table.</li>
<li><strong>offset_manager (OffsetManager):</strong>  Offset manager for managing the current offset.</li>
<li><strong>reflow_schema (str):</strong>  Schema containing the reflow table.</li>
<li><strong>reflow_table (str):</strong>  Reflow table name.</li>
<li><strong>reflow_id_field (str):</strong>  The reflow table field that contains the entity id value.</li>
<li><strong>reflow_offset_field (str):</strong>  The reflow table field to use as the offset.</li>
<li><strong>id_field:</strong>  (str, optional): the salesforce id field.  Defaults to Id.</li>
<li><strong>reflow_where_string (str, optional):</strong>  A SQL WHERE clause to use for select on the reflow table. Defaults to no WHERE clause.</li>
<li><strong>batch_size (int, optional):</strong>  Number of records to include in each batch from the reflow table. Defaults to 10.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>include_deleted (bool):</strong>  include soft-deleted records in results.  Defaults to True.</li>
<li><strong>api_version (str, optional):</strong>  Salesforce API version.</li>
</ul>
</div>


                            </div>
                            <div id="SalesforceReflowSource.process_batch" class="classattr">
                                        <input id="SalesforceReflowSource.process_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_batch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span>:</span></span>

                <label class="view-source-button" for="SalesforceReflowSource.process_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SalesforceReflowSource.process_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SalesforceReflowSource.process_batch-187"><a href="#SalesforceReflowSource.process_batch-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="SalesforceReflowSource.process_batch-188"><a href="#SalesforceReflowSource.process_batch-188"><span class="linenos">188</span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
</span><span id="SalesforceReflowSource.process_batch-189"><a href="#SalesforceReflowSource.process_batch-189"><span class="linenos">189</span></a>        <span class="n">reflow_records</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SalesforceReflowSource.process_batch-190"><a href="#SalesforceReflowSource.process_batch-190"><span class="linenos">190</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SalesforceReflowSource.process_batch-191"><a href="#SalesforceReflowSource.process_batch-191"><span class="linenos">191</span></a>            <span class="c1"># get id list from postgres offset table</span>
</span><span id="SalesforceReflowSource.process_batch-192"><a href="#SalesforceReflowSource.process_batch-192"><span class="linenos">192</span></a>            <span class="n">reflow_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_reflow_query</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="SalesforceReflowSource.process_batch-193"><a href="#SalesforceReflowSource.process_batch-193"><span class="linenos">193</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SalesforceReflowSource.process_batch-194"><a href="#SalesforceReflowSource.process_batch-194"><span class="linenos">194</span></a>                <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_id_field</span><span class="p">)</span>
</span><span id="SalesforceReflowSource.process_batch-195"><a href="#SalesforceReflowSource.process_batch-195"><span class="linenos">195</span></a>                <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="n">reflow_records</span>
</span><span id="SalesforceReflowSource.process_batch-196"><a href="#SalesforceReflowSource.process_batch-196"><span class="linenos">196</span></a>                <span class="k">if</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_id_field</span><span class="p">)</span>
</span><span id="SalesforceReflowSource.process_batch-197"><a href="#SalesforceReflowSource.process_batch-197"><span class="linenos">197</span></a>            <span class="p">]</span>
</span><span id="SalesforceReflowSource.process_batch-198"><a href="#SalesforceReflowSource.process_batch-198"><span class="linenos">198</span></a>            <span class="n">records</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="SalesforceReflowSource.process_batch-199"><a href="#SalesforceReflowSource.process_batch-199"><span class="linenos">199</span></a>                <span class="n">records</span><span class="o">=</span><span class="p">[</span>
</span><span id="SalesforceReflowSource.process_batch-200"><a href="#SalesforceReflowSource.process_batch-200"><span class="linenos">200</span></a>                    <span class="n">Record</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span>
</span><span id="SalesforceReflowSource.process_batch-201"><a href="#SalesforceReflowSource.process_batch-201"><span class="linenos">201</span></a>                    <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_query_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">())</span>
</span><span id="SalesforceReflowSource.process_batch-202"><a href="#SalesforceReflowSource.process_batch-202"><span class="linenos">202</span></a>                <span class="p">]</span>
</span><span id="SalesforceReflowSource.process_batch-203"><a href="#SalesforceReflowSource.process_batch-203"><span class="linenos">203</span></a>            <span class="p">)</span>
</span><span id="SalesforceReflowSource.process_batch-204"><a href="#SalesforceReflowSource.process_batch-204"><span class="linenos">204</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="SalesforceReflowSource.process_batch-205"><a href="#SalesforceReflowSource.process_batch-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</span><span id="SalesforceReflowSource.process_batch-206"><a href="#SalesforceReflowSource.process_batch-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SalesforceReflowSource.process_batch-207"><a href="#SalesforceReflowSource.process_batch-207"><span class="linenos">207</span></a>            <span class="nb">max</span><span class="p">(</span><span class="n">reflow_records</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflow_offset_field</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="SalesforceReflowSource.process_batch-208"><a href="#SalesforceReflowSource.process_batch-208"><span class="linenos">208</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">reflow_offset_field</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="SalesforceReflowSource.process_batch-209"><a href="#SalesforceReflowSource.process_batch-209"><span class="linenos">209</span></a>            <span class="p">)</span>
</span><span id="SalesforceReflowSource.process_batch-210"><a href="#SalesforceReflowSource.process_batch-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="n">reflow_records</span>
</span><span id="SalesforceReflowSource.process_batch-211"><a href="#SalesforceReflowSource.process_batch-211"><span class="linenos">211</span></a>            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span>
</span><span id="SalesforceReflowSource.process_batch-212"><a href="#SalesforceReflowSource.process_batch-212"><span class="linenos">212</span></a>        <span class="p">)</span>
</span><span id="SalesforceReflowSource.process_batch-213"><a href="#SalesforceReflowSource.process_batch-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="n">records</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="SalesforceReflowSource.unique_name" class="variable">unique_name</dd>
                <dd id="SalesforceReflowSource.pipeline" class="variable">pipeline</dd>
                <dd id="SalesforceReflowSource.add_downstream" class="function">add_downstream</dd>
                <dd id="SalesforceReflowSource.add_upstream" class="function">add_upstream</dd>
                <dd id="SalesforceReflowSource.get_downstreams" class="function">get_downstreams</dd>
                <dd id="SalesforceReflowSource.channels" class="variable">channels</dd>
                <dd id="SalesforceReflowSource.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="SalesforceReflowSource.log" class="variable">log</dd>
                <dd id="SalesforceReflowSource.reset_level" class="function">reset_level</dd>
                <dd id="SalesforceReflowSource.serialize" class="function">serialize</dd>

            </div>
            <div><dt>cluo.connections.salesforce_connection_mixin.SalesforceConnectionMixin</dt>
                                <dd id="SalesforceReflowSource.sf" class="variable">sf</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SalesforceSelectSource">
                            <input id="SalesforceSelectSource-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SalesforceSelectSource</span><wbr>(<span class="base">cluo.core.source.Source</span>, <span class="base">cluo.connections.salesforce_connection_mixin.SalesforceConnectionMixin</span>):

                <label class="view-source-button" for="SalesforceSelectSource-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SalesforceSelectSource"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SalesforceSelectSource-22"><a href="#SalesforceSelectSource-22"><span class="linenos"> 22</span></a><span class="k">class</span> <span class="nc">SalesforceSelectSource</span><span class="p">(</span><span class="n">Source</span><span class="p">,</span> <span class="n">SalesforceConnectionMixin</span><span class="p">):</span>
</span><span id="SalesforceSelectSource-23"><a href="#SalesforceSelectSource-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a batch of data from a Salesforce instance. Records return are from index [offset, offset + batch_size).&quot;&quot;&quot;</span>
</span><span id="SalesforceSelectSource-24"><a href="#SalesforceSelectSource-24"><span class="linenos"> 24</span></a>
</span><span id="SalesforceSelectSource-25"><a href="#SalesforceSelectSource-25"><span class="linenos"> 25</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceSelectSource-26"><a href="#SalesforceSelectSource-26"><span class="linenos"> 26</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-27"><a href="#SalesforceSelectSource-27"><span class="linenos"> 27</span></a>        <span class="n">entity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-28"><a href="#SalesforceSelectSource-28"><span class="linenos"> 28</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SalesforceSelectSource-29"><a href="#SalesforceSelectSource-29"><span class="linenos"> 29</span></a>        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-30"><a href="#SalesforceSelectSource-30"><span class="linenos"> 30</span></a>        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-31"><a href="#SalesforceSelectSource-31"><span class="linenos"> 31</span></a>        <span class="n">security_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-32"><a href="#SalesforceSelectSource-32"><span class="linenos"> 32</span></a>        <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-33"><a href="#SalesforceSelectSource-33"><span class="linenos"> 33</span></a>        <span class="n">offset_manager</span><span class="p">:</span> <span class="n">OffsetManager</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-34"><a href="#SalesforceSelectSource-34"><span class="linenos"> 34</span></a>        <span class="n">offset_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LastModifiedDate&quot;</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-35"><a href="#SalesforceSelectSource-35"><span class="linenos"> 35</span></a>        <span class="n">offset_nonunique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-36"><a href="#SalesforceSelectSource-36"><span class="linenos"> 36</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-37"><a href="#SalesforceSelectSource-37"><span class="linenos"> 37</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-38"><a href="#SalesforceSelectSource-38"><span class="linenos"> 38</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-39"><a href="#SalesforceSelectSource-39"><span class="linenos"> 39</span></a>        <span class="n">include_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-40"><a href="#SalesforceSelectSource-40"><span class="linenos"> 40</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-41"><a href="#SalesforceSelectSource-41"><span class="linenos"> 41</span></a>        <span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-42"><a href="#SalesforceSelectSource-42"><span class="linenos"> 42</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-43"><a href="#SalesforceSelectSource-43"><span class="linenos"> 43</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `SalesforceSelectSource`.</span>
</span><span id="SalesforceSelectSource-44"><a href="#SalesforceSelectSource-44"><span class="linenos"> 44</span></a>
</span><span id="SalesforceSelectSource-45"><a href="#SalesforceSelectSource-45"><span class="linenos"> 45</span></a><span class="sd">        Args:</span>
</span><span id="SalesforceSelectSource-46"><a href="#SalesforceSelectSource-46"><span class="linenos"> 46</span></a><span class="sd">            entity (str): The entity to query.</span>
</span><span id="SalesforceSelectSource-47"><a href="#SalesforceSelectSource-47"><span class="linenos"> 47</span></a><span class="sd">            fields (list[str]): The fields to select.</span>
</span><span id="SalesforceSelectSource-48"><a href="#SalesforceSelectSource-48"><span class="linenos"> 48</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch. Defaults to 10.</span>
</span><span id="SalesforceSelectSource-49"><a href="#SalesforceSelectSource-49"><span class="linenos"> 49</span></a><span class="sd">            username (str): Username.</span>
</span><span id="SalesforceSelectSource-50"><a href="#SalesforceSelectSource-50"><span class="linenos"> 50</span></a><span class="sd">            password (str): Password.</span>
</span><span id="SalesforceSelectSource-51"><a href="#SalesforceSelectSource-51"><span class="linenos"> 51</span></a><span class="sd">            security_token (str): Security token.</span>
</span><span id="SalesforceSelectSource-52"><a href="#SalesforceSelectSource-52"><span class="linenos"> 52</span></a><span class="sd">            domain (str): Domain.</span>
</span><span id="SalesforceSelectSource-53"><a href="#SalesforceSelectSource-53"><span class="linenos"> 53</span></a><span class="sd">            offset_manager (OffsetManager): Offset manager for managing the current offset.</span>
</span><span id="SalesforceSelectSource-54"><a href="#SalesforceSelectSource-54"><span class="linenos"> 54</span></a><span class="sd">            offset_field (str): Datetime field from Salesforce that is used for offset. Defaults to LastModifiedDate.</span>
</span><span id="SalesforceSelectSource-55"><a href="#SalesforceSelectSource-55"><span class="linenos"> 55</span></a><span class="sd">            offset_nonunique (bool): Your offset field is non-unique.  Defaults to False.</span>
</span><span id="SalesforceSelectSource-56"><a href="#SalesforceSelectSource-56"><span class="linenos"> 56</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SalesforceSelectSource-57"><a href="#SalesforceSelectSource-57"><span class="linenos"> 57</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SalesforceSelectSource-58"><a href="#SalesforceSelectSource-58"><span class="linenos"> 58</span></a><span class="sd">            include_deleted (bool, optional): include soft-deleted records in results.  Defaults to True.</span>
</span><span id="SalesforceSelectSource-59"><a href="#SalesforceSelectSource-59"><span class="linenos"> 59</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="SalesforceSelectSource-60"><a href="#SalesforceSelectSource-60"><span class="linenos"> 60</span></a><span class="sd">            api_version (str, optional): Salesforce API version.</span>
</span><span id="SalesforceSelectSource-61"><a href="#SalesforceSelectSource-61"><span class="linenos"> 61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SalesforceSelectSource-62"><a href="#SalesforceSelectSource-62"><span class="linenos"> 62</span></a>
</span><span id="SalesforceSelectSource-63"><a href="#SalesforceSelectSource-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT {:literal} FROM {:literal} WHERE {:literal} &gt; {:literal} ORDER BY {:literal} LIMIT </span><span class="si">{}</span><span class="s2"> OFFSET </span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="SalesforceSelectSource-64"><a href="#SalesforceSelectSource-64"><span class="linenos"> 64</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceSelectSource-65"><a href="#SalesforceSelectSource-65"><span class="linenos"> 65</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-66"><a href="#SalesforceSelectSource-66"><span class="linenos"> 66</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-67"><a href="#SalesforceSelectSource-67"><span class="linenos"> 67</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-68"><a href="#SalesforceSelectSource-68"><span class="linenos"> 68</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-69"><a href="#SalesforceSelectSource-69"><span class="linenos"> 69</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-70"><a href="#SalesforceSelectSource-70"><span class="linenos"> 70</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-71"><a href="#SalesforceSelectSource-71"><span class="linenos"> 71</span></a>        <span class="p">)</span>
</span><span id="SalesforceSelectSource-72"><a href="#SalesforceSelectSource-72"><span class="linenos"> 72</span></a>        <span class="n">SalesforceConnectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceSelectSource-73"><a href="#SalesforceSelectSource-73"><span class="linenos"> 73</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-74"><a href="#SalesforceSelectSource-74"><span class="linenos"> 74</span></a>            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-75"><a href="#SalesforceSelectSource-75"><span class="linenos"> 75</span></a>            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-76"><a href="#SalesforceSelectSource-76"><span class="linenos"> 76</span></a>            <span class="n">security_token</span><span class="o">=</span><span class="n">security_token</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-77"><a href="#SalesforceSelectSource-77"><span class="linenos"> 77</span></a>            <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-78"><a href="#SalesforceSelectSource-78"><span class="linenos"> 78</span></a>            <span class="n">version</span><span class="o">=</span><span class="n">api_version</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-79"><a href="#SalesforceSelectSource-79"><span class="linenos"> 79</span></a>        <span class="p">)</span>
</span><span id="SalesforceSelectSource-80"><a href="#SalesforceSelectSource-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span> <span class="o">=</span> <span class="n">offset_manager</span>
</span><span id="SalesforceSelectSource-81"><a href="#SalesforceSelectSource-81"><span class="linenos"> 81</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-82"><a href="#SalesforceSelectSource-82"><span class="linenos"> 82</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Salesforce batch_size must be greater than 1&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-83"><a href="#SalesforceSelectSource-83"><span class="linenos"> 83</span></a>        <span class="k">if</span> <span class="n">offset_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-84"><a href="#SalesforceSelectSource-84"><span class="linenos"> 84</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Offset field must be in fields list&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-85"><a href="#SalesforceSelectSource-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="s2">&quot;Id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-86"><a href="#SalesforceSelectSource-86"><span class="linenos"> 86</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Id field must be in fields list&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-87"><a href="#SalesforceSelectSource-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span>
</span><span id="SalesforceSelectSource-88"><a href="#SalesforceSelectSource-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="SalesforceSelectSource-89"><a href="#SalesforceSelectSource-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="n">offset_manager</span><span class="o">.</span><span class="n">initial_offset</span>
</span><span id="SalesforceSelectSource-90"><a href="#SalesforceSelectSource-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span> <span class="o">=</span> <span class="n">offset_field</span>
</span><span id="SalesforceSelectSource-91"><a href="#SalesforceSelectSource-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset_nonunique</span> <span class="o">=</span> <span class="n">offset_nonunique</span>
</span><span id="SalesforceSelectSource-92"><a href="#SalesforceSelectSource-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SalesforceSelectSource-93"><a href="#SalesforceSelectSource-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_deleted</span> <span class="o">=</span> <span class="n">include_deleted</span>
</span><span id="SalesforceSelectSource-94"><a href="#SalesforceSelectSource-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_processed_offset</span><span class="p">:</span> <span class="n">PossibleOffsetType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SalesforceSelectSource-95"><a href="#SalesforceSelectSource-95"><span class="linenos"> 95</span></a>
</span><span id="SalesforceSelectSource-96"><a href="#SalesforceSelectSource-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="nf">_prepare_soql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-97"><a href="#SalesforceSelectSource-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_id</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-98"><a href="#SalesforceSelectSource-98"><span class="linenos"> 98</span></a>            <span class="c1"># If offset is non-unique, we need to use the Id field to ensure deterministic ordering/batches</span>
</span><span id="SalesforceSelectSource-99"><a href="#SalesforceSelectSource-99"><span class="linenos"> 99</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">offset_type</span> <span class="o">==</span> <span class="n">OffsetType</span><span class="o">.</span><span class="n">STR</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-100"><a href="#SalesforceSelectSource-100"><span class="linenos">100</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT {:literal} FROM {:literal} WHERE ({:literal} &gt; </span><span class="si">{}</span><span class="s2">) OR ({:literal} = </span><span class="si">{}</span><span class="s2"> AND Id &gt; </span><span class="si">{}</span><span class="s2">) ORDER BY {:literal}, Id LIMIT </span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="SalesforceSelectSource-101"><a href="#SalesforceSelectSource-101"><span class="linenos">101</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-102"><a href="#SalesforceSelectSource-102"><span class="linenos">102</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT {:literal} FROM {:literal} WHERE ({:literal} &gt; {:literal}) OR ({:literal} = {:literal} AND Id &gt; </span><span class="si">{}</span><span class="s2">) ORDER BY {:literal}, Id LIMIT </span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="SalesforceSelectSource-103"><a href="#SalesforceSelectSource-103"><span class="linenos">103</span></a>
</span><span id="SalesforceSelectSource-104"><a href="#SalesforceSelectSource-104"><span class="linenos">104</span></a>            <span class="n">query</span> <span class="o">=</span> <span class="n">format_soql</span><span class="p">(</span>
</span><span id="SalesforceSelectSource-105"><a href="#SalesforceSelectSource-105"><span class="linenos">105</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-106"><a href="#SalesforceSelectSource-106"><span class="linenos">106</span></a>                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">),</span>
</span><span id="SalesforceSelectSource-107"><a href="#SalesforceSelectSource-107"><span class="linenos">107</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-108"><a href="#SalesforceSelectSource-108"><span class="linenos">108</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-109"><a href="#SalesforceSelectSource-109"><span class="linenos">109</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_format_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">),</span>
</span><span id="SalesforceSelectSource-110"><a href="#SalesforceSelectSource-110"><span class="linenos">110</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-111"><a href="#SalesforceSelectSource-111"><span class="linenos">111</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_format_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">),</span>
</span><span id="SalesforceSelectSource-112"><a href="#SalesforceSelectSource-112"><span class="linenos">112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_id</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-113"><a href="#SalesforceSelectSource-113"><span class="linenos">113</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-114"><a href="#SalesforceSelectSource-114"><span class="linenos">114</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-115"><a href="#SalesforceSelectSource-115"><span class="linenos">115</span></a>            <span class="p">)</span>
</span><span id="SalesforceSelectSource-116"><a href="#SalesforceSelectSource-116"><span class="linenos">116</span></a>            <span class="k">return</span> <span class="n">query</span>
</span><span id="SalesforceSelectSource-117"><a href="#SalesforceSelectSource-117"><span class="linenos">117</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-118"><a href="#SalesforceSelectSource-118"><span class="linenos">118</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">offset_type</span> <span class="o">==</span> <span class="n">OffsetType</span><span class="o">.</span><span class="n">STR</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-119"><a href="#SalesforceSelectSource-119"><span class="linenos">119</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT {:literal} FROM {:literal} WHERE {:literal} &gt; </span><span class="si">{}</span><span class="s2"> ORDER BY {:literal}, Id LIMIT </span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="SalesforceSelectSource-120"><a href="#SalesforceSelectSource-120"><span class="linenos">120</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-121"><a href="#SalesforceSelectSource-121"><span class="linenos">121</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT {:literal} FROM {:literal} WHERE {:literal} &gt; {:literal} ORDER BY {:literal}, Id LIMIT </span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="SalesforceSelectSource-122"><a href="#SalesforceSelectSource-122"><span class="linenos">122</span></a>
</span><span id="SalesforceSelectSource-123"><a href="#SalesforceSelectSource-123"><span class="linenos">123</span></a>            <span class="n">query</span> <span class="o">=</span> <span class="n">format_soql</span><span class="p">(</span>
</span><span id="SalesforceSelectSource-124"><a href="#SalesforceSelectSource-124"><span class="linenos">124</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-125"><a href="#SalesforceSelectSource-125"><span class="linenos">125</span></a>                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">),</span>
</span><span id="SalesforceSelectSource-126"><a href="#SalesforceSelectSource-126"><span class="linenos">126</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-127"><a href="#SalesforceSelectSource-127"><span class="linenos">127</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-128"><a href="#SalesforceSelectSource-128"><span class="linenos">128</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_format_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">),</span>
</span><span id="SalesforceSelectSource-129"><a href="#SalesforceSelectSource-129"><span class="linenos">129</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-130"><a href="#SalesforceSelectSource-130"><span class="linenos">130</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-131"><a href="#SalesforceSelectSource-131"><span class="linenos">131</span></a>            <span class="p">)</span>
</span><span id="SalesforceSelectSource-132"><a href="#SalesforceSelectSource-132"><span class="linenos">132</span></a>            <span class="k">return</span> <span class="n">query</span>
</span><span id="SalesforceSelectSource-133"><a href="#SalesforceSelectSource-133"><span class="linenos">133</span></a>
</span><span id="SalesforceSelectSource-134"><a href="#SalesforceSelectSource-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="nf">_process_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="SalesforceSelectSource-135"><a href="#SalesforceSelectSource-135"><span class="linenos">135</span></a>        <span class="n">records</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;records&quot;</span><span class="p">]]</span>
</span><span id="SalesforceSelectSource-136"><a href="#SalesforceSelectSource-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">records</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-137"><a href="#SalesforceSelectSource-137"><span class="linenos">137</span></a>            <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-138"><a href="#SalesforceSelectSource-138"><span class="linenos">138</span></a>                <span class="k">if</span> <span class="s2">&quot;attributes&quot;</span> <span class="ow">in</span> <span class="n">record</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-139"><a href="#SalesforceSelectSource-139"><span class="linenos">139</span></a>                    <span class="k">del</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>
</span><span id="SalesforceSelectSource-140"><a href="#SalesforceSelectSource-140"><span class="linenos">140</span></a>                <span class="c1"># Convert offset to datetime if offset is datetime</span>
</span><span id="SalesforceSelectSource-141"><a href="#SalesforceSelectSource-141"><span class="linenos">141</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">offset_type</span> <span class="o">==</span> <span class="n">OffsetType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-142"><a href="#SalesforceSelectSource-142"><span class="linenos">142</span></a>                    <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span>
</span><span id="SalesforceSelectSource-143"><a href="#SalesforceSelectSource-143"><span class="linenos">143</span></a>                        <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">]</span>
</span><span id="SalesforceSelectSource-144"><a href="#SalesforceSelectSource-144"><span class="linenos">144</span></a>                    <span class="p">)</span>
</span><span id="SalesforceSelectSource-145"><a href="#SalesforceSelectSource-145"><span class="linenos">145</span></a>        <span class="k">return</span> <span class="n">records</span>
</span><span id="SalesforceSelectSource-146"><a href="#SalesforceSelectSource-146"><span class="linenos">146</span></a>
</span><span id="SalesforceSelectSource-147"><a href="#SalesforceSelectSource-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">_execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-148"><a href="#SalesforceSelectSource-148"><span class="linenos">148</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_soql</span><span class="p">()</span>
</span><span id="SalesforceSelectSource-149"><a href="#SalesforceSelectSource-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sf</span><span class="o">.</span><span class="n">query_all</span><span class="p">(</span>
</span><span id="SalesforceSelectSource-150"><a href="#SalesforceSelectSource-150"><span class="linenos">150</span></a>            <span class="n">query</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-151"><a href="#SalesforceSelectSource-151"><span class="linenos">151</span></a>            <span class="n">include_deleted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">include_deleted</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-152"><a href="#SalesforceSelectSource-152"><span class="linenos">152</span></a>        <span class="p">)</span>
</span><span id="SalesforceSelectSource-153"><a href="#SalesforceSelectSource-153"><span class="linenos">153</span></a>
</span><span id="SalesforceSelectSource-154"><a href="#SalesforceSelectSource-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-155"><a href="#SalesforceSelectSource-155"><span class="linenos">155</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="SalesforceSelectSource-156"><a href="#SalesforceSelectSource-156"><span class="linenos">156</span></a>            <span class="n">records</span><span class="o">=</span><span class="p">[</span>
</span><span id="SalesforceSelectSource-157"><a href="#SalesforceSelectSource-157"><span class="linenos">157</span></a>                <span class="n">Record</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-158"><a href="#SalesforceSelectSource-158"><span class="linenos">158</span></a>                <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_query_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">())</span>
</span><span id="SalesforceSelectSource-159"><a href="#SalesforceSelectSource-159"><span class="linenos">159</span></a>            <span class="p">]</span>
</span><span id="SalesforceSelectSource-160"><a href="#SalesforceSelectSource-160"><span class="linenos">160</span></a>        <span class="p">)</span>
</span><span id="SalesforceSelectSource-161"><a href="#SalesforceSelectSource-161"><span class="linenos">161</span></a>
</span><span id="SalesforceSelectSource-162"><a href="#SalesforceSelectSource-162"><span class="linenos">162</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_nonunique</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-163"><a href="#SalesforceSelectSource-163"><span class="linenos">163</span></a>            <span class="c1"># If we have a full batch and offset is non-unique, store the last Id from the previous batch.</span>
</span><span id="SalesforceSelectSource-164"><a href="#SalesforceSelectSource-164"><span class="linenos">164</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-165"><a href="#SalesforceSelectSource-165"><span class="linenos">165</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_id</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-166"><a href="#SalesforceSelectSource-166"><span class="linenos">166</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-167"><a href="#SalesforceSelectSource-167"><span class="linenos">167</span></a>                <span class="c1"># If we have a partial or empty batch, we are done paging.  Use current max.</span>
</span><span id="SalesforceSelectSource-168"><a href="#SalesforceSelectSource-168"><span class="linenos">168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SalesforceSelectSource-169"><a href="#SalesforceSelectSource-169"><span class="linenos">169</span></a>
</span><span id="SalesforceSelectSource-170"><a href="#SalesforceSelectSource-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">max_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-171"><a href="#SalesforceSelectSource-171"><span class="linenos">171</span></a>
</span><span id="SalesforceSelectSource-172"><a href="#SalesforceSelectSource-172"><span class="linenos">172</span></a>        <span class="k">return</span> <span class="n">batch</span>
</span><span id="SalesforceSelectSource-173"><a href="#SalesforceSelectSource-173"><span class="linenos">173</span></a>
</span><span id="SalesforceSelectSource-174"><a href="#SalesforceSelectSource-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">_set_offset_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-175"><a href="#SalesforceSelectSource-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">set_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_name</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-176"><a href="#SalesforceSelectSource-176"><span class="linenos">176</span></a>
</span><span id="SalesforceSelectSource-177"><a href="#SalesforceSelectSource-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-178"><a href="#SalesforceSelectSource-178"><span class="linenos">178</span></a>        <span class="k">if</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">WRITE</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-179"><a href="#SalesforceSelectSource-179"><span class="linenos">179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_offset_key</span><span class="p">()</span>
</span><span id="SalesforceSelectSource-180"><a href="#SalesforceSelectSource-180"><span class="linenos">180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="SalesforceSelectSource-181"><a href="#SalesforceSelectSource-181"><span class="linenos">181</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-182"><a href="#SalesforceSelectSource-182"><span class="linenos">182</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">initial_offset</span>
</span><span id="SalesforceSelectSource-183"><a href="#SalesforceSelectSource-183"><span class="linenos">183</span></a>        <span class="k">elif</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">PREVIEW</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-184"><a href="#SalesforceSelectSource-184"><span class="linenos">184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="SalesforceSelectSource-185"><a href="#SalesforceSelectSource-185"><span class="linenos">185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-186"><a href="#SalesforceSelectSource-186"><span class="linenos">186</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown run mode.&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-187"><a href="#SalesforceSelectSource-187"><span class="linenos">187</span></a>
</span><span id="SalesforceSelectSource-188"><a href="#SalesforceSelectSource-188"><span class="linenos">188</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
</span><span id="SalesforceSelectSource-189"><a href="#SalesforceSelectSource-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-190"><a href="#SalesforceSelectSource-190"><span class="linenos">190</span></a>        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-191"><a href="#SalesforceSelectSource-191"><span class="linenos">191</span></a>        <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-192"><a href="#SalesforceSelectSource-192"><span class="linenos">192</span></a>        <span class="n">exc_tb</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceSelectSource-193"><a href="#SalesforceSelectSource-193"><span class="linenos">193</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-194"><a href="#SalesforceSelectSource-194"><span class="linenos">194</span></a>        <span class="n">has_exception</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SalesforceSelectSource-195"><a href="#SalesforceSelectSource-195"><span class="linenos">195</span></a>            <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">exc_tb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SalesforceSelectSource-196"><a href="#SalesforceSelectSource-196"><span class="linenos">196</span></a>        <span class="p">)</span>
</span><span id="SalesforceSelectSource-197"><a href="#SalesforceSelectSource-197"><span class="linenos">197</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_exception</span> <span class="ow">and</span> <span class="n">config_state</span><span class="o">.</span><span class="n">RUN_MODE</span> <span class="o">==</span> <span class="n">RunMode</span><span class="o">.</span><span class="n">WRITE</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-198"><a href="#SalesforceSelectSource-198"><span class="linenos">198</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_offset_key</span><span class="p">()</span>
</span><span id="SalesforceSelectSource-199"><a href="#SalesforceSelectSource-199"><span class="linenos">199</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-200"><a href="#SalesforceSelectSource-200"><span class="linenos">200</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-201"><a href="#SalesforceSelectSource-201"><span class="linenos">201</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="SalesforceSelectSource-202"><a href="#SalesforceSelectSource-202"><span class="linenos">202</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="SalesforceSelectSource-203"><a href="#SalesforceSelectSource-203"><span class="linenos">203</span></a>
</span><span id="SalesforceSelectSource-204"><a href="#SalesforceSelectSource-204"><span class="linenos">204</span></a>    <span class="k">def</span> <span class="nf">_format_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="n">PossibleOffsetType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SalesforceSelectSource-205"><a href="#SalesforceSelectSource-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
</span><span id="SalesforceSelectSource-206"><a href="#SalesforceSelectSource-206"><span class="linenos">206</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="SalesforceSelectSource-207"><a href="#SalesforceSelectSource-207"><span class="linenos">207</span></a>                <span class="n">offset</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-208"><a href="#SalesforceSelectSource-208"><span class="linenos">208</span></a>                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-209"><a href="#SalesforceSelectSource-209"><span class="linenos">209</span></a>                <span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="SalesforceSelectSource-210"><a href="#SalesforceSelectSource-210"><span class="linenos">210</span></a>                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource-211"><a href="#SalesforceSelectSource-211"><span class="linenos">211</span></a>            <span class="p">)</span>
</span><span id="SalesforceSelectSource-212"><a href="#SalesforceSelectSource-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a batch of data from a Salesforce instance. Records return are from index [offset, offset + batch_size).</p>
</div>


                            <div id="SalesforceSelectSource.__init__" class="classattr">
                                        <input id="SalesforceSelectSource.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SalesforceSelectSource</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">entity</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">username</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">password</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">security_token</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">domain</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">offset_manager</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">offset_manager</span><span class="o">.</span><span class="n">OffsetManager</span>,</span><span class="param">	<span class="n">offset_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;LastModifiedDate&#39;</span>,</span><span class="param">	<span class="n">offset_nonunique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">error_handling_method</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">STOP_PIPELINE</span><span class="p">:</span> <span class="mi">3</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">include_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="SalesforceSelectSource.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SalesforceSelectSource.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SalesforceSelectSource.__init__-25"><a href="#SalesforceSelectSource.__init__-25"><span class="linenos">25</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceSelectSource.__init__-26"><a href="#SalesforceSelectSource.__init__-26"><span class="linenos">26</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-27"><a href="#SalesforceSelectSource.__init__-27"><span class="linenos">27</span></a>        <span class="n">entity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-28"><a href="#SalesforceSelectSource.__init__-28"><span class="linenos">28</span></a>        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="SalesforceSelectSource.__init__-29"><a href="#SalesforceSelectSource.__init__-29"><span class="linenos">29</span></a>        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-30"><a href="#SalesforceSelectSource.__init__-30"><span class="linenos">30</span></a>        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-31"><a href="#SalesforceSelectSource.__init__-31"><span class="linenos">31</span></a>        <span class="n">security_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-32"><a href="#SalesforceSelectSource.__init__-32"><span class="linenos">32</span></a>        <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-33"><a href="#SalesforceSelectSource.__init__-33"><span class="linenos">33</span></a>        <span class="n">offset_manager</span><span class="p">:</span> <span class="n">OffsetManager</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-34"><a href="#SalesforceSelectSource.__init__-34"><span class="linenos">34</span></a>        <span class="n">offset_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LastModifiedDate&quot;</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-35"><a href="#SalesforceSelectSource.__init__-35"><span class="linenos">35</span></a>        <span class="n">offset_nonunique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-36"><a href="#SalesforceSelectSource.__init__-36"><span class="linenos">36</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-37"><a href="#SalesforceSelectSource.__init__-37"><span class="linenos">37</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-38"><a href="#SalesforceSelectSource.__init__-38"><span class="linenos">38</span></a>        <span class="n">error_handling_method</span><span class="p">:</span> <span class="n">ErrorHandlingMethod</span> <span class="o">=</span> <span class="n">ErrorHandlingMethod</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-39"><a href="#SalesforceSelectSource.__init__-39"><span class="linenos">39</span></a>        <span class="n">include_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-40"><a href="#SalesforceSelectSource.__init__-40"><span class="linenos">40</span></a>        <span class="n">expose_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-41"><a href="#SalesforceSelectSource.__init__-41"><span class="linenos">41</span></a>        <span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-42"><a href="#SalesforceSelectSource.__init__-42"><span class="linenos">42</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SalesforceSelectSource.__init__-43"><a href="#SalesforceSelectSource.__init__-43"><span class="linenos">43</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the `SalesforceSelectSource`.</span>
</span><span id="SalesforceSelectSource.__init__-44"><a href="#SalesforceSelectSource.__init__-44"><span class="linenos">44</span></a>
</span><span id="SalesforceSelectSource.__init__-45"><a href="#SalesforceSelectSource.__init__-45"><span class="linenos">45</span></a><span class="sd">        Args:</span>
</span><span id="SalesforceSelectSource.__init__-46"><a href="#SalesforceSelectSource.__init__-46"><span class="linenos">46</span></a><span class="sd">            entity (str): The entity to query.</span>
</span><span id="SalesforceSelectSource.__init__-47"><a href="#SalesforceSelectSource.__init__-47"><span class="linenos">47</span></a><span class="sd">            fields (list[str]): The fields to select.</span>
</span><span id="SalesforceSelectSource.__init__-48"><a href="#SalesforceSelectSource.__init__-48"><span class="linenos">48</span></a><span class="sd">            batch_size (int, optional): Number of records to include in each batch. Defaults to 10.</span>
</span><span id="SalesforceSelectSource.__init__-49"><a href="#SalesforceSelectSource.__init__-49"><span class="linenos">49</span></a><span class="sd">            username (str): Username.</span>
</span><span id="SalesforceSelectSource.__init__-50"><a href="#SalesforceSelectSource.__init__-50"><span class="linenos">50</span></a><span class="sd">            password (str): Password.</span>
</span><span id="SalesforceSelectSource.__init__-51"><a href="#SalesforceSelectSource.__init__-51"><span class="linenos">51</span></a><span class="sd">            security_token (str): Security token.</span>
</span><span id="SalesforceSelectSource.__init__-52"><a href="#SalesforceSelectSource.__init__-52"><span class="linenos">52</span></a><span class="sd">            domain (str): Domain.</span>
</span><span id="SalesforceSelectSource.__init__-53"><a href="#SalesforceSelectSource.__init__-53"><span class="linenos">53</span></a><span class="sd">            offset_manager (OffsetManager): Offset manager for managing the current offset.</span>
</span><span id="SalesforceSelectSource.__init__-54"><a href="#SalesforceSelectSource.__init__-54"><span class="linenos">54</span></a><span class="sd">            offset_field (str): Datetime field from Salesforce that is used for offset. Defaults to LastModifiedDate.</span>
</span><span id="SalesforceSelectSource.__init__-55"><a href="#SalesforceSelectSource.__init__-55"><span class="linenos">55</span></a><span class="sd">            offset_nonunique (bool): Your offset field is non-unique.  Defaults to False.</span>
</span><span id="SalesforceSelectSource.__init__-56"><a href="#SalesforceSelectSource.__init__-56"><span class="linenos">56</span></a><span class="sd">            name (str, optional): Stage name. Defaults to class name if name = None.</span>
</span><span id="SalesforceSelectSource.__init__-57"><a href="#SalesforceSelectSource.__init__-57"><span class="linenos">57</span></a><span class="sd">            error_handling_method (ErrorHandlingMethod, optional): Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</span>
</span><span id="SalesforceSelectSource.__init__-58"><a href="#SalesforceSelectSource.__init__-58"><span class="linenos">58</span></a><span class="sd">            include_deleted (bool, optional): include soft-deleted records in results.  Defaults to True.</span>
</span><span id="SalesforceSelectSource.__init__-59"><a href="#SalesforceSelectSource.__init__-59"><span class="linenos">59</span></a><span class="sd">            expose_metrics (bool, optional): Whether or not to expose metrics for this source. Defaults to False.</span>
</span><span id="SalesforceSelectSource.__init__-60"><a href="#SalesforceSelectSource.__init__-60"><span class="linenos">60</span></a><span class="sd">            api_version (str, optional): Salesforce API version.</span>
</span><span id="SalesforceSelectSource.__init__-61"><a href="#SalesforceSelectSource.__init__-61"><span class="linenos">61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SalesforceSelectSource.__init__-62"><a href="#SalesforceSelectSource.__init__-62"><span class="linenos">62</span></a>
</span><span id="SalesforceSelectSource.__init__-63"><a href="#SalesforceSelectSource.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT {:literal} FROM {:literal} WHERE {:literal} &gt; {:literal} ORDER BY {:literal} LIMIT </span><span class="si">{}</span><span class="s2"> OFFSET </span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="SalesforceSelectSource.__init__-64"><a href="#SalesforceSelectSource.__init__-64"><span class="linenos">64</span></a>        <span class="n">Source</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceSelectSource.__init__-65"><a href="#SalesforceSelectSource.__init__-65"><span class="linenos">65</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-66"><a href="#SalesforceSelectSource.__init__-66"><span class="linenos">66</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-67"><a href="#SalesforceSelectSource.__init__-67"><span class="linenos">67</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-68"><a href="#SalesforceSelectSource.__init__-68"><span class="linenos">68</span></a>            <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-69"><a href="#SalesforceSelectSource.__init__-69"><span class="linenos">69</span></a>            <span class="n">error_handling_method</span><span class="o">=</span><span class="n">error_handling_method</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-70"><a href="#SalesforceSelectSource.__init__-70"><span class="linenos">70</span></a>            <span class="n">expose_metrics</span><span class="o">=</span><span class="n">expose_metrics</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-71"><a href="#SalesforceSelectSource.__init__-71"><span class="linenos">71</span></a>        <span class="p">)</span>
</span><span id="SalesforceSelectSource.__init__-72"><a href="#SalesforceSelectSource.__init__-72"><span class="linenos">72</span></a>        <span class="n">SalesforceConnectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SalesforceSelectSource.__init__-73"><a href="#SalesforceSelectSource.__init__-73"><span class="linenos">73</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-74"><a href="#SalesforceSelectSource.__init__-74"><span class="linenos">74</span></a>            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-75"><a href="#SalesforceSelectSource.__init__-75"><span class="linenos">75</span></a>            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-76"><a href="#SalesforceSelectSource.__init__-76"><span class="linenos">76</span></a>            <span class="n">security_token</span><span class="o">=</span><span class="n">security_token</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-77"><a href="#SalesforceSelectSource.__init__-77"><span class="linenos">77</span></a>            <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-78"><a href="#SalesforceSelectSource.__init__-78"><span class="linenos">78</span></a>            <span class="n">version</span><span class="o">=</span><span class="n">api_version</span><span class="p">,</span>
</span><span id="SalesforceSelectSource.__init__-79"><a href="#SalesforceSelectSource.__init__-79"><span class="linenos">79</span></a>        <span class="p">)</span>
</span><span id="SalesforceSelectSource.__init__-80"><a href="#SalesforceSelectSource.__init__-80"><span class="linenos">80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset_manager</span> <span class="o">=</span> <span class="n">offset_manager</span>
</span><span id="SalesforceSelectSource.__init__-81"><a href="#SalesforceSelectSource.__init__-81"><span class="linenos">81</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SalesforceSelectSource.__init__-82"><a href="#SalesforceSelectSource.__init__-82"><span class="linenos">82</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Salesforce batch_size must be greater than 1&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource.__init__-83"><a href="#SalesforceSelectSource.__init__-83"><span class="linenos">83</span></a>        <span class="k">if</span> <span class="n">offset_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="SalesforceSelectSource.__init__-84"><a href="#SalesforceSelectSource.__init__-84"><span class="linenos">84</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Offset field must be in fields list&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource.__init__-85"><a href="#SalesforceSelectSource.__init__-85"><span class="linenos">85</span></a>        <span class="k">if</span> <span class="s2">&quot;Id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="SalesforceSelectSource.__init__-86"><a href="#SalesforceSelectSource.__init__-86"><span class="linenos">86</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Id field must be in fields list&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource.__init__-87"><a href="#SalesforceSelectSource.__init__-87"><span class="linenos">87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span>
</span><span id="SalesforceSelectSource.__init__-88"><a href="#SalesforceSelectSource.__init__-88"><span class="linenos">88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
</span><span id="SalesforceSelectSource.__init__-89"><a href="#SalesforceSelectSource.__init__-89"><span class="linenos">89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="n">offset_manager</span><span class="o">.</span><span class="n">initial_offset</span>
</span><span id="SalesforceSelectSource.__init__-90"><a href="#SalesforceSelectSource.__init__-90"><span class="linenos">90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span> <span class="o">=</span> <span class="n">offset_field</span>
</span><span id="SalesforceSelectSource.__init__-91"><a href="#SalesforceSelectSource.__init__-91"><span class="linenos">91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset_nonunique</span> <span class="o">=</span> <span class="n">offset_nonunique</span>
</span><span id="SalesforceSelectSource.__init__-92"><a href="#SalesforceSelectSource.__init__-92"><span class="linenos">92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SalesforceSelectSource.__init__-93"><a href="#SalesforceSelectSource.__init__-93"><span class="linenos">93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_deleted</span> <span class="o">=</span> <span class="n">include_deleted</span>
</span><span id="SalesforceSelectSource.__init__-94"><a href="#SalesforceSelectSource.__init__-94"><span class="linenos">94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_processed_offset</span><span class="p">:</span> <span class="n">PossibleOffsetType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the <code><a href="#SalesforceSelectSource">SalesforceSelectSource</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>entity (str):</strong>  The entity to query.</li>
<li><strong>fields (list[str]):</strong>  The fields to select.</li>
<li><strong>batch_size (int, optional):</strong>  Number of records to include in each batch. Defaults to 10.</li>
<li><strong>username (str):</strong>  Username.</li>
<li><strong>password (str):</strong>  Password.</li>
<li><strong>security_token (str):</strong>  Security token.</li>
<li><strong>domain (str):</strong>  Domain.</li>
<li><strong>offset_manager (OffsetManager):</strong>  Offset manager for managing the current offset.</li>
<li><strong>offset_field (str):</strong>  Datetime field from Salesforce that is used for offset. Defaults to LastModifiedDate.</li>
<li><strong>offset_nonunique (bool):</strong>  Your offset field is non-unique.  Defaults to False.</li>
<li><strong>name (str, optional):</strong>  Stage name. Defaults to class name if name = None.</li>
<li><strong>error_handling_method (ErrorHandlingMethod, optional):</strong>  Enum that represents how the stage would like the pipeline to handle errors which occur when running this stage. By default, errors will be raised.</li>
<li><strong>include_deleted (bool, optional):</strong>  include soft-deleted records in results.  Defaults to True.</li>
<li><strong>expose_metrics (bool, optional):</strong>  Whether or not to expose metrics for this source. Defaults to False.</li>
<li><strong>api_version (str, optional):</strong>  Salesforce API version.</li>
</ul>
</div>


                            </div>
                            <div id="SalesforceSelectSource.process_batch" class="classattr">
                                        <input id="SalesforceSelectSource.process_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_batch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">cluo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Batch</span>:</span></span>

                <label class="view-source-button" for="SalesforceSelectSource.process_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SalesforceSelectSource.process_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SalesforceSelectSource.process_batch-154"><a href="#SalesforceSelectSource.process_batch-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Batch</span><span class="p">:</span>
</span><span id="SalesforceSelectSource.process_batch-155"><a href="#SalesforceSelectSource.process_batch-155"><span class="linenos">155</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span>
</span><span id="SalesforceSelectSource.process_batch-156"><a href="#SalesforceSelectSource.process_batch-156"><span class="linenos">156</span></a>            <span class="n">records</span><span class="o">=</span><span class="p">[</span>
</span><span id="SalesforceSelectSource.process_batch-157"><a href="#SalesforceSelectSource.process_batch-157"><span class="linenos">157</span></a>                <span class="n">Record</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span>
</span><span id="SalesforceSelectSource.process_batch-158"><a href="#SalesforceSelectSource.process_batch-158"><span class="linenos">158</span></a>                <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_query_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">())</span>
</span><span id="SalesforceSelectSource.process_batch-159"><a href="#SalesforceSelectSource.process_batch-159"><span class="linenos">159</span></a>            <span class="p">]</span>
</span><span id="SalesforceSelectSource.process_batch-160"><a href="#SalesforceSelectSource.process_batch-160"><span class="linenos">160</span></a>        <span class="p">)</span>
</span><span id="SalesforceSelectSource.process_batch-161"><a href="#SalesforceSelectSource.process_batch-161"><span class="linenos">161</span></a>
</span><span id="SalesforceSelectSource.process_batch-162"><a href="#SalesforceSelectSource.process_batch-162"><span class="linenos">162</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_nonunique</span><span class="p">:</span>
</span><span id="SalesforceSelectSource.process_batch-163"><a href="#SalesforceSelectSource.process_batch-163"><span class="linenos">163</span></a>            <span class="c1"># If we have a full batch and offset is non-unique, store the last Id from the previous batch.</span>
</span><span id="SalesforceSelectSource.process_batch-164"><a href="#SalesforceSelectSource.process_batch-164"><span class="linenos">164</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
</span><span id="SalesforceSelectSource.process_batch-165"><a href="#SalesforceSelectSource.process_batch-165"><span class="linenos">165</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_id</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">)</span>
</span><span id="SalesforceSelectSource.process_batch-166"><a href="#SalesforceSelectSource.process_batch-166"><span class="linenos">166</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SalesforceSelectSource.process_batch-167"><a href="#SalesforceSelectSource.process_batch-167"><span class="linenos">167</span></a>                <span class="c1"># If we have a partial or empty batch, we are done paging.  Use current max.</span>
</span><span id="SalesforceSelectSource.process_batch-168"><a href="#SalesforceSelectSource.process_batch-168"><span class="linenos">168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SalesforceSelectSource.process_batch-169"><a href="#SalesforceSelectSource.process_batch-169"><span class="linenos">169</span></a>
</span><span id="SalesforceSelectSource.process_batch-170"><a href="#SalesforceSelectSource.process_batch-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_offset</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">max_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_field</span><span class="p">)</span>
</span><span id="SalesforceSelectSource.process_batch-171"><a href="#SalesforceSelectSource.process_batch-171"><span class="linenos">171</span></a>
</span><span id="SalesforceSelectSource.process_batch-172"><a href="#SalesforceSelectSource.process_batch-172"><span class="linenos">172</span></a>        <span class="k">return</span> <span class="n">batch</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>cluo.core.stage.Stage</dt>
                                <dd id="SalesforceSelectSource.unique_name" class="variable">unique_name</dd>
                <dd id="SalesforceSelectSource.pipeline" class="variable">pipeline</dd>
                <dd id="SalesforceSelectSource.add_downstream" class="function">add_downstream</dd>
                <dd id="SalesforceSelectSource.add_upstream" class="function">add_upstream</dd>
                <dd id="SalesforceSelectSource.get_downstreams" class="function">get_downstreams</dd>
                <dd id="SalesforceSelectSource.channels" class="variable">channels</dd>
                <dd id="SalesforceSelectSource.get_channels" class="function">get_channels</dd>

            </div>
            <div><dt>cluo.utils.log.logging_mixin.LoggingMixin</dt>
                                <dd id="SalesforceSelectSource.log" class="variable">log</dd>
                <dd id="SalesforceSelectSource.reset_level" class="function">reset_level</dd>
                <dd id="SalesforceSelectSource.serialize" class="function">serialize</dd>

            </div>
            <div><dt>cluo.connections.salesforce_connection_mixin.SalesforceConnectionMixin</dt>
                                <dd id="SalesforceSelectSource.sf" class="variable">sf</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>